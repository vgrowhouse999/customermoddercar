
<!-- saved from url=(0109)https://8ad2b71b8f1f894209bd060e4707a0d3.perchance.org/virtualgrowhouse?__generatorLastEditTime=1725759373012 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="color-scheme" content="light dark"></head><body><div class="line-gutter-backdrop"></div><form autocomplete="off"><label class="line-wrap-control">Line wrap<input type="checkbox" aria-label="Line wrap"></label></form><table><tbody><tr><td class="line-number" value="1"></td><td class="line-content"><span class="html-doctype">&lt;!DOCTYPE html&gt;</span></td></tr><tr><td class="line-number" value="2"></td><td class="line-content"><span class="html-tag">&lt;html&gt;</span></td></tr><tr><td class="line-number" value="3"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4"></td><td class="line-content"><span class="html-tag">&lt;head&gt;</span></td></tr><tr><td class="line-number" value="5"></td><td class="line-content">  <span class="html-tag">&lt;title&gt;</span>Perchance<span class="html-tag">&lt;/title&gt;</span>   </td></tr><tr><td class="line-number" value="6"></td><td class="line-content">  <span class="html-tag">&lt;meta <span class="html-attribute-name">name</span>="<span class="html-attribute-value">viewport</span>" <span class="html-attribute-name">content</span>="<span class="html-attribute-value">width=device-width, initial-scale=1</span>"&gt;</span></td></tr><tr><td class="line-number" value="7"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="8"></td><td class="line-content">  <span class="html-tag">&lt;base <span class="html-attribute-name">href</span><!--<base href="https://perchance.org/">--><base href=".">="<a class="html-attribute-value html-resource-link" target="_blank" href="https://perchance.org/" rel="noreferrer noopener">https://perchance.org/</a>" <span class="html-attribute-name">target</span>="<span class="html-attribute-value">_parent</span>"/&gt;</span></td></tr><tr><td class="line-number" value="9"></td><td class="line-content">  <span class="html-tag">&lt;meta <span class="html-attribute-name">name</span>="<span class="html-attribute-value">referrer</span>" <span class="html-attribute-name">content</span>="<span class="html-attribute-value">no-referrer</span>"/&gt;</span> </td></tr><tr><td class="line-number" value="10"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="11"></td><td class="line-content">  <span class="html-comment">&lt;!-- page may not actually support dark mode, but we say it does until the user's code has loaded to prevent white flash in the case that it does --&gt;</span></td></tr><tr><td class="line-number" value="12"></td><td class="line-content">  <span class="html-tag">&lt;meta <span class="html-attribute-name">id</span>="<span class="html-attribute-value">colorSchemeMetaTagToPreventWhiteFlash75847</span>" <span class="html-attribute-name">name</span>="<span class="html-attribute-value">color-scheme</span>" <span class="html-attribute-name">content</span>="<span class="html-attribute-value">light dark</span>"/&gt;</span></td></tr><tr><td class="line-number" value="13"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="14"></td><td class="line-content">  <span class="html-tag">&lt;style&gt;</span></td></tr><tr><td class="line-number" value="15"></td><td class="line-content">/* NOTE: Changes marked with "CHANGE" */</td></tr><tr><td class="line-number" value="16"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="17"></td><td class="line-content">/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */</td></tr><tr><td class="line-number" value="18"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="19"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="20"></td><td class="line-content"> * 1. Set default font family to sans-serif.</td></tr><tr><td class="line-number" value="21"></td><td class="line-content"> * 2. Prevent iOS and IE text size adjust after device orientation change,</td></tr><tr><td class="line-number" value="22"></td><td class="line-content"> *    without disabling user zoom.</td></tr><tr><td class="line-number" value="23"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="24"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="25"></td><td class="line-content">html {</td></tr><tr><td class="line-number" value="26"></td><td class="line-content">  font-family: sans-serif; /* 1 */</td></tr><tr><td class="line-number" value="27"></td><td class="line-content">  -ms-text-size-adjust: 100%; /* 2 */</td></tr><tr><td class="line-number" value="28"></td><td class="line-content">  -webkit-text-size-adjust: 100%; /* 2 */</td></tr><tr><td class="line-number" value="29"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="30"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="31"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="32"></td><td class="line-content"> * Remove default margin.</td></tr><tr><td class="line-number" value="33"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="34"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="35"></td><td class="line-content">body {</td></tr><tr><td class="line-number" value="36"></td><td class="line-content">  margin: 0;</td></tr><tr><td class="line-number" value="37"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="38"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="39"></td><td class="line-content">/* HTML5 display definitions</td></tr><tr><td class="line-number" value="40"></td><td class="line-content">   ========================================================================== */</td></tr><tr><td class="line-number" value="41"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="42"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="43"></td><td class="line-content"> * Correct `block` display not defined for any HTML5 element in IE 8/9.</td></tr><tr><td class="line-number" value="44"></td><td class="line-content"> * Correct `block` display not defined for `details` or `summary` in IE 10/11</td></tr><tr><td class="line-number" value="45"></td><td class="line-content"> * and Firefox.</td></tr><tr><td class="line-number" value="46"></td><td class="line-content"> * Correct `block` display not defined for `main` in IE 11.</td></tr><tr><td class="line-number" value="47"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="48"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="49"></td><td class="line-content">article,</td></tr><tr><td class="line-number" value="50"></td><td class="line-content">aside,</td></tr><tr><td class="line-number" value="51"></td><td class="line-content">details,</td></tr><tr><td class="line-number" value="52"></td><td class="line-content">figcaption,</td></tr><tr><td class="line-number" value="53"></td><td class="line-content">figure,</td></tr><tr><td class="line-number" value="54"></td><td class="line-content">footer,</td></tr><tr><td class="line-number" value="55"></td><td class="line-content">header,</td></tr><tr><td class="line-number" value="56"></td><td class="line-content">hgroup,</td></tr><tr><td class="line-number" value="57"></td><td class="line-content">main,</td></tr><tr><td class="line-number" value="58"></td><td class="line-content">menu,</td></tr><tr><td class="line-number" value="59"></td><td class="line-content">nav,</td></tr><tr><td class="line-number" value="60"></td><td class="line-content">/* summary, CHANGE */</td></tr><tr><td class="line-number" value="61"></td><td class="line-content">section {</td></tr><tr><td class="line-number" value="62"></td><td class="line-content">  display: block;</td></tr><tr><td class="line-number" value="63"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="64"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="65"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="66"></td><td class="line-content"> * 1. Correct `inline-block` display not defined in IE 8/9.</td></tr><tr><td class="line-number" value="67"></td><td class="line-content"> * 2. Normalize vertical alignment of `progress` in Chrome, Firefox, and Opera.</td></tr><tr><td class="line-number" value="68"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="69"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="70"></td><td class="line-content">audio,</td></tr><tr><td class="line-number" value="71"></td><td class="line-content">canvas,</td></tr><tr><td class="line-number" value="72"></td><td class="line-content">progress,</td></tr><tr><td class="line-number" value="73"></td><td class="line-content">video {</td></tr><tr><td class="line-number" value="74"></td><td class="line-content">  display: inline-block; /* 1 */</td></tr><tr><td class="line-number" value="75"></td><td class="line-content">  vertical-align: baseline; /* 2 */</td></tr><tr><td class="line-number" value="76"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="77"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="78"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="79"></td><td class="line-content"> * Prevent modern browsers from displaying `audio` without controls.</td></tr><tr><td class="line-number" value="80"></td><td class="line-content"> * Remove excess height in iOS 5 devices.</td></tr><tr><td class="line-number" value="81"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="82"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="83"></td><td class="line-content">audio:not([controls]) {</td></tr><tr><td class="line-number" value="84"></td><td class="line-content">  display: none;</td></tr><tr><td class="line-number" value="85"></td><td class="line-content">  height: 0;</td></tr><tr><td class="line-number" value="86"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="87"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="88"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="89"></td><td class="line-content"> * Address `[hidden]` styling not present in IE 8/9/10.</td></tr><tr><td class="line-number" value="90"></td><td class="line-content"> * Hide the `template` element in IE 8/9/10/11, Safari, and Firefox &lt; 22.</td></tr><tr><td class="line-number" value="91"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="92"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="93"></td><td class="line-content">[hidden],</td></tr><tr><td class="line-number" value="94"></td><td class="line-content">template {</td></tr><tr><td class="line-number" value="95"></td><td class="line-content">  display: none;</td></tr><tr><td class="line-number" value="96"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="97"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="98"></td><td class="line-content">/* Links</td></tr><tr><td class="line-number" value="99"></td><td class="line-content">   ========================================================================== */</td></tr><tr><td class="line-number" value="100"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="101"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="102"></td><td class="line-content"> * Remove the gray background color from active links in IE 10.</td></tr><tr><td class="line-number" value="103"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="104"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="105"></td><td class="line-content">a {</td></tr><tr><td class="line-number" value="106"></td><td class="line-content">  background-color: transparent;</td></tr><tr><td class="line-number" value="107"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="108"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="109"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="110"></td><td class="line-content"> * Improve readability of focused elements when they are also in an</td></tr><tr><td class="line-number" value="111"></td><td class="line-content"> * active/hover state.</td></tr><tr><td class="line-number" value="112"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="113"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="114"></td><td class="line-content">a:active,</td></tr><tr><td class="line-number" value="115"></td><td class="line-content">a:hover {</td></tr><tr><td class="line-number" value="116"></td><td class="line-content">  outline: 0;</td></tr><tr><td class="line-number" value="117"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="118"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="119"></td><td class="line-content">/* Text-level semantics</td></tr><tr><td class="line-number" value="120"></td><td class="line-content">   ========================================================================== */</td></tr><tr><td class="line-number" value="121"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="122"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="123"></td><td class="line-content"> * Address styling not present in IE 8/9/10/11, Safari, and Chrome.</td></tr><tr><td class="line-number" value="124"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="125"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="126"></td><td class="line-content">abbr[title] {</td></tr><tr><td class="line-number" value="127"></td><td class="line-content">  border-bottom: 1px dotted;</td></tr><tr><td class="line-number" value="128"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="129"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="130"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="131"></td><td class="line-content"> * Address style set to `bolder` in Firefox 4+, Safari, and Chrome.</td></tr><tr><td class="line-number" value="132"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="133"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="134"></td><td class="line-content">b,</td></tr><tr><td class="line-number" value="135"></td><td class="line-content">strong {</td></tr><tr><td class="line-number" value="136"></td><td class="line-content">  font-weight: bold;</td></tr><tr><td class="line-number" value="137"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="138"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="139"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="140"></td><td class="line-content"> * Address styling not present in Safari and Chrome.</td></tr><tr><td class="line-number" value="141"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="142"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="143"></td><td class="line-content">dfn {</td></tr><tr><td class="line-number" value="144"></td><td class="line-content">  font-style: italic;</td></tr><tr><td class="line-number" value="145"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="146"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="147"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="148"></td><td class="line-content"> * Address variable `h1` font-size and margin within `section` and `article`</td></tr><tr><td class="line-number" value="149"></td><td class="line-content"> * contexts in Firefox 4+, Safari, and Chrome.</td></tr><tr><td class="line-number" value="150"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="151"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="152"></td><td class="line-content">h1 {</td></tr><tr><td class="line-number" value="153"></td><td class="line-content">  font-size: 2em;</td></tr><tr><td class="line-number" value="154"></td><td class="line-content">  margin: 0.67em 0;</td></tr><tr><td class="line-number" value="155"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="156"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="157"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="158"></td><td class="line-content"> * Address styling not present in IE 8/9.</td></tr><tr><td class="line-number" value="159"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="160"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="161"></td><td class="line-content">mark {</td></tr><tr><td class="line-number" value="162"></td><td class="line-content">  background: #ff0;</td></tr><tr><td class="line-number" value="163"></td><td class="line-content">  color: #000;</td></tr><tr><td class="line-number" value="164"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="165"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="166"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="167"></td><td class="line-content"> * Address inconsistent and variable font size in all browsers.</td></tr><tr><td class="line-number" value="168"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="169"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="170"></td><td class="line-content">small {</td></tr><tr><td class="line-number" value="171"></td><td class="line-content">  font-size: 80%;</td></tr><tr><td class="line-number" value="172"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="173"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="174"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="175"></td><td class="line-content"> * Prevent `sub` and `sup` affecting `line-height` in all browsers.</td></tr><tr><td class="line-number" value="176"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="177"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="178"></td><td class="line-content">sub,</td></tr><tr><td class="line-number" value="179"></td><td class="line-content">sup {</td></tr><tr><td class="line-number" value="180"></td><td class="line-content">  font-size: 75%;</td></tr><tr><td class="line-number" value="181"></td><td class="line-content">  line-height: 0;</td></tr><tr><td class="line-number" value="182"></td><td class="line-content">  position: relative;</td></tr><tr><td class="line-number" value="183"></td><td class="line-content">  vertical-align: baseline;</td></tr><tr><td class="line-number" value="184"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="185"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="186"></td><td class="line-content">sup {</td></tr><tr><td class="line-number" value="187"></td><td class="line-content">  top: -0.5em;</td></tr><tr><td class="line-number" value="188"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="189"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="190"></td><td class="line-content">sub {</td></tr><tr><td class="line-number" value="191"></td><td class="line-content">  bottom: -0.25em;</td></tr><tr><td class="line-number" value="192"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="193"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="194"></td><td class="line-content">/* Embedded content</td></tr><tr><td class="line-number" value="195"></td><td class="line-content">   ========================================================================== */</td></tr><tr><td class="line-number" value="196"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="197"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="198"></td><td class="line-content"> * Remove border when inside `a` element in IE 8/9/10.</td></tr><tr><td class="line-number" value="199"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="200"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="201"></td><td class="line-content">img {</td></tr><tr><td class="line-number" value="202"></td><td class="line-content">  border: 0;</td></tr><tr><td class="line-number" value="203"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="204"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="205"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="206"></td><td class="line-content"> * Correct overflow not hidden in IE 9/10/11.</td></tr><tr><td class="line-number" value="207"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="208"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="209"></td><td class="line-content">svg:not(:root) {</td></tr><tr><td class="line-number" value="210"></td><td class="line-content">  overflow: hidden;</td></tr><tr><td class="line-number" value="211"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="212"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="213"></td><td class="line-content">/* Grouping content</td></tr><tr><td class="line-number" value="214"></td><td class="line-content">   ========================================================================== */</td></tr><tr><td class="line-number" value="215"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="216"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="217"></td><td class="line-content"> * Address margin not present in IE 8/9 and Safari.</td></tr><tr><td class="line-number" value="218"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="219"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="220"></td><td class="line-content">figure {</td></tr><tr><td class="line-number" value="221"></td><td class="line-content">  margin: 1em 40px;</td></tr><tr><td class="line-number" value="222"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="223"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="224"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="225"></td><td class="line-content"> * Address differences between Firefox and other browsers.</td></tr><tr><td class="line-number" value="226"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="227"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="228"></td><td class="line-content">hr {</td></tr><tr><td class="line-number" value="229"></td><td class="line-content">  box-sizing: content-box;</td></tr><tr><td class="line-number" value="230"></td><td class="line-content">  height: 0;</td></tr><tr><td class="line-number" value="231"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="232"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="233"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="234"></td><td class="line-content"> * Contain overflow in all browsers.</td></tr><tr><td class="line-number" value="235"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="236"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="237"></td><td class="line-content">pre {</td></tr><tr><td class="line-number" value="238"></td><td class="line-content">  overflow: auto;</td></tr><tr><td class="line-number" value="239"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="240"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="241"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="242"></td><td class="line-content"> * Address odd `em`-unit font size rendering in all browsers.</td></tr><tr><td class="line-number" value="243"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="244"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="245"></td><td class="line-content">code,</td></tr><tr><td class="line-number" value="246"></td><td class="line-content">kbd,</td></tr><tr><td class="line-number" value="247"></td><td class="line-content">pre,</td></tr><tr><td class="line-number" value="248"></td><td class="line-content">samp {</td></tr><tr><td class="line-number" value="249"></td><td class="line-content">  font-family: monospace, monospace;</td></tr><tr><td class="line-number" value="250"></td><td class="line-content">  font-size: 1em;</td></tr><tr><td class="line-number" value="251"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="252"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="253"></td><td class="line-content">/* Forms</td></tr><tr><td class="line-number" value="254"></td><td class="line-content">   ========================================================================== */</td></tr><tr><td class="line-number" value="255"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="256"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="257"></td><td class="line-content"> * Known limitation: by default, Chrome and Safari on OS X allow very limited</td></tr><tr><td class="line-number" value="258"></td><td class="line-content"> * styling of `select`, unless a `border` property is set.</td></tr><tr><td class="line-number" value="259"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="260"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="261"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="262"></td><td class="line-content"> * 1. Correct color not being inherited.</td></tr><tr><td class="line-number" value="263"></td><td class="line-content"> * 2. Correct font properties not being inherited.</td></tr><tr><td class="line-number" value="264"></td><td class="line-content"> * 3. Address margins set differently in Firefox 4+, Safari, and Chrome.</td></tr><tr><td class="line-number" value="265"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="266"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="267"></td><td class="line-content">button:not([disabled]), input:not([disabled]), optgroup:not([disabled]), select:not([disabled]), textarea:not([disabled]) {</td></tr><tr><td class="line-number" value="268"></td><td class="line-content">  color: inherit;</td></tr><tr><td class="line-number" value="269"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="270"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="271"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="272"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="273"></td><td class="line-content">button,</td></tr><tr><td class="line-number" value="274"></td><td class="line-content">input,</td></tr><tr><td class="line-number" value="275"></td><td class="line-content">optgroup,</td></tr><tr><td class="line-number" value="276"></td><td class="line-content">select,</td></tr><tr><td class="line-number" value="277"></td><td class="line-content">textarea {</td></tr><tr><td class="line-number" value="278"></td><td class="line-content">  font: inherit; /* 2 */</td></tr><tr><td class="line-number" value="279"></td><td class="line-content">  margin: 0; /* 3 */</td></tr><tr><td class="line-number" value="280"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="281"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="282"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="283"></td><td class="line-content"> * Address `overflow` set to `hidden` in IE 8/9/10/11.</td></tr><tr><td class="line-number" value="284"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="285"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="286"></td><td class="line-content">button {</td></tr><tr><td class="line-number" value="287"></td><td class="line-content">  overflow: visible;</td></tr><tr><td class="line-number" value="288"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="289"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="290"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="291"></td><td class="line-content"> * Address inconsistent `text-transform` inheritance for `button` and `select`.</td></tr><tr><td class="line-number" value="292"></td><td class="line-content"> * All other form control elements do not inherit `text-transform` values.</td></tr><tr><td class="line-number" value="293"></td><td class="line-content"> * Correct `button` style inheritance in Firefox, IE 8/9/10/11, and Opera.</td></tr><tr><td class="line-number" value="294"></td><td class="line-content"> * Correct `select` style inheritance in Firefox.</td></tr><tr><td class="line-number" value="295"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="296"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="297"></td><td class="line-content">button,</td></tr><tr><td class="line-number" value="298"></td><td class="line-content">select {</td></tr><tr><td class="line-number" value="299"></td><td class="line-content">  text-transform: none;</td></tr><tr><td class="line-number" value="300"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="301"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="302"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="303"></td><td class="line-content"> * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`</td></tr><tr><td class="line-number" value="304"></td><td class="line-content"> *    and `video` controls.</td></tr><tr><td class="line-number" value="305"></td><td class="line-content"> * 2. Correct inability to style clickable `input` types in iOS.</td></tr><tr><td class="line-number" value="306"></td><td class="line-content"> * 3. Improve usability and consistency of cursor style between image-type</td></tr><tr><td class="line-number" value="307"></td><td class="line-content"> *    `input` and others.</td></tr><tr><td class="line-number" value="308"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="309"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="310"></td><td class="line-content">button,</td></tr><tr><td class="line-number" value="311"></td><td class="line-content">html input[type="button"], /* 1 */</td></tr><tr><td class="line-number" value="312"></td><td class="line-content">input[type="reset"],</td></tr><tr><td class="line-number" value="313"></td><td class="line-content">input[type="submit"] {</td></tr><tr><td class="line-number" value="314"></td><td class="line-content">  -webkit-appearance: button; /* 2 */</td></tr><tr><td class="line-number" value="315"></td><td class="line-content">  cursor: pointer; /* 3 */</td></tr><tr><td class="line-number" value="316"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="317"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="318"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="319"></td><td class="line-content"> * Re-set default cursor for disabled elements.</td></tr><tr><td class="line-number" value="320"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="321"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="322"></td><td class="line-content">button[disabled],</td></tr><tr><td class="line-number" value="323"></td><td class="line-content">html input[disabled] {</td></tr><tr><td class="line-number" value="324"></td><td class="line-content">  cursor: default;</td></tr><tr><td class="line-number" value="325"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="326"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="327"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="328"></td><td class="line-content"> * Remove inner padding and border in Firefox 4+.</td></tr><tr><td class="line-number" value="329"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="330"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="331"></td><td class="line-content">button::-moz-focus-inner,</td></tr><tr><td class="line-number" value="332"></td><td class="line-content">input::-moz-focus-inner {</td></tr><tr><td class="line-number" value="333"></td><td class="line-content">  border: 0;</td></tr><tr><td class="line-number" value="334"></td><td class="line-content">  padding: 0;</td></tr><tr><td class="line-number" value="335"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="336"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="337"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="338"></td><td class="line-content"> * Address Firefox 4+ setting `line-height` on `input` using `!important` in</td></tr><tr><td class="line-number" value="339"></td><td class="line-content"> * the UA stylesheet.</td></tr><tr><td class="line-number" value="340"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="341"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="342"></td><td class="line-content">input {</td></tr><tr><td class="line-number" value="343"></td><td class="line-content">  line-height: normal;</td></tr><tr><td class="line-number" value="344"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="345"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="346"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="347"></td><td class="line-content"> * It's recommended that you don't attempt to style these elements.</td></tr><tr><td class="line-number" value="348"></td><td class="line-content"> * Firefox's implementation doesn't respect box-sizing, padding, or width.</td></tr><tr><td class="line-number" value="349"></td><td class="line-content"> *</td></tr><tr><td class="line-number" value="350"></td><td class="line-content"> * 1. Address box sizing set to `content-box` in IE 8/9/10.</td></tr><tr><td class="line-number" value="351"></td><td class="line-content"> * 2. Remove excess padding in IE 8/9/10.</td></tr><tr><td class="line-number" value="352"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="353"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="354"></td><td class="line-content">input[type="checkbox"],</td></tr><tr><td class="line-number" value="355"></td><td class="line-content">input[type="radio"] {</td></tr><tr><td class="line-number" value="356"></td><td class="line-content">  box-sizing: border-box; /* 1 */</td></tr><tr><td class="line-number" value="357"></td><td class="line-content">  padding: 0; /* 2 */</td></tr><tr><td class="line-number" value="358"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="359"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="360"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="361"></td><td class="line-content"> * Fix the cursor style for Chrome's increment/decrement buttons. For certain</td></tr><tr><td class="line-number" value="362"></td><td class="line-content"> * `font-size` values of the `input`, it causes the cursor style of the</td></tr><tr><td class="line-number" value="363"></td><td class="line-content"> * decrement button to change from `default` to `text`.</td></tr><tr><td class="line-number" value="364"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="365"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="366"></td><td class="line-content">input[type="number"]::-webkit-inner-spin-button,</td></tr><tr><td class="line-number" value="367"></td><td class="line-content">input[type="number"]::-webkit-outer-spin-button {</td></tr><tr><td class="line-number" value="368"></td><td class="line-content">  height: auto;</td></tr><tr><td class="line-number" value="369"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="370"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="371"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="372"></td><td class="line-content"> * 1. Address `appearance` set to `searchfield` in Safari and Chrome.</td></tr><tr><td class="line-number" value="373"></td><td class="line-content"> * 2. Address `box-sizing` set to `border-box` in Safari and Chrome.</td></tr><tr><td class="line-number" value="374"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="375"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="376"></td><td class="line-content">input[type="search"] {</td></tr><tr><td class="line-number" value="377"></td><td class="line-content">  -webkit-appearance: textfield; /* 1 */</td></tr><tr><td class="line-number" value="378"></td><td class="line-content">  box-sizing: content-box; /* 2 */</td></tr><tr><td class="line-number" value="379"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="380"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="381"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="382"></td><td class="line-content"> * Remove inner padding and search cancel button in Safari and Chrome on OS X.</td></tr><tr><td class="line-number" value="383"></td><td class="line-content"> * Safari (but not Chrome) clips the cancel button when the search input has</td></tr><tr><td class="line-number" value="384"></td><td class="line-content"> * padding (and `textfield` appearance).</td></tr><tr><td class="line-number" value="385"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="386"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="387"></td><td class="line-content">input[type="search"]::-webkit-search-cancel-button,</td></tr><tr><td class="line-number" value="388"></td><td class="line-content">input[type="search"]::-webkit-search-decoration {</td></tr><tr><td class="line-number" value="389"></td><td class="line-content">  -webkit-appearance: none;</td></tr><tr><td class="line-number" value="390"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="391"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="392"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="393"></td><td class="line-content"> * Define consistent border, margin, and padding.</td></tr><tr><td class="line-number" value="394"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="395"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="396"></td><td class="line-content">fieldset {</td></tr><tr><td class="line-number" value="397"></td><td class="line-content">  border: 1px solid #c0c0c0;</td></tr><tr><td class="line-number" value="398"></td><td class="line-content">  margin: 0 2px;</td></tr><tr><td class="line-number" value="399"></td><td class="line-content">  padding: 0.35em 0.625em 0.75em;</td></tr><tr><td class="line-number" value="400"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="401"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="402"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="403"></td><td class="line-content"> * 1. Correct `color` not being inherited in IE 8/9/10/11.</td></tr><tr><td class="line-number" value="404"></td><td class="line-content"> * 2. Remove padding so people aren't caught out if they zero out fieldsets.</td></tr><tr><td class="line-number" value="405"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="406"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="407"></td><td class="line-content">legend {</td></tr><tr><td class="line-number" value="408"></td><td class="line-content">  border: 0; /* 1 */</td></tr><tr><td class="line-number" value="409"></td><td class="line-content">  padding: 0; /* 2 */</td></tr><tr><td class="line-number" value="410"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="411"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="412"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="413"></td><td class="line-content"> * Remove default vertical scrollbar in IE 8/9/10/11.</td></tr><tr><td class="line-number" value="414"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="415"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="416"></td><td class="line-content">textarea {</td></tr><tr><td class="line-number" value="417"></td><td class="line-content">  overflow: auto;</td></tr><tr><td class="line-number" value="418"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="419"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="420"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="421"></td><td class="line-content"> * Don't inherit the `font-weight` (applied by a rule above).</td></tr><tr><td class="line-number" value="422"></td><td class="line-content"> * NOTE: the default cannot safely be changed in Chrome and Safari on OS X.</td></tr><tr><td class="line-number" value="423"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="424"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="425"></td><td class="line-content">optgroup {</td></tr><tr><td class="line-number" value="426"></td><td class="line-content">  font-weight: bold;</td></tr><tr><td class="line-number" value="427"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="428"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="429"></td><td class="line-content">/* Tables</td></tr><tr><td class="line-number" value="430"></td><td class="line-content">   ========================================================================== */</td></tr><tr><td class="line-number" value="431"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="432"></td><td class="line-content">/**</td></tr><tr><td class="line-number" value="433"></td><td class="line-content"> * Remove most spacing between table cells.</td></tr><tr><td class="line-number" value="434"></td><td class="line-content"> */</td></tr><tr><td class="line-number" value="435"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="436"></td><td class="line-content">table {</td></tr><tr><td class="line-number" value="437"></td><td class="line-content">  border-collapse: collapse;</td></tr><tr><td class="line-number" value="438"></td><td class="line-content">  border-spacing: 0;</td></tr><tr><td class="line-number" value="439"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="440"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="441"></td><td class="line-content">td,</td></tr><tr><td class="line-number" value="442"></td><td class="line-content">th {</td></tr><tr><td class="line-number" value="443"></td><td class="line-content">  padding: 0;</td></tr><tr><td class="line-number" value="444"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="445"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="446"></td><td class="line-content"><span class="html-tag">&lt;/style&gt;</span></td></tr><tr><td class="line-number" value="447"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="448"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span>try{window.localStorage.testIfWeCanReadLocalStorageWithoutDOMError}catch(err){console.debug("localStorage is disallowed. Adding a 'dummy' polyfill.");Object.defineProperty(window,"localStorage",{value:new Proxy({},{set:(t,k,v)=&gt;t[k]=String(v)})})}<span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="449"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="450"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="451"></td><td class="line-content">    let __localToken = "NOT_LOCAL_hfi2395tydn917r4bdn0174gns"; // downloader changes this to "LOCAL"</td></tr><tr><td class="line-number" value="452"></td><td class="line-content">    function __inIframe () {</td></tr><tr><td class="line-number" value="453"></td><td class="line-content">      try {</td></tr><tr><td class="line-number" value="454"></td><td class="line-content">        return window.self !== window.top;</td></tr><tr><td class="line-number" value="455"></td><td class="line-content">      } catch (e) {</td></tr><tr><td class="line-number" value="456"></td><td class="line-content">        return true;</td></tr><tr><td class="line-number" value="457"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="458"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="459"></td><td class="line-content">    // to prevent *direct* null.perchance.org / &lt;publicId&gt;.perchance.org access (but let it run however if it's a local copy):</td></tr><tr><td class="line-number" value="460"></td><td class="line-content">    if(!__inIframe() &amp;&amp; __localToken !== "LOCAL"){window.location.href="https://perchance.org/virtualgrowhouse";} // not to self: don't change this without changing generator downloader script</td></tr><tr><td class="line-number" value="461"></td><td class="line-content">  <span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="462"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="463"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="464"></td><td class="line-content">    // POLYFILLS:</td></tr><tr><td class="line-number" value="465"></td><td class="line-content">    if(!Array.prototype.at) { // For Safari 14 </td></tr><tr><td class="line-number" value="466"></td><td class="line-content">      Array.prototype.at = function(relativeIndex) {</td></tr><tr><td class="line-number" value="467"></td><td class="line-content">        let i = relativeIndex &gt;= 0 ? relativeIndex : this.length + relativeIndex;</td></tr><tr><td class="line-number" value="468"></td><td class="line-content">        return this[i];</td></tr><tr><td class="line-number" value="469"></td><td class="line-content">      };</td></tr><tr><td class="line-number" value="470"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="471"></td><td class="line-content">  <span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="472"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="473"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="474"></td><td class="line-content">    window.addEventListener("load", function() {</td></tr><tr><td class="line-number" value="475"></td><td class="line-content">      window.__windowOnLoadAlreadyFired = true;</td></tr><tr><td class="line-number" value="476"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="477"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="478"></td><td class="line-content">    if(window.location.hash.includes("with_export_debug83748")) {</td></tr><tr><td class="line-number" value="479"></td><td class="line-content">      window.__withExportDebug83748 = true;</td></tr><tr><td class="line-number" value="480"></td><td class="line-content">      console.log("WARNING: this with_export_debug83748 approach is incorrect in __evaluateSquareBlock - it should return undefined for [doesNotExist] but instead gives a ReferenceError. But bigger problem is it doesn't solve this: https://lemmy.world/post/18957816 due to function hoisting from block scope causing to to effectively be like var declaration");</td></tr><tr><td class="line-number" value="481"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="482"></td><td class="line-content">    window.__ignorePerchanceErrors = false;</td></tr><tr><td class="line-number" value="483"></td><td class="line-content">    window.generatorName = "virtualgrowhouse";</td></tr><tr><td class="line-number" value="484"></td><td class="line-content">    window.generatorPublicId = "8ad2b71b8f1f894209bd060e4707a0d3";</td></tr><tr><td class="line-number" value="485"></td><td class="line-content">    window.generatorLastEditTime = Number("1725759373012");</td></tr><tr><td class="line-number" value="486"></td><td class="line-content">    window.__parentWindow = window.parent; // since user could override `window.parent` which would break stuff</td></tr><tr><td class="line-number" value="487"></td><td class="line-content">  <span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="488"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="489"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="490"></td><td class="line-content">  <span class="html-tag">&lt;style&gt;</span></td></tr><tr><td class="line-number" value="491"></td><td class="line-content">    html {</td></tr><tr><td class="line-number" value="492"></td><td class="line-content">      margin:0;</td></tr><tr><td class="line-number" value="493"></td><td class="line-content">      padding:0;</td></tr><tr><td class="line-number" value="494"></td><td class="line-content">      width:100%;</td></tr><tr><td class="line-number" value="495"></td><td class="line-content">      height:100%;</td></tr><tr><td class="line-number" value="496"></td><td class="line-content">      box-sizing: border-box;</td></tr><tr><td class="line-number" value="497"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="498"></td><td class="line-content">    *, *:before, *:after {</td></tr><tr><td class="line-number" value="499"></td><td class="line-content">      box-sizing: inherit;</td></tr><tr><td class="line-number" value="500"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="501"></td><td class="line-content">    body {</td></tr><tr><td class="line-number" value="502"></td><td class="line-content">      margin:0;</td></tr><tr><td class="line-number" value="503"></td><td class="line-content">      padding:0;</td></tr><tr><td class="line-number" value="504"></td><td class="line-content">      text-align:center;</td></tr><tr><td class="line-number" value="505"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="506"></td><td class="line-content">    hidden {</td></tr><tr><td class="line-number" value="507"></td><td class="line-content">      position:fixed;</td></tr><tr><td class="line-number" value="508"></td><td class="line-content">      top:-14000px;</td></tr><tr><td class="line-number" value="509"></td><td class="line-content">      left:-14000px;</td></tr><tr><td class="line-number" value="510"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="511"></td><td class="line-content">    body ul {</td></tr><tr><td class="line-number" value="512"></td><td class="line-content">      text-align:left;</td></tr><tr><td class="line-number" value="513"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="514"></td><td class="line-content">  <span class="html-tag">&lt;/style&gt;</span></td></tr><tr><td class="line-number" value="515"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="516"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="517"></td><td class="line-content">  <span class="html-comment">&lt;!-- PRELOADED DATA --&gt;</span></td></tr><tr><td class="line-number" value="518"></td><td class="line-content">  <span class="html-tag">&lt;script <span class="html-attribute-name">id</span>="<span class="html-attribute-value">preloaded-generator-data</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">notjs</span>"&gt;</span>%7B%22name%22:%22virtualgrowhouse%22,%22modelText%22:%22layoutMaker%20=%20%7Bimport:layout-maker-plugin%7D%5Cn%5Cn%5Cn//%20This%20generator%20uses%20two%20different%20layouts%20and%20checks%20the%20width%20of%20the%20browser%20window%20with%20%5C%22window.innerWidth%5C%22%20(see%20HTML%20panel)%20to%20decide%20which%20layout%20to%20use.%5Cn%5Cn//Sources:%20https://en.wikipedia.org/wiki/List_of_colors:_A%25E2%2580%2593F%20for%20colors%5CnLL%5Cn%5Cn%5Cnartstyle%5Cn%20%20Synthwave%20%20%5Cn%20%20Outrun%20%20%5Cn%20%20Cyberpunk%20%20%5Cn%20%20Dreampunk%20%20%5Cn%20%20Seapunk%20%20%5Cn%20%20Retrofuturism%20%20%5Cn%20%20Lo-fi%20Aesthetic%20%5Cn%20%20Glitch%20Art%20%20%5Cn%20%20Futurism%20%20%5Cn%20%20Y2K%20Aesthetic%20%20%5Cn%20%20Mallwave%20%20%5Cn%20%20Hyperpop%20%20%5Cn%20%20Hauntology%20%20%5Cn%20%20New%20Aesthetic%20%20%5Cn%20%20Memphis%20Design%20%20%5Cn%20%20Vaporgoth%20%20%5Cn%20%20Indie%20Sleaze%20%20%5Cn%20%20Arcadecore%20%20%5Cn%20%20Webcore%20%20%5Cn%20%20Dreamcore%20%20%5Cn%20%20Nostalgiccore%20%20%5Cn%20%20Tech%20Noir%20%20%5Cn%20%20Grunge%20Aesthetic%20%20%5Cn%20%20Bubblegum%20Pop%20%20%5Cn%20%20Pixel%20Art%20%20%5Cn%20%20Aesthetic%20Anime%20%20%5Cn%20%20Internet%20Art%20%20%5Cn%20%20Decopunk%20%20%5Cn%20%20Sovietwave%20%20%5Cn%20%20Weirdcore%20%20%5Cn%20%20Post-Internet%20Art%20%20%5Cn%20%20Gothic%20Revival%20%20%5Cn%20%20Bio-Punk%20%20%5Cn%20%20Space%20Age%20%20%5Cn%20%20Surrealism%20%20%5Cn%20%20Postmodernism%20%20%5Cn%20%20Maximalism%20%20%5Cn%20%20Minimalism%20%20%5Cn%20%20Retro%20Futurism%20%5Cn%20%20Hacker%20Culture%20%5Cn%20%20Digital%20Art%20%20%5Cn%20%20Augmented%20Reality%20Art%20%20%5Cn%20%20AI%20Art%20%20%5Cn%20%20Algorithmic%20Art%20%20%5Cn%20%20Modernism%20%20%5Cn%20%20Art%20Deco%20%20%5Cn%20%20Abstract%20Expressionism%20%20%5Cn%20%20Cubism%20%20%5Cn%20%20Dadaism%20%20%5Cn%20%20Neo-Expressionism%20%20%5Cn%20%20Street%20Art%20%20%5Cn%20%20Graffiti%20Art%20%20%5Cn%20%20Visual%20Kei%20%20%5Cn%20%20Anime%20Aesthetic%20%5Cn%20%20Utopian%20Art%20%20%5Cn%20%20Dystopian%20Art%20%20%5Cn%20%20Retro%20Art%20%20%5Cn%20%20Psychedelic%20Art%5Cn%20%20Art%20Brut%20%20%5Cn%20%20Folk%20Art%20%20%5Cn%20%20Avant-Garde%20%20%5Cn%20%20Kitsch%20%20%5Cn%20%20Bauhaus%20%20%5Cn%20%20Pop%20Art%20%20%5Cn%20%20Conceptual%20Art%20%20%5Cn%20%20Fauvism%20%20%5Cn%20%20Op%20Art%20%20%5Cn%20%20Transgressive%20Art%20%20%5Cn%20%20Narrative%20Art%20%20%5Cn%20%20Ethereal%20Art%20%20%5Cn%20%20Metaphysical%20Art%20%20%5Cn%20%20Lofi%20Hip%20Hop%20%20%5Cn%20%20Technoir%20%20%5Cn%20%20Neo-Pop%20Art%20%20%5Cn%20%20Realisme%20%20%5Cn%20%20Eclipse%20Art%20%20%5Cn%20%20Transhuman%20Art%20%20%5Cn%20%20Punk%20Art%20%20%5Cn%20%20Contemporary%20Art%20%20%5Cn%20%20Bricolage%20%20%5Cn%20%20Cyborg%20Art%20%20%5Cn%20%20Holistic%20Art%20%20%5Cn%20%20Intermedia%20Art%20%20%5Cn%20%20Relational%20Art%20%20%5Cn%20%20Collage%20Art%20%20%5Cn%20%20Tactile%20Art%20%20%5Cn%20%20Social%20Practice%20Art%20%20%5Cn%20%20Performance%20Art%20%20%5Cn%20%20Land%20Art%20%20%5Cn%20%20Eco%20Art%20%20%5Cn%20%20Visual%20Poetry%20%20%5Cn%20%20Kinetic%20Art%5Cn%5Cncar%5Cn%20%20Patrol%5Cn%20%20Skyline%5Cn%20%20Altima%5Cn%20%20R90C%5Cn%20%20Silvia%5Cn%20%20200SX%5Cn%20%20Micra%5Cn%20%20Pulsar%5Cn%20%20300z%5Cn%20%20Skyline%20GT-R%5Cn%20%20GT-R%5Cn%20%20180SX%5Cn%20%20Qashqai%5Cn%20%20Gloria%5Cn%20%20Navara%5Cn%20%20Xterra%5Cn%20%20Sunny%5Cn%20%20Cefiro%5Cn%20%20Caravan%5Cn%20%20Tesla%20Model%20Y%5Cn%20%20Tesla%20Model%203%5Cn%20%20Wuling%20Hongguang%20Mini%20EV%5Cn%20%20Nissan%20Leaf%5Cn%20%20BYD%20Yuan%20Plus%20/%20Atto%203%5Cn%20%20BYD%20Dolphin%5Cn%20%20Aion%20S%5Cn%20%20BYD%20Qin%20EV%5Cn%20%20Renault%20Zoe%5Cn%20%20Volkswagen%20ID.4%5Cn%20%20Aion%20Y%5Cn%20%20BYD%20Han%20EV%5Cn%20%20Tesla%20Model%20S%5Cn%20%20Chery%20eQ1%5Cn%20%20Chevy%20Malibu%5Cn%20%20Chevrolet%20Silverado%201500%5Cn%20%202023%20Chevrolet%20Corvette%5Cn%20%20Chevy%20Equinox%5Cn%20%20Chevy%20Traverse%5Cn%20%202024%20Chevrolet%20Equinox%20EV%5Cn%20%202024%20Chevrolet%20Corvette%5Cn%20%20Chevy%20Camaro%5Cn%20%20Chevy%20Colorado%5Cn%20%20Chevy%20Trax%5Cn%20%202024%20Blazer%20EV%5Cn%20%202024%20Chevrolet%20Traverse%5Cn%20%202024%20Silverado%20EV%5Cn%20%202024%20Trailblazer%5Cn%20%20Bolt%20EV%5Cn%20%20Chevy%20Tahoe%5Cn%20%202024%20Chevrolet%20Silverado%201500%5Cn%20%20Chevy%20Blazer%5Cn%20%20Chevy%20Suburban%5Cn%20%20Chevrolet%20Silverado%202500HD%5Cn%20%202020%20Chevrolet%20Spark%5Cn%20%20Trailblazer%5Cn%20%202024%20Trax%5Cn%20%202023%20Chevrolet%20Silverado%201500%5Cn%5Cn%5Cn%20%20%5Cncolor%5Cn%20%20Absolute%20Zero%5Cn%20%20Acid%20green%5Cn%20%20Aero%5Cn%20%20Air%20superiority%20blue%5Cn%20%20Alice%20blue%5Cn%20%20Alizarin%5Cn%20%20Alloy%20orange%5Cn%20%20Amaranth%20deep%20purple%5Cn%20%20Amaranth%20pink%5Cn%20%20Amaranth%20purple%5Cn%20%20Amber%5Cn%20%20Android%20green%5Cn%20%20Antique%20brass%5Cn%20%20Antique%20fuchsia%5Cn%20%20Antique%20ruby%5Cn%20%20Antique%20white%5Cn%20%20Apricot%5Cn%20%20Aqua%5Cn%20%20Aquamarine%5Cn%20%20Arctic%20lime%5Cn%20%20Artichoke%20green%5Cn%20%20Arylide%20yellow%5Cn%20%20Ash%20gray%5Cn%20%20Atomic%20tangerine%5Cn%20%20Aureolin%5Cn%20%20Azure%5Cn%20%20Baby%20blue%5Cn%20%20Baby%20blue%20eyes%5Cn%20%20Baby%20pink%5Cn%20%20Baby%20powder%5Cn%20%20Banana%20Mania%5Cn%20%20Barn%20red%5Cn%20%20Beau%20blue%5Cn%20%20Beaver%5Cn%20%20Beige%5Cn%20%20B'dazzled%20blue%5Cn%20%20Big%20dip%20o%E2%80%99ruby%5Cn%20%20Bisque%5Cn%20%20Bistre%5Cn%20%20Bistre%20brown%5Cn%20%20Bitter%20lemon%5Cn%20%20Black%5Cn%20%20Black%20bean%5Cn%20%20Black%20coral%5Cn%20%20Black%20olive%5Cn%20%20Black%20Shadows%5Cn%20%20Blanched%20almond%5Cn%20%20Blast-off%20bronze%5Cn%20%20Bleu%20de%20France%5Cn%20%20Blizzard%20blue%5Cn%20%20Blood%20red%5Cn%20%20Blue%5Cn%20%20Blue%20(Crayola)%5Cn%20%20Blue%20(Munsell)%5Cn%20%20Blue%20(NCS)%5Cn%20%20Blue%20(Pantone)%5Cn%20%20Blue%20(pigment)%5Cn%20%20Blue%20bell%5Cn%20%20Blue-gray%5Cn%20%20Blue%20jeans%5Cn%20%20Blue%20sapphire%5Cn%20%20Blue-violet%5Cn%20%20Blue%20yonder%5Cn%20%20Bluetiful%5Cn%20%20Blush%5Cn%20%20Bole%5Cn%20%20Bone%5Cn%20%20Brick%20red%5Cn%20%20Bright%20lilac%5Cn%20%20Bright%20yellow%20(Crayola)%5Cn%20%20British%20racing%20green%5Cn%20%20Bronze%5Cn%20%20Brown%5Cn%20%20Brown%20sugar%5Cn%20%20Bud%20green%5Cn%20%20Buff%5Cn%20%20Burgundy%5Cn%20%20Burlywood%5Cn%20%20Burnished%20brown%5Cn%20%20Burnt%20orange%5Cn%20%20Byzantine%5Cn%20%20Byzantium%5Cn%20%20Cadet%20blue%5Cn%20%20Cadet%20grey%5Cn%20%20Cadmium%20green%5Cn%20%20Cadmium%20orange%5Cn%20%20Caf%C3%A9%20au%20lait%5Cn%20%20Caf%C3%A9%20noir%5Cn%20%20Cambridge%20blue%5Cn%20%20Camel%5Cn%20%20Cameo%20pink%5Cn%20%20Canary%5Cn%20%20Canary%20yellow%5Cn%20%20Candy%20pink%5Cn%20%20Cardinal%5Cn%20%20Caribbean%20green%5Cn%20%20Carmine%5Cn%20%20Carmine%20(M&amp;P)%5Cn%20%20Carnelian%5Cn%20%20Carolina%20blue%5Cn%20%20Carrot%20orange%5Cn%20%20Catawba%5Cn%20%20Cedar%20Chest%5Cn%20%20Celadon%5Cn%20%20Celeste%5Cn%20%20Cerise%5Cn%20%20Cerulean%5Cn%20%20Cerulean%20blue%5Cn%20%20Cerulean%20frost%5Cn%20%20Cerulean%20(Crayola)%5Cn%20%20Cerulean%20(RGB)%5Cn%20%20Champagne%5Cn%20%20Champagne%20pink%5Cn%20%20Charcoal%5Cn%20%20Charm%20pink%5Cn%20%20Chartreuse%20(web)%5Cn%20%20Cherry%20blossom%20pink%5Cn%20%20Chestnut%5Cn%20%20Chili%20red%5Cn%20%20China%20pink%5Cn%20%20Chinese%20red%5Cn%20%20Chinese%20violet%5Cn%20%20Chinese%20yellow%5Cn%20%20Chocolate%20(traditional)%5Cn%20%20Chocolate%20(web)%5Cn%20%20Cinereous%5Cn%20%20Cinnabar%5Cn%20%20Cinnamon%20Satin%5Cn%20%20Citrine%5Cn%20%20Citron%5Cn%20%20Claret%5Cn%20%20Coffee%5Cn%20%20Congo%20pink%5Cn%20%20Cool%20grey%5Cn%20%20Copper%5Cn%20%20Copper%20(Crayola)%5Cn%20%20Copper%20penny%5Cn%20%20Copper%20red%5Cn%20%20Copper%20rose%5Cn%20%20Coquelicot%5Cn%20%20Coral%5Cn%20%20Coral%20pink%5Cn%20%20Cordovan%5Cn%20%20Cornflower%20blue%5Cn%20%20Cornsilk%5Cn%20%20Cosmic%20cobalt%5Cn%20%20Cosmic%20latte%5Cn%20%20Coyote%20brown%5Cn%20%20Cotton%20candy%5Cn%20%20Cream%5Cn%20%20Crimson%5Cn%20%20Crimson%20(UA)%5Cn%20%20Cultured%20Pearl%5Cn%20%20Cyan%5Cn%20%20Cyan%20(process)%5Cn%20%20Cyber%20grape%5Cn%20%20Cyber%20yellow%5Cn%20%20Dandelion%5Cn%20%20Dark%20brown%5Cn%20%20Dark%20byzantium%5Cn%20%20Dark%20cyan%5Cn%20%20Dark%20electric%20blue%5Cn%20%20Dark%20goldenrod%5Cn%20%20Dark%20green%20(X11)%5Cn%20%20Dark%20jungle%20green%5Cn%20%20Dark%20lava%5Cn%20%20Dark%20liver%20(horses)%5Cn%20%20Dark%20magenta%5Cn%20%20Dark%20olive%20green%5Cn%20%20Dark%20orange%5Cn%20%20Dark%20orchid%5Cn%20%20Dark%20salmon%5Cn%20%20Dark%20sea%20green%5Cn%20%20Dark%20sienna%5Cn%20%20Dark%20sky%20blue%5Cn%20%20Dark%20slate%20blue%5Cn%20%20Dark%20slate%20gray%5Cn%20%20Dark%20spring%20green%5Cn%20%20Dark%20turquoise%5Cn%20%20Dark%20violet%5Cn%20%20Deep%20cerise%5Cn%20%20Deep%20champagne%5Cn%20%20Deep%20chestnut%5Cn%20%20Deep%20jungle%20green%5Cn%20%20Deep%20pink%5Cn%20%20Deep%20saffron%5Cn%20%20Deep%20sky%20blue%5Cn%20%20Deep%20Space%20Sparkle%5Cn%20%20Deep%20taupe%5Cn%20%20Denim%5Cn%20%20Denim%20blue%5Cn%20%20Desert%5Cn%20%20Desert%20sand%5Cn%20%20Dim%20gray%5Cn%20%20Dodger%20blue%5Cn%20%20Drab%20dark%20brown%5Cn%20%20Duke%20blue%5Cn%20%20Dutch%20white%5Cn%20%20Ecru%5Cn%20%20Eerie%20black%5Cn%20%20Eggplant%5Cn%20%20Eggshell%5Cn%20%20Electric%20lime%5Cn%20%20Electric%20purple%5Cn%20%20Electric%20violet%5Cn%20%20Emerald%5Cn%20%20Eminence%5Cn%20%20English%20lavender%5Cn%20%20English%20vermillion%5Cn%20%20English%20violet%5Cn%20%20Erin%5Cn%20%20Eton%20blue%5Cn%20%20Fallow%5Cn%20%20Falu%20red%5Cn%20%20Fandango%5Cn%20%20Fandango%20pink%5Cn%20%20Fawn%5Cn%20%20Fern%20green%5Cn%20%20Field%20drab%5Cn%20%20Fiery%20rose%5Cn%20%20Finn%5Cn%20%20Firebrick%5Cn%20%20Fire%20engine%20red%5Cn%20%20Flax%5Cn%20%20Flirt%5Cn%20%20Floral%20white%5Cn%20%20Forest%20green%20(web)%5Cn%20%20French%20beige%5Cn%20%20French%20bistre%5Cn%20%20French%20fuchsia%5Cn%20%20French%20lilac%5Cn%20%20French%20lime%5Cn%20%20French%20mauve%5Cn%20%20French%20pink%5Cn%20%20French%20raspberry%5Cn%20%20French%20sky%20blue%5Cn%20%20French%20violet%5Cn%20%20Frostbite%5Cn%20%20Fuchsia%5Cn%20%20Fuchsia%20(Crayola)%5Cn%20%20Fulvous%5Cn%20%20Fuzzy%20Wuzzy%5Cn%5Cnmod%5Cn%20%20tinted%20windows%5Cn%20%20sunroof%5Cn%20%20flames%5Cn%20%20nitrous%5Cn%20%20lowrider%20rims%5Cn%20%20custom%20interior%5Cn%20%20racing%20seats%5Cn%20%20twin%20exhaust%5Cn%20%20%5Cn%5Cnmod1%5Cn%20%20on%20airbags%5Cn%20%20on%20coilovers%5Cn%20%20slammed%5Cn%20%20stanced%5Cn%20%20turbo%5Cn%20%20twin%20turbo%5Cn%20%20%5Cnmod2%5Cn%20%20for%20Drag%20Racing%5Cn%20%20for%20Drifting%5Cn%20%20for%20car%20shows%5Cn%20%20for%20Barrettt%20Jackson%20Auto%20Auction%5Cn%20%20%5Cn%5CndesktopLayout%20%5Cn%20%20debug%20=%20colors%5Cn%5Ctcontainer%5Cn%5Ct%5Ctstyle%20=%20height:100vh;%5Cn%20%20grid%5Cn%20%20%20%20a%20a%20a%20a%20o%5Cn%20%20%20%20a%20a%20a%20a%20b%5Cn%20%20%20%20d%20c%20c%20c%20c%5Cn%20%20areas%5Cn%20%20%20%20o%5Cn%20%20%20%20%20%20content%20=%20%3Ch1%3ENismo%20Car%20Builder%20+%20Art%20Style%20@virtualgrowhouse%20%5Bartstyle%5D%5Cn%5Ct%5Ct%5Ctcentered%20=%20true%5Cn%20%20%20%20b%5Cn%20%20%20%20%20%20content%20=%20%3Cbutton%20onclick=%5C%22update()%5C%22%3Erandomize%3C/button%3E%5Cn%5Ct%5Ct%5Ctcentered%20=%20true%5Cn%20%20%20%20c%5Cn%20%20%20%20%5Cn%20%20%20%20%20%20content%20=%20The%20scene%20portrays%20the%20car,%20a%20%7B1987-2024%7D%20%5Bcar%5D%20painted%20in%20the%20%5Bcolor%5D%20color%20to%20the%20tone%20of%20%5Bartstyle%5D.%20Car%20Mods%20are:%20%5Bmod%5D,%20%5Bmod1%5D,%20%5Bmod2%5D%20and%20%5Bmod2%5D%5Cn%5Ct%5Ct%5Ctcentered%20=%20true%5Cn%5Ct%5Ctd%5Cn%5Ct%5Ct%5Ctcontent%20=%20%7B1776-2099%7D%5Cn%5Ct%5Ct%5Ctcentered%20=%20true%5Cn%5Cn%5Cn%5Cn%5Cn%5CnmobileLayout%5Cn%20%20debug%20=%20colors%5Cn%5Ctcontainer%5Cn%5Ct%5Ctstyle%20=%20height:100vh;%5Cn%20%20grid%5Cn%20%20%20%20a%20a%20a%5Cn%20%20%20%20b%20b%20b%5Cn%20%20%20%20c%20c%20d%5Cn%20%20areas%5Cn%20%20%20%20a%5Cn%20%20%20%20%20%20content%20=%20%3Cdiv%3E%3Ch1%3E%20Nissan%20Car%20Generator%3C/h1%3E%3Cp%3ETry%20resizing%20your%20browser%20and%20clicking%20ramdomize.%20Check%20out%20the%20%3Ca%20href=%5C%22/layout-maker-plugin%5C%22%20target=%5C%22_blank%5C%22%3Eplugin%20page%3C/a%3E%3C/p%3E%3C/div%3E%5Cn%5Ct%5Ct%5Ctcentered%20=%20true%5Cn%20%20%20%20b%5Cn%20%20%20%20%20%20content%20=%20%3Cbutton%20onclick=%5C%22update()%5C%22%3EMake%20Car%3C/button%3E%5Cn%5Ct%5Ct%5Ctcentered%20=%20true%5Cn%20%20%20%20c%5Cn%20%20%20%20%20%20content%20=%20%7Bimport:animal%7D%5Cn%5Ct%5Ct%5Ctcentered%20=%20true%5Cn%5Ct%5Ctd%5Cn%5Ct%5Ct%5Ctcontent%20=%20%7B100-999%7D%5Cn%5Ct%5Ct%5Ctcentered%20=%20true%22,%22outputTemplate%22:%22%5Bwindow.innerWidth%20%3C%20200%20?%20layoutMaker(mobileLayout)%20:%20layoutMaker(desktopLayout)%5D%22,%22imports%22:%5B%22animal%22,%22layout-maker-plugin%22%5D,%22canLink%22:false,%22isPrivate%22:false%7D<span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="519"></td><td class="line-content">  <span class="html-tag">&lt;script <span class="html-attribute-name">id</span>="<span class="html-attribute-value">imported-generators</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">notjs</span>"&gt;</span>%5B%7B%22name%22:%22animal%22,%22modelText%22:%22title%20=%20Random%20Animal%20Generator%5Cnsubtitle%20=%20A%20simple%20generator%20that%20gives%20you%20a%20random%20animal%20name.%5CnfontSize%20=%20230%5CnfontColor%20=%20black%5CnbuttonText%20=%20randomize%20%5CnnumberOfItems%20=%201%5CnitemSeperator%20=%20%3Cbr/%3E%5Cndescription%5Cn%20%20%7Bimport:simple-gen-footer%7D%5Cn%20%20$output%20=%20%3Cp%3E%5Bthis.joinItems(%5C%22%3C/p%3E%3Cp%3E%5C%22)%5D%3C/p%3E%20//%20%3C--%20don't%20remove%20this%20last%20line,%20it%20uses%20the%20special%20%5C%22$output%5C%22%20property%20to%20join%20and%20format%20your%20description%20as%20HTML%20paragraphs%20:)%5Cn%5Cn%5Cn$output%20=%20%5Banimal%5D%5Cn%5Cn//%20Credit%20goes%20to:%20https://github.com/dariusk/corpora%5Cnanimal%5Cn%20%20aardvark%5Cn%20%20alligator%5Cn%20%20alpaca%5Cn%20%20antelope%5Cn%20%20ape%5Cn%20%20armadillo%5Cn%20%20baboon%5Cn%20%20badger%5Cn%20%20bat%5Cn%20%20bear%5Cn%20%20beaver%5Cn%20%20bison%5Cn%20%20boar%5Cn%20%20buffalo%5Cn%20%20bull%5Cn%20%20camel%5Cn%20%20canary%5Cn%20%20capybara%5Cn%20%20cat%5Cn%20%20chameleon%5Cn%20%20cheetah%5Cn%20%20chimpanzee%5Cn%20%20chinchilla%5Cn%20%20chipmunk%5Cn%20%20cougar%5Cn%20%20cow%5Cn%20%20coyote%5Cn%20%20crocodile%5Cn%20%20crow%5Cn%20%20deer%5Cn%20%20dingo%5Cn%20%20dog%5Cn%20%20donkey%5Cn%20%20dromedary%5Cn%20%20elephant%5Cn%20%20elk%5Cn%20%20ewe%5Cn%20%20ferret%5Cn%20%20finch%5Cn%20%20fish%5Cn%20%20fox%5Cn%20%20frog%5Cn%20%20gazelle%5Cn%20%20gila%20monster%5Cn%20%20giraffe%5Cn%20%20gnu%5Cn%20%20goat%5Cn%20%20gopher%5Cn%20%20gorilla%5Cn%20%20grizzly%20bear%5Cn%20%20ground%20hog%5Cn%20%20guinea%20pig%5Cn%20%20hamster%5Cn%20%20hedgehog%5Cn%20%20hippopotamus%5Cn%20%20hog%5Cn%20%20horse%5Cn%20%20hyena%5Cn%20%20ibex%5Cn%20%20iguana%5Cn%20%20impala%5Cn%20%20jackal%5Cn%20%20jaguar%5Cn%20%20kangaroo%5Cn%20%20koala%5Cn%20%20lamb%5Cn%20%20lemur%5Cn%20%20leopard%5Cn%20%20lion%5Cn%20%20lizard%5Cn%20%20llama%5Cn%20%20lynx%5Cn%20%20mandrill%5Cn%20%20marmoset%5Cn%20%20mink%5Cn%20%20mole%5Cn%20%20mongoose%5Cn%20%20monkey%5Cn%20%20moose%5Cn%20%20mountain%20goat%5Cn%20%20mouse%5Cn%20%20mule%5Cn%20%20muskrat%5Cn%20%20mustang%5Cn%20%20mynah%20bird%5Cn%20%20newt%5Cn%20%20ocelot%5Cn%20%20opossum%5Cn%20%20orangutan%5Cn%20%20oryx%5Cn%20%20otter%5Cn%20%20ox%5Cn%20%20panda%5Cn%20%20panther%5Cn%20%20parakeet%5Cn%20%20parrot%5Cn%20%20pig%5Cn%20%20platypus%5Cn%20%20polar%20bear%5Cn%20%20porcupine%5Cn%20%20porpoise%5Cn%20%20prairie%20dog%5Cn%20%20puma%5Cn%20%20rabbit%5Cn%20%20raccoon%5Cn%20%20ram%5Cn%20%20rat%5Cn%20%20reindeer%5Cn%20%20reptile%5Cn%20%20rhinoceros%5Cn%20%20salamander%5Cn%20%20seal%5Cn%20%20sheep%5Cn%20%20shrew%5Cn%20%20silver%20fox%5Cn%20%20skunk%5Cn%20%20sloth%5Cn%20%20snake%5Cn%20%20squirrel%5Cn%20%20tapir%5Cn%20%20tiger%5Cn%20%20toad%5Cn%20%20turtle%5Cn%20%20walrus%5Cn%20%20warthog%5Cn%20%20weasel%5Cn%20%20whale%5Cn%20%20wildcat%5Cn%20%20wolf%5Cn%20%20wolverine%5Cn%20%20wombat%5Cn%20%20woodchuck%5Cn%20%20yak%5Cn%20%20zebra%5Cn%20%20anaconda%5Cn%20%20anteater%5Cn%20%20bobcat%5Cn%20%20buzzard%5Cn%20%20catfish%5Cn%20%20chicken%5Cn%20%20cobra%5Cn%20%20crab%5Cn%20%20cuckoo%5Cn%20%20dinosaur%5Cn%20%20dolphin%5Cn%20%20dove%5Cn%20%20duck%5Cn%20%20eagle%5Cn%20%20eel%5Cn%20%20emu%5Cn%20%20falcon%5Cn%20%20flamingo%5Cn%20%20goose%5Cn%20%20hare%5Cn%20%20hawk%5Cn%20%20hummingbird%5Cn%20%20lobster%5Cn%20%20meerkat%5Cn%20%20octopus%5Cn%20%20ostrich%5Cn%20%20owl%5Cn%20%20oyster%5Cn%20%20peacock%5Cn%20%20pelican%5Cn%20%20penguin%5Cn%20%20pheasant%5Cn%20%20pigeon%5Cn%20%20pony%5Cn%20%20quail%5Cn%20%20rattlesnake%5Cn%20%20rooster%5Cn%20%20shark%5Cn%20%20sparrow%22,%22imports%22:%5B%22simple-gen-footer%22%5D,%22lastEditTime%22:1725191809726,%22found%22:true%7D,%7B%22name%22:%22layout-maker-plugin%22,%22modelText%22:%22$output(spec)%20=%3E%5Cn%5Cn%20%20//%20enter%20yolo%20mode%5Cn%20%20if(!window.__alreadyAddedLayoutMakerPluginStuff)%20%7B%5Cn%20%20%20%20window.__alreadyAddedLayoutMakerPluginStuff%20=%20true;%5Cn%20%20%20%20//%20if%20people%20add%20id=foo%20to%20one%20of%20their%20areas,%20then%20they%20expect%20to%20be%20able%20to%20write%20update(foo)%20and%20have%20that%20specific%20area%20be%20updated%20like%20normal.%5Cn%20%20%20%20//%20but%20this%20doesn't%20work%20because%20the%20area%20has%20already%20been%20rendered/evaluated%20-%20i.e.%20there%20are%20no%20square/curly%20blocks%20to%20update.%5Cn%20%20%20%20//%20so%20to%20fix%20this,%20we%20wrap%20the%20update%20function,%20detect%20if%20the%20input%20element%20to%20the%20update%20function%20is%20a%20layout%20maker%20plugin%20'area',%20and%20if%20so,%20%5C%22manually%5C%22%20update%20that%20area%20using%20saved%20original/unevaluated%20content.%5Cn%20%20%20%20let%20realUpdateFunction%20=%20window.update;%5Cn%20%20%20%20window.update%20=%20function(...args)%20%7B%5Cn%20%20%20%20%20%20if(args%5B0%5D%20&amp;&amp;%20args%5B0%5D.dataset%20&amp;&amp;%20args%5B0%5D.dataset.isLayoutMakerPluginArea%20===%20%5C%22yes%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20id%20=%20args%5B0%5D.id;%5Cn%20%20%20%20%20%20%20%20let%20contentWrapper%20=%20args%5B0%5D;%5Cn%20%20%20%20%20%20%20%20if(contentWrapper.querySelector(%60%5Bdata-layout-maker-actual-content-wrapper='1'%5D%60))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20contentWrapper%20=%20contentWrapper.querySelector(%60%5Bdata-layout-maker-actual-content-wrapper='1'%5D%60);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20contentWrapper.innerHTML%20=%20window.__originalLayoutMakerPluginAreaContentById.get(id).evaluateItem;%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20realUpdateFunction.bind(window)(...args);%20//%20must%20pass%20on%20all%20args%20exactly%20as%20recieved%20-%20important%20to%20ensure%20forwards-compatibility%20with%20future%20perchance%20engine%20updates%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D;%5Cn%20%20%20%20window.__originalLayoutMakerPluginAreaContentById%20=%20new%20Map();%5Cn%20%20%7D%5Cn%20%20//%20exit%20yolo%20mode%5Cn%5Cn%5Ctlet%20rows%20=%20spec.grid.selectAll.map(r%20=%3E%20r+%5C%22%5C%22);%5Cn%5Ctlet%20areas%20=%20spec.areas%20%7C%7C%20%7B%7D;%5Cn%5Ctlet%20areaNames%20=%20%5B...new%20Set(rows.join(%5C%22%20%5C%22).split(/%5C%5Cs+/))%5D.filter(n%20=%3E%20n%20!==%20%5C%22.%5C%22);%5Cn%5Ct//let%20containerCSS%20=%20;%5Cn%5Ctlet%20b%20=%20spec.debug%20===%20%5C%22borders%5C%22;%5Cn%5Ctlet%20bg%20=%20spec.debug%20===%20%5C%22colors%5C%22%20%7C%7C%20spec.debug%20===%20%5C%22colours%5C%22;%5Cn%5Ct%5Cn%5Ctlet%20html%20=%20%60%3Cdiv%20$%7Bspec.container%20&amp;&amp;%20spec.container.id%20?%20%60id=%5C%22$%7Bspec.container.id%7D%5C%22%60%20:%20%5C%22%5C%22%7D%20style=%5C%22box-sizing:border-box;%20display:grid;%20grid-template-areas:$%7Brows.map(r%20=%3E%20%60'$%7Br%7D'%60).join(%5C%22%20%5C%22)%7D;%20$%7Bspec.rowSizes%20?%20%5C%22grid-template-rows:%5C%22+spec.rowSizes%20:%20%5C%22%5C%22%7D;%20$%7Bspec.columnSizes%20?%20%5C%22grid-template-columns:%5C%22+spec.columnSizes%20:%20%5C%22%5C%22%7D;%20$%7Bspec.container%20&amp;&amp;%20spec.container.style%20?%20spec.container.style%20:%20%5C%22min-height:300px;%5C%22%7D;%5C%22%3E%5Cn%5Ct%5Ct$%7BareaNames.map(n%20=%3E%20%7B%5Cn%20%20%20%20%20%20let%20content%20=%20%5C%22%5C%22;%5Cn%20%20%20%20%20%20let%20id%20=%20areas%5Bn%5D%20&amp;&amp;%20areas%5Bn%5D.id%20?%20areas%5Bn%5D.id%20:%20null;%5Cn%20%20%20%20%20%20if(areas%5Bn%5D%20&amp;&amp;%20areas%5Bn%5D.content)%20%7B%5Cn%20%20%20%20%20%20%20%20content%20=%20areas%5Bn%5D.content.toString().replace(/(%5B%7B%7D%5C%5C%5B%5C%5C%5D%5D)/g,%20%5C%22%5C%5C%5C%5C$1%5C%22);%20//%20%3C--need%20to%20put%20escapes%20back%20that%20toString%20took%20away%5Cn%20%20%20%20%20%20%20%20if(id)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20window.__originalLayoutMakerPluginAreaContentById.set(id,%20areas%5Bn%5D.content);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20return%20%60%3Cdiv%20$%7Bid%20?%20%5C%22id='%5C%22+id+%5C%22'%5C%22%20:%20%5C%22%5C%22%7D%20data-is-layout-maker-plugin-area=%5C%22yes%5C%22%20style=%5C%22box-sizing:border-box;%20grid-area:$%7Bn%7D;%20$%7Bareas%5Bn%5D%20&amp;&amp;%20areas%5Bn%5D.style%20%7C%7C%20%5C%22%5C%22%7D;%20$%7Bb%20?%20%5C%22border:1px%20dashed%20grey%5C%22%20:%20bg%20?%20%60background-color:hsl($%7B360%20*%20Math.random()%7D,$%7B(25%20+%2070%20*%20Math.random())%7D%25,$%7B(85%20+%2010%20*%20Math.random())%7D%25);%60%20:%20%5C%22%5C%22%7D%5C%22%3E%20$%7Bareas%5Bn%5D%20&amp;&amp;%20areas%5Bn%5D.centered%20?%20%60%3Cdiv%20style='display:flex;%20flex-direction:column;%20justify-content:center;%20align-items:center;%20width:100%25;%20height:100%25;'%3E%3Cdiv%20data-layout-maker-actual-content-wrapper=%5C%221%5C%22%3E%60%20:%20%5C%22%5C%22%7D$%7Bcontent%7D$%7Bareas%5Bn%5D%20&amp;&amp;%20areas%5Bn%5D.centered%20?%20%5C%22%3C/div%3E%3C/div%3E%5C%22%20:%20%5C%22%5C%22%7D%3C/div%3E%60%5Cn%20%20%20%20%7D).join(%5C%22%5C%22)%7D%5Cn%5Ct%3C/div%3E%60;%5Cn%5Ctreturn%20html;%5Cn%5Cn%20%5Cn%20%5Cnlayout0%5Cn%20%20grid%5Cn%20%20%20%20a%20a%20a%20a%20b%5Cn%20%20%20%20a%20a%20a%20a%20b%5Cn%20%20%20%20c%20c%20c%20c%20c%5Cn%5Ctcontainer%5Cn%5Ct%5Ctstyle%20=%20height:100%25;%5Cn%5Ctareas%5Cn%5Ct%5Cta%5Cn%5Ct%5Ct%5Ctstyle%20=%20background-color:lightblue;%5Cn%5Ct%5Ctb%5Cn%5Ct%5Ct%5Ctstyle%20=%20background-color:orange;%5Cn%5Ct%5Ctc%5Cn%5Ct%5Ct%5Ctstyle%20=%20background-color:pink;%5Cn%5Cnlayout1%5Cn%5Ctdebug%20=%20borders%20%20%20%20%20%5Cn%20%20grid%5Cn%20%20%20%20a%20a%20a%20a%20b%5Cn%20%20%20%20a%20a%20a%20a%20b%5Cn%20%20%20%20c%20c%20c%20c%20c%5Cn%20%20areas%5Cn%20%20%20%20a%5Cn%20%20%20%20%20%20content%20=%20%7Bhello%7Chi%20there%7D%20this%20is%20the%20%5C%22a%5C%22%20area%5Cn%20%20%20%20b%5Cn%20%20%20%20%20%20content%20=%20side%20bar%20thing%20(%5C%22b%5C%22%20area)%5Cn%20%20%20%20c%5Cn%20%20%20%20%20%20content%20=%20a%20sort%20of%20footer%20thing%20(%5C%22c%5C%22%20area)%5Cn%5Ct%5Ct%5Ct%5Cnlayout_auto_height%5Cn%5Ctdebug%20=%20colors%5Cn%5Ctcontainer%5Cn%5Ct%5Ctstyle%20=%20height:auto;%5Cn%20%20grid%5Cn%20%20%20%20a%20a%20a%20a%20b%5Cn%20%20%20%20a%20a%20a%20a%20b%5Cn%20%20%20%20c%20c%20c%20c%20c%5Cn%5Ct%5Cte%20d%20d%20d%20d%5Cn%5Ct%5Ctf%20f%20f%20f%20f%5Cn%20%20areas%5Cn%20%20%20%20a%5Cn%20%20%20%20%20%20content%20=%20%7Bhello%7Chi%20there%7D%20this%20is%20the%20%5C%22a%5C%22%20area%5Cn%20%20%20%20b%5Cn%20%20%20%20%20%20content%20=%20side%20bar%20thing%20(%5C%22b%5C%22%20area)%5Cn%20%20%20%20c%5Cn%20%20%20%20%20%20content%20=%20a%20sort%20of%20footer%20thing%20(%5C%22c%5C%22%20area)%5Cn%5Ct%5Ctd%5Cn%20%20%20%20%20%20content%20=%20another%20area%5Cn%5Ct%5Cte%5Cn%5Ct%5Ct%5Ctcontent%20=%20hi%5Cn%20%20%20%20f%5Cn%20%20%20%20%20%20content%20=%20hello%5Cn%5Ct%5Ct%5Ct%5Cnlayout1_centered%5Cn%5Ctdebug%20=%20colors%20%20%20%20%20%5Cn%20%20grid%5Cn%20%20%20%20a%20a%20a%20a%20b%5Cn%20%20%20%20a%20a%20a%20a%20b%5Cn%20%20%20%20c%20c%20c%20c%20c%5Cn%20%20areas%5Cn%20%20%20%20a%5Cn%20%20%20%20%20%20content%20=%20%7Bhello%7Chi%20there%7D%20this%20is%20the%20%5C%22a%5C%22%20area%5Cn%5Ct%5Ct%5Ctcentered%20=%20true%5Cn%20%20%20%20b%5Cn%20%20%20%20%20%20content%20=%20side%20bar%20thing%20(%5C%22b%5C%22%20area)%5Cn%5Ct%5Ct%5Ctcentered%20=%20true%5Cn%20%20%20%20c%5Cn%20%20%20%20%20%20content%20=%20a%20sort%20of%20footer%20thing%20(%5C%22c%5C%22%20area)%5Cn%5Ct%5Ct%5Ctcentered%20=%20true%5Cn%5Ct%5Cnlayout2%5Cn%5Ctdebug%20=%20colors%5Cn%20%20grid%5Cn%20%20%20%20t%20a%20a%20a%20b%20m%5Cn%20%20%20%20t%20a%20a%20a%20b%20k%5Cn%20%20%20%20c%20c%20c%20c%20c%20k%5Cn%5Ct%5Ctd%20d%20g%20s%20s%20s%5Cn%5Ctareas%5Cn%5Ct%5Cts%5Cn%5Ct%5Ct%5Ctcontent%20=%20hello%5Cn%5Ct%5Ct%5Ctcentered%20=%20true%5Cn%5Ct%5Ctm%5Cn%5Ct%5Ct%5Ctcontent%20=%20%7B1%7C2%7C3%7D%20%5Cn%5Ct%5Ct%5Ctcentered%20=%20true%5Cn%5Ct%5Ct%5Ct%5Cnlayout3%5Cn%20%20grid%5Cn%20%20%20%20a%20b%20c%5Cn%20%20%20%20a%20b%20c%5Cn%20%20%20%20a%20b%20c%5Cn%20%20areas%5Cn%20%20%20%20a%5Cn%20%20%20%20%20%20content%20=%20aaa%5Cn%5Ct%5Ct%5Ctstyle%20=%20background-color:lightblue;%5Cn%20%20%20%20b%5Cn%20%20%20%20%20%20content%20=%20bbb%5Cn%5Ct%5Ct%5Ctstyle%20=%20border:1px%20solid%20lightgrey;%5Cn%20%20%20%20c%5Cn%20%20%20%20%20%20content%20=%20ccc%5Cn%5Ct%5Ct%5Ctstyle%20=%20background-color:orange;%5Cn%5Ct%5Ct%5Ct%5Cnlayout4%5Cn%5Ctdebug%20=%20colors%5Cn%5Ctcontainer%5Cn%5Ct%5Ctstyle%20=%20height:100px;%20width:200px;%5Cn%20%20grid%5Cn%20%20%20%20a%20a%20a%5Cn%20%20%20%20b%20b%20b%5Cn%20%20%20%20c%20c%20c%5Cn%5Ct%5Ct%5Cnlayout5%5Cn%5Ctdebug%20=%20borders%5Cn%5CtcolumnSizes%20=%201fr%200.5fr%201fr%5Cn%5CtrowSizes%20=%202fr%201fr%201fr%5Cn%20%20grid%5Cn%20%20%20%20a%20b%20c%5Cn%5Ct%5Ctd%20e%20f%5Cn%5Ct%5Ctg%20h%20i%5Cn%5Ct%5Ct%5Cnlayout6%5Cn%5Ctdebug%20=%20colors%5Cn%20%20grid%5Cn%20%20%20%20a%20a%20.%5Cn%5Ct%5Ctb%20.%20c%5Cn%5Ct%5Ct.%20.%20d%5Cn%5Cn%5Ct%5Cn%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%22,%22imports%22:%5B%5D,%22lastEditTime%22:1700453066539,%22found%22:true%7D,%7B%22name%22:%22simple-gen-footer%22,%22modelText%22:%22$output%5Cn%5CtThe%20%3Ca%20href%5C%5C=%5C%22/useful-generators%5C%22%3Euseful%20generators%20list%3C/a%3E%20is%20a%20handy%20list%20of%20simple%20text%20generators%20on%20various%20topics.%20If%20you're%20a%20Perchance%20builder%20then%20you'll%20probably%20find%20some%20of%20them%20useful%20for%20importing%20into%20your%20own%20projects.%5Cn%5CtIf%20you'd%20like%20to%20learn%20how%20to%20create%20a%20random%20text%20generator,%20then%20check%20out%20the%20%3Ca%20href%5C%5C=%5C%22/minimal#edit%5C%22%3Eminimal%20generator%20template%3C/a%3E%20and%20the%20%3Ca%20href%5C%5C=%5C%22/tutorial%5C%22%3Etutorial%3C/a%3E.%20It's%20easier%20than%20you'd%20think%20and%20is%20great%20fun%20:)%5Cn%5Ct$output%20=%20%3Cp%3E%5Bthis.joinItems(%5C%22%3C/p%3E%3Cp%3E%5C%22)%5D%3C/p%3E%22,%22imports%22:%5B%5D,%22lastEditTime%22:1618109989813,%22found%22:true%7D%5D<span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="520"></td><td class="line-content">  <span class="html-tag">&lt;script <span class="html-attribute-name">id</span>="<span class="html-attribute-value">imported-generator-names</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">notjs</span>"&gt;</span>%5B%22animal%22,%22layout-maker-plugin%22,%22simple-gen-footer%22%5D<span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="521"></td><td class="line-content">  <span class="html-tag">&lt;script <span class="html-attribute-name">id</span>="<span class="html-attribute-value">this-html-server-render-time</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">notjs</span>"&gt;</span>1725759634025<span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="522"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="523"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="524"></td><td class="line-content">/* compromise v11.12.4</td></tr><tr><td class="line-number" value="525"></td><td class="line-content">   github.com/nlp-compromise/compromise</td></tr><tr><td class="line-number" value="526"></td><td class="line-content">   MIT</td></tr><tr><td class="line-number" value="527"></td><td class="line-content">*/</td></tr><tr><td class="line-number" value="528"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="529"></td><td class="line-content">!function(t){"object"==typeof exports&amp;&amp;"undefined"!=typeof module?module.exports=t():"function"==typeof define&amp;&amp;define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).nlp=t()}(function(){return function i(o,s,u){function l(e,t){if(!s[e]){if(!o[e]){var r="function"==typeof require&amp;&amp;require;if(!t&amp;&amp;r)return r(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var a=s[e]={exports:{}};o[e][0].call(a.exports,function(t){return l(o[e][1][t]||t)},a,a.exports,i,o,s,u)}return s[e].exports}for(var c="function"==typeof require&amp;&amp;require,t=0;t&lt;u.length;t++)l(u[t]);return l}({1:[function(h,r,n){(function(e){!function(t){"object"==typeof n&amp;&amp;void 0!==r?r.exports=t():("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).unpack=t()}(function(){return function i(o,s,u){function l(e,t){if(!s[e]){if(!o[e]){var r="function"==typeof h&amp;&amp;h;if(!t&amp;&amp;r)return r(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var a=s[e]={exports:{}};o[e][0].call(a.exports,function(t){return l(o[e][1][t]||t)},a,a.exports,i,o,s,u)}return s[e].exports}for(var c="function"==typeof h&amp;&amp;h,t=0;t&lt;u.length;t++)l(u[t]);return l}({1:[function(t,e,r){"use strict";var s=36,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",u=i.split("").reduce(function(t,e,r){return t[e]=r,t},{});e.exports={toAlphaCode:function(t){if(void 0!==i[t])return i[t];for(var e=1,r=s,n="";r&lt;=t;t-=r,e++,r*=s);for(;e--;){var a=t%s;n=String.fromCharCode((a&lt;10?48:55)+a)+n,t=(t-a)/s}return n},fromAlphaCode:function(t){if(void 0!==u[t])return u[t];for(var e=0,r=1,n=s,a=1;r&lt;t.length;e+=n,r++,n*=s);for(var i=t.length-1;0&lt;=i;i--,a*=s){var o=t.charCodeAt(i)-48;10&lt;o&amp;&amp;(o-=7),e+=o*a}return e}}},{}],2:[function(t,e,r){"use strict";var o=t("./unpack");e.exports=function(t){var a=t.split("|").reduce(function(t,e){var r=e.split("");return t[r[0]]=r[1],t},{}),i={};return Object.keys(a).forEach(function(t){var e=o(a[t]);"true"===t&amp;&amp;(t=!0);for(var r=0;r&lt;e.length;r++){var n=e[r];!0===i.hasOwnProperty(n)?!1===Array.isArray(i[n])?i[n]=[i[n],t]:i[n].push(t):i[n]=t}}),i}},{"./unpack":4}],3:[function(t,e,r){"use strict";var a=t("../encoding");e.exports=function(t){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),r=0;r&lt;t.nodes.length;r++){var n=e.exec(t.nodes[r]);if(!n){t.symCount=r;break}t.syms[a.fromAlphaCode(n[1])]=a.fromAlphaCode(n[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}},{"../encoding":1}],4:[function(t,e,r){"use strict";var n=t("./symbols"),p=t("../encoding");e.exports=function(t){var m,d,e={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&amp;&amp;n(e),m=e,d=[],function t(e,r){var n,a,i,o,s=m.nodes[e];"!"===s[0]&amp;&amp;(d.push(r),s=s.slice(1));for(var u=s.split(/([A-Z0-9,]+)/g),l=0;l&lt;u.length;l+=2){var c=u[l],h=u[l+1];if(c){var f=r+c;","!==h&amp;&amp;void 0!==h?t((n=m,a=h,i=e,(o=p.fromAlphaCode(a))&lt;n.symCount?n.syms[o]:i+o+1-n.symCount),f):d.push(f)}}}(0,""),d}},{"../encoding":1,"./symbols":3}]},{},[2])(2)}),function(t){"object"==typeof n&amp;&amp;void 0!==r?r.exports=t():("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).unpack=t()}(function(){return function i(o,s,u){function l(e,t){if(!s[e]){if(!o[e]){var r="function"==typeof h&amp;&amp;h;if(!t&amp;&amp;r)return r(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var a=s[e]={exports:{}};o[e][0].call(a.exports,function(t){return l(o[e][1][t]||t)},a,a.exports,i,o,s,u)}return s[e].exports}for(var c="function"==typeof h&amp;&amp;h,t=0;t&lt;u.length;t++)l(u[t]);return l}({1:[function(t,e,r){"use strict";var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",s=i.split("").reduce(function(t,e,r){return t[e]=r,t},{});e.exports={toAlphaCode:function(t){if(void 0!==i[t])return i[t];for(var e=1,r=36,n="";r&lt;=t;t-=r,e++,r*=36);for(;e--;){var a=t%36;n=String.fromCharCode((a&lt;10?48:55)+a)+n,t=(t-a)/36}return n},fromAlphaCode:function(t){if(void 0!==s[t])return s[t];for(var e=0,r=1,n=36,a=1;r&lt;t.length;e+=n,r++,n*=36);for(var i=t.length-1;0&lt;=i;i--,a*=36){var o=t.charCodeAt(i)-48;10&lt;o&amp;&amp;(o-=7),e+=o*a}return e}}},{}],2:[function(t,e,r){"use strict";var o=t("./unpack");e.exports=function(t){var a=t.split("|").reduce(function(t,e){var r=e.split("");return t[r[0]]=r[1],t},{}),i={};return Object.keys(a).forEach(function(t){var e=o(a[t]);"true"===t&amp;&amp;(t=!0);for(var r=0;r&lt;e.length;r++){var n=e[r];!0===i.hasOwnProperty(n)?!1===Array.isArray(i[n])?i[n]=[i[n],t]:i[n].push(t):i[n]=t}}),i}},{"./unpack":4}],3:[function(t,e,r){"use strict";var a=t("../encoding");e.exports=function(t){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),r=0;r&lt;t.nodes.length;r++){var n=e.exec(t.nodes[r]);if(!n){t.symCount=r;break}t.syms[a.fromAlphaCode(n[1])]=a.fromAlphaCode(n[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}},{"../encoding":1}],4:[function(t,e,r){"use strict";var n=t("./symbols"),p=t("../encoding");e.exports=function(t){var m,d,e={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&amp;&amp;n(e),m=e,d=[],function t(e,r){var n,a,i,o,s=m.nodes[e];"!"===s[0]&amp;&amp;(d.push(r),s=s.slice(1));for(var u=s.split(/([A-Z0-9,]+)/g),l=0;l&lt;u.length;l+=2){var c=u[l],h=u[l+1];if(c){var f=r+c;","!==h&amp;&amp;void 0!==h?t((n=m,a=h,i=e,(o=p.fromAlphaCode(a))&lt;n.symCount?n.syms[o]:i+o+1-n.symCount),f):d.push(f)}}}(0,""),d}},{"../encoding":1,"./symbols":3}]},{},[2])(2)}),function(t){"object"==typeof n&amp;&amp;void 0!==r?r.exports=t():("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).unpack=t()}(function(){return function i(o,s,u){function l(e,t){if(!s[e]){if(!o[e]){var r="function"==typeof h&amp;&amp;h;if(!t&amp;&amp;r)return r(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var a=s[e]={exports:{}};o[e][0].call(a.exports,function(t){return l(o[e][1][t]||t)},a,a.exports,i,o,s,u)}return s[e].exports}for(var c="function"==typeof h&amp;&amp;h,t=0;t&lt;u.length;t++)l(u[t]);return l}({1:[function(t,e,r){"use strict";var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",s=i.split("").reduce(function(t,e,r){return t[e]=r,t},{});e.exports={toAlphaCode:function(t){if(void 0!==i[t])return i[t];for(var e=1,r=36,n="";r&lt;=t;t-=r,e++,r*=36);for(;e--;){var a=t%36;n=String.fromCharCode((a&lt;10?48:55)+a)+n,t=(t-a)/36}return n},fromAlphaCode:function(t){if(void 0!==s[t])return s[t];for(var e=0,r=1,n=36,a=1;r&lt;t.length;e+=n,r++,n*=36);for(var i=t.length-1;0&lt;=i;i--,a*=36){var o=t.charCodeAt(i)-48;10&lt;o&amp;&amp;(o-=7),e+=o*a}return e}}},{}],2:[function(t,e,r){"use strict";var o=t("./unpack");e.exports=function(t){var a=t.split("|").reduce(function(t,e){var r=e.split("");return t[r[0]]=r[1],t},{}),i={};return Object.keys(a).forEach(function(t){var e=o(a[t]);"true"===t&amp;&amp;(t=!0);for(var r=0;r&lt;e.length;r++){var n=e[r];!0===i.hasOwnProperty(n)?!1===Array.isArray(i[n])?i[n]=[i[n],t]:i[n].push(t):i[n]=t}}),i}},{"./unpack":4}],3:[function(t,e,r){"use strict";var a=t("../encoding");e.exports=function(t){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),r=0;r&lt;t.nodes.length;r++){var n=e.exec(t.nodes[r]);if(!n){t.symCount=r;break}t.syms[a.fromAlphaCode(n[1])]=a.fromAlphaCode(n[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}},{"../encoding":1}],4:[function(t,e,r){"use strict";var n=t("./symbols"),p=t("../encoding");e.exports=function(t){var m,d,e={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&amp;&amp;n(e),m=e,d=[],function t(e,r){var n,a,i,o,s=m.nodes[e];"!"===s[0]&amp;&amp;(d.push(r),s=s.slice(1));for(var u=s.split(/([A-Z0-9,]+)/g),l=0;l&lt;u.length;l+=2){var c=u[l],h=u[l+1];if(c){var f=r+c;","!==h&amp;&amp;void 0!==h?t((n=m,a=h,i=e,(o=p.fromAlphaCode(a))&lt;n.symCount?n.syms[o]:i+o+1-n.symCount),f):d.push(f)}}}(0,""),d}},{"../encoding":1,"./symbols":3}]},{},[2])(2)}),function(t){"object"==typeof n&amp;&amp;void 0!==r?r.exports=t():("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).unpack=t()}(function(){return function i(o,s,u){function l(e,t){if(!s[e]){if(!o[e]){var r="function"==typeof h&amp;&amp;h;if(!t&amp;&amp;r)return r(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var a=s[e]={exports:{}};o[e][0].call(a.exports,function(t){return l(o[e][1][t]||t)},a,a.exports,i,o,s,u)}return s[e].exports}for(var c="function"==typeof h&amp;&amp;h,t=0;t&lt;u.length;t++)l(u[t]);return l}({1:[function(t,e,r){"use strict";var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",s=i.split("").reduce(function(t,e,r){return t[e]=r,t},{});e.exports={toAlphaCode:function(t){if(void 0!==i[t])return i[t];for(var e=1,r=36,n="";r&lt;=t;t-=r,e++,r*=36);for(;e--;){var a=t%36;n=String.fromCharCode((a&lt;10?48:55)+a)+n,t=(t-a)/36}return n},fromAlphaCode:function(t){if(void 0!==s[t])return s[t];for(var e=0,r=1,n=36,a=1;r&lt;t.length;e+=n,r++,n*=36);for(var i=t.length-1;0&lt;=i;i--,a*=36){var o=t.charCodeAt(i)-48;10&lt;o&amp;&amp;(o-=7),e+=o*a}return e}}},{}],2:[function(t,e,r){"use strict";var o=t("./unpack");e.exports=function(t){var a=t.split("|").reduce(function(t,e){var r=e.split("");return t[r[0]]=r[1],t},{}),i={};return Object.keys(a).forEach(function(t){var e=o(a[t]);"true"===t&amp;&amp;(t=!0);for(var r=0;r&lt;e.length;r++){var n=e[r];!0===i.hasOwnProperty(n)?!1===Array.isArray(i[n])?i[n]=[i[n],t]:i[n].push(t):i[n]=t}}),i}},{"./unpack":4}],3:[function(t,e,r){"use strict";var a=t("../encoding");e.exports=function(t){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),r=0;r&lt;t.nodes.length;r++){var n=e.exec(t.nodes[r]);if(!n){t.symCount=r;break}t.syms[a.fromAlphaCode(n[1])]=a.fromAlphaCode(n[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}},{"../encoding":1}],4:[function(t,e,r){"use strict";var n=t("./symbols"),p=t("../encoding");e.exports=function(t){var m,d,e={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&amp;&amp;n(e),m=e,d=[],function t(e,r){var n,a,i,o,s=m.nodes[e];"!"===s[0]&amp;&amp;(d.push(r),s=s.slice(1));for(var u=s.split(/([A-Z0-9,]+)/g),l=0;l&lt;u.length;l+=2){var c=u[l],h=u[l+1];if(c){var f=r+c;","!==h&amp;&amp;void 0!==h?t((n=m,a=h,i=e,(o=p.fromAlphaCode(a))&lt;n.symCount?n.syms[o]:i+o+1-n.symCount),f):d.push(f)}}}(0,""),d}},{"../encoding":1,"./symbols":3}]},{},[2])(2)}),function(t){"object"==typeof n&amp;&amp;void 0!==r?r.exports=t():("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).unpack=t()}(function(){return function i(o,s,u){function l(e,t){if(!s[e]){if(!o[e]){var r="function"==typeof h&amp;&amp;h;if(!t&amp;&amp;r)return r(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var a=s[e]={exports:{}};o[e][0].call(a.exports,function(t){return l(o[e][1][t]||t)},a,a.exports,i,o,s,u)}return s[e].exports}for(var c="function"==typeof h&amp;&amp;h,t=0;t&lt;u.length;t++)l(u[t]);return l}({1:[function(t,e,r){"use strict";var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",s=i.split("").reduce(function(t,e,r){return t[e]=r,t},{});e.exports={toAlphaCode:function(t){if(void 0!==i[t])return i[t];for(var e=1,r=36,n="";r&lt;=t;t-=r,e++,r*=36);for(;e--;){var a=t%36;n=String.fromCharCode((a&lt;10?48:55)+a)+n,t=(t-a)/36}return n},fromAlphaCode:function(t){if(void 0!==s[t])return s[t];for(var e=0,r=1,n=36,a=1;r&lt;t.length;e+=n,r++,n*=36);for(var i=t.length-1;0&lt;=i;i--,a*=36){var o=t.charCodeAt(i)-48;10&lt;o&amp;&amp;(o-=7),e+=o*a}return e}}},{}],2:[function(t,e,r){"use strict";var o=t("./unpack");e.exports=function(t){var a=t.split("|").reduce(function(t,e){var r=e.split("");return t[r[0]]=r[1],t},{}),i={};return Object.keys(a).forEach(function(t){var e=o(a[t]);"true"===t&amp;&amp;(t=!0);for(var r=0;r&lt;e.length;r++){var n=e[r];!0===i.hasOwnProperty(n)?!1===Array.isArray(i[n])?i[n]=[i[n],t]:i[n].push(t):i[n]=t}}),i}},{"./unpack":4}],3:[function(t,e,r){"use strict";var a=t("../encoding");e.exports=function(t){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),r=0;r&lt;t.nodes.length;r++){var n=e.exec(t.nodes[r]);if(!n){t.symCount=r;break}t.syms[a.fromAlphaCode(n[1])]=a.fromAlphaCode(n[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}},{"../encoding":1}],4:[function(t,e,r){"use strict";var n=t("./symbols"),p=t("../encoding");e.exports=function(t){var m,d,e={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&amp;&amp;n(e),m=e,d=[],function t(e,r){var n,a,i,o,s=m.nodes[e];"!"===s[0]&amp;&amp;(d.push(r),s=s.slice(1));for(var u=s.split(/([A-Z0-9,]+)/g),l=0;l&lt;u.length;l+=2){var c=u[l],h=u[l+1];if(c){var f=r+c;","!==h&amp;&amp;void 0!==h?t((n=m,a=h,i=e,(o=p.fromAlphaCode(a))&lt;n.symCount?n.syms[o]:i+o+1-n.symCount),f):d.push(f)}}}(0,""),d}},{"../encoding":1,"./symbols":3}]},{},[2])(2)}),function(t){"object"==typeof n&amp;&amp;void 0!==r?r.exports=t():("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).unpack=t()}(function(){return function i(o,s,u){function l(e,t){if(!s[e]){if(!o[e]){var r="function"==typeof h&amp;&amp;h;if(!t&amp;&amp;r)return r(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var a=s[e]={exports:{}};o[e][0].call(a.exports,function(t){return l(o[e][1][t]||t)},a,a.exports,i,o,s,u)}return s[e].exports}for(var c="function"==typeof h&amp;&amp;h,t=0;t&lt;u.length;t++)l(u[t]);return l}({1:[function(t,e,r){"use strict";var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",s=i.split("").reduce(function(t,e,r){return t[e]=r,t},{});e.exports={toAlphaCode:function(t){if(void 0!==i[t])return i[t];for(var e=1,r=36,n="";r&lt;=t;t-=r,e++,r*=36);for(;e--;){var a=t%36;n=String.fromCharCode((a&lt;10?48:55)+a)+n,t=(t-a)/36}return n},fromAlphaCode:function(t){if(void 0!==s[t])return s[t];for(var e=0,r=1,n=36,a=1;r&lt;t.length;e+=n,r++,n*=36);for(var i=t.length-1;0&lt;=i;i--,a*=36){var o=t.charCodeAt(i)-48;10&lt;o&amp;&amp;(o-=7),e+=o*a}return e}}},{}],2:[function(t,e,r){"use strict";var o=t("./unpack");e.exports=function(t){var a=t.split("|").reduce(function(t,e){var r=e.split("");return t[r[0]]=r[1],t},{}),i={};return Object.keys(a).forEach(function(t){var e=o(a[t]);"true"===t&amp;&amp;(t=!0);for(var r=0;r&lt;e.length;r++){var n=e[r];!0===i.hasOwnProperty(n)?!1===Array.isArray(i[n])?i[n]=[i[n],t]:i[n].push(t):i[n]=t}}),i}},{"./unpack":4}],3:[function(t,e,r){"use strict";var a=t("../encoding");e.exports=function(t){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),r=0;r&lt;t.nodes.length;r++){var n=e.exec(t.nodes[r]);if(!n){t.symCount=r;break}t.syms[a.fromAlphaCode(n[1])]=a.fromAlphaCode(n[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}},{"../encoding":1}],4:[function(t,e,r){"use strict";var n=t("./symbols"),p=t("../encoding");e.exports=function(t){var m,d,e={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&amp;&amp;n(e),m=e,d=[],function t(e,r){var n,a,i,o,s=m.nodes[e];"!"===s[0]&amp;&amp;(d.push(r),s=s.slice(1));for(var u=s.split(/([A-Z0-9,]+)/g),l=0;l&lt;u.length;l+=2){var c=u[l],h=u[l+1];if(c){var f=r+c;","!==h&amp;&amp;void 0!==h?t((n=m,a=h,i=e,(o=p.fromAlphaCode(a))&lt;n.symCount?n.syms[o]:i+o+1-n.symCount),f):d.push(f)}}}(0,""),d}},{"../encoding":1,"./symbols":3}]},{},[2])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,r){e.exports={author:"Spencer Kelly &lt;spencermountain@gmail.com&gt; (http://spencermounta.in)",name:"compromise",description:"natural language processing in the browser",version:"11.12.4",main:"./builds/compromise.js",types:"./compromise.d.ts",repository:{type:"git",url:"git://github.com/nlp-compromise/compromise.git"},scripts:{test:'tape "./test/unit/**/*.test.js" | tap-dancer',"test:spec":'tape "./test/unit/**/*.test.js" | tap-spec',testb:'TESTENV=prod tape "./test/unit/**/*.test.js" | tap-spec',buildTest:"TESTENV=prod node ./scripts/test.js","test:types":"tsc --project test/types",browserTest:"node ./scripts/browserTest.js",benchmark:"node ./scripts/benchmark.js",build:"node ./scripts/build/index.js",pack:"node ./scripts/pack.js",prepublishOnly:"node ./scripts/prepublish",postpublish:"node ./scripts/postpublish",watch:"amble ./scratch.js",filesize:"node ./scripts/lib/filesize.js",coverage:"node ./scripts/postpublish/coverage.js",lint:"node ./scripts/prepublish/linter.js"},files:["builds/","docs/","compromise.d.ts"],dependencies:{"efrt-unpack":"2.0.3"},devDependencies:{"@babel/core":"7.2.0","@babel/preset-env":"7.2.0",amble:"0.0.7",babelify:"10.0.0",babili:"0.1.4",browserify:"16.2.3",chalk:"2.4.1",codecov:"3.1.0","compromise-plugin":"0.0.8",derequire:"2.0.6",eslint:"5.9.0",nyc:"13.1.0",shelljs:"0.8.3","tap-dancer":"0.1.2","tap-spec":"5.0.0",tape:"4.9.1","uglify-js":"3.4.9"},license:"MIT"}},{}],3:[function(t,e,a){"use strict";function r(t){return(r="function"==typeof Symbol&amp;&amp;"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&amp;&amp;"function"==typeof Symbol&amp;&amp;t.constructor===Symbol&amp;&amp;t!==Symbol.prototype?"symbol":typeof t})(t)}var i=t("./tags"),o={reset:"[0m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",black:"[30m"};void 0===e&amp;&amp;Object.keys(o).forEach(function(t){o[t]=""}),a.ensureString=function(t){return"string"==typeof t?t:"number"==typeof t?String(t):""},a.ensureObject=function(t){return"object"!==r(t)?{}:null===t||t instanceof Array?{}:t},a.titleCase=function(t){return t.charAt(0).toUpperCase()+t.substr(1)},a.copy=function(e){var r={};return e=a.ensureObject(e),Object.keys(e).forEach(function(t){r[t]=e[t]}),r},a.extend=function(t,e){t=a.copy(t);for(var r=Object.keys(e),n=0;n&lt;r.length;n++)t[r[n]]=e[r[n]];return t},a.green=function(t){return o.green+t+o.reset},a.red=function(t){return o.red+t+o.reset},a.blue=function(t){return o.blue+t+o.reset},a.magenta=function(t){return o.magenta+t+o.reset},a.cyan=function(t){return o.cyan+t+o.reset},a.yellow=function(t){return o.yellow+t+o.reset},a.black=function(t){return o.black+t+o.reset},a.printTag=function(t){if(i[t]){var e=i[t].color||"blue";return a[e](t)}return t},a.printTerm=function(t){for(var e=Object.keys(t.tags),r=0;r&lt;e.length;r++)if(i[e[r]]){var n=i[e[r]].color||"black";return a[n](t.out("text"))}return o.reset+t.plaintext+o.reset},a.leftPad=function(t,e,r){for(r=r||" ",t=t.toString();t.length&lt;e;)t+=r;return t},a.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},a.isObject=function(t){return t===Object(t)}},{"./tags":137}],4:[function(u,l,t){(function(t){"use strict";var a=u("./text/build"),e=u("../package.json"),r=u("./log"),n=u("./world/unpack"),i=u("./world"),o=i.w,s=function(t,e){e&amp;&amp;o.plugin({words:e});var r=a(t,o);return r.tagger(),r};s.unpack=function(t){return n(t)},s.version=e.version,s.verbose=function(t){r.enable(t)},s.tokenize=function(t){return a(t)},s.plugin=function(t){o.plugin(t)},s.addWords=function(t){o.plugin({words:t})},s.addTags=function(t){o.plugin({tags:t})},s.addRegex=function(t){o.plugin({regex:t})},s.addPatterns=function(t){o.plugin({patterns:t})},s.addPlurals=function(t){o.plugin({plurals:t})},s.addConjugations=function(t){o.plugin({conjugations:t})},s.clone=function(){var n=i.reBuild(),t=function(t,e){e&amp;&amp;n.plugin({words:e});var r=a(t,n);return r.tagger(),r};return t.tokenize=s.tokenize,t.verbose=s.verbose,t.version=s.version,["Words","Tags","Regex","Patterns","Plurals","Conjugations"].forEach(function(e){t["add"+e]=function(t){n["add"+e](t)}}),t},"undefined"!=typeof self?self.nlp=s:"undefined"!=typeof window?window.nlp=s:void 0!==t&amp;&amp;(t.nlp=s),void 0!==l&amp;&amp;(l.exports=s)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../package.json":2,"./log":6,"./text/build":190,"./world":215,"./world/unpack":223}],5:[function(t,e,r){"use strict";var a=t("../fns");e.exports={tag:function(t,e,r){var n=t.normal||"["+t.silent_term+"]";n=a.leftPad("'"+n+"'",12),n+="  -&gt;   "+e,n+=a.leftPad(r||"",15),console.log("%c"+n," color: #a2c99c")},untag:function(t,e,r){var n=t.normal||"["+t.silent_term+"]";n=a.leftPad("'"+n+"'",12),n+="  ~*   "+e,n+="    "+(r||""),console.log("%c"+n," color: #b66a6a")}}},{"../fns":3}],6:[function(t,e,r){"use strict";var n=t("./client"),a=t("./server"),i=!1;e.exports={enable:function(t){void 0===t&amp;&amp;(t=!0),i=t},tag:function(t,e,r){!0!==i&amp;&amp;"tagger"!==i||("undefined"!=typeof window?n.tag(t,e,r):a.tag(t,e,r))},unTag:function(t,e,r){!0!==i&amp;&amp;"tagger"!==i||("undefined"!=typeof window?n.untag(t,e,r):a.untag(t,e,r))}}},{"./client":5,"./server":7}],7:[function(t,e,r){"use strict";var a=t("../fns");e.exports={tag:function(t,e,r){var n=t.normal||"["+t.silent_term+"]";n=a.yellow(n),n=a.leftPad("'"+n+"'",20),n+="  -&gt;   "+a.printTag(e),n=a.leftPad(n,54),console.log("       "+n+"("+a.cyan(r||"")+")")},untag:function(t,e,r){var n="-"+t.normal+"-";n=a.red(n),n=a.leftPad(n,20),n+="  ~*   "+a.red(e),n=a.leftPad(n,54),console.log("       "+n+"("+a.red(r||"")+")")}}},{"../fns":3}],8:[function(t,e,r){"use strict";e.exports={fns:t("./fns"),Terms:t("./terms")}},{"./fns":3,"./terms":165}],9:[function(t,e,r){"use strict";var n=t("../../text");e.exports=n.makeSubset({stripPeriods:function(){return this.list.forEach(function(t){t.terms.forEach(function(t){var e=t._text.split(".");2&lt;e.length&amp;&amp;(t.text=e.join(""))})}),this},addPeriods:function(){return this.list.forEach(function(t){t.terms.forEach(function(t){if(2&lt;t._text.split(".").length){var e=t._text.replace(/\./g,"");t.text=e.split("").join(".")+"."}})}),this},data:function(){return this.terms().list.map(function(t){var e=t.terms[0],r=e.text.toUpperCase().replace(/\./g,"").split("");return{periods:r.join("."),normal:r.join(""),text:e.text}})}},function(t,e){return t=t.match("#Acronym"),"number"==typeof e&amp;&amp;(t=t.get(e)),t})},{"../../text":192}],10:[function(t,e,r){"use strict";var n=t("../../text"),o=t("./methods"),a={data:function(){var i=this;return this.list.map(function(t){var e,r,n=t.out("normal"),a={normal:n,text:i.out("text"),comparative:"more "+n,superlative:"most "+n,adverbForm:null,nounForm:null};return 1==(e=n,r=i.world().words,!(!e||e.length&lt;=3)&amp;&amp;("Comparable"===r[e]||"Adjective"!==r[e]&amp;&amp;-1===e.indexOf(" ")))&amp;&amp;(a.comparative=o.toComparative(n)||a.comparative,a.superlative=o.toSuperlative(n)||a.superlative,a.adverbForm=o.toAdverb(n),a.nounForm=o.toNoun(n)),a})}};e.exports=n.makeSubset(a,function(t,e){return t=t.match("#Adjective"),"number"==typeof e&amp;&amp;(t=t.get(e)),t})},{"../../text":192,"./methods":11}],11:[function(t,e,r){"use strict";e.exports={toNoun:t("./toNoun"),toSuperlative:t("./toSuperlative"),toComparative:t("./toComparative"),toAdverb:t("./toAdverb"),toVerb:t("./toVerb")}},{"./toAdverb":12,"./toComparative":13,"./toNoun":14,"./toSuperlative":15,"./toVerb":16}],12:[function(t,e,r){"use strict";var n=[/airs$/,/ll$/,/ee.$/,/ile$/,/y$/],a=t("../../../world/more-data/irregularAdjectives").toAdverb,i=[{reg:/al$/i,repl:"ally"},{reg:/ly$/i,repl:"ly"},{reg:/(.{3})y$/i,repl:"$1ily"},{reg:/que$/i,repl:"quely"},{reg:/ue$/i,repl:"uly"},{reg:/ic$/i,repl:"ically"},{reg:/ble$/i,repl:"bly"},{reg:/l$/i,repl:"ly"}];e.exports=function(t){if(!0===a.hasOwnProperty(t))return a[t];for(var e=0;e&lt;n.length;e++)if(!0===n[e].test(t))return null;for(var r=0;r&lt;i.length;r++)if(!0===i[r].reg.test(t))return t.replace(i[r].reg,i[r].repl);return t+"ly"}},{"../../../world/more-data/irregularAdjectives":218}],13:[function(t,e,r){"use strict";var a=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/old$/,/oud$/,/e[ae]p$/],i=[/ary$/,/ous$/],o=t("../../../world/more-data/irregularAdjectives").toComparative,s=[{reg:/y$/i,repl:"ier"},{reg:/([aeiou])t$/i,repl:"$1tter"},{reg:/([aeou])de$/i,repl:"$1der"},{reg:/nge$/i,repl:"nger"}];e.exports=function(t){if(o.hasOwnProperty(t))return o[t];for(var e=0;e&lt;s.length;e++)if(!0===s[e].reg.test(t))return t.replace(s[e].reg,s[e].repl);for(var r=0;r&lt;i.length;r++)if(!0===i[r].test(t))return null;for(var n=0;n&lt;a.length;n++)if(!0===a[n].test(t))return t+"er";return!0===/e$/.test(t)?t+"r":t+"er"}},{"../../../world/more-data/irregularAdjectives":218}],14:[function(t,e,r){"use strict";var n={clean:"cleanliness",naivety:"naivety",hurt:"hurt"},a=[{reg:/y$/,repl:"iness"},{reg:/le$/,repl:"ility"},{reg:/ial$/,repl:"y"},{reg:/al$/,repl:"ality"},{reg:/ting$/,repl:"ting"},{reg:/ring$/,repl:"ring"},{reg:/bing$/,repl:"bingness"},{reg:/sing$/,repl:"se"},{reg:/ing$/,repl:"ment"},{reg:/ess$/,repl:"essness"},{reg:/ous$/,repl:"ousness"}];e.exports=function(t){if(n.hasOwnProperty(t))return n[t];var e=t.charAt(t.length-1);if("w"===e||"s"===e)return null;for(var r=0;r&lt;a.length;r++)if(!0===a[r].reg.test(t))return t.replace(a[r].reg,a[r].repl);return t+"ness"}},{}],15:[function(t,e,r){"use strict";var a=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/oud$/,/...p$/],i=[/ary$/],o=t("../../../world/more-data/irregularAdjectives").toSuperlative,s=[{reg:/y$/i,repl:"iest"},{reg:/([aeiou])t$/i,repl:"$1ttest"},{reg:/([aeou])de$/i,repl:"$1dest"},{reg:/nge$/i,repl:"ngest"},{reg:/([aeiou])te$/i,repl:"$1test"}];e.exports=function(t){if(o.hasOwnProperty(t))return o[t];for(var e=0;e&lt;s.length;e++)if(s[e].reg.test(t))return t.replace(s[e].reg,s[e].repl);for(var r=0;r&lt;i.length;r++)if(!0===i[r].test(t))return null;for(var n=0;n&lt;a.length;n++)if(!0===a[n].test(t))return"e"===t.charAt(t.length-1)?t+"st":t+"est";return t+"est"}},{"../../../world/more-data/irregularAdjectives":218}],16:[function(t,e,r){"use strict";var n={red:"redden",sad:"sadden",fat:"fatten"};e.exports=function(t){return!0===n.hasOwnProperty(t)?n[t]:!0===/e$/.test(t)?t+"n":t+"en"}},{}],17:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./toAdjective"),i={data:function(){return this.terms().list.map(function(t){var e=t.terms[0];return{adjectiveForm:a(e.normal),normal:e.normal,text:e.text}})}};e.exports=n.makeSubset(i,function(t,e){return t=(t=t.splitAfter("#Comma")).match("#Adverb+"),"number"==typeof e&amp;&amp;(t=t.get(e)),t})},{"../../text":192,"./toAdjective":18}],18:[function(t,e,r){"use strict";var n={idly:"idle",sporadically:"sporadic",basically:"basic",grammatically:"grammatical",alphabetically:"alphabetical",economically:"economical",conically:"conical",politically:"political",vertically:"vertical",practically:"practical",theoretically:"theoretical",critically:"critical",fantastically:"fantastic",mystically:"mystical",pornographically:"pornographic",fully:"full",jolly:"jolly",wholly:"whole"},a=[{reg:/bly$/i,repl:"ble"},{reg:/gically$/i,repl:"gical"},{reg:/([rsdh])ically$/i,repl:"$1ical"},{reg:/ically$/i,repl:"ic"},{reg:/uly$/i,repl:"ue"},{reg:/ily$/i,repl:"y"},{reg:/(.{3})ly$/i,repl:"$1"}];e.exports=function(t){if(n.hasOwnProperty(t))return n[t];for(var e=0;e&lt;a.length;e++)if(!0===a[e].reg.test(t))return t.replace(a[e].reg,a[e].repl);return t}},{}],19:[function(t,e,r){"use strict";var n=function(t,e){e.whitespace.after=t.whitespace.after,t.whitespace.after="",e.whitespace.before="",t.silent_term=t.text,e.silent_term=e.text,e.text="",t.tag("Contraction","new-contraction"),e.tag("Contraction","new-contraction")},a={can:"can't",will:"won't"};e.exports=function(t){return!1===t.expanded||t.match("#Contraction").found||(t.match("(#Noun|#QuestionWord) is").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'s",t.contracted=!0}),t.match("#PronNoun did").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'d",t.contracted=!0}),t.match("#QuestionWord (did|do)").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'d",t.contracted=!0}),t.match("#Noun (could|would)").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'d",t.contracted=!0}),t.match("(they|we|you) are").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'re",t.contracted=!0}),t.match("i am").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'m",t.contracted=!0}),t.match("(#Noun|#QuestionWord) will").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'ll",t.contracted=!0}),t.match("(they|we|you|i) have").list.forEach(function(t){n(t.terms[0],t.terms[1]),t.terms[0].text+="'ve",t.contracted=!0}),t.match("(#Copula|#Modal|do|does|have|has|can|will) not").list.forEach(function(t){n(t.terms[0],t.terms[1]),!0===a.hasOwnProperty(t.terms[0].text)?t.terms[0].text=a[t.terms[0].text]:t.terms[0].text+="n't",t.contracted=!0})),t}},{}],20:[function(t,e,r){"use strict";var n=t("../../paths").Terms,a=t("./contract"),i=t("./expand"),o=function(t,e,r){n.call(this,t,e,r)};(o.prototype=Object.create(n.prototype)).data=function(){var t=i(this.clone()),e=a(this.clone());return{text:this.out("text"),normal:this.out("normal"),expanded:{normal:t.out("normal"),text:t.out("text")},contracted:{normal:e.out("normal"),text:e.out("text")},isContracted:Boolean(this.contracted)}},o.prototype.expand=function(){return i(this)},o.prototype.contract=function(){return a(this)},e.exports=o},{"../../paths":8,"./contract":19,"./expand":21}],21:[function(t,e,r){"use strict";e.exports=function(t){return!1===t.contracted||t.terms.forEach(function(t){t.silent_term&amp;&amp;(t.text||(t.whitespace.before=" "),t._text=t.silent_term,t.tags.TitleCase&amp;&amp;t.toTitleCase(),t.normalize(),t.silent_term=null,t.unTag("Contraction","expanded"))}),t}},{}],22:[function(t,e,r){"use strict";e.exports=function(t){var e=t.not("#Contraction"),r=e.match("(#Noun|#QuestionWord) (#Copula|did|do|have|had|could|would|will)");return r.concat(e.match("(they|we|you|i) have")),r.concat(e.match("i am")),r.concat(e.match("(#Copula|#Modal|do|does|have|has|can|will) not")),r.list.forEach(function(t){t.expanded=!0}),r}},{}],23:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./contraction"),i=t("./findPossible");e.exports=n.makeSubset({contract:function(){return this.list.forEach(function(t){return t.contract()}),this},expand:function(){return this.list.forEach(function(t){return t.expand()}),this},contracted:function(){return this.list=this.list.filter(function(t){return t.contracted}),this},expanded:function(){return this.list=this.list.filter(function(t){return!t.contracted}),this}},function(t,e){var r=t.match("#Contraction #Contraction #Contraction?");return r.list=r.list.map(function(t){var e=new a(t.terms,t.world,t.refText,t.refTerms);return e.contracted=!0,e}),i(t).list.forEach(function(t){var e=new a(t.terms,t.world,t.refText,t.refTerms);e.contracted=!1,r.list.push(e)}),r.sort("chronological"),"number"==typeof e&amp;&amp;(r=r.get(e)),r})},{"../../text":192,"./contraction":20,"./findPossible":22}],24:[function(t,e,r){"use strict";var n=t("../../paths").Terms,a=t("./parseDate"),i=function(t,e,r){n.call(this,t,e,r),this.month=this.match("#Month")};(i.prototype=Object.create(n.prototype)).data=function(){return{text:this.out("text"),normal:this.out("normal"),date:a(this)}},e.exports=i},{"../../paths":8,"./parseDate":28}],25:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./date"),i=t("./weekday"),o=t("./month"),s={toShortForm:function(){return this.match("#Month").terms().list.forEach(function(t){var e=t.terms[0];o.toShortForm(e)}),this.match("#WeekDay").terms().list.forEach(function(t){var e=t.terms[0];i.toShortForm(e)}),this},toLongForm:function(){return this.match("#Month").terms().list.forEach(function(t){var e=t.terms[0];o.toLongForm(e)}),this.match("#WeekDay").terms().list.forEach(function(t){var e=t.terms[0];i.toLongForm(e)}),this}};e.exports=n.makeSubset(s,function(t,e){var r=t.match("#Date+");return"number"==typeof e&amp;&amp;(r=r.get(e)),r.list=r.list.map(function(t){return new a(t.terms,t.world,t.refText,t.refTerms)}),r})},{"../../text":192,"./date":24,"./month":27,"./weekday":31}],26:[function(t,e,r){"use strict";r.longMonths={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11},r.shortMonths={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11,febr:1,sept:8}},{}],27:[function(t,e,r){"use strict";var n=t("./data"),a=n.shortMonths,i=n.longMonths,o=function(t){return t.charAt(0).toUpperCase()+t.substr(1)};e.exports={index:function(t){if(t.tags.Month){if(void 0!==i[t.normal])return i[t.normal];if(void 0!==a[t.normal])return a[t.normal]}return null},toShortForm:function(t){if(void 0!==t.tags.Month&amp;&amp;void 0!==i[t.normal]){var e=Object.keys(a),r=t.getPunctuation()||"";t.text=e[i[t.normal]]+r,t.tags.TitleCase&amp;&amp;(t.text=o(t.text))}return t.dirty=!0,t},toLongForm:function(t){if(void 0!==t.tags.Month&amp;&amp;void 0!==a[t.normal]){var e=Object.keys(i),r=t.getPunctuation()||"";t.text=e[a[t.normal]]+r,t.tags.TitleCase&amp;&amp;(t.text=o(t.text))}return t.dirty=!0,t}}},{"./data":26}],28:[function(t,e,r){"use strict";var u=t("./parseTime"),l=t("./weekday"),c=t("./month"),h=function(t){return!!(t&amp;&amp;t&lt;31&amp;&amp;0&lt;t)},f=function(t){return!!(t&amp;&amp;1e3&lt;t&amp;&amp;t&lt;3e3)};e.exports=function(t){var e={month:null,date:null,weekday:null,year:null,named:null,time:null},r=t.match("(#Holiday|today|tomorrow|yesterday)");if(r.found&amp;&amp;(e.named=r.out("normal")),(r=t.match("#Month")).found&amp;&amp;(e.month=c.index(r.list[0].terms[0])),(r=t.match("#WeekDay")).found&amp;&amp;(e.weekday=l.index(r.list[0].terms[0])),(r=t.match("#Time")).found&amp;&amp;(e.time=u(t),t.not("#Time")),(r=t.match("#Month #Value #Year")).found){var n=r.values().numbers();h(n[0])&amp;&amp;(e.date=n[0]);var a=parseInt(t.match("#Year").out("normal"),10);f(a)&amp;&amp;(e.year=a)}if(!r.found){if((r=t.match("#Month #Value")).found){var i=r.values().numbers()[0];h(i)&amp;&amp;(e.date=i)}if((r=t.match("#Month #Year")).found){var o=parseInt(t.match("#Year").out("normal"),10);f(o)&amp;&amp;(e.year=o)}}if((r=t.match("#Value of #Month")).found){var s=r.values().numbers()[0];h(s)&amp;&amp;(e.date=s)}return e}},{"./month":27,"./parseTime":29,"./weekday":31}],29:[function(t,e,r){"use strict";var i=/([12]?[0-9]) ?(am|pm)/i,o=/([12]?[0-9]):([0-9][0-9]) ?(am|pm)?/i,s=function(t){return!!(t&amp;&amp;0&lt;t&amp;&amp;t&lt;25)};e.exports=function(t){var a={logic:null,hour:null,minute:null,second:null,timezone:null},e=t.match("(by|before|for|during|at|until|after) #Time").firstTerm();return e.found&amp;&amp;(a.logic=e.out("normal")),t.match("#Time").terms().list.forEach(function(t){var e,r=t.terms[0],n=r.text.match(i);null!==n&amp;&amp;(a.hour=parseInt(n[1],10),"pm"===n[2]&amp;&amp;(a.hour+=12),!1===s(a.hour)&amp;&amp;(a.hour=null)),null!==(n=r.text.match(o))&amp;&amp;(a.hour=parseInt(n[1],10),a.minute=parseInt(n[2],10),(e=a.minute)&amp;&amp;0&lt;e&amp;&amp;e&lt;60||(a.minute=null),"pm"===n[3]&amp;&amp;(a.hour+=12),!1===s(a.hour)&amp;&amp;(a.hour=null))}),a}},{}],30:[function(t,e,r){"use strict";r.longDays={sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},r.shortDays={sun:0,mon:1,tues:2,wed:3,weds:3,thurs:4,fri:5,sat:6}},{}],31:[function(t,e,r){"use strict";var n=t("./data"),a=n.shortDays,i=n.longDays;e.exports={index:function(t){if(t.tags.WeekDay){if(void 0!==i[t.normal])return i[t.normal];if(void 0!==a[t.normal])return a[t.normal]}return null},toShortForm:function(t){if(t.tags.WeekDay&amp;&amp;void 0!==i[t.normal]){var e=Object.keys(a);t.text=e[i[t.normal]]}return t},toLongForm:function(t){if(t.tags.WeekDay&amp;&amp;void 0!==a[t.normal]){var e=Object.keys(i);t.text=e[a[t.normal]]}return t}}},{"./data":30}],32:[function(t,e,r){"use strict";var n=t("./index"),i=t("./getGrams"),o=function(t,e,r){n.call(this,t,e,r)};o.prototype=Object.create(n.prototype),o.find=function(t,e,r){var n={size:[1,2,3,4],edge:"end"};r&amp;&amp;(n.size=[r]);var a=i(t,n);return(t=new o(a)).sort(),"number"==typeof e&amp;&amp;(t=t.get(e)),t},e.exports=o},{"./getGrams":33,"./index":35}],33:[function(t,e,r){"use strict";var u=t("./gram"),l=function(t){return t.terms.filter(function(t){return""!==t._text})};e.exports=function(t,i){(i=i||{}).size=i.size||[1,2,3],"number"==typeof i.size&amp;&amp;(i.size=[i.size]);var s={};return i.size.forEach(function(a){t.list.forEach(function(o){var t,e,r,n;("start"===i.edge?(r=a,(n=l(o)).length&lt;r?[]:[new u(n.slice(0,r))]):"end"===i.edge?(t=a,(e=l(o)).length&lt;t?[]:[new u(e.slice(e.length-t,e.length))]):function(t,e){var r=l(o);if(r.length&lt;e)return[];for(var n=[],a=0;a&lt;r.length-e+1;a++){var i=new u(r.slice(a,a+e));n.push(i)}return n}(0,a)).forEach(function(t){s.hasOwnProperty(t.key)?s[t.key].inc():s[t.key]=t})})}),Object.keys(s).map(function(t){return s[t]})}},{"./gram":34}],34:[function(t,e,r){"use strict";var n=t("../../paths").Terms,a=function(t,e,r){n.call(this,t,e,r),this.key=this.out("normal"),this.size=t.length,this.count=1};(a.prototype=Object.create(n.prototype)).inc=function(){this.count+=1},e.exports=a},{"../../paths":8}],35:[function(t,e,r){"use strict";var o=t("../../text"),s=t("./getGrams"),u=function(t){return t.list=t.list.sort(function(t,e){return t.count&gt;e.count?-1:t.count===e.count&amp;&amp;(t.size&gt;e.size||t.key.length&gt;e.key.length)?-1:1}),t},n={data:function(){return this.list.map(function(t){return{normal:t.out("normal"),count:t.count,size:t.size}})},unigrams:function(){return this.list=this.list.filter(function(t){return 1===t.size}),this},bigrams:function(){return this.list=this.list.filter(function(t){return 2===t.size}),this},trigrams:function(){return this.list=this.list.filter(function(t){return 3===t.size}),this},sort:function(){return u(this)}};e.exports=o.makeSubset(n,function(t,e){var r=[];"number"==typeof e&amp;&amp;(e={n:e});for(var n=(e=e||{}).max||4,a=1;a&lt;=n;a++)r.push(a);e.size&amp;&amp;(r=[e.size]);var i=s(t,{size:r});return t=new o(i),t=u(t),void 0!==e.n&amp;&amp;(t=t.get(e.n)),t})},{"../../text":192,"./getGrams":33}],36:[function(t,e,r){"use strict";var n=t("./index"),i=t("./getGrams"),o=function(t,e,r){n.call(this,t,e,r)};o.prototype=Object.create(n.prototype),o.find=function(t,e,r){var n={size:[1,2,3,4],edge:"start"};r&amp;&amp;(n.size=[r]);var a=i(t,n);return(t=new o(a)).sort(),"number"==typeof e&amp;&amp;(t=t.get(e)),t},e.exports=o},{"./getGrams":33,"./index":35}],37:[function(t,e,r){"use strict";e.exports=function(t){if(!t.tags.Noun)return!1;if(t.tags.Plural)return!0;for(var e=["Pronoun","Place","Value","Person","Month","WeekDay","RelativeDay","Holiday"],r=0;r&lt;e.length;r++)if(t.tags[e[r]])return!1;return!0!==t.tags.Uncountable}},{}],38:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./noun");e.exports=n.makeSubset({isPlural:function(){return this.list=this.list.filter(function(t){return t.isPlural()}),this},hasPlural:function(){return this.list.map(function(t){return t.hasPlural()})},toPlural:function(){return this.list.forEach(function(t){return t.toPlural()}),this},toSingular:function(e){return this.list.forEach(function(t){return t.toSingular(e)}),this},toPossessive:function(e){return this.list.forEach(function(t){return t.toPossessive(e)}),this},articles:function(){return this.list.map(function(t){return{text:t.out("text"),normal:t.out("normal"),article:t.article()}})}},function(t,e){return t=(t=(t=(t=(t=(t=(t=t.clauses()).match("#Noun+ (of|by)? the? #Noun+?")).not("#Pronoun")).not("(there|these)")).not("(#Month|#WeekDay)")).not("(my|our|your|their|her|his)")).not("(of|for|by|the)$"),"number"==typeof e&amp;&amp;(t=t.get(e)),t.list=t.list.map(function(t){return new a(t.terms,t.world,t.refText,t.refTerms)}),t})},{"../../text":192,"./noun":46}],39:[function(t,e,r){"use strict";var o=t("./methods/data/indicators"),s=/([a-z]*) (of|in|by|for) [a-z]/,u=t("./hasPlural"),l={i:!1,he:!1,she:!1,we:!0,they:!0},c=["Place","Value","Person","Month","WeekDay","RelativeDay","Holiday","Possessive"];e.exports=function(t,e){if(t.tags.Plural)return!0;if(t.tags.Singular)return!1;var r=t.normal;if(!0===l.hasOwnProperty(r))return l[r];if(e.plurals&amp;&amp;!0===e.plurals.hasOwnProperty(r))return!1;if(e.cache.toSingular&amp;&amp;!0===e.cache.toSingular.hasOwnProperty(r))return!0;if(!1===function(t){if(!1===u(t))return!1;for(var e=0;e&lt;c.length;e++)if(t.tags[c[e]])return!1;return!0}(t))return null;var n=r.match(s);null!==n&amp;&amp;(r=n[1]);for(var a=0;a&lt;o.plural_indicators.length;a++)if(!0===o.plural_indicators[a].test(r))return!0;for(var i=0;i&lt;o.singular_indicators.length;i++)if(!0===o.singular_indicators[i].test(r))return!1;return!0===/s$/.test(r)&amp;&amp;!1===/ss$/.test(r)&amp;&amp;3&lt;r.length}},{"./hasPlural":37,"./methods/data/indicators":41}],40:[function(t,e,r){"use strict";var a={hour:"an",heir:"an",heirloom:"an",honest:"an",honour:"an",honor:"an",uber:"an"},i={a:!0,e:!0,f:!0,h:!0,i:!0,l:!0,m:!0,n:!0,o:!0,r:!0,s:!0,x:!0},o=[/^onc?e/i,/^u[bcfhjkqrstn][aeiou]/i,/^eul/i];e.exports=function(t){var e=t.normal;if(t.tags.Person)return"";if(t.tags.Plural)return"the";if(a.hasOwnProperty(e))return a[e];var r=e.substr(0,1);if(t.isAcronym()&amp;&amp;i.hasOwnProperty(r))return"an";for(var n=0;n&lt;o.length;n++)if(o[n].test(e))return"a";return/^[aeiou]/i.test(e)?"an":"a"}},{}],41:[function(t,e,r){"use strict";e.exports={singular_indicators:[/(ax|test)is$/i,/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,/(octop|vir)i$/i,/(rl)f$/i,/(alias|status)$/i,/(bu)s$/i,/(al|ad|at|er|et|ed|ad)o$/i,/(ti)um$/i,/(ti)a$/i,/sis$/i,/(?:(^f)fe|(lr)f)$/i,/hive$/i,/(^aeiouy|qu)y$/i,/(x|ch|ss|sh|z)$/i,/(matr|vert|ind|cort)(ix|ex)$/i,/(m|l)ouse$/i,/(m|l)ice$/i,/(antenn|formul|nebul|vertebr|vit)a$/i,/.sis$/i,/^(?!talis|.*hu)(.*)man$/i],plural_indicators:[/(^v)ies$/i,/ises$/i,/ives$/i,/(antenn|formul|nebul|vertebr|vit)ae$/i,/(octop|vir|radi|nucle|fung|cact|stimul)i$/i,/(buffal|tomat|tornad)oes$/i,/(analy|ba|diagno|parenthe|progno|synop|the)ses$/i,/(vert|ind|cort)ices$/i,/(matr|append)ices$/i,/(x|ch|ss|sh|s|z|o)es$/i,/men$/i,/news$/i,/.tia$/i,/(^f)ves$/i,/(lr)ves$/i,/(^aeiouy|qu)ies$/i,/(m|l)ice$/i,/(cris|ax|test)es$/i,/(alias|status)es$/i,/ics$/i]}},{}],42:[function(t,e,r){"use strict";e.exports=[[/(ax|test)is$/i,"$1es"],[/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,"$1i"],[/(octop|vir)i$/i,"$1i"],[/(kn|l|w)ife$/i,"$1ives"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)f$/i,"$1ves"],[/^(dwar|handkerchie|hoo|scar|whar)f$/i,"$1ves"],[/(alias|status)$/i,"$1es"],[/(bu)s$/i,"$1ses"],[/(al|ad|at|er|et|ed|ad)o$/i,"$1oes"],[/([ti])um$/i,"$1a"],[/([ti])a$/i,"$1a"],[/sis$/i,"ses"],[/(hive)$/i,"$1s"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/(x|ch|ss|sh|s|z)$/i,"$1es"],[/(matr|vert|ind|cort)(ix|ex)$/i,"$1ices"],[/([m|l])ouse$/i,"$1ice"],[/([m|l])ice$/i,"$1ice"],[/^(ox)$/i,"$1en"],[/^(oxen)$/i,"$1"],[/(quiz)$/i,"$1zes"],[/(antenn|formul|nebul|vertebr|vit)a$/i,"$1ae"],[/(sis)$/i,"ses"],[/^(?!talis|.*hu)(.*)man$/i,"$1men"],[/(.*)/i,"$1s"]].map(function(t){return{reg:t[0],repl:t[1]}})},{}],43:[function(t,e,r){"use strict";e.exports=[[/([^v])ies$/i,"$1y"],[/ises$/i,"isis"],[/(kn|[^o]l|w)ives$/i,"$1ife"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)ves$/i,"$1f"],[/^(dwar|handkerchie|hoo|scar|whar)ves$/i,"$1f"],[/(antenn|formul|nebul|vertebr|vit)ae$/i,"$1a"],[/(octop|vir|radi|nucle|fung|cact|stimul)(i)$/i,"$1us"],[/(buffal|tomat|tornad)(oes)$/i,"$1o"],[/(..[aeiou]s)es$/i,"$1"],[/(vert|ind|cort)(ices)$/i,"$1ex"],[/(matr|append)(ices)$/i,"$1ix"],[/(x|ch|ss|sh|z|o)es$/i,"$1"],[/men$/i,"man"],[/(n)ews$/i,"$1ews"],[/([ti])a$/i,"$1um"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/(s)eries$/i,"$1eries"],[/(m)ovies$/i,"$1ovie"],[/([m|l])ice$/i,"$1ouse"],[/(cris|ax|test)es$/i,"$1is"],[/(alias|status)es$/i,"$1"],[/(ss)$/i,"$1"],[/(ics)$/i,"$1"],[/s$/i,""]].map(function(t){return{reg:t[0],repl:t[1]}})},{}],44:[function(t,e,r){"use strict";var a=t("./data/pluralRules");e.exports=function(t,e){var r=e.plurals||{};if(!0===r.hasOwnProperty(t))return r[t];for(var n=0;n&lt;a.length;n++)if(!0===a[n].reg.test(t))return t.replace(a[n].reg,a[n].repl);return null}},{"./data/pluralRules":42}],45:[function(t,e,r){"use strict";var u=t("./data/singleRules");e.exports=function t(e,r){var n=r.cache.toSingular||{};if(!0===n.hasOwnProperty(e))return n[e];if(r&amp;&amp;r.plurals)for(var a=Object.keys(r.plurals),i=0;i&lt;a.length;i++)if(r.plurals[a[i]]===e)return a[i];if(!0===/([a-z]*) (of|in|by|for) [a-z]/.test(e)){var o=(e.match(/^([a-z]*) (of|in|by|for) [a-z]/)||[])[1];if(o)return t(o)+e.replace(o,"")}for(var s=0;s&lt;u.length;s++)if(!0===u[s].reg.test(e))return e.replace(u[s].reg,u[s].repl);return null}},{"./data/singleRules":43}],46:[function(t,e,r){"use strict";var n=t("../../paths").Terms,a=t("./hasPlural"),i=t("./isPlural"),o=t("./toPossessive"),s=t("./makeArticle"),u=t("./methods/pluralize"),l=t("./methods/singularize"),c={article:function(){return s(this.main)},isPlural:function(){return i(this.main,this.world)},hasPlural:function(){return a(this.main)},toPlural:function(t){var e=this.main;return a(e)&amp;&amp;!i(e,this.world)&amp;&amp;(e.text=u(e.normal,this.world,t)||e.text,e.unTag("Singular","toPlural"),e.tag("Plural","toPlural")),this},toSingular:function(t){var e=this.main;return i(e,this.world)&amp;&amp;(e.text=l(e.normal,this.world,t)||e.text,e.unTag("Plural","toSingular"),e.tag("Singular","toSingular")),this},toPossessive:function(){var t=this.main;return t.tags.Possessive||(t=o(t)),this},data:function(){var t=this.main,e=t.text;i(t,this.world)&amp;&amp;(e=l(t.normal,this.world)||t.text);var r=t.text;a(t)&amp;&amp;!i(t,this.world)&amp;&amp;(r=u(t.normal,this.world)||t.text);var n="";return this.qualifier&amp;&amp;(e+=" "+(n=this.qualifier.out("normal")),r+=" "+n),{text:this.out("text"),normal:this.out("normal"),article:this.article(),main:t.normal,qualifier:n,singular:e,plural:r}}},h=function(t,e,r){n.call(this,t,e,r),this.main=this.match("[#Noun+] (of|by|for)"),this.main.found?this.main=this.main.list[0].terms[0]:this.main=this.terms[this.terms.length-1],this.qualifier=this.match(this.main.normal+" [.+]").list[0]};h.prototype=Object.create(n.prototype),Object.keys(c).forEach(function(t){h.prototype[t]=c[t]}),e.exports=h},{"../../paths":8,"./hasPlural":37,"./isPlural":39,"./makeArticle":40,"./methods/pluralize":44,"./methods/singularize":45,"./toPossessive":47}],47:[function(t,e,r){"use strict";var n={he:"his",she:"hers",they:"theirs",we:"ours",i:"mine",you:"yours",her:"hers",their:"theirs",our:"ours",my:"mine",your:"yours"};e.exports=function(t){return t.tag("Possessive","toPossessive"),n.hasOwnProperty(t.normal)?t.text=n[t.normal]:/s$/.test(t.normal)?t.text+="'":t.text+="'s",t}},{}],48:[function(t,e,r){"use strict";e.exports=function(t){return t?!0===/.(i|ee|[a|e]y|a)$/.test(t)?"Female":!0===/[ou]$/.test(t)?"Male":!0===/(nn|ll|tt)/.test(t)?"Female":null:null}},{}],49:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./person");e.exports=n.makeSubset({pronoun:function(){return this.list.map(function(t){return t.pronoun()})},firstNames:function(){return this.match("#FirstName")},lastNames:function(){return this.match("#LastName")}},function(t,e){var r=t.clauses();return r=r.match("#Person+"),"number"==typeof e&amp;&amp;(r=r.get(e)),r.list=r.list.map(function(t){return new a(t.terms,t.world,t.refText,t.refTerms)}),r})},{"../../text":192,"./person":50}],50:[function(t,e,r){"use strict";var i=t("../../paths").Terms,n=t("./guessGender"),a=function(t,e,r,n){if(i.call(this,t,e,r,n),this.firstName=this.match("#FirstName+"),this.middleName=this.match("#Acronym+"),this.nickName=this.match("#NickName+"),this.honorifics=this.match("#Honorific"),this.lastName=this.match("#LastName+"),!this.firstName.found&amp;&amp;1&lt;this.length){var a=this.not("(#Acronym|#Honorific)");this.firstName=a.first(),this.lastName=a.last()}return this};a.prototype=Object.create(i.prototype);var o={data:function(){return{text:this.out("text"),normal:this.out("normal"),firstName:this.firstName.out("normal"),middleName:this.middleName.out("normal"),nickName:this.nickName.out("normal"),lastName:this.lastName.out("normal"),genderGuess:this.guessGender(),pronoun:this.pronoun(),honorifics:this.honorifics.out("array")}},guessGender:function(){if(this.honorifics.match("(mr|mister|sr|sir|jr)").found)return"Male";if(this.honorifics.match("(mrs|miss|ms|misses|mme|mlle)").found)return"Female";if(this.firstName.match("#MaleName").found)return"Male";if(this.firstName.match("#FemaleName").found)return"Female";var t=this.firstName.out("normal");return n(t)},pronoun:function(){var t=this.firstName.out("normal"),e=this.guessGender(t);return"Male"===e?"he":"Female"===e?"she":"they"},root:function(){var t=this.firstName.out("root"),e=this.lastName.out("root");return t&amp;&amp;e?t+" "+e:e||t||this.out("root")}};Object.keys(o).forEach(function(t){a.prototype[t]=o[t]}),e.exports=a},{"../../paths":8,"./guessGender":48}],51:[function(t,e,r){"use strict";var n=t("../../text");e.exports=n.makeSubset({strip:function(){return this.list.forEach(function(t){var e=t.terms[t.terms.length-1];e.text=e.text.replace(/'s$/,""),e.unTag("Possessive",".strip()")}),this}},function(t,e){return t=(t=t.match("#Possessive+")).splitAfter("#Comma"),"number"==typeof e&amp;&amp;(t=t.get(e)),t})},{"../../text":192}],52:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./sentence"),i={toPastTense:function(){return this.list=this.list.map(function(t){return t=t.toPastTense(),new a(t.terms,t.world,t.refText,t.refTerms)}),this},toPresentTense:function(){return this.list=this.list.map(function(t){return t=t.toPresentTense(),new a(t.terms,t.world,t.refText,t.refTerms)}),this},toFutureTense:function(){return this.list=this.list.map(function(t){return t=t.toFutureTense(),new a(t.terms,t.world,t.refText,t.refTerms)}),this},toContinuous:function(){return this.list=this.list.map(function(t){return t=t.toContinuous(),new a(t.terms,t.world,t.refText,t.refTerms)}),this},toNegative:function(){return this.list=this.list.map(function(t){return t=t.toNegative(),new a(t.terms,t.world,t.refText,t.refTerms)}),this},toPositive:function(){return this.list=this.list.map(function(t){return t=t.toPositive(),new a(t.terms,t.world,t.refText,t.refTerms)}),this},isPassive:function(){return this.list=this.list.filter(function(t){return t.isPassive()}),this},isQuestion:function(){return this.questions()},prepend:function(e){return this.list=this.list.map(function(t){return t.prepend(e)}),this},append:function(e){return this.list=this.list.map(function(t){return t.append(e)}),this},toExclamation:function(){return this.list.forEach(function(t){t.setPunctuation("!")}),this},toQuestion:function(){return this.list.forEach(function(t){t.setPunctuation("?")}),this},toStatement:function(){return this.list.forEach(function(t){t.setPunctuation(".")}),this}};e.exports=n.makeSubset(i,function(t,e){return t=t.all(),"number"==typeof e&amp;&amp;(t=t.get(e)),t.list=t.list.map(function(t){return new a(t.terms,t.world,t.refText,t.refTerms)}),t})},{"../../text":192,"./sentence":54}],53:[function(t,e,r){"use strict";e.exports=function(t){var e=t.getPunctuation(),r=t.match("*").splitAfter("#Comma");return!(!0!==/\?/.test(e)&amp;&amp;(/\.\.$/.test(t.out("text"))||t.has("^#QuestionWord")&amp;&amp;t.has("#Comma")||!t.has("^#QuestionWord")&amp;&amp;!t.has("^(do|does|did|is|was|can|could|will|would|may) #Noun")&amp;&amp;!t.has("^(have|must) you")&amp;&amp;!r.has("^#QuestionWord")&amp;&amp;!r.has("(do|does|is|was) #Noun+ #Adverb? (#Adjective|#Infinitive)$")))}},{}],54:[function(t,e,r){"use strict";var a=t("../../paths").Terms,n=t("./toNegative"),i=t("./toPositive"),s=t("../verbs/verb"),o=t("./smartInsert"),u=function(t){var e=t.match("#Condition"),r=t.not("#Condition"),n=r.match("#VerbPhrase+").first(),a=n.out("normal"),i=r.match("#Determiner? #Adjective+? #Noun "+a).first().not("#VerbPhrase"),o=r.match(a+" #Preposition? #Determiner? #Noun").first().not("#VerbPhrase");return t.conditions=e,t.subject=i,t.verb=n,t.object=o,t.verb.found&amp;&amp;(t.verb=new s(t.verb.list[0].terms,t.world,t.refText,t.refTerms)),t},l=function(t){t.found&amp;&amp;t.contractions().expand()},c={toSingular:function(){return this.match("#Noun").match("!#Pronoun").firstTerm().things().toSingular(),this},toPlural:function(){return this.match("#Noun").match("!#Pronoun").firstTerm().things().toPlural(),this},mainVerb:function(){return u(this),this.verb.found?this.verb:null},toPastTense:function(){var t=this.mainVerb();if(t){var e=t.out("root");t.toPastTense();var r=this.match("#Contraction "+e);l(r);var n=t.out("root");return this.parentTerms.replace(e,n)}return this},toPresentTense:function(){var t,e=this.mainVerb();if(e){var r=e.out("normal");if(1==!(!this.subject.found||!this.subject.has("(i|we)")))this.has("(am|will|did) "+r)&amp;&amp;((t=this).terms=t.terms.filter(function(t){if(t.silent_term){if("am"===t.silent_term||"will"===t.silent_term||"did"===t.silent_term)return!1;t.text=t.silent_term,t.silent_term=null,t.unTag("Contraction"),!0===t.tags.TitleCase&amp;&amp;t.toTitleCase()}return!0})),e.toInfinitive();else{e.toPresentTense();var n=this.match("#Contraction "+r);l(n)}var a=e.out("normal");return this.parentTerms.replace(r,a)}return this},toFutureTense:function(){var t=this.mainVerb();if(t){var e=t.clone();t.toFutureTense();var r=this.match("#Contraction "+e.out("normal"));l(r);var n=t.out("normal");return this.parentTerms.replace(e,n)}return this},toContinuous:function(){var t=this.mainVerb();if(t){var e=t.clone();t.toGerund();var r=this.match("#Contraction "+e.out("normal"));l(r);var n=t.out("normal");return this.parentTerms.replace(e,n)}return this},isNegative:function(){return 1===this.match("#Negative").list.length},toNegative:function(){return this.isNegative()?this:n(this)},toPositive:function(){return this.isNegative()?i(this):this},append:function(t){return o.append(this,t)},prepend:function(t){return o.prepend(this,t)},isPassive:function(){return this.match("was #Adverb? #PastTense #Adverb? by").found}},h=function(t,e,r,n){a.call(this,t,e,r,n),u(this)};h.prototype=Object.create(a.prototype),Object.keys(c).forEach(function(t){h.prototype[t]=c[t]}),e.exports=h},{"../../paths":8,"../verbs/verb":94,"./smartInsert":55,"./toNegative":56,"./toPositive":57}],55:[function(t,e,r){"use strict";var n=/^[A-Z]/;e.exports={append:function(t,e){var r=t.terms[t.terms.length-1],n=t.getPunctuation();n&amp;&amp;r.killPunctuation(),t.insertAt(t.terms.length,e);var a=t.terms[t.terms.length-1];return n&amp;&amp;(a.text+=n),r.whitespace.after&amp;&amp;(a.whitespace.after=r.whitespace.after,r.whitespace.after=""),t},prepend:function(t,e){var r=t.terms[0];return t.insertAt(0,e),n.test(r.text)&amp;&amp;(!1===r.needsTitleCase()&amp;&amp;r.toLowerCase(),t.terms[0].toTitleCase()),t}}},{}],56:[function(t,e,r){"use strict";var a={everyone:"no one",everybody:"nobody",someone:"no one",somebody:"nobody",always:"never"};e.exports=function(t){var e=t.match("(everyone|everybody|someone|somebody|always)").first();if(e.found&amp;&amp;a[e.out("normal")]){var r=e.out("normal");return(t=t.match(r).replaceWith(a[r]).list[0]).parentTerms}var n=t.mainVerb();return n&amp;&amp;n.toNegative(),t}},{}],57:[function(t,e,r){"use strict";var n={never:"always",nothing:"everything"};e.exports=function(t){var e=t.match("(never|nothing)").first();if(e.found){var r=e.out("normal");if(n[r])return(t=t.match(r).replaceWith(n[r],!0).list[0]).parentTerms}return t.delete("#Negative"),t}},{}],58:[function(t,e,r){"use strict";var a=t("../../text"),i=t("../../paths").Terms,n={data:function(){return this.list.map(function(t){var e=t.terms[0];return{spaceBefore:e.whitespace.before,text:e.text,spaceAfter:e.whitespace.after,normal:e.normal,implicit:e.silent_term,bestTag:e.bestTag(),tags:Object.keys(e.tags)}})}};e.exports=a.makeSubset(n,function(r,t){var n=[];return r.list.forEach(function(e){e.terms.forEach(function(t){n.push(new i([t],e.world,r))})}),r=new a(n,r.world,r.parent),"number"==typeof t&amp;&amp;(r=r.get(t)),r})},{"../../paths":8,"../../text":192}],59:[function(t,e,r){"use strict";var n=t("./numOrdinal"),a=t("./textOrdinal"),i=t("./textCardinal"),o=t("./niceNumber"),s={nice:function(t){return o(t)},ordinal:function(t){return n(t)},cardinal:function(t){return String(t)},niceOrdinal:function(t){return t=n(t),o(t)},text:function(t){return i(t).join(" ")},textOrdinal:function(t){return a(t)}};e.exports=s},{"./niceNumber":60,"./numOrdinal":61,"./textCardinal":62,"./textOrdinal":63}],60:[function(t,e,r){"use strict";e.exports=function(t){if(!t&amp;&amp;0!==t)return null;for(var e=(t=String(t)).split("."),r=e[0],n=1&lt;e.length?"."+e[1]:"",a=/(\d+)(\d{3})/;a.test(r);)r=r.replace(a,"$1,$2");return r+n}},{}],61:[function(t,e,r){"use strict";var i=t("./toString");e.exports=function(t){if(!t&amp;&amp;0!==t)return null;var e=t%100;if(10&lt;e&amp;&amp;e&lt;20)return String(t)+"th";var r={0:"th",1:"st",2:"nd",3:"rd"},n=i(t),a=n.slice(n.length-1,n.length);return n+(r[a]?r[a]:"th")}},{"./toString":64}],62:[function(t,e,r){"use strict";var u=t("./toString"),n=[["ninety",90],["eighty",80],["seventy",70],["sixty",60],["fifty",50],["forty",40],["thirty",30],["twenty",20]],a=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],l=[[1e24,"septillion"],[1e21,"sextillion"],[1e18,"quintillion"],[1e15,"quadrillion"],[1e12,"trillion"],[1e9,"billion"],[1e8,"hundred million"],[1e6,"million"],[1e5,"hundred thousand"],[1e3,"thousand"],[100,"hundred"],[1,"one"]],c=function(t){var e=[];if(100&lt;t)return e;for(var r=0;r&lt;n.length;r++)t&gt;=n[r][1]&amp;&amp;(t-=n[r][1],e.push(n[r][0]));return a[t]&amp;&amp;e.push(a[t]),e};e.exports=function(o){if(1e21&lt;o)return[String(o)];var t=[];o&lt;0&amp;&amp;(t.push("negative"),o=Math.abs(o));for(var r,n,a,e=(n=r=o,a=[],l.forEach(function(t){if(r&gt;=t[0]){var e=Math.floor(n/t[0]);n-=e*t[0],e&amp;&amp;a.push({unit:t[1],count:e})}}),a),i=0;i&lt;e.length;i++){var s=e[i].unit;"one"===s&amp;&amp;(s="",1&lt;t.length&amp;&amp;t.push("and")),(t=t.concat(c(e[i].count))).push(s)}return 0===(t=(t=t.concat(function(t){var e=["zero","one","two","three","four","five","six","seven","eight","nine"],r=[],n=u(o).match(/\.([0-9]+)/);if(!n||!n[0])return r;r.push("point");for(var a=n[0].split(""),i=0;i&lt;a.length;i++)r.push(e[a[i]]);return r}())).filter(function(t){return t})).length&amp;&amp;(t[0]=""),t}},{"./toString":64}],63:[function(t,e,r){"use strict";var n=t("./textCardinal"),a=t("../../../world/more-data/numbers").toOrdinal;e.exports=function(t){var e=n(t),r=e[e.length-1];return e[e.length-1]=a[r]||r,e.join(" ")}},{"../../../world/more-data/numbers":220,"./textCardinal":62}],64:[function(t,e,r){"use strict";e.exports=function(t){if(t&lt;1e6)return String(t);var e=t.toFixed(0);return-1===e.indexOf("e+")?e:e.replace(".","").split("e+").reduce(function(t,e){return t+Array(e-t.length+2).join(0)})}},{}],65:[function(t,e,r){"use strict";var n=t("../../text"),i=t("./value"),a=t("./parse"),o={noDates:function(){return this.not("#Date")},noUnits:function(){return this.not("#Unit")},units:function(){return this.match("#Unit+")},numbers:function(){return this.list.map(function(t){return t.number()})},toNumber:function(){return this.list=this.list.map(function(t){return t.toNumber()}),this},toText:function(){return this.list=this.list.map(function(t){return t.toText()}),this},toCardinal:function(){return this.list=this.list.map(function(t){return t.toCardinal()}),this},toOrdinal:function(){return this.list=this.list.map(function(t){return t.toOrdinal()}),this},toNice:function(){return this.list=this.list.map(function(t){return t.toNice()}),this},isEqual:function(e){return e=a(e),this.list=this.list.filter(function(t){return null!==e&amp;&amp;t.number()===e}),this},greaterThan:function(e){return e=a(e),this.list=this.list.filter(function(t){return null!==e&amp;&amp;t.number()&gt;e}),this},lessThan:function(e){return e=a(e),this.list=this.list.filter(function(t){return null!==e&amp;&amp;t.number()&lt;e}),this},between:function(r,n){return void 0===r||void 0===n||(r=a(r),n=a(n),this.list=this.list.filter(function(t){var e=t.number();return r&lt;e&amp;&amp;e&lt;n})),this},add:function(e){return this.list=this.list.map(function(t){return t.add(e)}),this},subtract:function(e){return this.list=this.list.map(function(t){return t.subtract(e)}),this},increment:function(){return this.list=this.list.map(function(t){return t.add(1)}),this},decrement:function(){return this.list=this.list.map(function(t){return t.subtract(1)}),this}};e.exports=n.makeSubset(o,function(t,e){var r="twenty|thirty|forty|fifty|sixty|seventy|eighty|ninety|fourty";if((t=t.match("#Value+ #Unit?")).has("#NumericValue #NumericValue")&amp;&amp;(t.has("#Value #Comma #Value")?t.splitAfter("#Comma"):t.splitAfter("#NumericValue")),t.has("#Value #Value #Value")&amp;&amp;!t.has("#Multiple")&amp;&amp;t.has("("+r+") #Cardinal #Cardinal")&amp;&amp;t.splitAfter("("+r+") #Cardinal"),t.has("#Value #Value")){t.has("#NumericValue #NumericValue")&amp;&amp;t.splitOn("#Year"),t.has("("+r+") (eleven|twelve|thirteen|fourteen|fifteen|sixteen|seventeen|eighteen|nineteen)")&amp;&amp;t.splitAfter("("+r+")");var n=t.match("#Cardinal #Cardinal");n.found&amp;&amp;!t.has("(point|decimal)")&amp;&amp;(n.has("#Cardinal (#Multiple|point|decimal)")||n.has("("+r+") #Cardinal")||n.has("#Multiple #Value")||t.splitAfter(n.terms(0).out("normal"))),t.match("#Ordinal #Ordinal").match("#TextValue").found&amp;&amp;!t.has("#Multiple")&amp;&amp;(t.has("("+r+") #Ordinal")||t.splitAfter("#Ordinal")),t.has("#Ordinal #Cardinal")&amp;&amp;t.splitBefore("#Cardinal+"),t.has("#TextValue #NumericValue")&amp;&amp;!t.has("("+r+"|#Multiple)")&amp;&amp;t.splitBefore("#NumericValue+")}t.has("#NumberRange")&amp;&amp;t.splitAfter("#NumberRange"),"number"==typeof e&amp;&amp;(t=t.get(e));var a=t.world();return t.list=t.list.map(function(t){return new i(t.terms,a,t.refText,t.refTerms)}),t})},{"../../text":192,"./parse":66,"./value":74}],66:[function(t,e,r){"use strict";var n=t("./parseText"),a=/^-?(\$|||)?\.?[0-9]+[0-9,\.]*(st|nd|rd|th|rth|%)?$/,i=function(t){if(!0===a.test(t)){t=(t=(t=(t=t.replace(/,/g,"")).replace(/^[\$|||]/g,"")).replace(/%$/,"")).replace(/(st|nd|rd|th|rth)$/g,"");var e=parseFloat(t);if(e||0===e)return e}return n(t)};e.exports=function(t){if(null==t||"number"==typeof t)return t;if("string"==typeof t)return i(t);if(1!==t.terms.length||!0===t.terms[0].tags.TextValue)return n(t.out("normal"));var e=t.terms[0].normal;return i(e)}},{"./parseText":69}],67:[function(t,e,r){"use strict";var n=t("../../../world/more-data/numbers"),a=t("../paths").fns,i=a.extend(n.ordinal.ones,n.cardinal.ones),o=a.extend(n.ordinal.teens,n.cardinal.teens),s=a.extend(n.ordinal.tens,n.cardinal.tens),u=a.extend(n.ordinal.multiples,n.cardinal.multiples);u.grand=1e3,e.exports={ones:i,teens:o,tens:s,multiples:u}},{"../../../world/more-data/numbers":220,"../paths":73}],68:[function(t,e,r){"use strict";e.exports=function(t){for(var e=[{reg:/^(minus|negative)[\s\-]/i,mult:-1},{reg:/^(a\s)?half[\s\-](of\s)?/i,mult:.5}],r=0;r&lt;e.length;r++)if(!0===e[r].reg.test(t))return{amount:e[r].mult,str:t.replace(e[r].reg,"")};return{amount:1,str:t}}},{}],69:[function(t,e,r){"use strict";var d=t("./findModifiers"),p=t("./data"),g=t("./validate"),v=t("./parseDecimals"),y=t("./parseNumeric"),b=/^([0-9,\. ]+)\/([0-9,\. ]+)$/,D={"a couple":2,"a dozen":12,"two dozen":24,zero:0},w=function(r){return Object.keys(r).reduce(function(t,e){return t+r[e]},0)};e.exports=function(t){if(!0===D.hasOwnProperty(t))return D[t];if("a"===t||"an"===t)return 1;for(var e=d(t),r=null,n={},a=0,i=!1,o=(t=e.str).split(/[ -]/),s=0;s&lt;o.length;s++){var u=o[s];if((u=y(u))&amp;&amp;"and"!==u)if("-"!==u&amp;&amp;"negative"!==u){if("-"===u.charAt(0)&amp;&amp;(i=!0,u=u.substr(1)),"point"===u)return a+=w(n),(a+=v(o.slice(s+1,o.length)))*e.amount;var l=u.match(b);if(l){var c=parseFloat(l[1].replace(/[, ]/g,"")),h=parseFloat(l[2].replace(/[, ]/g,""));h&amp;&amp;(a+=c/h||0)}else{if(!1===g(u,n))return null;if(/^[0-9\.]+$/.test(u))n.ones=parseFloat(u);else if(!0===p.ones.hasOwnProperty(u))n.ones=p.ones[u];else if(!0===p.teens.hasOwnProperty(u))n.teens=p.teens[u];else if(!0===p.tens.hasOwnProperty(u))n.tens=p.tens[u];else if(!0===p.multiples.hasOwnProperty(u)){var f=p.multiples[u];if(f===r)return null;if(100===f&amp;&amp;void 0!==o[s+1]){var m=o[s+1];p.multiples[m]&amp;&amp;(f*=p.multiples[m],s+=1)}null===r||f&lt;r?(a+=(w(n)||1)*f,r=f):a=((a+=w(n))||1)*(r=f),n={}}}}else i=!0}return a+=w(n),a*=e.amount,0==(a*=i?-1:1)&amp;&amp;0===Object.keys(n).length?null:a}},{"./data":67,"./findModifiers":68,"./parseDecimals":70,"./parseNumeric":71,"./validate":72}],70:[function(t,e,r){"use strict";var a=t("./data");e.exports=function(t){for(var e="0.",r=0;r&lt;t.length;r++){var n=t[r];if(!0===a.ones.hasOwnProperty(n))e+=a.ones[n];else if(!0===a.teens.hasOwnProperty(n))e+=a.teens[n];else if(!0===a.tens.hasOwnProperty(n))e+=a.tens[n];else{if(!0!==/^[0-9]$/.test(n))return 0;e+=n}}return parseFloat(e)}},{"./data":67}],71:[function(t,e,r){"use strict";e.exports=function(t){return(t=(t=(t=(t=(t=(t=(t=t.replace(/1st$/,"1")).replace(/2nd$/,"2")).replace(/3rd$/,"3")).replace(/([4567890])r?th$/,"$1")).replace(/^[$]/,"")).replace(/[%$]$/,"")).replace(/,/g,"")).replace(/([0-9])([a-z]{1,2})$/,"$1")}},{}],72:[function(t,e,r){"use strict";var n=t("./data");e.exports=function(t,e){if(n.ones.hasOwnProperty(t)){if(e.ones||e.teens)return!1}else if(n.teens.hasOwnProperty(t)){if(e.ones||e.teens||e.tens)return!1}else if(n.tens.hasOwnProperty(t)&amp;&amp;(e.ones||e.teens||e.tens))return!1;return!0}},{"./data":67}],73:[function(t,e,r){"use strict";e.exports=t("../../paths")},{"../../paths":8}],74:[function(t,e,r){"use strict";var a=t("../../paths").Terms,n=t("./parse"),i=t("./format"),o=function(t){return t.val=t.match("#Value+"),t.val=t.val.list[0],t.unit=t.match("#Unit+"),t.unit.found&amp;&amp;(t.unit=t.unit.list[0]),t},s=function(t,e){return!(!t.has("#Percent")&amp;&amp;!e.has("#Percent"))||"percent"===e.out("normal")||null!==t.out("normal").match(/%$/)},u=function(t,e){var r=t.val.out();return r=t.has("#Ordinal")?t.has("#TextValue")?i.textOrdinal(e):i.ordinal(e):t.has("#TextValue")?i.text(e):t.has("#NiceNumber")?i.nice(e):i.cardinal(e),t.unit.found&amp;&amp;(r+=t.unit.out("text")),t=t.replaceWith(r,!0),o(t)},l=function(t,e,r,n){a.call(this,t,e,r,n),o(this)};l.prototype=Object.create(a.prototype);var c={data:function(){var t=n(this.val);return{number:t,nice:i.nice(t),ordinal:i.ordinal(t),niceOrdinal:i.niceOrdinal(t),text:i.text(t),textOrdinal:i.textOrdinal(t),unit:this.unit.out("normal")}},number:function(){return n(this.val)},toNumber:function(){var t=n(this.val);if(t||0===t){var e="";this.val.has("#Ordinal")?e=i.ordinal(t):(e=String(t),s(this.val,this.unit)&amp;&amp;(e+="%",this.unit.delete())),this.unit.found&amp;&amp;(e+=this.unit.out("text")),this.replaceWith(e,!0).tag("NumericValue"),this.unit.found&amp;&amp;this.match(this.unit.out("normal")).tag("Unit")}return this},toText:function(){var t=n(this.val);if(t||0===t){var e="";this.val.has("#Ordinal")?e=i.textOrdinal(t):(e=i.text(t),s(this.val,this.unit)&amp;&amp;(e+=" percent")),this.unit.found&amp;&amp;(e+=this.unit.out("text")),this.replaceWith(e,!0).tag("TextValue"),this.unit.found&amp;&amp;this.match(this.unit.out("normal")).tag("Unit")}return this},toCardinal:function(){var t=n(this.val);if(t||0===t){var e="";e=this.val.has("#TextValue")?i.text(t):t,this.unit.found&amp;&amp;(e+=this.unit.out("text")),this.replaceWith(e,!0).tag("Cardinal"),this.unit.found&amp;&amp;this.match(this.unit.out("normal")).tag("Unit")}return this},toOrdinal:function(){var t=n(this.val);if(t||0===t){var e="";e=this.val.has("#TextValue")?i.textOrdinal(t):i.ordinal(t),this.unit.found&amp;&amp;(e+=this.unit.out("text")),this.replaceWith(e,!0).tag("Ordinal"),this.unit.found&amp;&amp;this.match(this.unit.out("normal")).tag("Unit")}return this},toNice:function(){var t=n(this.val);if(t||0===t){var e="";e=this.val.has("#Ordinal")?i.niceOrdinal(t):i.nice(t),this.unit.found&amp;&amp;(e+=this.unit.out("text")),this.replaceWith(e,!0).tag("NumericValue"),this.unit.found&amp;&amp;this.match(this.unit.out("normal")).tag("Unit")}return this},add:function(t){if(!t)return this;var e=n(this.val)||0;return u(this,e+=t)},subtract:function(t){if(!t)return this;var e=n(this.val)||0;return u(this,e-=t)},increment:function(){return this.add(1)},decrement:function(){return this.subtract(1)}};Object.keys(c).forEach(function(t){l.prototype[t]=c[t]}),e.exports=l},{"../../paths":8,"./format":59,"./parse":66}],75:[function(t,e,r){"use strict";var n=t("../../text"),a=t("./verb"),i={conjugation:function(e){return this.list.map(function(t){return t.conjugation(e)})},conjugate:function(t,e){return null!==t&amp;&amp;"number"==typeof t&amp;&amp;this.list[t]?this.list[t].conjugate(e):this.list.map(function(t){return t.conjugate(e)})},isPlural:function(){return this.list=this.list.filter(function(t){return t.isPlural()}),this},isSingular:function(){return this.list=this.list.filter(function(t){return!t.isPlural()}),this},isNegative:function(){return this.list=this.list.filter(function(t){return t.isNegative()}),this},isPositive:function(){return this.list=this.list.filter(function(t){return!t.isNegative()}),this},toNegative:function(){return this.list=this.list.map(function(t){return t.toNegative()}),this},toPositive:function(){return this.list.forEach(function(t){t.toPositive()}),this},toPastTense:function(){return this.list.forEach(function(t){t.toPastTense()}),this},toPresentTense:function(){return this.list.forEach(function(t){t.toPresentTense()}),this},toFutureTense:function(){return this.list.forEach(function(t){t.toFutureTense()}),this},toInfinitive:function(){return this.list.forEach(function(t){t.toInfinitive()}),this},toGerund:function(){return this.list.forEach(function(t){t.toGerund()}),this},asAdjective:function(){return this.list.map(function(t){return t.asAdjective()})}};i.toContinuous=i.toGerund,e.exports=n.makeSubset(i,function(t,e){return t=(t=(t=t.match("(#Adverb|#Auxiliary|#Verb|#Negative|#Particle)+")).splitAfter("#Comma")).if("#Verb"),"number"==typeof e&amp;&amp;(t=t.get(e)),t.list=t.list.map(function(t){return new a(t.terms,t.world,t.refText,t.refTerms)}),new n(t.list,this.world,this.parent)})},{"../../text":192,"./verb":94}],76:[function(t,e,r){"use strict";var s=t("./methods/predict"),u=t("./methods/isPlural");e.exports=function(t){var e,r,n,a,i,o;return{negative:2!==(e=t.match("#Negative").list).length&amp;&amp;1===e.length,continuous:(o=t,o.match("#Gerund").found),passive:(i=t,!!i.match("is being #PastTense").found||!!i.match("(had|has) been #PastTense").found||!!i.match("will have been #PastTense").found),perfect:(a=t,!!a.match("^(had|have) #PastTense")),plural:u(t),modal:(r=t,n=r.match("#Modal"),n.found?n.out("normal"):null),tense:function(t){if(t.auxiliary.found){if(t.match("will have #PastTense").found)return"Past";if(t.auxiliary.match("will").found)return"Future";if(t.auxiliary.match("was").found)return"Past"}return t.verb&amp;&amp;{PastTense:"Past",FutureTense:"Future",FuturePerfect:"Future"}[s(t.verb)]||"Present"}(t)}}},{"./methods/isPlural":86,"./methods/predict":87}],77:[function(t,e,r){"use strict";var s=t("./irregulars"),u=t("./suffixes"),l=t("./toActor"),c=t("./generic"),h=t("../predict"),f=t("../toInfinitive"),m=t("./toBe");e.exports=function(t,e){if("is"===t.normal||"was"===t.normal||"will"===t.normal)return m();t.tags.Contraction&amp;&amp;(t.text=t.silent_term);var r={PastTense:null,PresentTense:null,Infinitive:null,Gerund:null,Actor:null},n=h(t);n&amp;&amp;(r[n]=t.normal),"Infinitive"!==n&amp;&amp;(r.Infinitive=f(t,e)||"");var a=s(r.Infinitive,e)||{};Object.keys(a).forEach(function(t){a[t]&amp;&amp;!r[t]&amp;&amp;(r[t]=a[t])});var i=r.Infinitive||t.normal,o=u(i);return Object.keys(o).forEach(function(t){o[t]&amp;&amp;!r[t]&amp;&amp;(r[t]=o[t])}),r.Actor||(r.Actor=l(i)),Object.keys(r).forEach(function(t){!r[t]&amp;&amp;c[t]&amp;&amp;(r[t]=c[t](r))}),r}},{"../predict":87,"../toInfinitive":90,"./generic":80,"./irregulars":82,"./suffixes":83,"./toActor":84,"./toBe":85}],78:[function(t,e,r){"use strict";e.exports=[{reg:/(eave)$/i,repl:{pr:"$1s",pa:"$1d",gr:"eaving",ar:"$1r"}},{reg:/(ink)$/i,repl:{pr:"$1s",pa:"unk",gr:"$1ing",ar:"$1er"}},{reg:/([aeiou]k)in$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing",ar:"$1er"}},{reg:/(end)$/i,repl:{pr:"$1s",pa:"ent",gr:"$1ing",ar:"$1er"}},{reg:/(ide)$/i,repl:{pr:"$1s",pa:"ode",gr:"iding",ar:"ider"}},{reg:/(ake)$/i,repl:{pr:"$1s",pa:"ook",gr:"aking",ar:"$1r"}},{reg:/(eed)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing",ar:"$1er"}},{reg:/(e)(ep)$/i,repl:{pr:"$1$2s",pa:"$1pt",gr:"$1$2ing",ar:"$1$2er"}},{reg:/(a[tg]|i[zn]|ur|nc|gl|is)e$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing",prt:"$1en"}},{reg:/([i|f|rr])y$/i,repl:{pr:"$1ies",pa:"$1ied",gr:"$1ying"}},{reg:/([td]er)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/([bd]l)e$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}},{reg:/(ish|tch|ess)$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}},{reg:/(ion|end|e[nc]t)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(om)e$/i,repl:{pr:"$1es",pa:"ame",gr:"$1ing"}},{reg:/(.eat)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/([aeiu])([pt])$/i,repl:{pr:"$1$2s",pa:"$1$2",gr:"$1$2$2ing"}},{reg:/(er)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(en)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(ed)$/i,repl:{pr:"$1s",pa:"$1ded",ar:"$1der",gr:"$1ding"}},{reg:/(..)(ow)$/i,repl:{pr:"$1$2s",pa:"$1ew",gr:"$1$2ing",prt:"$1$2n"}},{reg:/(..)([cs]h)$/i,repl:{pr:"$1$2es",pa:"$1$2ed",gr:"$1$2ing"}},{reg:/([^aeiou][ou])(g|d)$/i,repl:{pr:"$1$2s",pa:"$1$2$2ed",gr:"$1$2$2ing"}},{reg:/([^aeiou][aeiou])(b|t|p|m)$/i,repl:{pr:"$1$2s",pa:"$1$2$2ed",gr:"$1$2$2ing"}},{reg:/([aeiou]zz)$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}}]},{}],79:[function(t,e,r){"use strict";var o=t("./irregulars"),s=t("./suffixes"),u=t("./generic"),l=["Gerund","PastTense","PresentTense"];e.exports=function(t,e){var r={Infinitive:t};if(e&amp;&amp;e.conjugations){var n=o(r.Infinitive,e);null!==n&amp;&amp;Object.keys(n).forEach(function(t){n[t]&amp;&amp;!r[t]&amp;&amp;(r[t]=n[t])})}var a=s(t);Object.keys(a).forEach(function(t){a[t]&amp;&amp;!r[t]&amp;&amp;(r[t]=a[t])});for(var i=0;i&lt;l.length;i++)void 0===r[l[i]]&amp;&amp;(r[l[i]]=u[l[i]](r));return r}},{"./generic":80,"./irregulars":82,"./suffixes":83}],80:[function(t,e,r){"use strict";var n=/[bcdfghjklmnpqrstvwxz]y$/,a={Gerund:function(t){var e=t.Infinitive;return"e"===e.charAt(e.length-1)?e.replace(/e$/,"ing"):e+"ing"},PresentTense:function(t){var e=t.Infinitive;return"s"===e.charAt(e.length-1)?e+"es":!0===n.test(e)?e.slice(0,-1)+"ies":e+"s"},PastTense:function(t){var e=t.Infinitive;return"e"===e.charAt(e.length-1)?e+"d":"ed"===e.substr(-2)?e:!0===n.test(e)?e.slice(0,-1)+"ied":e+"ed"}};e.exports=a},{}],81:[function(t,e,r){"use strict";var s=t("./conjugate"),u=t("./toBe"),l=function(e,r){if(r.adverbs.found){var n=r.first().match("#Adverb").found;Object.keys(e).forEach(function(t){e[t]=n?r.adverbs.out()+" "+e[t]:e[t]+r.adverbs.out()})}return e};e.exports=function(e,t){var r=e.negative.found,n=e.isPlural();if(e.verb.tags.Copula||"be"===e.verb.normal&amp;&amp;e.auxiliary.match("will").found){var a=!1;e.parent&amp;&amp;e.parent.has("i #Adverb? #Copula")&amp;&amp;(a=!0);var i=u(n,r,a);return l(i,e)}var o=s(e.verb,e.world,t);return e.particle.found&amp;&amp;Object.keys(o).forEach(function(t){o[t]=o[t]+e.particle.out()}),r&amp;&amp;(o.PastTense="did not "+o.Infinitive,o.PresentTense="does not "+o.Infinitive,o.Gerund="not "+o.Gerund),o.FutureTense||(o.FutureTense=r?"will not "+o.Infinitive:"will "+o.Infinitive),o=l(o,e)}},{"./conjugate":77,"./toBe":85}],82:[function(t,e,r){"use strict";var l=t("../../../../fns"),c=["Participle","Gerund","PastTense","PresentTense","FuturePerfect","PerfectTense","Actor"];e.exports=function(t,e){var r=e.conjugations,n=Object.keys(r);if(e&amp;&amp;e.conjugations&amp;&amp;!0===e.conjugations.hasOwnProperty(t))return e.conjugations[t];if(!0===r.hasOwnProperty(t)){var a=l.copy(r[t]);return a.Infinitive=t,a}for(var i=0;i&lt;n.length;i++)for(var o=0;o&lt;c.length;o++){var s=r[n[i]];if(s[c[o]]===t){var u=l.copy(s);return u.Infinitive=n[i],u}}return{}}},{"../../../../fns":3}],83:[function(t,e,r){"use strict";var i=t("./data/rules"),o={pr:"PresentTense",pa:"PastTense",gr:"Gerund",prt:"Participle",ar:"Actor"},s=Object.keys(o);e.exports=function(t){for(var e={},r=0;r&lt;i.length;r++)if(!0===i[r].reg.test(t)){for(var n=i[r].repl,a=0;a&lt;s.length;a++)!0===n.hasOwnProperty(s[a])&amp;&amp;(e[o[s[a]]]=t.replace(i[r].reg,n[s[a]]));return e}return e}},{"./data/rules":78}],84:[function(t,e,r){"use strict";var n={tie:"tier",dream:"dreamer",sail:"sailer",run:"runner",rub:"rubber",begin:"beginner",win:"winner",claim:"claimant",deal:"dealer",spin:"spinner"},a={aid:1,fail:1,appear:1,happen:1,seem:1,try:1,say:1,marry:1,be:1,forbid:1,understand:1,bet:1},i=[{reg:/e$/i,repl:"er"},{reg:/([aeiou])([mlgp])$/i,repl:"$1$2$2er"},{reg:/([rlf])y$/i,repl:"$1ier"},{reg:/^(.?.[aeiou])t$/i,repl:"$1tter"}];e.exports=function(t){if(a[t])return null;if(n.hasOwnProperty(t))return n[t];for(var e=0;e&lt;i.length;e++)if(!0===i[e].reg.test(t))return t.replace(i[e].reg,i[e].repl);return t+"er"}},{}],85:[function(t,e,r){"use strict";e.exports=function(t,e,r){var n={PastTense:"was",PresentTense:"is",FutureTense:"will be",Infinitive:"is",Gerund:"being",Actor:"",PerfectTense:"been",Pluperfect:"been"};return!0===r&amp;&amp;(n.PresentTense="am",n.Infinitive="am"),t&amp;&amp;(n.PastTense="were",n.PresentTense="are",n.Infinitive="are"),e&amp;&amp;(n.PastTense+=" not",n.PresentTense+=" not",n.FutureTense="will not be",n.Infinitive+=" not",n.PerfectTense="not "+n.PerfectTense,n.Pluperfect="not "+n.Pluperfect,n.Gerund="not "+n.Gerund),n}},{}],86:[function(t,e,r){"use strict";e.exports=function(t){if(t.match("(are|were|does)").found)return!0;if(t.match("(is|am|do|was)").found)return!1;var e=t.getNoun();if(e&amp;&amp;e.found){if(e.match("#Plural").found)return!0;if(e.match("#Singular").found)return!1}return null}},{}],87:[function(t,e,r){"use strict";var i=t("./suffix_rules"),o={Infinitive:!0,Gerund:!0,PastTense:!0,PresentTense:!0,FutureTense:!0,PerfectTense:!0,Pluperfect:!0,FuturePerfect:!0,Participle:!0};e.exports=function(t){for(var e=Object.keys(o),r=0;r&lt;e.length;r++)if(t.tags[e[r]])return e[r];for(var n=Object.keys(i),a=0;a&lt;n.length;a++)if(t.normal.substr(-n[a].length)===n[a]&amp;&amp;t.normal.length&gt;n[a].length)return i[n[a]];return null}},{"./suffix_rules":88}],88:[function(t,e,r){"use strict";for(var n={Gerund:["ing"],Actor:["erer"],Infinitive:["ate","ize","tion","rify","then","ress","ify","age","nce","ect","ise","ine","ish","ace","ash","ure","tch","end","ack","and","ute","ade","ock","ite","ase","ose","use","ive","int","nge","lay","est","ain","ant","ent","eed","er","le","own","unk","ung","en"],PastTense:["ed","lt","nt","pt","ew","ld"],PresentTense:["rks","cks","nks","ngs","mps","tes","zes","ers","les","acks","ends","ands","ocks","lays","eads","lls","els","ils","ows","nds","ays","ams","ars","ops","ffs","als","urs","lds","ews","ips","es","ts","ns","s"]},a={},i=Object.keys(n),o=i.length,s=0;s&lt;o;s++)for(var u=n[i[s]].length,l=0;l&lt;u;l++)a[n[i[s]][l]]=i[s];e.exports=a},{}],89:[function(t,e,r){"use strict";var n=[[/y$/,"i"],[/([aeiou][n])$/,"$1n"]],a={collect:!0,exhaust:!0,convert:!0,digest:!0,discern:!0,dismiss:!0,reverse:!0,access:!0,collapse:!0,express:!0},i={eat:"edible",hear:"audible",see:"visible",defend:"defensible",write:"legible",move:"movable",divide:"divisible",perceive:"perceptible"};e.exports=function(t){if(i.hasOwnProperty(t))return i[t];for(var e=0;e&lt;n.length;e++)!0===n[e][0].test(t)&amp;&amp;(t=t.replace(n[e][0],n[e][1]));var r=t+"able";return a[t]&amp;&amp;(r=t+"ible"),r}},{}],90:[function(t,e,r){"use strict";var o=t("./rules"),s=t("../predict");e.exports=function(t,e){var r=e.cache.toInfinitive||{};if(t.tags.Infinitive)return t.normal;if(!0===r.hasOwnProperty(t.normal))return r[t.normal];var n=s(t);if(o[n])for(var a=0;a&lt;o[n].length;a++){var i=o[n][a];if(t.normal.match(i.reg))return t.normal.replace(i.reg,i.to)}return t.normal}},{"../predict":87,"./rules":91}],91:[function(t,e,r){"use strict";e.exports={Participle:[{reg:/own$/i,to:"ow"},{reg:/(.)un([g|k])$/i,to:"$1in$2"}],Actor:[{reg:/(er)er$/i,to:"$1"}],PresentTense:[{reg:/(..)(ies)$/i,to:"$1y"},{reg:/(tch|sh)es$/i,to:"$1"},{reg:/(ss|zz)es$/i,to:"$1"},{reg:/([tzlshicgrvdnkmu])es$/i,to:"$1e"},{reg:/(n[dtk]|c[kt]|[eo]n|i[nl]|er|a[ytrl])s$/i,to:"$1"},{reg:/(ow)s$/i,to:"$1"},{reg:/(op)s$/i,to:"$1"},{reg:/([eirs])ts$/i,to:"$1t"},{reg:/(ll)s$/i,to:"$1"},{reg:/(el)s$/i,to:"$1"},{reg:/(ip)es$/i,to:"$1e"},{reg:/ss$/i,to:"ss"},{reg:/s$/i,to:""}],Gerund:[{reg:/pping$/i,to:"p"},{reg:/lling$/i,to:"ll"},{reg:/tting$/i,to:"t"},{reg:/dding$/i,to:"d"},{reg:/ssing$/i,to:"ss"},{reg:/(..)gging$/i,to:"$1g"},{reg:/([^aeiou])ying$/i,to:"$1y"},{reg:/([^ae]i.)ing$/i,to:"$1e"},{reg:/(ea.)ing$/i,to:"$1"},{reg:/(u[rtcb]|[bdtpkg]l|n[cg]|a[gdkvtc]|[ua]s|[dr]g|yz|o[rlsp]|cre)ing$/i,to:"$1e"},{reg:/(ch|sh)ing$/i,to:"$1"},{reg:/(..)ing$/i,to:"$1"}],PastTense:[{reg:/(ued)$/i,to:"ue"},{reg:/a([^aeiouy])ed$/i,to:"a$1e"},{reg:/([aeiou]zz)ed$/i,to:"$1"},{reg:/(e|i)lled$/i,to:"$1ll"},{reg:/(.)(sh|ch)ed$/i,to:"$1$2"},{reg:/(tl|gl)ed$/i,to:"$1e"},{reg:/(um?pt?)ed$/i,to:"$1"},{reg:/(ss)ed$/i,to:"$1"},{reg:/pped$/i,to:"p"},{reg:/tted$/i,to:"t"},{reg:/(..)gged$/i,to:"$1g"},{reg:/(..)lked$/i,to:"$1lk"},{reg:/([^aeiouy][aeiou])ked$/i,to:"$1ke"},{reg:/(.[aeiou])led$/i,to:"$1l"},{reg:/(..)(h|ion|n[dt]|ai.|[cs]t|pp|all|ss|tt|int|ail|ld|en|oo.|er|k|pp|w|ou.|rt|ght|rm)ed$/i,to:"$1$2"},{reg:/(.ut)ed$/i,to:"$1e"},{reg:/(.pt)ed$/i,to:"$1"},{reg:/(us)ed$/i,to:"$1e"},{reg:/(..[^aeiouy])ed$/i,to:"$1e"},{reg:/(..)ied$/i,to:"$1y"},{reg:/(.o)ed$/i,to:"$1o"},{reg:/(..i)ed$/i,to:"$1"},{reg:/(.a[^aeiou])ed$/i,to:"$1"},{reg:/([rl])ew$/i,to:"$1ow"},{reg:/([pl])t$/i,to:"$1t"}]}},{}],92:[function(t,e,r){"use strict";e.exports=function(t){return t.match("#Contraction+").list.forEach(function(t){t.has("#Verb")&amp;&amp;t.terms.forEach(function(t){t.silent_term&amp;&amp;(t.text||(t.whitespace.before=" "),t._text=t.silent_term,t.tags.TitleCase&amp;&amp;t.toTitleCase(),t.normalize(),t.silent_term=null,t.unTag("Contraction","expanded"))})}),t}},{}],93:[function(t,e,r){"use strict";var C=t("./methods/toInfinitive"),k=function(t){return(t=(t=t.match("(#Adverb|#Auxiliary|#Verb|#Negative|#Particle)+")).splitAfter("#Comma")).list[0]};e.exports=function(t){var e=t.match("#Auxiliary").first();if(e.found){var r=e.list[0].index(),n=t.parentTerms.insertAt(r+1,"not","Verb");return n.match("not").tag("Negative","tag-not"),k(n)}var a=t.match("(#Copula|will|has|had|do)").first();if(a.found){var i=a.list[0].index(),o=t.parentTerms.insertAt(i+1,"not","Verb");return o.match("not").tag("Negative","tag-not"),k(o)}var s=t.isPlural(),u=t.match("#PastTense").last();if(u.found){var l=u.list[0],c=l.index();l.terms[0].text=C(l.terms[0],t.world);var h=t.parentTerms.insertAt(c,"did not","Verb");return h.match("not").tag("Negative","tag-not"),k(h)}var f=t.match("#PresentTense").first();if(f.found){var m=f.list[0],d=m.index();m.terms[0].text=C(m.terms[0],t.world);var p=null;return(p=t.getNoun().match("(i|we|they|you)").found?t.parentTerms.insertAt(d,"do not","Verb"):t.parentTerms.insertAt(d,"does not","Verb")).match("not").tag("Negative","tag-not"),k(p)}var g=t.match("#Gerund").last();if(g.found){var v=g.list[0].index(),y=t.parentTerms.insertAt(v,"not","Verb");return y.match("not").tag("Negative","tag-not"),k(y)}var b=t.match("#Verb").last();if(b.found){var D=b.list[0],w=D.index();D.terms[0].text=C(D.terms[0],t.world);var x=t;return(x=s?t.parentTerms.insertAt(w-1,"do not","Verb"):t.parentTerms.insertAt(w-1,"does not","Verb")).match("not").tag("Negative","tag-not"),k(x)}return t}},{"./methods/toInfinitive":90}],94:[function(t,e,r){"use strict";var a=t("../../paths").Terms,n=t("./methods/conjugate"),i=t("./methods/toAdjective"),o=t("./interpret"),s=t("./toNegative"),u=t("./methods/isPlural"),l=t("./methods/verbContraction"),c=function(t){var e=t;t.negative=t.match("#Negative"),t.adverbs=t.match("#Adverb");var r=t.clone().not("(#Adverb|#Negative)");if(t.verb=r.match("#Verb").not("#Particle").last(),t.particle=r.match("#Particle").last(),t.verb.found){var n=t.verb.out("normal");t.auxiliary=e.not(n).not("(#Adverb|#Negative)"),t.verb=t.verb.list[0].terms[0]}else t.verb=e.terms[0];return t},h={parse:function(){return c(this)},data:function(t){return{text:this.out("text"),normal:this.out("normal"),parts:{negative:this.negative.out("normal"),auxiliary:this.auxiliary.out("normal"),verb:this.verb.out("normal"),particle:this.particle.out("normal"),adverbs:this.adverbs.out("normal")},interpret:o(this,t),conjugations:this.conjugate()}},getNoun:function(){if(!this.refTerms)return null;var t="#Adjective? #Noun+ "+this.out("normal");return this.refTerms.match(t).match("#Noun+")},conjugation:function(){return o(this,!1).tense},conjugate:function(t){return n(this,t)},isPlural:function(){return u(this)},isNegative:function(){return 1===this.match("#Negative").list.length},isPerfect:function(){return this.auxiliary.match("(have|had)").found},toNegative:function(){return this.isNegative()?this:s(this)},toPositive:function(){return this.match("#Negative").delete()},toPastTense:function(){this.has("#Contraction")&amp;&amp;(this.list=l(this.parentTerms).list);var t=this.conjugate().PastTense,e=this.replaceWith(t,!1);return e.verb.tag("#PastTense"),e},toPresentTense:function(){this.has("#Contraction")&amp;&amp;l(this.parentTerms);var t=this.conjugate(),e=this.replaceWith(t.PresentTense,!1);return e.verb.tag("#PresentTense"),e},toFutureTense:function(){this.has("#Contraction")&amp;&amp;l(this.parentTerms);var t=this.conjugate(),e=this.replaceWith(t.FutureTense,!1);return e.verb.tag("#FutureTense"),e},toInfinitive:function(){this.has("#Contraction")&amp;&amp;l(this.parentTerms);var t=this.conjugate(),e=this.replaceWith(t.Infinitive,!1);return e.verb.tag("#Infinitive"),e},toGerund:function(){this.has("#Contraction")&amp;&amp;l(this.parentTerms);var t=this.conjugate(),e="is",r=this.getNoun().out("normal");if(r){var n={i:"am",we:"are",they:"are"};n.hasOwnProperty(r)&amp;&amp;(e=n[r])}var a=e+" "+t.Gerund,i=this.replaceWith(a,!1);return i.verb.tag("#Gerund"),i},asAdjective:function(){return i(this.verb.out("normal"))}},f=function(t,e,r,n){return a.call(this,t,e,r,n),c(this)};f.prototype=Object.create(a.prototype),Object.keys(h).forEach(function(t){f.prototype[t]=h[t]}),e.exports=f},{"../../paths":8,"./interpret":76,"./methods/conjugate":81,"./methods/isPlural":86,"./methods/toAdjective":89,"./methods/verbContraction":92,"./toNegative":93}],95:[function(t,e,r){"use strict";var n={punctuation_step:t("./steps/01-punctuation_step"),emoji_step:t("./steps/02-emoji_step"),lexicon_step:t("./steps/03-lexicon_step"),lexicon_multi:t("./steps/04-lexicon_multi"),web_step:t("./steps/05-web_step"),suffix_step:t("./steps/06-suffix_step"),neighbour_step:t("./steps/07-neighbour_step"),capital_step:t("./steps/08-capital_step"),noun_fallback:t("./steps/09-noun_fallback"),contraction:t("./steps/10-contraction_step"),date_step:t("./steps/11-date_step"),auxiliary_step:t("./steps/12-auxiliary_step"),negation_step:t("./steps/13-negation_step"),comma_step:t("./steps/14-comma_step"),quotation_step:t("./steps/15-quotation_step"),possessive_step:t("./steps/16-possessive_step"),acronym_step:t("./steps/17-acronym_step"),person_step:t("./steps/18-person_step"),organization_step:t("./steps/19-organization_step"),parentheses_step:t("./steps/20-parentheses_step"),plural_step:t("./steps/21-plural_step"),value_step:t("./steps/22-value_step"),corrections:t("./steps/23-corrections"),properNoun:t("./steps/24-proper_noun"),custom:t("./steps/25-custom")},a=t("./phrase");e.exports=function(t){return t=n.punctuation_step(t),t=n.emoji_step(t),t=n.lexicon_step(t),t=n.lexicon_multi(t),t=n.web_step(t),t=n.suffix_step(t),t=n.comma_step(t),t=n.neighbour_step(t),t=n.capital_step(t),t=n.noun_fallback(t),t=n.contraction(t),t=n.date_step(t),t=n.auxiliary_step(t),t=n.negation_step(t),t=n.quotation_step(t),t=n.possessive_step(t),t=n.acronym_step(t),t=n.person_step(t),t=n.organization_step(t),t=n.parentheses_step(t),t=n.plural_step(t),t=n.value_step(t),t=n.corrections(t),t=n.properNoun(t),t=a(t),n.custom(t)}},{"./phrase":98,"./steps/01-punctuation_step":99,"./steps/02-emoji_step":100,"./steps/03-lexicon_step":101,"./steps/04-lexicon_multi":102,"./steps/05-web_step":103,"./steps/06-suffix_step":104,"./steps/07-neighbour_step":105,"./steps/08-capital_step":106,"./steps/09-noun_fallback":107,"./steps/10-contraction_step":108,"./steps/11-date_step":109,"./steps/12-auxiliary_step":110,"./steps/13-negation_step":111,"./steps/14-comma_step":112,"./steps/15-quotation_step":113,"./steps/16-possessive_step":114,"./steps/17-acronym_step":115,"./steps/18-person_step":116,"./steps/19-organization_step":117,"./steps/20-parentheses_step":118,"./steps/21-plural_step":119,"./steps/22-value_step":120,"./steps/23-corrections":121,"./steps/24-proper_noun":122,"./steps/25-custom":123}],96:[function(t,e,r){"use strict";e.exports=function(t){var e=t.match("#Condition .{1,7} #ClauseEnd");return e.found&amp;&amp;e.match("#Comma$")&amp;&amp;e.tag("Condition"),(e=t.match("#Condition .{1,13} #ClauseEnd #Pronoun")).found&amp;&amp;e.match("#Comma$")&amp;&amp;e.not("#Pronoun$").tag("Condition","end-pronoun"),(e=t.match("#Condition .{1,7} then")).found&amp;&amp;e.not("then$").tag("Condition","cond-then"),(e=t.match("as long as .{1,7} (then|#ClauseEnd)")).found&amp;&amp;e.not("then$").tag("Condition","as-long-then"),(e=t.match("#Comma #Condition .{1,7} .$")).found&amp;&amp;e.not("^#Comma").tag("Condition","comma-7-end"),(e=t.match("#Condition .{1,4}$")).found&amp;&amp;e.tag("Condition","cond-4-end"),t}},{}],97:[function(t,e,r){"use strict";e.exports=function(t){return t.has("(#Verb|#Auxiliary)")&amp;&amp;(t.match("#Verb").tag("VerbPhrase","verbphrase-verb"),t.match("#Adverb #Verb").tag("VerbPhrase","adverb-verb"),t.match("#Verb #Adverb").tag("VerbPhrase","verb-adverb"),t.match("#Verb #Negative").tag("VerbPhrase","verb-not"),t.match("never #Verb").tag("VerbPhrase","not-verb"),t.match("#Auxiliary+").tag("VerbPhrase","2"),t.match("#Copula").tag("VerbPhrase","#3"),t.match("#Adverb #Auxiliary").tag("VerbPhrase","#4")),t}},{}],98:[function(t,e,r){"use strict";var n=t("./00-conditionPass"),a=t("./01-verbPhrase");e.exports=function(t){return t=n(t),a(t)}},{"./00-conditionPass":96,"./01-verbPhrase":97}],99:[function(t,e,r){"use strict";var u=/^[A-Z][a-z']/,l=/^[IVXCM]+$/,c={a:!0,i:!0,u:!0,r:!0,c:!0,k:!0};e.exports=function(o){var s=o.world.regex||[];return o.terms.forEach(function(t,e){var r,n=t.text;!0===u.test(n)&amp;&amp;t.tag("TitleCase","punct-rule"),"-"===t.whitespace.after&amp;&amp;o.terms[e+1]&amp;&amp;""===o.terms[e+1].whitespace.before&amp;&amp;(t.tag("Hyphenated","has-hyphen"),o.terms[e+1].tag("Hyphenated","has-hyphen")),"("===t.text[0]&amp;&amp;t.tag("StartBracket"),!0===/\)[,.?!;:]?$/.test(t.text)&amp;&amp;t.tag("EndBracket"),n=n.replace(/[,\.\?]$/,"");for(var a=0;a&lt;s.length;a++){var i=s[a];if(!0===i.reg.test(n))return void(t.canBe(i.tag)&amp;&amp;t.tag(i.tag,'punctuation-rule- "'+i.reg.toString()+'"'))}1===n.length&amp;&amp;o.terms[e+1]&amp;&amp;/[A-Z]/.test(n)&amp;&amp;!c[n.toLowerCase()]&amp;&amp;t.tag("Acronym","one-letter-acronym"),1&lt;(r=t).text.length&amp;&amp;!0===l.test(r.text)&amp;&amp;r.canBe("RomanNumeral")&amp;&amp;t.tag("RomanNumeral","is-roman-numeral"),!0===/[0-9]\+$/.test(t.text)&amp;&amp;t.tag("NumericValue","number-plus")}),o}},{}],100:[function(t,e,r){"use strict";var i=t("./rules/emoji_regex"),o=t("./rules/emoticon_list");e.exports=function(t){for(var e=0;e&lt;t.terms.length;e++){var r=t.terms[e];":"!==(a=r).text.charAt(0)||null===a.text.match(/:.?$/)||a.text.match(" ")||35&lt;a.text.length||r.tag("Emoji","comma-emoji"),r.text.match(i)&amp;&amp;r.tag("Emoji","unicode-emoji"),n=r.text.replace(/^[:;]/,":"),!0===o.hasOwnProperty(n)&amp;&amp;r.tag("Emoji","emoticon-emoji")}var n,a;return t}},{"./rules/emoji_regex":130,"./rules/emoticon_list":131}],101:[function(t,e,r){"use strict";var o=t("./contraction/split");e.exports=function(t){for(var e=t.world.words||{},r=0;r&lt;t.terms.length;r++){var n=t.terms[r];if(!0!==e.hasOwnProperty(n.normal))if(n.silent_term&amp;&amp;!0===e.hasOwnProperty(n.silent_term))n.tag(e[n.silent_term],"silent_term-lexicon");else if(n.root&amp;&amp;n.normal!==n.root&amp;&amp;!0===e.hasOwnProperty(n.root))n.tag(e[n.root],"lexicon");else{var a=o(n);if(a&amp;&amp;a.start){var i=a.start.toLowerCase();if(!0===e.hasOwnProperty(i)){n.tag(e[i],"contraction-lexicon");continue}}}else n.tag(e[n.normal],"lexicon")}return t}},{"./contraction/split":129}],102:[function(t,e,r){"use strict";var a=function(t,e,r){var n=r.words,a=t.terms[e].root,i=t.terms.slice(e+1,e+4).map(function(t){return t.root}),o=4;i.length&lt;o&amp;&amp;(o=i.length);for(var s=o;0&lt;s;s-=1){var u=a+" "+i.slice(0,s).join(" ");if(!0===n.hasOwnProperty(u))return t.slice(e,e+s+1).tag(n[u],"multi-lexicon-"+u),s}return 0};e.exports=function(t){t.world.cache=t.world.cache||{};for(var e=t.world.cache.firstWords||{},r=0;r&lt;t.terms.length;r++){var n=t.terms[r];!0!==e.hasOwnProperty(n.root)||(r+=a(t,r,t.world))}return t}},{}],103:[function(t,e,r){"use strict";var a=/^\w+@\w+\.[a-z]{2,3}$/,i=/^#[a-z0-9_]{2,}$/,o=/^@\w{2,}$/,s=/^(https?:\/\/|www\.)\w+\.[a-z]{2,3}/,u=/^[\w\.\/]+\.(com|net|gov|org|ly|edu|info|biz|ru|jp|de|in|uk|br)/;e.exports=function(t){for(var e=0;e&lt;t.length;e++){var r=t.get(e),n=r.text.trim().toLowerCase();!0===a.test(n)&amp;&amp;r.tag("Email","web_pass"),!0===i.test(n)&amp;&amp;r.tag("HashTag","web_pass"),!0===o.test(n)&amp;&amp;r.tag("AtMention","web_pass"),!0!==s.test(n)&amp;&amp;!0!==u.test(n)||r.tag("Url","web_pass")}return t}},{}],104:[function(t,e,r){"use strict";var a=t("./rules/regex_list"),i=t("./rules/suffix_lookup"),o=[[/^(lol)+[sz]$/,"Expression"],[/^ma?cd[aeiou]/,"LastName"],[/^[\-\+]?[0-9][0-9,]*(\.[0-9])*$/,"Cardinal"],[/^(un|de|re)\\-[a-z]../,"Verb"],[/^[\-\+]?[0-9]+(\.[0-9])*$/,"NumericValue"],[/^https?\:?\/\/[a-z0-9]/,"Url"],[/^www\.[a-z0-9]/,"Url"],[/^(over|under)[a-z]{2,}/,"Adjective"],[/^[0-9]{1,4}\.[0-9]{1,2}\.[0-9]{1,4}$/,"Date"],[/^[0-9]+([a-z]{1,2})$/,"Value"],[/^[0-9][0-9,\.]*(st|nd|rd|r?th)$/,["NumericValue","Ordinal"]],[/[a-z]*\\-[a-z]*\\-/,"Adjective"]],s=function(t){var e=t.normal.length,r=7;e&lt;=r&amp;&amp;(r=e-1);for(var n=r;1&lt;n;n-=1){var a=t.normal.substr(e-n,e);if(void 0!==i[n][a])return i[n][a]}return null},u=function(t){var e=t.normal.charAt(t.normal.length-1);if(void 0===a[e])return null;for(var r=a[e],n=0;n&lt;r.length;n++)if(!0===r[n][0].test(t.normal))return r[n];return null};e.exports=function(t){for(var e=0;e&lt;t.terms.length;e++){var r=t.terms[e],n=s(r);if(null===n||!0!==r.canBe(n))if(null===(n=u(r))||!0!==r.canBe(n[1]))for(var a=0;a&lt;o.length;a++)!0===o[a][0].test(r.normal)&amp;&amp;(n=o[a][1],!0===r.canBe(n)&amp;&amp;r.tag(n,"misc-regex-"+o[a][0]));else r.tag(n[1],"regex-list: "+String(n[0]));else r.tag(n,"suffix-lookup")}return t}},{"./rules/regex_list":133,"./rules/suffix_lookup":134}],105:[function(t,e,r){"use strict";var n=t("./rules/neighbours"),l=n.afterThisWord,c=n.beforeThisWord,h=n.beforeThisPos,f=n.afterThisPos,m={TitleCase:!0,UpperCase:!0,CamelCase:!0,Hyphenated:!0,StartBracket:!0,EndBracket:!0,Comma:!0,ClauseEnd:!0};e.exports=function(u){return u.terms.forEach(function(t,e){var r=Object.keys(t.tags);if(0===(r=r.filter(function(t){return!1===m.hasOwnProperty(t)})).length){var n=u.terms[e-1],a=u.terms[e+1];if(n&amp;&amp;l.hasOwnProperty(n.normal)&amp;&amp;!n.tags.ClauseEnd)return void t.tag(l[n.normal],'neighbour-after-"'+n.normal+'"');if(!t.tags.ClauseEnd&amp;&amp;a&amp;&amp;c.hasOwnProperty(a.normal))return void t.tag(c[a.normal],'neighbour-before-"'+a.normal+'"');var i=[];if(n){i=Object.keys(n.tags);for(var o=0;o&lt;i.length;o++)if(f[i[o]])return void t.tag(f[i[o]],"neighbour-after-["+i[o]+"]")}if(a){i=Object.keys(a.tags);for(var s=0;s&lt;i.length;s++)if(h[i[s]])return void t.tag(h[i[s]],"neighbour-before-["+i[s]+"]")}}}),u}},{"./rules/neighbours":132}],106:[function(t,e,r){"use strict";e.exports=function(t){for(var e=1;e&lt;t.terms.length;e++){var r=t.terms[e];r.tags.TitleCase&amp;&amp;r.isWord()&amp;&amp;(r.tag("Noun","capital-step"),r.tag("TitleCase","capital-step"))}var n=t.terms[0];return n&amp;&amp;n.tags.TitleCase&amp;&amp;(n.tags.Person||n.tags.Organization||n.tags.Place)&amp;&amp;n.tag("TitleCase","first-term-capital"),t}},{}],107:[function(t,e,r){"use strict";var n={TitleCase:!0,UpperCase:!0,CamelCase:!0,Hyphenated:!0,StartBracket:!0,EndBracket:!0,Comma:!0,ClauseEnd:!0},a=function(t){if(t.tags.Noun||t.tags.Verb||t.tags.Adjective)return!1;var e=Object.keys(t.tags);return 0===e.length||0===e.filter(function(t){return!n[t]}).length},i=function(t){if(!0===/^(re|un)-?[^aeiou]./.test(t.normal)){var e=t.normal.replace(/^(re|un)-?/,"");if(!0===t.world.words.hasOwnProperty(e)){var r=t.world.words[e];if("Infinitive"===r||"PresentTense"===r||"PastTense"===r||"Gerund"===r)return r}}return null};e.exports=function(t){for(var e=0;e&lt;t.terms.length;e++){var r=t.terms[e];if(!r.tags.Noun&amp;&amp;!r.tags.Verb&amp;&amp;a(r)){if(!1===r.isWord())continue;var n=i(r);if(null!==n){r.tag(n,"root-tag-match");continue}r.tag("Noun","noun-fallback")}}return t}},{}],108:[function(t,e,r){"use strict";var n=t("./contraction/01-irregulars"),a=t("./contraction/02-isWasHas"),i=t("./contraction/03-easyOnes"),o=t("./contraction/04-numberRange");e.exports=function(t){return t=n(t),t=a(t),t=i(t),o(t)}},{"./contraction/01-irregulars":124,"./contraction/02-isWasHas":125,"./contraction/03-easyOnes":126,"./contraction/04-numberRange":127}],109:[function(t,e,r){"use strict";var o="(in|by|before|during|on|until|after|of|within|all)",s="(last|next|this|previous|current|upcoming|coming)",u="(start|end|middle|starting|ending|midpoint|beginning)",l="(spring|summer|winter|fall|autumn)",c=function(t,r){!0===t.found&amp;&amp;t.list.forEach(function(t){var e=parseInt(t.terms[0].normal,10);e&amp;&amp;1e3&lt;e&amp;&amp;e&lt;3e3&amp;&amp;t.terms[0].tag("Year",r)})},h=function(t,r){!0===t.found&amp;&amp;t.list.forEach(function(t){var e=parseInt(t.terms[0].normal,10);e&amp;&amp;1900&lt;e&amp;&amp;e&lt;2030&amp;&amp;t.terms[0].tag("Year",r)})};e.exports=function(t){var e="(january|april|may|june|summer|autumn|jan|sep)";t.has(e)&amp;&amp;(t.match("#Infinitive #Determiner? #Adjective? #Noun? (to|for) ".concat(e)).lastTerm().tag("Person","ambig-person"),t.match("#Infinitive ".concat(e)).lastTerm().tag("Person","infinitive-person"),t.match("".concat(e," #PresentTense (to|for)")).firstTerm().tag("Person","ambig-active"),t.match("".concat(e," #Modal")).firstTerm().tag("Person","ambig-modal"),t.match("#Modal ".concat(e)).lastTerm().tag("Person","modal-ambig"),t.match("(that|with|for) ".concat(e)).term(1).tag("Person","that-month"),t.match("#Copula ".concat(e)).term(1).tag("Person","is-may"),t.match("".concat(e," #Copula")).term(0).tag("Person","may-is"),t.match("".concat(e," the? #Value")).term(0).tag("Month","person-value"),t.match("#Date ".concat(e)).term(1).tag("Month","correction-may"),t.match("".concat(e," the? #Value")).firstTerm().tag("Month","may-5th"),t.match("#Value of ".concat(e)).lastTerm().tag("Month","5th-of-may"),t.match("".concat(o," ").concat(e)).ifNo("#Holiday").term(1).tag("Month","preps-month"),t.match("(next|this|last) ".concat(e)).term(1).tag("Month","correction-may"));var r="(may|march)";if(t.has(r)&amp;&amp;(t.match("#Adverb ".concat(r)).lastTerm().tag("Infinitive","ambig-verb"),t.match("".concat(r," #Adverb")).lastTerm().tag("Infinitive","ambig-verb"),t.match("".concat(o," ").concat(r)).lastTerm().tag("Month","in-month"),t.match("(next|this|last) ".concat(r)).lastTerm().tag("Month","this-month"),t.match("".concat(r," the? #Value")).firstTerm().tag("Month","march-5th"),t.match("#Value of? ".concat(r)).lastTerm().tag("Month","5th-of-march"),t.match("[".concat(r,"] .? #Date")).lastTerm().tag("Month","march-and-feb"),t.match("#Date .? [".concat(r,"]")).lastTerm().tag("Month","feb-and-march"),t.has("march")&amp;&amp;(t.match("march (up|down|back|to|toward)").term(0).tag("Infinitive","march-to"),t.match("#Modal march").term(1).tag("Infinitive","must-march"))),t.has("sun")&amp;&amp;(t.match("sun #Date").firstTerm().tag("WeekDay","sun-feb"),t.match("sun the #Ordinal").tag("Date").firstTerm().tag("WeekDay","sun-the-5th"),t.match("#Determiner sun").lastTerm().tag("Singular","the-sun")),t.has("sat")&amp;&amp;(t.match("sat #Date").firstTerm().tag("WeekDay","sat-feb"),t.match("".concat(o," sat")).lastTerm().tag("WeekDay","sat")),t.has("#Month")&amp;&amp;(t.match("#Month #DateRange+").tag("Date","correction-numberRange"),t.match("#Value of #Month").tag("Date","value-of-month"),t.match("#Cardinal #Month").tag("Date","cardinal-month"),t.match("#Month #Value to #Value").tag("Date","value-to-value"),t.match("#Month the #Value").tag("Date","month-the-value")),t.match("in the (night|evening|morning|afternoon|day|daytime)").tag("Time","in-the-night"),t.match("(#Value|#Time) (am|pm)").tag("Time","value-ampm"),t.has("#Value")){t.match("for #Value #Duration").tag("Date","for-x-duration"),t.match("#Value #Abbreviation").tag("Value","value-abbr"),t.match("a #Value").if("(hundred|thousand|million|billion|trillion|quadrillion|quintillion|sextillion|septillion)").tag("Value","a-value"),t.match("(minus|negative) #Value").tag("Value","minus-value"),t.match("#Value grand").tag("Value","value-grand"),t.match("(half|quarter) #Ordinal").tag("Value","half-ordinal"),t.match("(hundred|thousand|million|billion|trillion|quadrillion|quintillion|sextillion|septillion) and #Value").tag("Value","magnitude-and-value"),t.match("#Value (point|decimal) #Value").tag("Value","value-point-value"),t.match("".concat(o,"? #Value #Duration")).tag("Date","value-duration"),t.match("(#WeekDay|#Month) #Value").ifNo("#Money").tag("Date","date-value"),t.match("#Value (#WeekDay|#Month)").ifNo("#Money").tag("Date","value-date");var n=t.match("#TextValue #TextValue");n.found&amp;&amp;n.has("#Date")&amp;&amp;n.tag("#Date","textvalue-date"),t.match("#Value #Duration #Conjunction").tag("Date","val-duration-conjunction"),t.match("#Value #Duration old").unTag("Date","val-years-old")}if(t.has(l)&amp;&amp;(t.match("".concat(o,"? ").concat(s," ").concat(l)).tag("Date","thisNext-season"),t.match("the? ".concat(u," of ").concat(l)).tag("Date","section-season")),t.has("#Date")&amp;&amp;(t.match("#Date the? #Ordinal").tag("Date","correction-date"),t.match("".concat(s," #Date")).tag("Date","thisNext-date"),t.match("due? (by|before|after|until) #Date").tag("Date","by-date"),t.match("#Date (by|before|after|at|@|about) #Cardinal").not("^#Date").tag("Time","date-before-Cardinal"),t.match("#Date (am|pm)").term(1).unTag("Verb").unTag("Copula").tag("Time","date-am"),t.match("(last|next|this|previous|current|upcoming|coming|the) #Date").tag("Date","next-feb"),t.match("#Date (#Preposition|to) #Date").tag("Date","date-prep-date"),t.match("the? ".concat(u," of #Date")).tag("Date","section-of-date"),t.match("#Ordinal #Duration in #Date").tag("Date","duration-in-date"),t.match("(early|late) (at|in)? the? #Date").tag("Time","early-evening")),t.has("#Cardinal")){var a=t.match("#Date #Value #Cardinal").lastTerm();c(a,"date-value-year"),a=t.match("#Date+ #Cardinal").lastTerm(),c(a,"date-year"),a=t.match("#Month #Value #Cardinal").lastTerm(),c(a,"month-value-year"),a=t.match("#Month #Value to #Value #Cardinal").lastTerm(),c(a,"month-range-year"),a=t.match("(in|of|by|during|before|starting|ending|for|year) #Cardinal").lastTerm(),c(a,"in-year"),a=t.match("(q1|q2|q3|q4) [#Cardinal]"),c(a,"in-year"),a=t.match("#Ordinal quarter [#Cardinal]"),c(a,"in-year"),a=t.match("the year [#Cardinal]"),c(a,"in-year"),a=t.match("it (is|was) [#Cardinal]"),h(a,"in-year"),a=t.match("#Cardinal !#Plural").firstTerm(),h(a,"year-unsafe")}if(t.has("#Date")){t.has("#Time")&amp;&amp;(t.match("#Cardinal #Time").not("#Year").tag("Time","value-time"),t.match("(by|before|after|at|@|about) #Time").tag("Time","preposition-time"),t.match("#Time (eastern|pacific|central|mountain)").term(1).tag("Time","timezone"),t.match("#Time (est|pst|gmt)").term(1).tag("Time","timezone abbr"));var i=t.match("#Date+").splitOn("Clause");!1===i.has("(#Year|#Time)")&amp;&amp;i.match("#Value (#Month|#Weekday) #Value").lastTerm().unTag("Date")}return t}},{}],110:[function(t,e,r){"use strict";var a={do:!0,"don't":!0,does:!0,"doesn't":!0,will:!0,wont:!0,"won't":!0,have:!0,"haven't":!0,had:!0,"hadn't":!0,not:!0};e.exports=function(t){for(var e=0;e&lt;t.terms.length;e++){var r=t.terms[e];if(a[r.normal]||a[r.silent_term]){var n=t.terms[e+1];if(n&amp;&amp;(n.tags.Verb||n.tags.Adverb||n.tags.Negative)){r.tag("Auxiliary","corrections-Auxiliary");continue}}}return t}},{}],111:[function(t,e,r){"use strict";e.exports=function(t){for(var e=0;e&lt;t.length;e++){var r=t.get(e);if("not"===r.normal||"not"===r.silent_term)for(var n=e+1;n&lt;t.length;n++){if(t.get(n).tags.Verb){r.tag("VerbPhrase","negate-verb");break}if(t.get(n).tags.Adjective){r.tag("AdjectivePhrase","negate-adj");break}}}return t}},{}],112:[function(t,e,r){"use strict";var c=function(t,e){var r,n=e,a=(r=t.terms[e]).tags.Adjective?"Adjective":r.tags.Noun?"Noun":r.tags.Verb?"Verb":r.tags.Value?"Value":null,i=0,o=0,s=!1;for(e+=1;e&lt;t.terms.length;e++){var u=t.terms[e];if(0&lt;o&amp;&amp;u.tags.Conjunction)s=!0;else{if(u.tags[a]){if(u.tags.Comma){o+=1,i=0;continue}if(0&lt;o&amp;&amp;s)return t.slice(n,e).tag("List"),!0}if(5&lt;(i+=1))return!1;if("Value"===a)return!0}}return!1};e.exports=function(t){for(var e=0;e&lt;t.terms.length;e++){var r=t.terms[e],n=r.getPunctuation();","!==n?";"!==n&amp;&amp;":"!==n?r.whitespace.after.match(/^\.\./)?r.tag("ClauseEnd","clause-elipses"):t.terms[e+1]&amp;&amp;t.terms[e+1].whitespace.before.match(/ - /)&amp;&amp;r.tag("ClauseEnd","hypen-clause"):r.tag("ClauseEnd","clause-punt"):r.tag("Comma","comma-step")}for(var a=0;a&lt;t.terms.length;a++){var i=t.terms[a];if(i.tags.Comma){if(i.tags.List)continue;if(s=a,u=(o=t).terms[s],(l=o.terms[s+1])&amp;&amp;u.tags.Place&amp;&amp;!u.tags.Country&amp;&amp;l.tags.Country)continue;c(t,a)||i.tag("ClauseEnd","phrasal-comma")}}var o,s,u,l;return t}},{}],113:[function(t,e,r){"use strict";var l={'"':{close:'"',tag:"StraightDoubleQuotes"},"":{close:"",tag:"StraightDoubleQuotesWide"},"'":{close:"'",tag:"StraightSingleQuotes"},"":{close:"",tag:"CommaDoubleQuotes"},"":{close:"",tag:"CommaSingleQuotes"},"":{close:"",tag:"CurlyDoubleQuotesReversed"},"":{close:"",tag:"CurlySingleQuotesReversed"},"":{close:"",tag:"LowCurlyDoubleQuotes"},"":{close:"",tag:"LowCurlyDoubleQuotesReversed"},"":{close:"",tag:"LowCurlySingleQuotes"},"":{close:"",tag:"AngleDoubleQuotes"},"":{close:"",tag:"AngleSingleQuotes"},"":{close:"",tag:"PrimeSingleQuotes"},"":{close:"",tag:"PrimeDoubleQuotes"},"":{close:"",tag:"PrimeTripleQuotes"},"":{close:"",tag:"PrimeDoubleQuotes"},"`":{close:"",tag:"PrimeSingleQuotes"},"":{close:"",tag:"LowPrimeDoubleQuotesReversed"}};Object.keys(l).forEach(function(t){l[t].regex=new RegExp(l[t].close+"[;:,.]*"),l[t].open=t});var c=new RegExp("["+Object.keys(l).join("")+"]");e.exports=function(t){for(var e=t.terms.slice(0),r=0;r&lt;e.length;r++){var n=t.terms[r];if(c.test(n.whitespace.before)){var a=n.whitespace.before.match(c).shift().split("");a=a.map(function(t){return l[t]});for(var i=0;i&lt;t.terms.length&amp;&amp;e[r+i]&amp;&amp;!(28&lt;i);i++){for(var o=-1,s=0;s&lt;a.length;s+=1)if(!0===a[s].regex.test(e[r+i].whitespace.after)){o=s;break}if(-1!==o){var u=a.splice(o,1).pop();if(u.regex.test(t.terms[r+i].normal)&amp;&amp;t.terms[r+i].whitespace.after.replace(u.regex,""),n.tag("StartQuotation","quotation_open"),t.terms[r+i].tag("EndQuotation","quotation_close"),t.slice(r,r+i+1).tag("Quotation","quotation_step"),i-=1,!a.length)break}}}}return t}},{}],114:[function(t,e,r){"use strict";var l=["it's","that's"],n="'`",c=new RegExp("([a-z]s["+n+"])\\W*$"),h=new RegExp("["+n+"]"),s=new RegExp("[^"+n+"\\w]+$"),u={};[["'","'"],["",""],["",""],["",""],["",""],["`",""]].forEach(function(t){u[t[0]]=new RegExp(t[1]+"[^"+t[1]+"\\w]*$")}),l.map(function(t){return new RegExp(t.replace("'","["+n+"]"))});var f=function(t,e,r){var n=t.get(r),a=t.get(r+1),i=t.get(r+2),o=l.map(function(t){return e.match(t)}).find(function(t){return t}),s=h.test(n.whitespace.after),u=n.tags.Pronoun;return!(o||u||!s||!c.test(e)&amp;&amp;void 0!==a&amp;&amp;!0!==a.tags.Noun&amp;&amp;!0!==n.tags.ClauseEnd&amp;&amp;(void 0===i||!a.tags.Adjective||!i.tags.Noun))};e.exports=function(t){for(var e=[],r=0;r&lt;t.length;r++){var n=t.get(r),a=n.text;void 0!==u[a[0]]&amp;&amp;(e[e.length]=u[a[0]],a=a.slice(1)),a=a.replace(s,"");for(var i=-1,o=0;o&lt;e.length;o+=1)if(!0===e[o].test(a)){i=o;break}-1!==i&amp;&amp;(a=a.replace(e[i],""),delete e[i]),a=a.replace(s,""),f(t,a,r)&amp;&amp;(n.tags.Noun||n.tag("Noun","possessive_pass"),n.tag("Possessive","possessive_pass"),!0===n.tags.Contraction&amp;&amp;(n.unTag("Contraction"),t.terms.splice(r+1,1),n.silent_term=""))}return t}},{}],115:[function(t,e,r){"use strict";e.exports=function(t){return t.terms.forEach(function(t){t.isAcronym()&amp;&amp;t.tag("Acronym","acronym-step")}),t}},{}],116:[function(t,e,r){"use strict";e.exports=function(t){t.match("(mr|mrs|ms|dr) (#TitleCase|#Possessive)+").tag("#Person","mr-putin");var e="(rose|robin|dawn|ray|holly|bill|joy|viola|penny|sky|violet|daisy|melody|kelvin|hope|mercedes|olive|jewel|faith|van|charity|miles|lily|summer|dolly|rod|dick|cliff|lane|reed|kitty|art|jean|trinity)";t.has(e)&amp;&amp;(t.match("(#Determiner|#Adverb|#Pronoun|#Possessive) ["+e+"]").tag("Noun","the-ray"),t.match(e+" (#Person|#Acronym|#TitleCase)").canBe("#Person").tag("Person","ray-smith"));var r="(pat|wade|ollie|will|rob|buck|bob|mark|jack)";t.has(r)&amp;&amp;(t.match("(#Modal|#Adverb) ["+r+"]").tag("Verb","would-mark"),t.match(r+" (#Person|#TitleCase)").tag("Person","rob-smith"));var n="(misty|rusty|dusty|rich|randy)";t.has(n)&amp;&amp;(t.match("#Adverb ["+n+"]").tag("Adjective","really-rich"),t.match(n+" (#Person|#TitleCase)").tag("Person","randy-smith"));var a="(april|june|may|jan|august|eve)";t.has(a)&amp;&amp;(t.match(String(a)+" (#Person|#TitleCase)").canBe("#Person").tag("Person","june-smith"),t.match("(in|during|on|by|before|#Date) ["+a+"]").canBe("#Date").tag("Date","in-june"),t.match(a+" (#Date|#Value)").canBe("#Date").tag("Date","june-5th"));var i="(paris|alexandria|houston|kobe|salvador|sydney)";return t.has(i)&amp;&amp;(t.match("(in|near|at|from|to|#Place) ["+i+"]").canBe("#Place").tag("Place","in-paris"),t.match("["+i+"] #Place").canBe("#Place").tag("Place","paris-france"),t.match("["+i+"] #Person").canBe("#Person").tag("Person","paris-hilton")),t.match("al")&amp;&amp;(t.match("al (#Person|#TitleCase)").canBe("#Person").tag("#Person","al-borlen"),t.match("#TitleCase al #TitleCase").canBe("#Person").tag("#Person","arabic-al-arabic")),t.match("(private|general|major|corporal|lord|lady|secretary|premier) #Honorific? #Person").terms(0).tag("Honorific","ambg-honorifics"),t.match("(1st|2nd|first|second) #Honorific").terms(0).tag("Honorific","ordinal-honorific"),t.has("#FirstName")&amp;&amp;(t.match("#FirstName #Noun").ifNo("^#Possessive").ifNo("#ClauseEnd .").lastTerm().canBe("#LastName").tag("#LastName","firstname-noun"),t.match("#FirstName de #Noun").canBe("#Person").tag("#Person","firstname-de-noun"),t.match("#FirstName (bin|al) #Noun").canBe("#Person").tag("#Person","firstname-al-noun"),t.match("#FirstName #Acronym #TitleCase").tag("Person","firstname-acronym-titlecase"),t.match("#FirstName #FirstName #TitleCase").tag("Person","firstname-firstname-titlecase"),t.match("#Honorific #FirstName? #TitleCase").tag("Person","Honorific-TitleCase"),t.match("#FirstName #TitleCase #TitleCase?").match("#Noun+").tag("Person","firstname-titlecase"),t.match("#FirstName the #Adjective").tag("Person","correction-determiner5"),t.match("#FirstName (green|white|brown|hall|young|king|hill|cook|gray|price)").tag("#Person","firstname-maybe"),t.match("#FirstName #Acronym #Noun").ifNo("#Date").tag("#Person","n-acro-noun").lastTerm().tag("#LastName","n-acro-noun"),t.match("#FirstName [#Determiner? #Noun] #LastName").tag("#NickName","first-noun-last").tag("#Person","first-noun-last"),t.match("#FirstName (#Singular|#Possessive)").ifNo("#Date").ifNo("#NickName").tag("#Person","first-possessive").lastTerm().tag("#LastName","first-possessive")),t.has("#LastName")&amp;&amp;(t.match("#Noun #LastName").firstTerm().canBe("#FirstName").tag("#FirstName","noun-lastname"),t.match("(will|may|april|june|said|rob|wade|ray|rusty|drew|miles|jack|chuck|randy|jan|pat|cliff|bill) #LastName").firstTerm().tag("#FirstName","maybe-lastname"),t.match("#TitleCase #Acronym? #LastName").ifNo("#Date").tag("#Person","title-acro-noun").lastTerm().tag("#LastName","title-acro-noun"),t.match("#Copula (#Noun|#PresentTense) #LastName").term(1).tag("#FirstName","copula-noun-lastname")),t.has("#TitleCase")&amp;&amp;(t.match("#Acronym #TitleCase").canBe("#Person").tag("#Person","acronym-titlecase"),t.match("#TitleCase (van|al|bin) #TitleCase").canBe("#Person").tag("Person","correction-titlecase-van-titlecase"),t.match("#TitleCase (de|du) la? #TitleCase").canBe("#Person").tag("Person","correction-titlecase-van-titlecase"),t.match("#Person #TitleCase").match("#TitleCase #Noun").canBe("#Person").tag("Person","correction-person-titlecase"),t.match("(lady|queen|sister) #TitleCase").ifNo("#Date").ifNo("#Honorific").tag("#FemaleName","lady-titlecase"),t.match("(king|pope|father) #TitleCase").ifNo("#Date").tag("#MaleName","correction-poe")),t.match("#Noun van der? #Noun").canBe("#Person").tag("#Person","von der noun"),t.match("(king|queen|prince|saint|lady) of? #Noun").canBe("#Person").tag("#Person","king-of-noun"),t.match("#Honorific #Acronym").tag("Person","Honorific-TitleCase"),t.match("#Person #Person the? #RomanNumeral").tag("Person","correction-roman-numeral"),t.match("#Honorific #Person").tag("Person","Honorific-Person"),t.match("^#Honorific$").unTag("Person","single-honorific"),t}},{}],117:[function(t,e,r){"use strict";var i=t("../../world/more-data/orgWords"),o=function(t){return!(!t.tags.Noun||t.tags.Pronoun||t.tags.Comma||t.tags.Possessive||t.tags.Place||!(t.tags.TitleCase||t.tags.Organization||t.tags.Acronym))};e.exports=function(t){for(var e=0;e&lt;t.terms.length;e++){var r=t.terms[e];if(!0===i.hasOwnProperty(r.root)){var n=t.terms[e-1];if(n&amp;&amp;o(n)){n.tag("Organization","org-word-1"),r.tag("Organization","org-word-2");continue}var a=t.terms[e+1];if(a&amp;&amp;"of"===a.normal&amp;&amp;t.terms[e+2]&amp;&amp;o(t.terms[e+2])){r.tag("Organization","org-of-word-1"),a.tag("Organization","org-of-word-2"),t.terms[e+2].tag("Organization","org-of-word-3");continue}}}return t.has("#Acronym")&amp;&amp;(t.match("the #Acronym").not("(iou|fomo|yolo|diy|dui|nimby)").lastTerm().tag("Organization","the-acronym"),t.match("#Acronym").match("#Possessive").tag("Organization","possessive-acronym")),t}},{"../../world/more-data/orgWords":221}],118:[function(t,e,r){"use strict";e.exports=function(n){return n.terms.forEach(function(t,e){if(t.tags.StartBracket)for(var r=e;r&lt;n.terms.length;r+=1)if(!0===n.terms[r].tags.EndBracket){n.slice(e,r+1).tag("Parentheses");break}}),n}},{}],119:[function(t,e,r){"use strict";var a=t("../../subset/nouns/isPlural");e.exports=function(t){for(var e=0;e&lt;t.terms.length;e++){var r=t.terms[e];if(r.tags.Noun){if(r.tags.Singular||r.tags.Plural)continue;var n=a(r,r.world);!0===n?r.tag("Plural","pluralStep"):!1===n&amp;&amp;r.tag("Singular","pluralStep")}}return t}},{"../../subset/nouns/isPlural":39}],120:[function(t,e,r){"use strict";var n=/^\$?[0-9,](\.[0-9])?/,a=/[0-9](st|nd|rd|th)$/;e.exports=function(t){for(var e=0;e&lt;t.terms.length;e++){var r=t.terms[e];!0===r.tags.Value&amp;&amp;void 0===r.tags.Ordinal&amp;&amp;void 0===r.tags.Cardinal&amp;&amp;(!0===n.test(r.normal)?(r.tag("Cardinal","cardinal-val-regex"),r.tag("NumericValue","NumericValue-regex")):!0===a.test(r.normal)&amp;&amp;(r.tag("Ordinal","ordinal-value-regex"),r.tag("NumericValue","NumericValue-regex")))}return t.match("#Cardinal #Plural").lastTerm().tag("Unit","cardinal-plural"),t.match("#Ordinal #Singular").lastTerm().tag("Unit","ordinal-singular"),t}},{}],121:[function(t,e,r){"use strict";e.exports=function(t){if(t.has("so")&amp;&amp;(t.match("so #Adjective").match("so").tag("Adverb","so-adv"),t.match("so #Noun").match("so").tag("Conjunction","so-conj"),t.match("do so").match("so").tag("Noun","so-noun")),t.has("all")&amp;&amp;(t.match("[all] #Determiner? #Noun").tag("Adjective","all-noun"),t.match("[all] #Verb").tag("Adverb","all-verb")),t.has("(that|which)")&amp;&amp;(t.match("#Verb #Adverb? #Noun (that|which)").lastTerm().tag("Preposition","that-prep"),t.match("that #Noun #Verb").firstTerm().tag("Determiner","that-determiner"),t.match("#Comma [which] (#Pronoun|#Verb)").tag("Preposition","which-copula")),t.has("#Determiner")&amp;&amp;(t.match("(the|this) [#Verb] #Preposition .").tag("Noun","correction-determiner1"),t.match("(the|those|these) (#Infinitive|#PresentTense|#PastTense)").term(1).tag("Noun","correction-determiner2"),t.match("(a|an) [#Gerund]").tag("Adjective","correction-a|an"),t.match("(a|an) #Adjective (#Infinitive|#PresentTense)").term(2).tag("Noun","correction-a|an2"),t.match("(some [#Verb] #Plural").tag("Noun","correction-determiner6"),t.match("#Determiner #Adjective$").not("(#Comparative|#Superlative)").term(1).tag("Noun","the-adj-1"),t.match("#Determiner [#Adjective] (#Copula|#PastTense|#Auxiliary)").tag("Noun","the-adj-2"),t.match("(the|this|those|these) #Adjective [#Verb]").tag("Noun","the-adj-verb"),t.match("(the|this|those|these) #Adverb #Adjective [#Verb]").tag("Noun","correction-determiner4"),t.match("(the|this|a|an) [#Infinitive] #Adverb? #Verb").tag("Noun","correction-determiner5"),t.match("#Determiner [#Verb] of").tag("Noun","the-verb-of"),t.match("#Determiner #Noun of [#Verb]").tag("Noun","noun-of-noun"),t.match("#Determiner #Adverb? [close]").tag("Adjective","a-close"),t.match("#Verb (a|an) [#Value]").tag("Singular","a-value"),t.match("(a|an) #Noun [#Infinitive]").tag("Noun","a-noun-inf")),t.has("like")&amp;&amp;(t.match("just [like]").tag("Preposition","like-preposition"),t.match("#Noun [like] #Noun").tag("Preposition","noun-like"),t.match("#Verb [like]").tag("Adverb","verb-like"),t.match("#Adverb like").not("(really|generally|typically|usually|sometimes|often) like").lastTerm().tag("Adverb","adverb-like")),t.has("#Value")&amp;&amp;(t.match("half a? #Value").tag("Value","half-a-value"),t.match("#Value and a (half|quarter)").tag("Value","value-and-a-half"),t.match("#Value+ #Currency").tag("Money","value-currency").lastTerm().tag("Unit","money-unit"),t.match("#Money and #Money #Currency?").tag("Money","money-and-money"),t.match("1 #Value #PhoneNumber").tag("PhoneNumber","1-800-Value"),t.match("#NumericValue #PhoneNumber").tag("PhoneNumber","(800) PhoneNumber"),t.match("#TextValue+").match("#Cardinal+ #Ordinal").tag("Ordinal","two-hundredth")),t.has("#Noun")&amp;&amp;(t.match("more #Noun").tag("Noun","more-noun"),t.match("[second] #Noun").not("#Honorific").unTag("Unit").tag("Ordinal","second-noun"),t.match("#Noun #Adverb [#Noun]").tag("Verb","correction"),t.match("#Noun [#Particle]").tag("Preposition","repair-noPhrasal"),t.match("#Noun (&amp;|n) #Noun").tag("Organization","Noun-&amp;-Noun"),t.match("#Noun #Actor").tag("Actor","thing-doer"),t.match("(this|that) [#Plural]").tag("PresentTense","this-verbs"),t.match("#Determiner #Infinitive$").lastTerm().tag("Noun","a-inf"),t.match("#Determiner [(western|eastern|northern|southern|central)] #Noun").tag("Noun","western-line"),t.match("(#Determiner|#Value) [(linear|binary|mobile|lexical|technical|computer|scientific|formal)] #Noun").tag("Noun","technical-noun"),t.has("#Organization")&amp;&amp;(t.match("#Organization of the? #TitleCase").tag("Organization","org-of-place"),t.match("#Organization #Country").tag("Organization","org-country"),t.match("(world|global|international|national|#Demonym) #Organization").tag("Organization","global-org")),t.has("#Possessive")&amp;&amp;(t.match("#Possessive [#FirstName]").unTag("Person","possessive-name"),t.match("#FirstName #Acronym? #Possessive").notIf("#Comma").match("#FirstName #Acronym? #LastName").tag("Possessive"),t.match("#Organization+ #Possessive").notIf("#Comma").tag("Possessive"),t.match("#Place+ #Possessive").notIf("#Comma").tag("Possessive"))),t.has("#Verb")){if(t.match("[still] #Verb").tag("Adverb","still-verb"),t.match("[u] #Verb").tag("Pronoun","u-pronoun-1"),t.match("is no [#Verb]").tag("Noun","is-no-verb"),t.match("[#Verb] than").tag("Noun","correction"),t.match("#Possessive [#Verb]").tag("Noun","correction-possessive"),t.match("there (are|were) #Adjective? [#PresentTense]").tag("Plural","there-are"),t.has("(who|what|where|why|how|when)")){t.match("^how").tag("QuestionWord","how-question").tag("QuestionWord","how-question"),t.match("how (#Determiner|#Copula|#Modal|#PastTense)").term(0).tag("QuestionWord","how-is"),t.match("^which").tag("QuestionWord","which-question").tag("QuestionWord","which-question"),t.match("which . (#Noun)+ #Pronoun").term(0).tag("QuestionWord","which-question2"),t.match("which").tag("QuestionWord","which-question3");var e=t.match("#QuestionWord #Noun #Copula #Adverb? (#Verb|#Adjective)").firstTerm();e.unTag("QuestionWord").tag("Conjunction","how-he-is-x"),(e=t.match("#QuestionWord #Noun #Adverb? #Infinitive not? #Gerund").firstTerm()).unTag("QuestionWord").tag("Conjunction","when i go fishing")}t.has("#Copula")&amp;&amp;(t.match("#Copula #Adjective to #Verb").match("#Adjective to").tag("Verb","correction"),t.match("#Copula [#Infinitive] #Noun").tag("Noun","is-pres-noun"),t.match("[#Infinitive] #Copula").tag("Noun","infinitive-copula"),t.match("#Copula (pretty|dead|full|well) (#Adjective|#Noun)").notIf("#Comma").tag("#Copula #Adverb #Adjective","sometimes-adverb"),t.match("#Copula [(just|alone)$]").tag("Adjective","not-adverb"));var r="(#Adverb|not)+?";t.has(r)&amp;&amp;(t.match("(has|had) ".concat(r," #PastTense")).not("#Verb$").tag("Auxiliary","had-walked"),t.match("#Copula ".concat(r," #Gerund")).not("#Verb$").tag("Auxiliary","copula-walking"),t.match("(be|been) ".concat(r," #Gerund")).not("#Verb$").tag("Auxiliary","be-walking"),t.match("(#Modal|did) ".concat(r," #Verb")).not("#Verb$").tag("Auxiliary","modal-verb"),t.match("#Modal ".concat(r," have ").concat(r," had ").concat(r," #Verb")).not("#Verb$").tag("Auxiliary","would-have"),t.match("(#Modal) ".concat(r," be ").concat(r," #Verb")).not("#Verb$").tag("Auxiliary","would-be"),t.match("(#Modal|had|has) ".concat(r," been ").concat(r," #Verb")).not("#Verb$").tag("Auxiliary","would-be")),t.match("#PhrasalVerb #PhrasalVerb").lastTerm().tag("Particle","phrasal-particle"),t.has("#Gerund")&amp;&amp;(t.match("#Gerund #Adverb? not? #Copula").firstTerm().tag("Activity","gerund-copula"),t.match("#Gerund #Modal").firstTerm().tag("Activity","gerund-modal"),t.match("#Gerund #Determiner [#Infinitive]").tag("Noun","running-a-show")),t.has("will #Adverb? not? #Adverb? be")&amp;&amp;!1===t.has("will #Adverb? not? #Adverb? be #Gerund")&amp;&amp;(t.match("will not? be").tag("Copula","will-be-copula"),t.match("will #Adverb? not? #Adverb? be #Adjective").match("be").tag("Copula","be-copula"))}if(t.has("#Adjective")&amp;&amp;(t.match("still #Adjective").match("still").tag("Adverb","still-advb"),t.match("#Adjective [#PresentTense]").tag("Noun","adj-presentTense"),t.match("will [#Adjective]").tag("Verb","will-adj"),t.match("#PresentTense (hard|quick|long|bright|slow)").lastTerm().tag("Adverb","lazy-ly"),t.match("(his|her|its) [#Adjective]").tag("Noun","his-fine"),t.match("#Noun #Adverb? [left]").tag("PastTense","left-verb")),t.has("#TitleCase")&amp;&amp;(t.match("#TitleCase (ltd|co|inc|dept|assn|bros)").tag("Organization","org-abbrv"),t.match("#TitleCase+ (district|region|province|county|prefecture|municipality|territory|burough|reservation)").tag("Region","foo-district"),t.match("(district|region|province|municipality|territory|burough|state) of #TitleCase").tag("Region","district-of-Foo")),t.has("#Hyphenated")){t.match("#Hyphenated #Hyphenated").match("#Noun #Verb").tag("Noun","hyphen-verb");var n=t.match("#Hyphenated+");n.has("#Expression")&amp;&amp;n.tag("Expression","ooh-wee")}return t.has("#Place")&amp;&amp;(t.match("(west|north|south|east|western|northern|southern|eastern)+ #Place").tag("Region","west-norfolk"),t.match("#City [#Acronym]").match("(al|ak|az|ar|ca|ct|dc|fl|ga|id|il|nv|nh|nj|ny|oh|or|pa|sc|tn|tx|ut|vt|pr)").tag("Region","us-state")),t.match("(foot|feet)").tag("Noun","foot-noun"),t.match("#Value (foot|feet)").term(1).tag("Unit","foot-unit"),t.match("#Conjunction [u]").tag("Pronoun","u-pronoun-2"),t.match("(a|an) (#Duration|hundred|thousand|million|billion|trillion|quadrillion|quintillion|sextillion|septillion)").ifNo("#Plural").term(0).tag("Value","a-is-one"),t.match("holy (shit|fuck|hell)").tag("Expression","swears-expression"),t.match("#Determiner (shit|damn|hell)").term(1).tag("Noun","swears-noun"),t.match("(shit|damn|fuck) (#Determiner|#Possessive|them)").term(0).tag("Verb","swears-verb"),t.match("#Copula fucked up?").not("#Copula").tag("Adjective","swears-adjective"),t.match("#Holiday (day|eve)").tag("Holiday","holiday-day"),t.match("(standard|daylight|summer|eastern|pacific|central|mountain) standard? time").tag("Time","timezone"),t.match("#Demonym #Currency").tag("Currency","demonym-currency"),t.match("about to #Adverb? #Verb").match("about to").tag(["Auxiliary","Verb"],"about-to"),t.match("#Honorific #Person").tag("Person","honorific-person"),t.match("#Person (jr|sr|md)").tag("Person","person-honorific"),t.match("(right|rights) of .").tag("Noun","right-of"),t}},{}],122:[function(t,e,r){"use strict";e.exports=function(t){return!0===t.has("#Person")&amp;&amp;(t.match("#FirstName #Person+").tag("ProperNoun"),t.match("#Person+ #LastName").tag("ProperNoun")),!0===t.has("#Place")&amp;&amp;t.match("(#City|#Region|#Country)").tag("ProperNoun"),t.match("#Organization").tag("ProperNoun"),t.match("#Month").tag("ProperNoun"),t}},{}],123:[function(t,e,r){"use strict";e.exports=function(e){var r=e.world.patterns;return Object.keys(r).forEach(function(t){e.match(t).tag(r[t],"post-hoc: "+t)}),e}},{}],124:[function(t,e,r){"use strict";var a=t("./fix"),i={wanna:["want","to"],gonna:["going","to"],im:["i","am"],alot:["a","lot"],dont:["do","not"],dun:["do","not"],ive:["i","have"],"won't":["will","not"],wont:["will","not"],"can't":["can","not"],cant:["can","not"],cannot:["can","not"],"shan't":["should","not"],imma:["I","will"],"where'd":["where","did"],whered:["where","did"],"when'd":["when","did"],whend:["when","did"],"how'd":["how","did"],howd:["how","did"],"what'd":["what","did"],whatd:["what","did"],"let's":["let","us"],dunno:["do","not","know"],brb:["be","right","back"],gtg:["got","to","go"],irl:["in","real","life"],tbh:["to","be","honest"],imo:["in","my","opinion"],til:["today","i","learned"],rn:["right","now"],twas:["it","was"],"@":["at"]};e.exports=function(t){for(var e=0;e&lt;t.terms.length;e++){var r=t.terms[e];if(i[r.normal]){var n=i[r.normal];t=a(t,n,e),e+=n.length-1}}return t}},{"./fix":128}],125:[function(t,e,r){"use strict";var c=t("./fix"),h=t("./split"),f={"that's":!0,"there's":!0},a={we:!0,they:!0,you:!0},m=function(t,e){var r=["is","not"];if(t.terms[e-1]){var n=t.terms[e-1];n.tags.Adverb&amp;&amp;t.terms[e-2]&amp;&amp;(n=t.terms[e-2]),(n.tags.Plural||!0===a[n.normal])&amp;&amp;(r[0]="are")}return r};e.exports=function(t){for(var e=0;e&lt;t.terms.length;e++)if(!t.terms[e].silent_term)if("ain't"!==t.terms[e].normal&amp;&amp;"aint"!==t.terms[e].normal){var r=h(t.terms[e]);if(r&amp;&amp;"s"===r.end){if(s=e,u=(o=t).terms[s],l=o.terms[s+1],!u.tags.Pronoun&amp;&amp;!u.tags.QuestionWord&amp;&amp;!f[u.normal]&amp;&amp;(!l||l.tags.Infinitive||!l.tags.VerbPhrase&amp;&amp;(l.tags.Noun||l.tags.Adjective&amp;&amp;o.terms[s+2]&amp;&amp;o.terms[s+2].tags.Noun||(l.tags.Adjective||l.tags.Adverb||l.tags.Verb,0)))){t.terms[e].tag("#Possessive","hard-contraction");continue}var n=[r.start,"is"];if(t.terms[e+1]){var a=t.terms[e].normal;t.match(a+" (#Negative|#Adverb|#Auxiliary)+? #Gerund").found?n=[r.start,"is"]:t.match(a+" (#Negative|#Adverb|#Auxiliary)+? #Verb").found&amp;&amp;(n=[r.start,"has"])}t=c(t,n,e),e+=1}}else{var i=m(t,e);t=c(t,i,e),e+=1}var o,s,u,l;return t}},{"./fix":128,"./split":129}],126:[function(t,e,r){"use strict";var i=t("./fix"),o=t("./split"),s={ll:"will",ve:"have",re:"are",m:"am","n't":"not"};e.exports=function(t){for(var e=0;e&lt;t.terms.length;e++)if(!t.terms[e].silent_term){var r=o(t.terms[e]);if(r){if(r.start=r.start.toLowerCase(),s[r.end]){var n=[r.start,s[r.end]];t=i(t,n,e),e+=1}if("d"===r.end){var a=[r.start,"would"];t.terms[e+1]&amp;&amp;t.terms[e+1].tags.PastTense&amp;&amp;(a[1]="had"),t.terms[e+2]&amp;&amp;t.terms[e+2].tags.PastTense&amp;&amp;t.terms[e+1].tags.Adverb&amp;&amp;(a[1]="had"),t=i(t,a,e),e+=1}}}return t}},{"./fix":128,"./split":129}],127:[function(t,e,r){"use strict";var i=t("./fix"),o=t("../../../term"),s=function(t){var e=/(-||)/;return e.test(t.whitespace.before)||e.test(t.whitespace.after)};e.exports=function(t){t.match("#Hyphenated #Hyphenated").match("#NumericValue #NumericValue").tag("NumberRange");for(var e=0;e&lt;t.terms.length;e++){var r=t.terms[e];if(!r.silent_term&amp;&amp;!r.tags.TextValue){if(r.tags.Value&amp;&amp;t.terms[e+1]&amp;&amp;0&lt;e&amp;&amp;(s(r)||s(t.terms[e-1]))&amp;&amp;t.terms[e-1].tags.Value){var n=new o("",t.world);return n.silent_term="to",t.insertAt(e,n),t.terms[e-1].tag("NumberRange","number-number1"),t.terms[e].tag("NumberRange","number-number2"),t.terms[e].whitespace.before="",t.terms[e].whitespace.after="",t.terms[e+1].tag("NumberRange","number-number3"),t}if(r.tags.NumberRange){var a=r.text.split(/(-||)/);a[1]="to",(t=i(t,a,e)).terms[e].tag(["NumberRange","NumericValue"],"numRange-1"),t.terms[e+1].tag(["NumberRange","Preposition"],"numRange-silent"),t.terms[e+2].tag(["NumberRange","NumericValue"],"numRange-3"),e+=2}}}return t}},{"../../../term":143,"./fix":128}],128:[function(t,e,r){"use strict";var o=t("../../../term"),n={not:"Negative",will:"Verb",would:"Modal",have:"Verb",are:"Copula",is:"Copula",am:"Verb"},s=function(t){n[t.silent_term]&amp;&amp;t.tag(n[t.silent_term])};e.exports=function(t,e,r){var n=t.terms[r];if(n.silent_term=e[0],n.tag("Contraction","tagger-contraction"),e[1]){var a=new o("",t.world);a.silent_term=e[1],a.tag("Contraction","tagger-contraction"),t.insertAt(r+1,a),a.whitespace.before="",a.whitespace.after="",s(a)}if(e[2]){var i=new o("",t.world);i.silent_term=e[2],t.insertAt(r+2,i),i.tag("Contraction","tagger-contraction"),s(i)}return t}},{"../../../term":143}],129:[function(t,e,r){"use strict";var n=/^([a-z]+)'([a-z][a-z]?)$/i,a=/[a-z]s'$/i,i={re:1,ve:1,ll:1,t:1,s:1,d:1,m:1};e.exports=function(t){if("can't"===t.normal)return{start:"can",end:"n't"};var e=t.normal.match(n);return e&amp;&amp;e[1]&amp;&amp;1===i[e[2]]?("t"===e[2]&amp;&amp;e[1].match(/[a-z]n$/)&amp;&amp;(e[1]=e[1].replace(/n$/,""),e[2]="n't"),!0===t.tags.TitleCase&amp;&amp;(e[1]=e[1].replace(/^[a-z]/,function(t){return t.toUpperCase()})),{start:e[1],end:e[2]}):!0===a.test(t.text)?{start:t.normal.replace(/s'?$/,""),end:""}:null}},{}],130:[function(t,e,r){"use strict";e.exports=/(?:0\u20E3\n1\u20E3|2\u20E3|3\u20E3|4\u20E3|5\u20E3|6\u20E3|7\u20E3|8\u20E3|9\u20E3|#\u20E3|\*\u20E3|\uD83C(?:\uDDE6\uD83C(?:\uDDE8|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDEE|\uDDF1|\uDDF2|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFC|\uDDFD|\uDDFF)|\uDDE7\uD83C(?:\uDDE6|\uDDE7|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDEF|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFB|\uDDFC|\uDDFE|\uDDFF)|\uDDE8\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF5|\uDDF7|\uDDFA|\uDDFB|\uDDFC|\uDDFD|\uDDFE|\uDDFF)|\uDDE9\uD83C(?:\uDDEA|\uDDEC|\uDDEF|\uDDF0|\uDDF2|\uDDF4|\uDDFF)|\uDDEA\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEC|\uDDED|\uDDF7|\uDDF8|\uDDF9|\uDDFA)|\uDDEB\uD83C(?:\uDDEE|\uDDEF|\uDDF0|\uDDF2|\uDDF4|\uDDF7)|\uDDEC\uD83C(?:\uDDE6|\uDDE7|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDEE|\uDDF1|\uDDF2|\uDDF3|\uDDF5|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFC|\uDDFE)|\uDDED\uD83C(?:\uDDF0|\uDDF2|\uDDF3|\uDDF7|\uDDF9|\uDDFA)|\uDDEE\uD83C(?:\uDDE8|\uDDE9|\uDDEA|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF6|\uDDF7|\uDDF8|\uDDF9)|\uDDEF\uD83C(?:\uDDEA|\uDDF2|\uDDF4|\uDDF5)|\uDDF0\uD83C(?:\uDDEA|\uDDEC|\uDDED|\uDDEE|\uDDF2|\uDDF3|\uDDF5|\uDDF7|\uDDFC|\uDDFE|\uDDFF)|\uDDF1\uD83C(?:\uDDE6|\uDDE7|\uDDE8|\uDDEE|\uDDF0|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFB|\uDDFE)|\uDDF2\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF5|\uDDF6|\uDDF7|\uDDF8|\uDDF9|\uDDFA|\uDDFB|\uDDFC|\uDDFD|\uDDFE|\uDDFF)|\uDDF3\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEB|\uDDEC|\uDDEE|\uDDF1|\uDDF4|\uDDF5|\uDDF7|\uDDFA|\uDDFF)|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C(?:\uDDE6|\uDDEA|\uDDEB|\uDDEC|\uDDED|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF7|\uDDF8|\uDDF9|\uDDFC|\uDDFE)|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C(?:\uDDEA|\uDDF4|\uDDF8|\uDDFA|\uDDFC)|\uDDF8\uD83C(?:\uDDE6|\uDDE7|\uDDE8|\uDDE9|\uDDEA|\uDDEC|\uDDED|\uDDEE|\uDDEF|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF7|\uDDF8|\uDDF9|\uDDFB|\uDDFD|\uDDFE|\uDDFF)|\uDDF9\uD83C(?:\uDDE6|\uDDE8|\uDDE9|\uDDEB|\uDDEC|\uDDED|\uDDEF|\uDDF0|\uDDF1|\uDDF2|\uDDF3|\uDDF4|\uDDF7|\uDDF9|\uDDFB|\uDDFC|\uDDFF)|\uDDFA\uD83C(?:\uDDE6|\uDDEC|\uDDF2|\uDDF8|\uDDFE|\uDDFF)|\uDDFB\uD83C(?:\uDDE6|\uDDE8|\uDDEA|\uDDEC|\uDDEE|\uDDF3|\uDDFA)|\uDDFC\uD83C(?:\uDDEB|\uDDF8)|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C(?:\uDDEA|\uDDF9)|\uDDFF\uD83C(?:\uDDE6|\uDDF2|\uDDFC)))|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2692-\u2694\u2696\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD79\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED0\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3]|\uD83E[\uDD10-\uDD18\uDD80-\uDD84\uDDC0]/g},{}],131:[function(t,e,r){"use strict";e.exports={":(":!0,":)":!0,":P":!0,":p":!0,":O":!0,":3":!0,":|":!0,":/":!0,":\\":!0,":$":!0,":*":!0,":@":!0,":-(":!0,":-)":!0,":-P":!0,":-p":!0,":-O":!0,":-3":!0,":-|":!0,":-/":!0,":-\\":!0,":-$":!0,":-*":!0,":-@":!0,":^(":!0,":^)":!0,":^P":!0,":^p":!0,":^O":!0,":^3":!0,":^|":!0,":^/":!0,":^\\":!0,":^$":!0,":^*":!0,":^@":!0,"):":!0,"(:":!0,"$:":!0,"*:":!0,")-:":!0,"(-:":!0,"$-:":!0,"*-:":!0,")^:":!0,"(^:":!0,"$^:":!0,"*^:":!0,"&lt;3":!0,"&lt;/3":!0,"&lt;\\3":!0}},{}],132:[function(t,e,r){"use strict";e.exports={beforeThisWord:{there:"Verb",me:"Verb",man:"Adjective",only:"Verb",him:"Verb",were:"Noun",took:"Noun",himself:"Verb",went:"Noun",who:"Noun",jr:"Person"},afterThisWord:{i:"Verb",first:"Noun",it:"Verb",there:"Verb",not:"Verb",because:"Noun",if:"Noun",but:"Noun",who:"Verb",this:"Noun",his:"Noun",when:"Noun",you:"Verb",very:"Adjective",old:"Noun",never:"Verb",before:"Noun"},beforeThisPos:{Copula:"Noun",PastTense:"Noun",Conjunction:"Noun",Modal:"Noun",PluperfectTense:"Noun",PerfectTense:"Verb"},afterThisPos:{Adjective:"Noun",Possessive:"Noun",Determiner:"Noun",Adverb:"Verb",Pronoun:"Verb",Value:"Noun",Ordinal:"Noun",Modal:"Verb",Superlative:"Noun",Demonym:"Noun",Honorific:"Person"}}},{}],133:[function(t,e,r){"use strict";var n="Adjective",a="Infinitive",i="Singular",o="PastTense",s="Expression",u="LastName";e.exports={a:[[/.[aeiou]na$/,"Noun"],[/.[oau][wvl]ska$/,u],[/.[^aeiou]ica$/,i],[/^([hyj]a)+$/,s]],c:[[/.[^aeiou]ic$/,n]],d:[[/.[ia]sed$/,n],[/.[gt]led$/,n],[/.[aeiou][td]ed$/,o],[/.[^aeiou]led$/,o],[/[^aeiou]ard$/,i],[/[aeiou][^aeiou]id$/,n],[/[aeiou]c?ked$/,o],[/[^aeiou][aeiou][tvx]ed$/,o],[/.[vrl]id$/,n]],e:[[/.[lnr]ize$/,a],[/.[^aeiou]ise$/,a],[/.[aeiou]te$/,a],[/.[^aeiou][ai]ble$/,n],[/.[^aeiou]eable$/,n],[/.[^aeiou]ive$/,n]],h:[[/.[^aeiouf]ish$/,n],[/.v[iy]ch$/,u],[/^ug?h+$/,s],[/^uh[ -]?oh$/,s]],i:[[/.[oau][wvl]ski$/,u]],k:[[/^(k)+$/,s]],l:[[/.[gl]ial$/,n],[/.[^aeiou]ful$/,n],[/.[nrtumcd]al$/,n],[/.[^aeiou][ei]al$/,n]],m:[[/.[^aeiou]ium$/,i],[/[^aeiou]ism$/,i],[/^h*u*m+$/,s],[/^\d+ ?[ap]m$/,"Date"]],n:[[/.[lsrnpb]ian$/,n],[/[^aeiou]ician$/,"Actor"],[/okin$/,"Gerund"]],o:[[/^no+$/,s],[/^(yo)+$/,s],[/^woo+[pt]?$/,s]],r:[[/.[ilk]er$/,"Comparative"],[/[aeiou][pns]er$/,i],[/[^i]fer$/,a],[/.[^aeiou][ao]pher$/,"Actor"]],t:[[/.[di]est$/,"Superlative"],[/.[icldtgrv]ent$/,n],[/[aeiou].*ist$/,n],[/^[a-z]et$/,"Verb"]],s:[[/.[rln]ates$/,"PresentTense"],[/.[^z]ens$/,"Verb"],[/.[lstrn]us$/,i],[/[aeiou][^aeiou]is$/,i],[/[a-z]\'s$/,"Noun"],[/^yes+$/,s]],v:[[/.[^aeiou][ai][kln]ov$/,u]],y:[[/.[cts]hy$/,n],[/.[st]ty$/,n],[/.[gk]y$/,n],[/.[tnl]ary$/,n],[/.[oe]ry$/,i],[/[rdntkbhs]ly$/,"Adverb"],[/...lly$/,"Adverb"],[/[bszmp]{2}y$/,n],[/.(gg|bb|zz)ly$/,n],[/.[aeiou]my$/,n],[/[ea]{2}zy$/,n],[/.[^aeiou]ity$/,i]]}},{}],134:[function(t,e,r){"use strict";var n="Adjective",a="Infinitive",i="PresentTense",o="Singular",s="PastTense",u="Adverb",l="Plural",c="Actor",h="Verb",f="LastName";e.exports=[null,null,{ea:o,ia:"Noun",ic:n,ly:u,"'n":h,"'t":h},{que:n,lar:n,ike:n,ffy:n,nny:n,rmy:n,azy:n,oid:n,mum:n,ous:n,end:h,sis:o,rol:o,ize:a,ify:a,zes:i,nes:i,ing:"Gerund"," so":u,"'ll":"Modal","'re":"Copula"},{teen:"Value",tors:"Noun",amed:s,ched:s,ends:h,oses:i,fies:i,ects:i,nded:s,cede:a,tage:a,gate:a,vice:o,tion:o,cted:s,ette:o,some:n,llen:n,ried:n,gone:n,made:n,fore:u,less:u,ices:l,ions:l,ints:l,aped:s,lked:s,ould:"Modal",tive:c,sson:f,czyk:f,chuk:f,enko:f,akis:f,nsen:f},{fully:u,where:u,wards:u,urned:s,tized:s,eased:s,ances:l,tures:l,ports:l,ettes:l,ities:l,rough:n,bound:n,tieth:"Ordinal",ishes:i,tches:i,nssen:f,marek:f},{keeper:c,logist:c,auskas:f,teenth:"Value"},{sdottir:f,opoulos:f}]},{}],135:[function(t,e,r){"use strict";e.exports=function(r){var n=Object.keys(r);n.forEach(function(t){r[t].downward=[];for(var e=0;e&lt;n.length;e++)r[n[e]].isA&amp;&amp;r[n[e]].isA===t&amp;&amp;r[t].downward.push(n[e])})}},{}],136:[function(t,e,r){"use strict";e.exports=[["Noun","Verb","Adjective","Adverb","Determiner","Conjunction","Preposition","QuestionWord","Expression","Url","PhoneNumber","Email","Emoji"],["Person","Organization","Value","Place","Actor","Demonym","Pronoun"],["Acronym","Pronoun","Actor","Unit","Address"],["Acronym","Plural"],["Plural","Singular"],["MaleName","FemaleName"],["FirstName","LastName","Honorific"],["Comparative","Superlative"],["Value","Verb","Adjective"],["Ordinal","Cardinal"],["TextValue","NumericValue"],["NiceNumber","TextValue"],["Ordinal","Currency"],["PastTense","PresentTense","FutureTense"],["Pluperfect","Copula","Modal","Participle","Infinitive","Gerund","FuturePerfect","PerfectTense"],["Auxiliary","Noun","Value"],["Month","WeekDay","Year","Duration","Holiday"],["Particle","Conjunction","Adverb","Preposition"],["Date","Verb","Adjective","Person"],["Date","Money","RomanNumeral","Fraction"],["Value","Determiner"],["Url","Value","HashTag","PhoneNumber","Emoji"],["RomanNumeral","Fraction","NiceNumber"],["RomanNumeral","Money"],["UpperCase","TitleCase","CamelCase"],["VerbPhrase","Noun","Adjective","Value"],["QuestionWord","VerbPhrase"],["Acronym","VerbPhrase"]]},{}],137:[function(t,e,r){"use strict";var n,a,i,o=t("./conflicts"),s=t("./tags/nouns"),u=t("./tags/verbs"),l=t("./tags/values"),c=t("./tags/dates"),h=t("./tags/misc"),f=t("./addDownward"),m={Noun:"blue",Date:"red",Value:"red",Verb:"green",Auxiliary:"green",Negative:"green",VerbPhrase:"green",Preposition:"cyan",Condition:"cyan",Conjunction:"cyan",Determiner:"cyan",Adjective:"magenta",Adverb:"cyan"},d=function(e,r){Object.keys(e).forEach(function(t){r[t]=e[t]})};e.exports=(d(s,i={}),d(u,i),d(l,i),d(c,i),d(h,i),f(i),n=i,Object.keys(n).forEach(function(e){n[e].notA={};for(var t=0;t&lt;o.length;t++){var r=o[t];-1!==r.indexOf(e)&amp;&amp;(r=r.filter(function(t){return t!==e})).forEach(function(t){n[e].notA[t]=!0})}n[e].notA=Object.keys(n[e].notA)}),a=i,Object.keys(a).forEach(function(t){m[t]?a[t].color=m[t]:a[t].isA&amp;&amp;m[a[t].isA]?a[t].color=m[a[t].isA]:a[t].isA&amp;&amp;a[a[t].isA].color&amp;&amp;(a[t].color=a[a[t].isA].color)}),i)},{"./addDownward":135,"./conflicts":136,"./tags/dates":138,"./tags/misc":139,"./tags/nouns":140,"./tags/values":141,"./tags/verbs":142}],138:[function(t,e,r){"use strict";e.exports={Date:{},Month:{isA:"Date",also:"Singular"},WeekDay:{isA:"Date",also:"Noun"},RelativeDay:{isA:"Date"},Year:{isA:"Date"},Duration:{isA:"Date",also:"Noun"},Time:{isA:"Date",also:"Noun"},Holiday:{isA:"Date",also:"Noun"}}},{}],139:[function(t,e,r){"use strict";e.exports={Adjective:{},Comparable:{isA:"Adjective"},Comparative:{isA:"Adjective"},Superlative:{isA:"Adjective"},NumberRange:{isA:"Contraction"},Adverb:{},Currency:{},Determiner:{},Conjunction:{},Preposition:{},QuestionWord:{},RelativeProunoun:{isA:"Pronoun"},Expression:{},Abbreviation:{},Url:{},PhoneNumber:{},HashTag:{},AtMention:{is:"Noun"},Emoji:{},Email:{},Condition:{},VerbPhrase:{},Auxiliary:{},Negative:{},Contraction:{},TitleCase:{},CamelCase:{},UpperCase:{},Hyphenated:{},Acronym:{},ClauseEnd:{},Quotation:{},StartQuotation:{isA:"Quotation"},EndQuotation:{isA:"Quotation"},Parentheses:{},EndBracket:{isA:"Parentheses"},StartBracket:{isA:"Parentheses"}}},{}],140:[function(t,e,r){"use strict";e.exports={Noun:{},Singular:{isA:"Noun"},ProperNoun:{isA:"Noun"},Person:{isA:"Singular"},FirstName:{isA:"Person"},MaleName:{isA:"FirstName"},FemaleName:{isA:"FirstName"},LastName:{isA:"Person"},Honorific:{isA:"Noun"},Place:{isA:"Singular"},Country:{isA:"Place"},City:{isA:"Place"},Region:{isA:"Place"},Address:{isA:"Place"},Organization:{isA:"Singular"},SportsTeam:{isA:"Organization"},Company:{isA:"Organization"},School:{isA:"Organization"},Plural:{isA:"Noun"},Uncountable:{isA:"Noun"},Pronoun:{isA:"Noun"},Actor:{isA:"Noun"},Activity:{isA:"Noun"},Unit:{isA:"Noun"},Demonym:{isA:"Noun"},Possessive:{isA:"Noun"}}},{}],141:[function(t,e,r){"use strict";e.exports={Value:{},Ordinal:{isA:"Value"},Cardinal:{isA:"Value"},Multiple:{isA:"Value"},RomanNumeral:{isA:"Cardinal"},Fraction:{isA:"Value"},TextValue:{isA:"Value"},NumericValue:{isA:"Value"},NiceNumber:{isA:"Value"},Money:{},Percent:{isA:"Value"}}},{}],142:[function(t,e,r){"use strict";e.exports={Verb:{isA:"VerbPhrase"},PresentTense:{isA:"Verb"},Infinitive:{isA:"PresentTense"},Gerund:{isA:"PresentTense"},PastTense:{isA:"Verb"},PerfectTense:{isA:"Verb"},FuturePerfect:{isA:"Verb"},Pluperfect:{isA:"Verb"},Copula:{isA:"Verb"},Modal:{isA:"Verb"},Participle:{isA:"Verb"},Particle:{isA:"Verb"},PhrasalVerb:{isA:"Verb"}}},{}],143:[function(t,e,r){"use strict";var n=t("./paths").fns,a=t("./whitespace"),i=t("./makeUID"),o=t("./methods/normalize/normalize").addNormal,s=t("./methods/normalize/root"),u=function(t,e){this.tags={},this._text=n.ensureString(t),Object.defineProperty(this,"world",{enumerable:!1,value:e});var r=a(this._text);this.whitespace=r.whitespace,this._text=r.text,this.parent=null,this.silent_term="",this.lumped=!1,o(this),s(this),this.dirty=!1,this.uid=i(this.normal),Object.defineProperty(this,"text",{get:function(){return this._text},set:function(t){t=t||"",this._text=t.trim(),this.dirty=!0,this.normalize()}}),Object.defineProperty(this,"isA",{get:function(){return"Term"}})};u.prototype.normalize=function(){return o(this),s(this),this},u.prototype.index=function(){var t=this.parentTerms;return t?t.terms.indexOf(this):null},u.prototype.clone=function(){var t=new u(this._text,this.world);return t.tags=n.copy(this.tags),t.whitespace=n.copy(this.whitespace),t.silent_term=this.silent_term,t},t("./methods/misc")(u),t("./methods/out")(u),t("./methods/tag")(u),t("./methods/case")(u),t("./methods/punctuation")(u),e.exports=u},{"./makeUID":144,"./methods/case":146,"./methods/misc":147,"./methods/normalize/normalize":149,"./methods/normalize/root":150,"./methods/out":153,"./methods/punctuation":156,"./methods/tag":158,"./paths":161,"./whitespace":162}],144:[function(t,e,r){"use strict";e.exports=function(t){for(var e="",r=0;r&lt;5;r++)e+=parseInt(9*Math.random(),10);return t+"-"+e}},{}],145:[function(t,e,r){"use strict";var n={Auxiliary:1,Possessive:1,TitleCase:1,ClauseEnd:1,Comma:1,CamelCase:1,UpperCase:1,Hyphenated:1,VerbPhrase:1,EndBracket:1,StartBracket:1,Parentheses:1,Quotation:1};e.exports=function(t){var r=t.world.tags,e=Object.keys(t.tags);return(e=(e=e.sort()).sort(function(t,e){return r[t]?n[e]||!r[e]?-1:(r[t].downward.length,r[e].downward.length,1):1}))[0]}},{}],146:[function(t,e,r){"use strict";e.exports=function(e){var r={toUpperCase:function(){return this.text=this._text.toUpperCase(),this.tag("#UpperCase","toUpperCase"),this},toLowerCase:function(){return this.text=this._text.toLowerCase(),this.unTag("#TitleCase"),this.unTag("#UpperCase"),this},toTitleCase:function(){return this.text=this._text.replace(/^ *[a-z]/,function(t){return t.toUpperCase()}),this.tag("#TitleCase","toTitleCase"),this},needsTitleCase:function(){for(var t=["Person","Place","Organization","Acronym","UpperCase","Currency","RomanNumeral","Month","WeekDay","Holiday","Demonym"],e=0;e&lt;t.length;e++)if(this.tags[t[e]])return!0;for(var r=["i","god","allah"],n=0;n&lt;r.length;n++)if(this.normal===r[n])return!0;return!1}};return Object.keys(r).forEach(function(t){e.prototype[t]=r[t]}),e}},{}],147:[function(t,e,r){"use strict";var n=t("./normalize/isAcronym"),a=t("./bestTag"),i=/[aeiouy]/i,o=/[a-z]/,s=/[0-9]/;e.exports=function(e){var r={bestTag:function(){return a(this)},isAcronym:function(){return n(this._text)},isWord:function(){var t=this;return!(!t.silent_term&amp;&amp;(!1===/[a-z|A-Z|0-9]/.test(t.text)||3&lt;t.normal.length&amp;&amp;!0===o.test(t.normal)&amp;&amp;!1===i.test(t.normal)&amp;&amp;!1===t.isAcronym()||!0===s.test(t.normal)&amp;&amp;!1===t.tags.hasOwnProperty("Value")&amp;&amp;!0===/[a-z][0-9][a-z]/.test(t.normal)))}};return Object.keys(r).forEach(function(t){e.prototype[t]=r[t]}),e}},{"./bestTag":145,"./normalize/isAcronym":148}],148:[function(t,e,r){"use strict";var n=/([A-Z]\.)+[A-Z]?,?$/,a=/^[A-Z]\.,?$/,i=/[A-Z]{2}('s|,)?$/;e.exports=function(t){return!0===n.test(t)||!0===a.test(t)||!0===i.test(t)}},{}],149:[function(t,e,r){"use strict";var n=t("./unicode"),a=t("./isAcronym");r.normalize=function(t){var e=t=(t=(t=t||"").toLowerCase()).trim();return t=(t=(t=(t=(t=(t=(t=n(t)).replace(/^[#@]/,"")).replace(/[,;.!?]+$/,"")).replace(/[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]+/g,"'")).replace(/[\u0022\u00AB\u00BB\u201C\u201D\u201E\u201F\u2033\u2034\u2036\u2037\u2E42\u301D\u301E\u301F\uFF02]+/g,'"')).replace(/\u2026/g,"...")).replace(/\u2013/g,"-"),!0===/[a-z][^aeiou]in[']$/.test(t)&amp;&amp;(t=t.replace(/in[']$/,"ing")),!0===/^(re|un)-?[^aeiou]./.test(t)&amp;&amp;(t=t.replace("-","")),!1===/^[:;]/.test(t)&amp;&amp;(t=(t=(t=t.replace(/\.{3,}$/g,"")).replace(/['",\.!:;\?\)]+$/g,"")).replace(/^['"\(]+/g,"")),""===(t=t.trim())&amp;&amp;(t=e),t},r.addNormal=function(t){var e=t._text||"";e=r.normalize(e),a(t._text)&amp;&amp;(e=e.replace(/\./g,"")),e=e.replace(/([0-9]),([0-9])/g,"$1$2"),t.normal=e}},{"./isAcronym":148,"./unicode":151}],150:[function(t,e,r){"use strict";e.exports=function(t){var e=t.normal||t.silent_term||"";e=(e=e.replace(/'s\b/,"")).replace(/'$/,""),t.root=e}},{}],151:[function(t,e,r){"use strict";var n={"!":"","?":"",'"':'"',"'":"","-":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",I:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:""},a={};Object.keys(n).forEach(function(e){n[e].split("").forEach(function(t){a[t]=e})}),e.exports=function(t){var r=t.split("");return r.forEach(function(t,e){a[t]&amp;&amp;(r[e]=a[t])}),r.join("")}},{}],152:[function(t,e,r){"use strict";var n=t("../../paths"),i=n.fns,o=n.tags;e.exports=function(t){for(var e="silver",r=Object.keys(t.tags),n=0;n&lt;r.length;n++)if(o[r[n]]&amp;&amp;o[r[n]].color){e=o[r[n]].color;break}var a=i.leftPad(t.text,12);a+=" "+r,console.log("%c "+a,"color: "+e)}},{"../../paths":161}],153:[function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&amp;&amp;"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&amp;&amp;"function"==typeof Symbol&amp;&amp;t.constructor===Symbol&amp;&amp;t!==Symbol.prototype?"symbol":typeof t})(t)}var a=t("./renderHtml"),i=t("./client"),o=t("./server"),s={text:function(t){return(t.whitespace.before||"")+t._text+(t.whitespace.after||"")},normal:function(t){return t.normal},root:function(t){return t.root||t.normal},html:function(t){return a(t)},tags:function(t){return{text:t.text,normal:t.normal,tags:Object.keys(t.tags)}},debug:function(t){"object"===("undefined"==typeof window?"undefined":n(window))?i(t):o(t)}};e.exports=function(t){return t.prototype.out=function(t){return s[t]||(t="text"),s[t](this)},t}},{"./client":152,"./renderHtml":154,"./server":155}],154:[function(t,e,r){"use strict";var a=function(t){var e={"&lt;":"&amp;lt;","&gt;":"&amp;gt;","&amp;":"&amp;amp;",'"':"&amp;quot;","'":"&amp;#39;"," ":"&amp;nbsp;"};return t.replace(/[&lt;&gt;&amp;"' ]/g,function(t){return e[t]})};e.exports=function(t){var e=Object.keys(t.tags).filter(function(t){return"Term"!==t});e=(e=e.map(function(t){return"nl-"+t})).join(" ");var r=function(t){for(var e,r="(?:[^\"'&gt;]|\"[^\"]*\"|'[^']*')*",n=new RegExp("&lt;(?:!--(?:(?:-*[^-&gt;])*--+|-?)|script\\b"+r+"&gt;[\\s\\S]*?&lt;/script\\s*|style\\b"+r+"&gt;[\\s\\S]*?&lt;/style\\s*|/?[a-z]"+r+")&gt;","gi");(t=(e=t).replace(n,""))!==e;);return t.replace(/&lt;/g,"&amp;lt;")}(t.text),n='&lt;span class="'+e+'"&gt;'+(r=a(r))+"&lt;/span&gt;";return a(t.whitespace.before)+n+a(t.whitespace.after)}},{}],155:[function(t,e,r){"use strict";var a=t("../../paths").fns;e.exports=function(t){var e=Object.keys(t.tags).map(function(t){return a.printTag(t)}).join(", "),r=t.text;r="'"+a.yellow(r||"-")+"'";var n="";t.silent_term&amp;&amp;(n="["+t.silent_term+"]"),r=a.leftPad(r,20),r+=a.leftPad(n,8),console.log("   "+r+"        - "+e)}},{"../../paths":161}],156:[function(t,e,r){"use strict";var n=/([a-z0-9 ])([,:;.!?]+)$/i;e.exports=function(e){var r={getPunctuation:function(){var t=this.text.match(n);return t?t[2]:null},setPunctuation:function(t){return this.killPunctuation(),this.text+=t,","===t&amp;&amp;(this.tags.Comma=!0),this},hasComma:function(){return","===this.getPunctuation()},killPunctuation:function(){return this.text=this._text.replace(n,"$1"),delete this.tags.Comma,delete this.tags.ClauseEnd,this}};return Object.keys(r).forEach(function(t){e.prototype[t]=r[t]}),e}},{}],157:[function(t,e,r){"use strict";e.exports=function t(e,r){var n=e.world.tags;if(void 0===n[r])return!0;for(var a=n[r].notA||[],i=0;i&lt;a.length;i++)if(!0===e.tags[a[i]])return!1;return void 0===n[r].isA||t(e,n[r].isA)}},{}],158:[function(t,e,r){"use strict";var n=t("./setTag"),a=t("./unTag"),i=t("./canBe"),o={".":!0};e.exports=function(e){var r={tag:function(t,e){!0!==o[t]&amp;&amp;n(this,t,e)},unTag:function(t,e){!0!==o[t]&amp;&amp;a(this,t,e)},canBe:function(t){if("string"==typeof(t=t||"")){if(!0===o[t])return!0;t=t.replace(/^#/,"")}return i(this,t)}};return Object.keys(r).forEach(function(t){e.prototype[t]=r[t]}),e}},{"./canBe":157,"./setTag":159,"./unTag":160}],159:[function(t,e,r){"use strict";var n=t("../../paths"),u=n.log,a=n.fns,l=t("./unTag"),i=function t(e,r,n){var a=e.world.tags;if(r=r.replace(/^#/,""),!0!==e.tags[r]&amp;&amp;(e.tags[r]=!0,u.tag(e,r,n),a[r])){for(var i=a[r].notA||[],o=0;o&lt;i.length;o++)!0===e.tags[i[o]]&amp;&amp;l(e,i[o],n);if(a[r].isA){var s=a[r].isA;!0!==e.tags[s]&amp;&amp;t(e,s," --\x3e "+r)}}};e.exports=function(e,t,r){if(e&amp;&amp;t){var n=e.world.tags;a.isArray(t)?t.forEach(function(t){return i(e,t,r)}):(i(e,t,r),n[t]&amp;&amp;void 0!==n[t].also&amp;&amp;i(e,n[t].also,r))}}},{"../../paths":161,"./unTag":160}],160:[function(t,e,r){"use strict";var s=t("../../paths").log;e.exports=function(t,e,r){t&amp;&amp;e&amp;&amp;("*"!==e?function t(e,r,n){var a=e.world.tags;if(e.tags[r]&amp;&amp;(s.unTag(e,r,n),delete e.tags[r],a[r]))for(var i=a[r].downward,o=0;o&lt;i.length;o++)t(e,i[o]," - -   - ")}(t,e,r):t.tags={})}},{"../../paths":161}],161:[function(t,e,r){"use strict";e.exports={fns:t("../fns"),log:t("../log")}},{"../fns":3,"../log":6}],162:[function(t,e,r){"use strict";var n=/^([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]|\x2D+|\.\.+|\/|"|"|\uFF02|'|\u201C|\u2018|\u201F|\u201B|\u201E|\u2E42|\u201A|\xAB|\u2039|\u2035|\u2036|\u2037|\u301D|`|\u301F)+/,a=/([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+|\x2D+|\.\.+|"|"|\uFF02|'|\u201D|\u2019|\xBB|\u203A|\u2032|\u2033|\u2034|\u301E|\xB4)+$/,i=/([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+|\x2D+|\.\.+|"|"|\uFF02|'|\u201D|\u2019|\xBB|\u203A|\u2032|\u2033|\u2034|\u301E|\xB4)+[ !,\.;\?]*$/,o=/^( *)-(\$|||)?([0-9])/;e.exports=function(t){var e={before:"",after:""},r=t.match(o);return null!==r?(e.before=r[1],t=t.replace(/^ */,"")):null!==(r=t.match(n))&amp;&amp;(e.before=t.match(n)[0],t=t.replace(n,"")),null!==(r=t.match(i))&amp;&amp;(t=t.replace(a,""),e.after=r[0]),{whitespace:e,text:t}}},{}],163:[function(t,e,r){"use strict";var d=t("../term"),p=/\S/,g=/^[!?.]+$/,v={".":!0,"-":!0,"":!0,"":!0,"--":!0,"...":!0};e.exports=function(t,e){var r,n=[],a=[];"number"==typeof(t=t||"")&amp;&amp;(t=String(t));for(var i,o=t.split(/(\S+)/),s=0;s&lt;o.length;s++){var u=o[s];if(!0==(!0!==/^(re|un)-?[^aeiou]./.test(r=u)&amp;&amp;(!0===/^([a-z`"'/]+)(-||)([a-z0-9].*)/i.test(r)||!!/^([0-9]+)(|)([0-9].*)/i.test(r))))for(var l=u.split(/[-]/),c=0;c&lt;l.length;c++)c===l.length-1?a.push(l[c]):a.push(l[c]+"-");else if(1==!(!/[a-z]\/[a-z]/.test(i=u)||2!==i.split(/\//g).length)){var h=u.split(/\//);a.push(h[0]),a.push("/"+h[1])}else a.push(u)}for(var f="",m=0;m&lt;a.length;m++)!0===p.test(a[m])&amp;&amp;!1===v.hasOwnProperty(a[m])&amp;&amp;!1===g.test(a[m])?(n.push(f+a[m]),f=""):f+=a[m];return f&amp;&amp;0&lt;n.length&amp;&amp;(n[n.length-1]+=f),n.map(function(t){return new d(t,e)})}},{"../term":143}],164:[function(t,e,r){"use strict";e.exports={parent:{get:function(){return this.refText||this},set:function(t){return this.refText=t,this}},parentTerms:{get:function(){return this.refTerms||this},set:function(t){return this.refTerms=t,this}},dirty:{get:function(){for(var t=0;t&lt;this.terms.length;t++)if(!0===this.terms[t].dirty)return!0;return!1},set:function(e){this.terms.forEach(function(t){t.dirty=e})}},refTerms:{get:function(){return this._refTerms||this},set:function(t){return this._refTerms=t,this}},found:{get:function(){return 0&lt;this.terms.length}},length:{get:function(){return this.terms.length}},isA:{get:function(){return"Terms"}},whitespace:{get:function(){var e=this;return{before:function(t){return e.firstTerm().whitespace.before=t,e},after:function(t){return e.lastTerm().whitespace.after=t,e}}}}}},{}],165:[function(t,e,r){"use strict";var a=t("./build"),s=t("./getters"),u=t("../world"),i=function(t,e,r,n){var a=this;this.terms=t,this.world=e||u,this.refText=r,this._refTerms=n,this.get=function(t){return a.terms[t]};for(var i=Object.keys(s),o=0;o&lt;i.length;o++)Object.defineProperty(this,i[o],s[i[o]])};i.fromString=function(t,e){var r=a(t,e),n=new i(r,e,null);return n.terms.forEach(function(t){t.parentTerms=n}),n},t("./match")(i),t("./methods/tag")(i),t("./methods/loops")(i),t("./match/not")(i),t("./methods/delete")(i),t("./methods/insert")(i),t("./methods/misc")(i),t("./methods/out")(i),t("./methods/replace")(i),t("./methods/split")(i),t("./methods/transform")(i),t("./methods/lump")(i),e.exports=i},{"../world":215,"./build":163,"./getters":164,"./match":166,"./match/not":176,"./methods/delete":177,"./methods/insert":178,"./methods/loops":179,"./methods/lump":181,"./methods/misc":182,"./methods/out":183,"./methods/replace":184,"./methods/split":185,"./methods/tag":186,"./methods/transform":187}],166:[function(t,e,r){"use strict";var i=t("./lib/syntax"),o=t("./lib/startHere"),s=t("../../text"),u=t("./lib");e.exports=function(a){var e={match:function(t,e){var r=this;if(0===this.terms.length)return new s([],this.world,this.parent);if(!t)return new s([],this.world,this.parent);var n=u(this,t,e);return n=n.map(function(t){return new a(t,r.world,r.refText,r.refTerms)}),new s(n,this.world,this.parent)},matchOne:function(t){if(0===this.terms.length)return null;for(var e=i(t),r=0;r&lt;this.terms.length&amp;&amp;!(e[0]&amp;&amp;e[0].starting&amp;&amp;0&lt;r);r++){var n=o(this,r,e);if(n)return n}return null},has:function(t){return null!==this.matchOne(t)}};return Object.keys(e).forEach(function(t){a.prototype[t]=e[t]}),a}},{"../../text":192,"./lib":170,"./lib/startHere":174,"./lib/syntax":175}],167:[function(t,e,r){"use strict";e.exports=function(t,e){e.capture?t.captureGroup=!0:t.captureGroup=void 0}},{}],168:[function(t,e,r){"use strict";e.exports=function(t){var n=[];return t.forEach(function(t){if(0!==t.filter(function(t){return!0===t.captureGroup}).length){for(var e=[],r=0;r&lt;t.length;r+=1)t[r].captureGroup?e.push(t[r]):0&lt;e.length&amp;&amp;(n.push(e),e=[]);0&lt;e.length&amp;&amp;n.push(e)}else n.push(t)}),n}},{}],169:[function(t,e,r){"use strict";e.exports=function(t,e){for(var r=0;r&lt;e.length;r++){var n=e[r],a=!1;if(!0!==n.optional&amp;&amp;!0!==n.negative&amp;&amp;void 0===n.minMax){if(void 0!==n.normal){for(var i=0;i&lt;t.terms.length;i++){if(t.terms[i].normal===n.normal||t.terms[i].silent_term===n.normal){a=!0;break}if(!0===t.terms[i].lumped)return!1}if(!1===a)return!0}if(void 0!==n.tag){for(var o=0;o&lt;t.terms.length;o++)if(!0===t.terms[o].tags[n.tag]){a=!0;break}if(!1===a)return!0}}}return!1}},{}],170:[function(t,e,r){"use strict";var o=t("./syntax"),s=t("./startHere"),u=t("./fastPass"),l=t("./captureGroup"),c=function(t){return t?t.terms.map(function(t){return{id:t.uid}}):[]};e.exports=function(t,e,r){if("string"==typeof e?e=o(e):e&amp;&amp;"Text"===e.isA?e=c(e.list[0]):e&amp;&amp;"Terms"===e.isA&amp;&amp;(e=c(e)),!e||0===e.length)return[];if(!0===u(t,e,r))return[];for(var n=[],a=0;a&lt;t.terms.length&amp;&amp;!(0&lt;a&amp;&amp;e[0]&amp;&amp;e[0].starting);a+=1){var i=s(t,a,e,r);i&amp;&amp;0&lt;i.length&amp;&amp;(n.push(i),a+=i.length-1)}return l(n)}},{"./captureGroup":168,"./fastPass":169,"./startHere":174,"./syntax":175}],171:[function(t,e,r){"use strict";var a=t("./applyCaptureGroup");e.exports=function(t,e,r){if(!t||!e)return!1;var n=function(t,e){if(!t||!e)return!1;if(!0===e.anyOne)return!0;if(void 0!==e.tag)return t.tags[e.tag];if(void 0!==e.id)return e.id===t.uid;if(void 0!==e.normal)return e.normal===t.normal||e.normal===t.silent_term;if(!0===e.suffix&amp;&amp;void 0!==e.partial){var r=t.normal.length;return t.normal.substr(r-e.partial.length,r)===e.partial}if(!0===e.prefix&amp;&amp;void 0!==e.partial)return t.normal.substr(0,e.partial.length)===e.partial;if(!0===e.infix&amp;&amp;e.partial)return-1!==t.normal.indexOf(e.partial);if(void 0!==e.regex)return e.regex.test(t.normal)||e.regex.test(t.text);if(void 0===e.oneOf)return!1;for(var n=0;n&lt;e.oneOf.tagArr.length;n++)if(!0===t.tags.hasOwnProperty(e.oneOf.tagArr[n]))return!0;return e.oneOf.terms.hasOwnProperty(t.normal)||e.oneOf.terms.hasOwnProperty(t.silent_term)}(t,e);return e.negative&amp;&amp;(n=!Boolean(n)),n&amp;&amp;a(t,e),n}},{"./applyCaptureGroup":167}],172:[function(t,e,r){"use strict";var a=function(t,e){return e.normal.substr(0,t.length)===t};e.exports=function(t,e,r){var n=e[r].normal;if(void 0!==n&amp;&amp;a(n,t))for(r+=1;r&lt;e.length;r++){if((n+=" "+e[r].normal)===t.normal)return r;if(!1===a(n,t))return null}return null}},{}],173:[function(t,e,r){arguments[4][73][0].apply(r,arguments)},{"../../paths":189,dup:73}],174:[function(t,e,r){"use strict";var x=t("./lumpMatch"),C=t("./isMatch"),k=t("./applyCaptureGroup"),E=function(t,e,r){for(;e&lt;t.length;e++)if(C(t.terms[e],r))return e;return null},A=function(t,e,r,n){for(;e&lt;t.length;e++){var a=t.terms[e];if(n&amp;&amp;C(a,n))return e;if(!C(a,r))return e}return e};e.exports=function(t,e,r,n){for(var a=e,i=0;i&lt;r.length;i++){var o=t.terms[a],s=r[i],u=r[i+1];if(!o){if(!0===s.optional)continue;return null}if(!0===s.starting&amp;&amp;0&lt;a)return null;if(!0===s.ending&amp;&amp;a!==t.length-1&amp;&amp;!s.minMax)return null;if(!0!==s.astrix)if(void 0===r[i].minMax)if(!0!==s.optional)if(C(o,s,n)){if(a+=1,!0===s.consecutive){var l=r[i+1];a=A(t,a,s,l)}}else if(!o.silent_term||o.normal){var c=x(o,r,i,n);if(null===c){if(!0!==s.optional)return null}else i=c,a+=1}else{if(0===i)return null;a+=1,i-=1}else{var h=r[i+1];a=A(t,a,s,h)}else for(var f=r[i].minMax.min||0,m=r[i].minMax.max,d=r[i+1],p=0;p&lt;m;p++){var g=t.terms[a+p];if(!g)return null;if(!1===C(g,s))return null;if(!(p&lt;f-1)){if(!d){a+=1;break}if(f&lt;=p&amp;&amp;C(g,d))break;var v=t.terms[a+p+1];if(v&amp;&amp;C(v,d)){a+=p+2,i+=1;break}if(p===m-1)return null}}else{if(!u){for(var y=t.terms.slice(e,t.length),b=a-e;b&lt;y.length;b++)k(y[b],s);return y}var D=E(t,a,r[i+1]);if(!D)return null;for(var w=a;w&lt;D;w++)k(t.terms[w],s);a=D+1,i+=1}}return t.terms.slice(e,a)}},{"./applyCaptureGroup":167,"./isMatch":171,"./lumpMatch":172}],175:[function(t,e,r){"use strict";var i=t("./paths").fns,o=/\{[0-9,]+\}$/,s=function(t){return t.substr(1,t.length)},u=function(t){return t.substring(0,t.length-1)};e.exports=function(t){for(var e=(t=t||"").split(/ +/),r=0;r&lt;e.length;r+=1)if(-1!==e[r].indexOf("(")&amp;&amp;-1===e[r].indexOf(")")){var n=e[r+1];n&amp;&amp;-1===n.indexOf("(")&amp;&amp;-1!==n.indexOf(")")&amp;&amp;(e[r+1]=e[r]+" "+e[r+1],e[r]="")}e=e.filter(function(t){return t});var a=!1;return e.map(function(t){var e=!1;return"["===t.charAt(0)&amp;&amp;(t=s(t),a=!0),"]"===t.charAt(t.length-1)&amp;&amp;(t=u(t),e=!(a=!1)),t=function(t){t=(t=t||"").trim();var r={};if(1===t.length&amp;&amp;"."!==t&amp;&amp;"*"!==t)return r.normal=t.toLowerCase(),r;if("!"===t.charAt(0)&amp;&amp;(t=s(t),r.negative=!0),"^"===t.charAt(0)&amp;&amp;(t=s(t),r.starting=!0),"$"===t.charAt(t.length-1)&amp;&amp;(t=u(t),r.ending=!0),"?"===t.charAt(t.length-1)&amp;&amp;(t=u(t),r.optional=!0),"+"===t.charAt(t.length-1)&amp;&amp;(t=u(t),r.consecutive=!0),"_"===t.charAt(t.length-1)?(t=u(t),r.prefix=!0,"_"===t.charAt(0)&amp;&amp;(t=s(t),r.prefix=void 0,r.infix=!0),r.partial=t,t=""):"_"===t.charAt(0)&amp;&amp;(t=s(t),r.suffix=!0,r.partial=t,t=""),"}"===t.charAt(t.length-1)&amp;&amp;!0===o.test(t)){var e=t.match(/\{([0-9])*,? ?([0-9]+)\}/);r.minMax={min:parseInt(e[1],10)||0,max:parseInt(e[2],10)},t=t.replace(o,"")}if("#"===t.charAt(0)&amp;&amp;(t=s(t),r.tag=i.titleCase(t),t=""),"/"===t.charAt(0)&amp;&amp;"/"===t.charAt(t.length-1)&amp;&amp;(t=u(t),t=s(t),r.regex=new RegExp(t,"i"),t=""),"("===t.charAt(0)&amp;&amp;")"===t.charAt(t.length-1)){t=u(t);var n=(t=s(t)).split(/\|/g);r.oneOf={terms:{},tagArr:[]},n.forEach(function(t){if("#"===t.charAt(0)){var e=t.substr(1,t.length);e=i.titleCase(e),r.oneOf.tagArr.push(e)}else r.oneOf.terms[t]=!0}),t=""}return"."===t&amp;&amp;(r.anyOne=!0,t=""),"*"===t&amp;&amp;(r.astrix=!0,t=""),""!==t&amp;&amp;(t=t.replace(/\\([\\#\*\.\[\]\(\)\+\?\^])/g,""),r.normal=t.toLowerCase()),r}(t),!0!==a&amp;&amp;!0!==e||(t.capture=!0),t})}},{"./paths":173}],176:[function(t,e,r){"use strict";function a(t){return(a="function"==typeof Symbol&amp;&amp;"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&amp;&amp;"function"==typeof Symbol&amp;&amp;t.constructor===Symbol&amp;&amp;t!==Symbol.prototype?"symbol":typeof t})(t)}var l=t("./lib/syntax"),c=t("./lib/startHere"),h=t("../../text");e.exports=function(u){var n={notObj:function(e,r){var n=[],a=[];return e.terms.forEach(function(t){r.hasOwnProperty(t.normal)?(a.length&amp;&amp;n.push(a),a=[]):a.push(t)}),a.length&amp;&amp;n.push(a),n=n.map(function(t){return new u(t,e.world,e.refText,e.refTerms)}),new h(n,e.world,e.parent)},notString:function(e,t,r){for(var n=[],a=l(t),i=[],o=0;o&lt;e.terms.length;o++){var s=c(e,o,a,r);s&amp;&amp;0&lt;s.length?(0&lt;i.length&amp;&amp;(n.push(i),i=[]),o+=s.length-1):i.push(e.terms[o])}return 0&lt;i.length&amp;&amp;n.push(i),n=n.map(function(t){return new u(t,e.world,e.refText,e.refTerms)}),new h(n,e.world,e.parent)},notArray:function(t,e){var r=e.reduce(function(t,e){return t[e]=!0,t},{});return n.notObj(t,r)},notText:function(t,e){var r=e.out("array");return n.notArray(t,r)}};return u.prototype.not=function(t,e){if("object"===a(t)){var r=Object.prototype.toString.call(t);if("[object Array]"===r)return n.notArray(this,t,e);if("[object Object]"===r)return"Text"===t.isA?n.notText(this,t,e):n.notObj(this,t,e)}return"string"==typeof t?n.notString(this,t,e):this},u}},{"../../text":192,"./lib/startHere":174,"./lib/syntax":175}],177:[function(t,e,r){"use strict";var n=t("../mutate");e.exports=function(t){return t.prototype.delete=function(t){if(!this.found)return this;if(!t)return this.parentTerms=n.deleteThese(this.parentTerms,this),this;var e=this.match(t);return e.found?n.deleteThese(this,e):this.parentTerms},t}},{"../mutate":188}],178:[function(t,e,r){"use strict";var o=t("../mutate"),s=function(t,e){return t.terms.length&amp;&amp;t.terms[e]&amp;&amp;(t.terms[e].whitespace.before=" "),t};e.exports=function(n){var i=function(t,e){if("Terms"===t.isA)return t;if("Term"===t.isA)return new n([t],e);var r=n.fromString(t,e);return r.tagger(),r},e={insertBefore:function(t,e){var r=this.terms.length,n=i(t,this.world);e&amp;&amp;n.tag(e);var a=this.index();return s(this.parentTerms,a),0&lt;a&amp;&amp;s(n,0),this.parentTerms.terms=o.insertAt(this.parentTerms.terms,a,n),this.terms.length===r&amp;&amp;(this.terms=n.terms.concat(this.terms)),this},insertAfter:function(t,e){var r=this.terms.length,n=i(t,this.world);e&amp;&amp;n.tag(e);var a=this.terms[this.terms.length-1].index();return s(n,0),this.parentTerms.terms=o.insertAt(this.parentTerms.terms,a+1,n),this.terms.length===r&amp;&amp;(this.terms=this.terms.concat(n.terms)),this},insertAt:function(t,e,r){t&lt;0&amp;&amp;(t=0);var n=this.terms.length,a=i(e,this.world);return r&amp;&amp;a.tag(r),0&lt;t&amp;&amp;s(a,0),this.parentTerms.terms=o.insertAt(this.parentTerms.terms,t,a),this.terms.length===n&amp;&amp;Array.prototype.splice.apply(this.terms,[t,0].concat(a.terms)),0===t&amp;&amp;(this.terms[0].whitespace.before="",a.terms[a.terms.length-1].whitespace.after=" "),this}};return Object.keys(e).forEach(function(t){n.prototype[t]=e[t]}),n}},{"../mutate":188}],179:[function(t,e,r){"use strict";e.exports=function(e){return[["toUpperCase","UpperCase"],["toLowerCase"],["toTitleCase","TitleCase"]].forEach(function(t){var r=t[0],n=t[1];e.prototype[r]=function(){var e=arguments;return this.terms.forEach(function(t){t[r].apply(t,e)}),n&amp;&amp;this.tag(n,r),this}}),e}},{}],180:[function(t,e,r){"use strict";var u=t("../../../term");e.exports=function(t,e){var r=t.terms[e],n=t.terms[e+1];if(n){var a,i,o,s=(i=n,o=(a=r).whitespace.before+a.text+a.whitespace.after,o+=i.whitespace.before+i.text+i.whitespace.after);t.terms[e]=new u(s,r.context),t.terms[e].normal=r.normal+" "+n.normal,t.terms[e].lumped=!0,t.terms[e].parentTerms=t.terms[e+1].parentTerms,t.terms[e+1]=null,t.terms=t.terms.filter(function(t){return null!==t})}}},{"../../../term":143}],181:[function(t,e,r){"use strict";var i=t("./combine"),a=t("../../mutate"),o=function(t,e){for(var r=t.terms.length,n=0;n&lt;r;n++)i(t,0);var a=t.terms[0];return a.tags=e,a};e.exports=function(t){return t.prototype.lump=function(){var t=this.index(),e={};if(this.terms.forEach(function(t){Object.keys(t.tags).forEach(function(t){return e[t]=!0})}),this.parentTerms===this){var r=o(this,e);return this.terms=[r],this}this.parentTerms=a.deleteThese(this.parentTerms,this);var n=o(this,e);return this.parentTerms.terms=a.insertAt(this.parentTerms.terms,t,n),this},t}},{"../../mutate":188,"./combine":180}],182:[function(t,e,r){"use strict";var a=t("../../tagger");e.exports=function(n){var e={tagger:function(){return a(this),this},firstTerm:function(){return this.terms[0]},lastTerm:function(){return this.terms[this.terms.length-1]},all:function(){return this.parent},data:function(){return{text:this.out("text"),normal:this.out("normal")}},term:function(t){return this.terms[t]},first:function(){var t=this.terms[0];return new n([t],this.world,this.refText,this.refTerms)},last:function(){var t=this.terms[this.terms.length-1];return new n([t],this.world,this.refText,this.refTerms)},slice:function(t,e){var r=this.terms.slice(t,e);return new n(r,this.world,this.refText,this.refTerms)},index:function(){var t=this.parentTerms,e=this.terms[0];if(!t||!e)return null;for(var r=0;r&lt;t.terms.length;r++)if(e===t.terms[r])return r;return null},termIndex:function(){var t=this.terms[0],e=this.refText||this;if(!e||!t)return null;for(var r=0,n=0;n&lt;e.list.length;n++)for(var a=e.list[n],i=0;i&lt;a.terms.length;i++){if(a.terms[i]===t)return r;r+=1}return r},chars:function(){return this.terms.reduce(function(t,e){return t+=e.whitespace.before.length,(t+=e.text.length)+e.whitespace.after.length},0)},wordCount:function(){return this.terms.length},setPunctuation:function(t){this.terms[this.terms.length-1].setPunctuation(t)},getPunctuation:function(){var t=this.last().terms[0];return t&amp;&amp;t.getPunctuation()||""},toCamelCase:function(){return this.toTitleCase(),this.terms.forEach(function(t,e){0!==e&amp;&amp;(t.whitespace.before=""),t.whitespace.after=""}),this.tag("#CamelCase","toCamelCase"),this}};return Object.keys(e).forEach(function(t){n.prototype[t]=e[t]}),n}},{"../../tagger":95}],183:[function(t,e,r){"use strict";var n=t("../paths").fns,a={text:function(t){return t.terms.reduce(function(t,e){return t+e.out("text")},"")},match:function(t){for(var e="",r=t.terms.length,n=0;n&lt;r;n++)0&lt;n&amp;&amp;(e+=t.terms[n].whitespace.before),e+=t.terms[n].text.replace(/[,.?!]$/,""),n&lt;r-1&amp;&amp;(e+=t.terms[n].whitespace.after);return e},normal:function(t){var e=t.terms.filter(function(t){return t.text});return(e=e.map(function(t){return t.normal})).join(" ")},grid:function(t){var e="  ";return(e+=t.terms.reduce(function(t,e){return t+n.leftPad(e.text,11)},""))+"\n\n"},color:function(t){return t.terms.reduce(function(t,e){return t+n.printTerm(e)},"")},csv:function(t){return t.terms.map(function(t){return t.normal.replace(/,/g,"")}).join(",")},newlines:function(t){return t.terms.reduce(function(t,e){return t+e.out("text").replace(/\n/g," ")},"").replace(/^\s/,"")},root:function(t){return t.terms.map(function(t){return t.silent_term||t.root}).join(" ").toLowerCase()},html:function(t){return t.terms.map(function(t){return t.render.html()}).join(" ")},debug:function(t){t.terms.forEach(function(t){t.out("debug")})},custom:function(t,n){return t.terms.map(function(r){return Object.keys(n).reduce(function(t,e){return n[e]&amp;&amp;r[e]&amp;&amp;("function"==typeof r[e]?t[e]=r[e]():t[e]=r[e]),t},{})})}};a.plaintext=a.text,a.normalize=a.normal,a.normalized=a.normal,a.colors=a.color,a.tags=a.terms,e.exports=function(t){return t.prototype.out=function(t){if("string"==typeof t){if(a[t])return a[t](this)}else if(!0===n.isObject(t))return a.custom(this,t);return a.text(this)},t.prototype.debug=function(){return a.debug(this)},t}},{"../paths":189}],184:[function(t,e,r){"use strict";var o=t("../mutate");e.exports=function(i){var e={replace:function(t,e,r){return void 0===e?this.replaceWith(t,r):(this.match(t).replaceWith(e,r),this)},replaceWith:function(t,e){var n=i.fromString(t,this.world);n.tagger(),e&amp;&amp;this.terms.forEach(function(t,e){var r=Object.keys(t.tags);void 0!==n.terms[e]&amp;&amp;r.forEach(function(t){return n.terms[e].tag(t,"from-memory")})});var r=this.getPunctuation(),a=this.index();return this.parentTerms=o.deleteThese(this.parentTerms,this),this.parentTerms.terms=o.insertAt(this.parentTerms.terms,a,n),this.terms=n.terms,0&lt;this.terms.length&amp;&amp;(this.terms[this.terms.length-1].whitespace.after+=r),this}};return Object.keys(e).forEach(function(t){i.prototype[t]=e[t]}),i}},{"../mutate":188}],185:[function(t,e,r){"use strict";var l=function(t,e){for(var r=e.terms[0],n=e.terms.length,a=0;a&lt;t.length;a++)if(t[a]===r)return{before:t.slice(0,a),match:t.slice(a,a+n),after:t.slice(a+n,t.length)};return{after:t}};e.exports=function(u){var e={splitAfter:function(t,e){var r=this,n=this.match(t,e),a=this.terms,i=[];return n.list.forEach(function(t){var e=l(a,t);e.before&amp;&amp;e.match&amp;&amp;i.push(e.before.concat(e.match)),a=e.after}),a.length&amp;&amp;i.push(a),i=i.map(function(t){var e=r.refText;return new u(t,r.world,e,r.refTerms)})},splitOn:function(t,e){var r=this,n=this.match(t,e),a=this.terms,i=[];return n.list.forEach(function(t){var e=l(a,t);e.before&amp;&amp;i.push(e.before),e.match&amp;&amp;i.push(e.match),a=e.after}),a.length&amp;&amp;i.push(a),i=(i=i.filter(function(t){return t&amp;&amp;t.length})).map(function(t){return new u(t,t.world,t.refText,r.refTerms)})},splitBefore:function(t,e){var r=this,n=this.match(t,e),a=this.terms,i=[];n.list.forEach(function(t){var e=l(a,t);e.before&amp;&amp;i.push(e.before),e.match&amp;&amp;i.push(e.match),a=e.after}),a.length&amp;&amp;i.push(a);for(var o=0;o&lt;i.length;o++)for(var s=0;s&lt;n.length;s++)n.list[s].terms[0]===i[o][0]&amp;&amp;i[o+1]&amp;&amp;(i[o]=i[o].concat(i[o+1]),i[o+1]=[]);return i=(i=i.filter(function(t){return t&amp;&amp;t.length})).map(function(t){return new u(t,t.world,t.refText,r.refTerms)})}};return Object.keys(e).forEach(function(t){u.prototype[t]=e[t]}),u}},{}],186:[function(t,e,r){"use strict";e.exports=function(r){var e={tag:function(e,r){var n=[];return"string"==typeof e&amp;&amp;(n=e.split(" ")),1&lt;n.length?this.terms.forEach(function(t,e){t.tag(n[e],r)}):this.terms.forEach(function(t){t.tag(e,r)}),this},unTag:function(e,r){var n=[];return"string"==typeof e&amp;&amp;(n=e.split(" ")),1&lt;n.length?this.terms.forEach(function(t,e){t.unTag(n[e],r)}):this.terms.forEach(function(t){t.unTag(e,r)}),this},canBe:function(e){var t=this.terms.filter(function(t){return t.canBe(e)});return new r(t,this.world,this.refText,this.refTerms)}};return Object.keys(e).forEach(function(t){r.prototype[t]=e[t]}),r}},{}],187:[function(t,e,r){"use strict";e.exports=function(e){var r={clone:function(){var t=this.terms.map(function(t){return t.clone()});return new e(t,this.world,this.refText,null)},hyphenate:function(){var r=this;return this.terms.forEach(function(t,e){e!==r.terms.length-1&amp;&amp;(t.whitespace.after="-"),0!==e&amp;&amp;(t.whitespace.before="")}),this},dehyphenate:function(){return this.terms.forEach(function(t){"-"===t.whitespace.after&amp;&amp;(t.whitespace.after=" ")}),this},trim:function(){return this.length&lt;=0||(this.terms[0].whitespace.before="",this.terms[this.terms.length-1].whitespace.after=""),this}};return Object.keys(r).forEach(function(t){e.prototype[t]=r[t]}),e}},{}],188:[function(t,e,r){"use strict";var a=function(t){var e=[];return"Terms"===t.isA?e=t.terms:"Text"===t.isA?e=t.flatten().list[0].terms:"Term"===t.isA&amp;&amp;(e=[t]),e};r.deleteThese=function(t,e){var r=a(e);return t.terms=t.terms.filter(function(t){for(var e=0;e&lt;r.length;e++)if(t===r[e])return!1;return!0}),t},r.insertAt=function(t,e,r){r.dirty=!0;var n=a(r);return 0&lt;e&amp;&amp;n[0]&amp;&amp;!n[0].whitespace.before&amp;&amp;(n[0].whitespace.before=" "),Array.prototype.splice.apply(t,[e,0].concat(n)),t}},{}],189:[function(t,e,r){"use strict";e.exports={fns:t("../fns"),Term:t("../term")}},{"../fns":3,"../term":143}],190:[function(t,e,r){"use strict";var a=t("./index"),i=t("./tokenize"),n=t("./paths"),o=n.Terms,s=n.fns;e.exports=function(t,e){var r=(s.isArray(t)?t:(t=s.ensureString(t),i(t))).map(function(t){return o.fromString(t,e)}),n=new a(r,e);return n.list.forEach(function(t){t.refText=n}),n}},{"./index":192,"./paths":205,"./tokenize":207}],191:[function(t,e,r){"use strict";e.exports={found:function(){return 0&lt;this.list.length},parent:function(){return this.original||this},length:function(){return this.list.length},isA:function(){return"Text"},whitespace:function(){var t=this;return{before:function(e){return t.list.forEach(function(t){t.whitespace.before(e)}),t},after:function(e){return t.list.forEach(function(t){t.whitespace.after(e)}),t}}}}},{}],192:[function(t,e,r){"use strict";var i=t("./getters");function a(t,e,r){this.list=t||[],"function"==typeof e&amp;&amp;(e=e()),this.world=function(){return e},this.original=r;for(var n=Object.keys(i),a=0;a&lt;n.length;a++)Object.defineProperty(this,n[a],{get:i[n[a]]})}(e.exports=a).addMethods=function(t,e){for(var r=Object.keys(e),n=0;n&lt;r.length;n++)t.prototype[r[n]]=e[r[n]]},a.makeSubset=function(t,e){var r=function(t,e,r){a.call(this,t,e,r)};return r.prototype=Object.create(a.prototype),a.addMethods(r,t),r.find=e,r},t("./methods/misc")(a),t("./methods/loops")(a),t("./methods/match")(a),t("./methods/out")(a),t("./methods/sort")(a),t("./methods/split")(a),t("./methods/normalize")(a),t("./subsets")(a);var o={acronyms:t("../subset/acronyms"),adjectives:t("../subset/adjectives"),adverbs:t("../subset/adverbs"),contractions:t("../subset/contractions"),dates:t("../subset/dates"),nouns:t("../subset/nouns"),people:t("../subset/people"),sentences:t("../subset/sentences"),terms:t("../subset/terms"),possessives:t("../subset/possessives"),values:t("../subset/values"),verbs:t("../subset/verbs"),ngrams:t("../subset/ngrams"),startGrams:t("../subset/ngrams/startGrams"),endGrams:t("../subset/ngrams/endGrams")};Object.keys(o).forEach(function(n){a.prototype[n]=function(t,e){var r=o[n].find(this,t,e);return new o[n](r.list,this.world,this.parent)}}),a.prototype.words=a.prototype.terms},{"../subset/acronyms":9,"../subset/adjectives":10,"../subset/adverbs":17,"../subset/contractions":23,"../subset/dates":25,"../subset/ngrams":35,"../subset/ngrams/endGrams":32,"../subset/ngrams/startGrams":36,"../subset/nouns":38,"../subset/people":49,"../subset/possessives":51,"../subset/sentences":52,"../subset/terms":58,"../subset/values":65,"../subset/verbs":75,"./getters":191,"./methods/loops":193,"./methods/match":194,"./methods/misc":195,"./methods/normalize":196,"./methods/out":197,"./methods/sort":202,"./methods/split":204,"./subsets":206}],193:[function(t,e,r){"use strict";var n=["toTitleCase","toUpperCase","toLowerCase","toCamelCase","hyphenate","dehyphenate","trim","insertBefore","insertAfter","insertAt","replace","replaceWith","delete","lump","tagger","unTag"];e.exports=function(t){n.forEach(function(e){t.prototype[e]=function(){for(var t=0;t&lt;this.list.length;t++)this.list[t][e].apply(this.list[t],arguments);return this}}),t.prototype.tag=function(){if(0===this.list.length)return this;for(var t=0;t&lt;this.list.length;t++)this.list[t].tag.apply(this.list[t],arguments);return this}}},{}],194:[function(t,e,r){"use strict";var u=t("../../../terms/match/lib/syntax"),a=t("../../../terms");e.exports=function(s){var i=function(e,r){var n=[];return e.list.forEach(function(t){t.terms.forEach(function(t){!0===r.hasOwnProperty(t.normal)&amp;&amp;n.push(t)})}),n=n.map(function(t){return new a([t],e.world(),e,t.parentTerms)}),new s(n,e.world(),e.parent)},o=function(t,e){var r=e.reduce(function(t,e){return t[e]=!0,t},{});return i(t,r)},t={match:function(t,e){if(0===this.list.length||null==t){var r=this.parent||this;return new s([],this.world(),r)}if("string"==typeof t||"number"==typeof t)return function(t,e,r){var n=[];e=u(e),t.list.forEach(function(t){t.match(e,r).list.forEach(function(t){n.push(t)})});var a=t.parent||t;return new s(n,t.world(),a)}(this,t,e);var n,a=Object.prototype.toString.call(t);return"[object Array]"===a?o(this,t):"[object Object]"===a?"Text"===t.isA?(this,n=t.out("array"),o(this,n)):i(this,t):this},not:function(r,n){var a=[];this.list.forEach(function(t){var e=t.not(r,n);a=a.concat(e.list)});var t=this.parent||this;return new s(a,this.world(),t)},if:function(t){for(var e=[],r=0;r&lt;this.list.length;r++)!0===this.list[r].has(t)&amp;&amp;e.push(this.list[r]);var n=this.parent||this;return new s(e,this.world(),n)},ifNo:function(t){for(var e=[],r=0;r&lt;this.list.length;r++)!1===this.list[r].has(t)&amp;&amp;e.push(this.list[r]);var n=this.parent||this;return new s(e,this.world(),n)},has:function(t){for(var e=0;e&lt;this.list.length;e++)if(!0===this.list[e].has(t))return!0;return!1},before:function(t){for(var e=[],r=0;r&lt;this.list.length;r++){var n=this.list[r].matchOne(t);if(n){var a=n[0].index(),i=this.list[r].slice(0,a);0&lt;i.length&amp;&amp;e.push(i)}}var o=this.parent||this;return new s(e,this.world(),o)},after:function(t){for(var e=[],r=0;r&lt;this.list.length;r++){var n=this.list[r].matchOne(t);if(n){var a=n[n.length-1].index(),i=this.list[r].slice(a+1,this.list[r].length);0&lt;i.length&amp;&amp;e.push(i)}}var o=this.parent||this;return new s(e,this.world(),o)}};return t.and=t.match,t.notIf=t.ifNo,t.only=t.if,t.onlyIf=t.if,s.addMethods(s,t),s}},{"../../../terms":165,"../../../terms/match/lib/syntax":175}],195:[function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&amp;&amp;"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&amp;&amp;"function"==typeof Symbol&amp;&amp;t.constructor===Symbol&amp;&amp;t!==Symbol.prototype?"symbol":typeof t})(t)}var o=t("../../terms");e.exports=function(i){var t={all:function(){return this.parent},index:function(){return this.list.map(function(t){return t.index()})},wordCount:function(){return this.terms().length},data:function(){return this.list.map(function(t){return t.data()})},map:function(n){var a=this;return this.list.map(function(t,e){var r=new i([t],a.world);return n(r,e)})},forEach:function(n){var a=this;return this.list.forEach(function(t,e){var r=new i([t],a.world);n(r,e)}),this},filter:function(n){var a=this,t=this.list.filter(function(t,e){var r=new i([t],a.world);return n(r,e)});return new i(t,this.world)},reduce:function(n,t){var a=this;return this.list.reduce(function(t,e){var r=new i([e],a.world);return n(t,r)},t)},find:function(t){for(var e=0;e&lt;this.list.length;e++){var r=this.list[e],n=new i([r],this.world);if(t(n))return n}},clone:function(){var t=this.list.map(function(t){return t.clone()});return new i(t,this.world)},term:function(n){var a=this,t=this.list.map(function(t){var e=[],r=t.terms[n];return r&amp;&amp;(e=[r]),new o(e,a.world,a.refText,a.refTerms)});return new i(t,this.world,this.parent)},firstTerm:function(){return this.match("^.")},lastTerm:function(){return this.match(".$")},slice:function(t,e){return this.list=this.list.slice(t,e),this},get:function(t){if(!t&amp;&amp;0!==t||!this.list[t])return new i([],this.world,this.parent);var e=this.list[t];return new i([e],this.world,this.parent)},first:function(t){return t||0===t?new i(this.list.slice(0,t),this.world,this.parent):this.get(0)},last:function(t){if(!t&amp;&amp;0!==t)return this.get(this.list.length-1);var e=this.list.length,r=e-t;return new i(this.list.slice(r,e),this.world,this.parent)},concat:function(){for(var t=0;t&lt;arguments.length;t++){var e=arguments[t];"object"===n(e)&amp;&amp;("Text"===e.isA&amp;&amp;e.list&amp;&amp;(this.list=this.list.concat(e.list)),"Terms"===e.isA&amp;&amp;this.list.push(e))}return this},flatten:function(){var e=[];if(this.list.forEach(function(t){e=e.concat(t.terms)}),!e.length)return new i(null,this.world,this.parent);var t=new o(e,this.world,this,null);return new i([t],this.world,this.parent)},canBe:function(e){return this.list.forEach(function(t){t.terms=t.terms.filter(function(t){return t.canBe(e)})}),this},random:function(t){t=t||1;var e=Math.floor(Math.random()*this.list.length),r=this.list.slice(e,e+t);if(r.length&lt;t){var n=t-r.length;e&lt;n&amp;&amp;(n=e),r=r.concat(this.list.slice(0,n))}return new i(r,this.world,this.parent)},setPunctuation:function(e){return this.list.forEach(function(t){return t.setPunctuation(e)}),this},getPunctuation:function(t){return t||0===t?this.list[t]?this.list[t].getPunctuation():"":this.list.map(function(t){return t.getPunctuation()})},offset:function(){return this.out("offset")},text:function(){return this.out("text")}};t.eq=t.get,t.join=t.flatten,i.addMethods(i,t)}},{"../../terms":165}],196:[function(t,e,r){"use strict";var n=t("../../term/methods/normalize/unicode"),a={whitespace:!0,case:!0,numbers:!0,punctuation:!0,unicode:!0,contractions:!0,acronyms:!0,parentheses:!1,possessives:!1,plurals:!1,verbs:!1,honorifics:!1},i={whitespace:function(t){return t.terms().list.forEach(function(t,e){var r=t.terms[0];0&lt;e&amp;&amp;!r.silent_term?r.whitespace.before=" ":0===e&amp;&amp;(r.whitespace.before=""),!(r.whitespace.after="")===r.tags.StartQuotation&amp;&amp;(r.whitespace.before+='"'),!0===r.tags.EndQuotation&amp;&amp;(r.whitespace.after='"'+r.whitespace.after)}),t},case:function(t){return t.list.forEach(function(r){r.terms.forEach(function(t,e){0===e||t.tags.Person||t.tags.Place||t.tags.Organization||r.toLowerCase()})}),t},numbers:function(t){return t.values().toNumber(),t},punctuation:function(t){return t.list.forEach(function(t){if(t.terms.length){t.terms[0]._text=t.terms[0]._text.replace(/^/,"");for(var e=0;e&lt;t.terms.length-1;e++){var r=t.terms[e];r._text=r._text.replace(/[:;,]$/,"")}var n=t.terms[t.terms.length-1];n._text=n._text.replace(/\.+$/,"."),n._text=n._text.replace(/!+$/,"!"),n._text=n._text.replace(/\?+!?$/,"?")}}),t},unicode:function(t){return t.list.forEach(function(t){t.terms.forEach(function(t){t.text=n(t.text)})}),t},contractions:function(t){return t.contractions().expand(),t},acronyms:function(t){return t.acronyms().stripPeriods(),t},possessives:function(t){return t.possessives().strip(),t},parentheses:function(t){return t.parentheses().delete(),t},plurals:function(t){return t.nouns().toSingular(),t},verbs:function(t){return t.verbs().toInfinitive(),t},honorifics:function(t){return t.delete("#Honorific")}};e.exports=function(t){t.prototype.normalize=function(e){var r=this;e=e||{};var n=Object.assign({},a);return Object.keys(e).forEach(function(t){n[t]=e[t]}),Object.keys(n).forEach(function(t){n[t]&amp;&amp;void 0!==i[t]&amp;&amp;(r=i[t](r))}),r}}},{"../../term/methods/normalize/unicode":151}],197:[function(t,e,r){"use strict";var n=t("./topk"),a=t("./offset"),i=t("./indexes"),o=t("../paths").fns,s={text:function(t){return t.list.reduce(function(t,e){return t+e.out("text")},"")},match:function(t){return t.list.reduce(function(t,e){return t+e.out("match")},"")},normal:function(t){return t.list.map(function(t){var e=t.out("normal");if(t.last()){var r=t.getPunctuation();"."!==r&amp;&amp;"!"!==r&amp;&amp;"?"!==r||(e+=r)}return e}).join(" ")},root:function(t){return t.list.map(function(t){return t.out("root")}).join(" ")},offsets:function(t){return a(t)},index:function(t){return i(t)},grid:function(t){return t.list.reduce(function(t,e){return t+e.out("grid")},"")},color:function(t){return t.list.reduce(function(t,e){return t+e.out("color")},"")},array:function(t){return t.list.map(function(t){return t.out("normal")})},csv:function(t){return t.list.map(function(t){return t.out("csv")}).join("\n")},newlines:function(t){return t.list.map(function(t){return t.out("newlines")}).join("\n")},json:function(t){return t.list.reduce(function(t,e){var r=e.terms.map(function(t){return{text:t.text,normal:t.normal,tags:t.tag}});return t.push(r),t},[])},html:function(t){return"&lt;span&gt; "+t.list.reduce(function(t,e){return t+"\n  &lt;span&gt;"+e.terms.reduce(function(t,e){return t+"\n    "+e.out("html")},"")+"\n  &lt;/span&gt;"},"")+"\n&lt;/span&gt;"},terms:function(t){var e=[];return t.list.forEach(function(t){t.terms.forEach(function(t){e.push({text:t.text,normal:t.normal,tags:Object.keys(t.tags)})})}),e},debug:function(t){return console.log("===="),t.list.forEach(function(t){console.log("   --"),t.debug()}),t},topk:function(t){return n(t)},custom:function(t,e){return t.list.map(function(t){return t.out(e)})}};s.plaintext=s.text,s.normalized=s.normal,s.colors=s.color,s.tags=s.terms,s.offset=s.offsets,s.idexes=s.index,s.frequency=s.topk,s.freq=s.topk,s.arr=s.array,e.exports=function(t){return t.prototype.out=function(t){if("string"==typeof t){if(s[t])return s[t](this)}else if(!0===o.isObject(t))return s.custom(this,t);return s.text(this)},t.prototype.debug=function(){return s.debug(this)},t}},{"../paths":201,"./indexes":198,"./offset":199,"./topk":200}],198:[function(t,e,r){"use strict";e.exports=function(t){var n=[],a={};t.terms().list.forEach(function(t){a[t.terms[0].uid]=!0});var i=0;return t.all().list.forEach(function(t,r){t.terms.forEach(function(t,e){void 0!==a[t.uid]&amp;&amp;n.push({text:t.text,normal:t.normal,term:i,sentence:r,sentenceTerm:e}),i+=1})}),n}},{}],199:[function(t,e,r){"use strict";e.exports=function(t){var s=t.all();return t.list.map(function(t){for(var e=[],r=0;r&lt;t.terms.length;r++)e.push(t.terms[r].normal);var n=function(t){var e=t.terms;if(e.length&lt;=2)return t.out("normal");for(var r=e[0].normal,n=1;n&lt;e.length-1;n++){var a=e[n];r+=a.whitespace.before+a.text+a.whitespace.after}return r+" "+e[t.terms.length-1].normal}(t),a=t.out("text"),i=function(t,e){for(var r=0,n=0;n&lt;t.list.length;n++)for(var a=0;a&lt;t.list[n].terms.length;a++){var i=t.list[n].terms[a];if(i.uid===e.uid)return r;r+=i.whitespace.before.length+i._text.length+i.whitespace.after.length}return null}(s,t.terms[0]),o=i+t.terms[0].whitespace.before.length;return{text:a,normal:t.out("normal"),offset:i,length:a.length,wordStart:o,wordEnd:o+n.length}})}},{}],200:[function(t,e,r){"use strict";e.exports=function(e,t){var r={};e.list.forEach(function(t){var e=t.out("root");r[e]=r[e]||0,r[e]+=1});var n=[];return Object.keys(r).forEach(function(t){n.push({normal:t,count:r[t]})}),n.forEach(function(t){t.percent=parseFloat((t.count/e.list.length*100).toFixed(2))}),n=n.sort(function(t,e){return t.count&gt;e.count?-1:1}),t&amp;&amp;(n=n.splice(0,t)),n}},{}],201:[function(t,e,r){"use strict";e.exports=t("../paths")},{"../paths":205}],202:[function(t,e,r){"use strict";var n=t("./methods");e.exports=function(e){var t={sort:function(t){return(t=(t=t||"alphabetical").toLowerCase())&amp;&amp;"alpha"!==t&amp;&amp;"alphabetical"!==t?"chron"===t||"chronological"===t?n.chron(this,e):"length"===t?n.lengthFn(this,e):"freq"===t||"frequency"===t?n.freq(this,e):"wordcount"===t?n.wordCount(this,e):this:n.alpha(this,e)},reverse:function(){return this.list=this.list.reverse(),this},unique:function(){var r={};return this.list=this.list.filter(function(t){var e=t.out("root");return!r.hasOwnProperty(e)&amp;&amp;(r[e]=!0)}),this}};return e.addMethods(e,t),e}},{"./methods":203}],203:[function(t,e,r){"use strict";var n=function(t){return(t=t.sort(function(t,e){return t.index&gt;e.index?1:t.index===e.index?0:-1})).map(function(t){return t.ts})};r.alpha=function(t){return t.list.sort(function(t,e){if(t===e)return 0;if(t.terms[0]&amp;&amp;e.terms[0]){if(t.terms[0].root&gt;e.terms[0].root)return 1;if(t.terms[0].root&lt;e.terms[0].root)return-1}return t.out("root")&gt;e.out("root")?1:-1}),t},r.chron=function(t){var e=t.list.map(function(t){return{ts:t,index:t.termIndex()}});return t.list=n(e),t},r.lengthFn=function(t){var e=t.list.map(function(t){return{ts:t,index:t.chars()}});return t.list=n(e).reverse(),t},r.wordCount=function(t){var e=t.list.map(function(t){return{ts:t,index:t.length}});return t.list=n(e),t},r.freq=function(t){var r={};t.list.forEach(function(t){var e=t.out("root");r[e]=r[e]||0,r[e]+=1});var e=t.list.map(function(t){var e=r[t.out("root")]||0;return{ts:t,index:-1*e}});return t.list=n(e),t}},{}],204:[function(t,e,r){"use strict";e.exports=function(t){return t.addMethods(t,{splitAfter:function(e,r){var n=[];return this.list.forEach(function(t){t.splitAfter(e,r).forEach(function(t){n.push(t)})}),this.list=n,this},splitBefore:function(e,r){var n=[];return this.list.forEach(function(t){t.splitBefore(e,r).forEach(function(t){n.push(t)})}),this.list=n,this},splitOn:function(e,r){var n=[];return this.list.forEach(function(t){t.splitOn(e,r).forEach(function(t){n.push(t)})}),this.list=n,this}}),t}},{}],205:[function(t,e,r){arguments[4][201][0].apply(r,arguments)},{"../paths":8,dup:201}],206:[function(t,e,r){"use strict";var a=t("../subset/sentences/isQuestion");e.exports=function(n){var e={clauses:function(t){var e=this.splitAfter("#ClauseEnd");return"number"==typeof t&amp;&amp;(e=e.get(t)),e},hashTags:function(t){var e=this.match("#HashTag").terms();return"number"==typeof t&amp;&amp;(e=e.get(t)),e},organizations:function(t){var e=this.splitAfter("#Comma");return e=e.match("#Organization+"),"number"==typeof t&amp;&amp;(e=e.get(t)),e},phoneNumbers:function(t){var e=this.splitAfter("#Comma");return e=e.match("#PhoneNumber+"),"number"==typeof t&amp;&amp;(e=e.get(t)),e},places:function(t){var e=this.splitAfter("#Comma");return e=e.match("#Place+"),"number"==typeof t&amp;&amp;(e=e.get(t)),e},quotations:function(t){var e=this.match("#Quotation+"),i=[];return e.list.forEach(function(r){var n=0,a=null;r.terms.forEach(function(t,e){!0===t.tags.StartQuotation&amp;&amp;(0===n&amp;&amp;(a=e),n+=1),0&lt;n&amp;&amp;!0===t.tags.EndQuotation&amp;&amp;(n-=1),0===n&amp;&amp;null!==a&amp;&amp;(i.push(r.slice(a,e+1)),a=null)}),null!==a&amp;&amp;i.push(r.slice(a,r.terms.length))}),e.list=i,"number"==typeof t&amp;&amp;(e=e.get(t)),e},topics:function(t){var e=this.clauses(),r=e.people();return r.concat(e.places()),r.concat(e.organizations()),(r=r.not(["someone","man","woman","mother","brother","sister","father"])).sort("chronological"),"number"==typeof t&amp;&amp;(r=r.get(t)),r},urls:function(t){var e=this.match("#Url");return"number"==typeof t&amp;&amp;(e=e.get(t)),e},questions:function(t){var e=this.all();"number"==typeof t&amp;&amp;(e=e.get(t));var r=e.list.filter(function(t){return a(t)});return new n(r,this.world,this.parent)},statements:function(t){var e=this.all();"number"==typeof t&amp;&amp;(e=e.get(t));var r=e.list.filter(function(t){return!1===a(t)});return new n(r,this.world,this.parent)},parentheses:function(t){var e=this.match("#Parentheses+");return e=e.splitAfter("#EndBracket"),"number"==typeof t&amp;&amp;(e=e.get(t)),e}};return Object.keys(e).forEach(function(t){n.prototype[t]=e[t]}),n}},{"../subset/sentences/isQuestion":53}],207:[function(t,e,r){"use strict";var n=Object.keys(t("../world/more-data/abbreviations")),u=new RegExp("\\b("+n.join("|")+")[.!?-] *$","i"),l=/[ .][A-Z]\.? *$/i,c=/(?:\u2026|\.{2,}) *$/,h=/((?:\r?\n|\r)+)/,f=/(\S.+?[.!?\u203D\u2E18\u203C\u2047-\u2049])(?=\s+|$)/g,m=/[a-z0-9\u0000-\u007F]/i,d=/\S/;e.exports=function(o){o=o||"";var t=[],e=[];if(!(o=String(o))||"string"!=typeof o||!1===d.test(o))return t;for(var r=function(t){for(var e=[],r=o.split(h),n=0;n&lt;r.length;n++)for(var a=r[n].split(f),i=0;i&lt;a.length;i++)e.push(a[i]);return e}(),n=0;n&lt;r.length;n++){var a=r[n];if(void 0!==a&amp;&amp;""!==a){if(!1===d.test(a)){if(e[e.length-1]){e[e.length-1]+=a;continue}if(r[n+1]){r[n+1]=a+r[n+1];continue}}e.push(a)}}for(var i=0;i&lt;e.length;i++){var s=e[i];e[i+1]&amp;&amp;m.test(s)&amp;&amp;(u.test(s)||l.test(s)||c.test(s))?e[i+1]=s+(e[i+1]||""):s&amp;&amp;0&lt;s.length&amp;&amp;m.test(s)&amp;&amp;(t.push(s),e[i]="")}return 0===t.length?[o]:t}},{"../world/more-data/abbreviations":216}],208:[function(t,e,r){"use strict";e.exports='{"words":"Comparativebetter|Superlativeearlier|PresentTensesounds|Valuea few|Nounautumn,daylight9eom,here,no doubt,one d8s5t2w0yesterd8;eek0int5;d6end;mr1o0;d4morrow;!w;ome 1tandard3umm0;er;d0point;ay; time|Copulaa1is,w0;as,ere;m,re|Conditionif,unless|PastTensebe2came,d1had,mea0sa1taken,we0;nt;id;en,gan|Gerundaccord0be0develop0go0result0stain0;ing|Negativen0;ever,o0;!n,t|QuestionWordhow3wh0;at,e1ich,o0y;!m,se;n,re; come,\'s|Singulara05bYcTdPeNfKgJhFici09jel06kitty,lEmCnBoAp7question mark,r6s4t1us 0;dollUstV; rex,a1h0ic,ragedy,v show;ere,i06;l02x return;ky,tu0uper bowl,yst05;dIff;alZi02oom;a1robl02u0;dCrpo8;rt,tE;cean,thers;othiXumbG;ayfTeeNo0;del,nopoS;iRunch;ead start,o0;lPme1u0;se;! run;adfMirlIlaci8od,rand slam,ulM;amiLly,olLr1un0;diN;iGosD;conomy,gg,ner3v0xampG;ent;eath,inn2o0ragonfG;cument6g0iFlFor;gy;er;an3eiliFhocol2i0ottage,redit card;ty,vil w0;ar;ate;ary;ankiAel7les9o2reakfast,u0;n0tterf6;ti8;dy,tt2y0;fri0;end;le;d1l0noma0;ly; homin2verti0;si0;ng;em|Infinitive0:6Y;1:7C;2:7A;3:79;4:74;5:5F;6:6D;7:6L;8:78;9:6W;A:73;B:7D;C:76;D:6R;E:68;F:60;a6Qb69c5Bd4Je43f3Qg3Jh3Ci2Zj2Xk2Tl2Km2Bn28o24p1Pques3Rr0Xs05tWuRvOwHyG;awn,ield;aJe24hist7iIoGre6H;nd0rG;k,ry;n,pe,sh,th0;lk,nHrGsh,tDve;n,raB;d0t;aHiGo8;ew,sA;l6Rry;nHpGr3se;gra4Wli49;dGi8lo65;erGo;go,mi5H;aNeMhKie,oJrHuGwi4;ne,rn;aGe0Ui60u4y;de,in,nsf0p,v5O;r37uD;ank,rG;eat2Vi2;nd,st;ke,lk,rg5Os8;a06c03eZhWi4Jkip,lVmUneTo56pQtJuGwitD;bmAck,ff0gge4ppHrGspe6;ge,pri1rou53vi2;ly,o3D;aLeKoJrHuG;dy,mb7;aEeGi2;ngth2Lss,tD;p,re;m,p;in,ke,r0Yy;iHlaFoil,rinG;g,k7;n,t;ak,e3E;aFe22i7o5B;am,e1Qip;aHiv0oG;ck,ut;re,ve;arDeIle6nHr2tG;!t7;d,se;k,m;aHo5rG;atDew;le,re;il,ve;a05eIisk,oHuG;b,in,le,n,sh;am,ll;a01cZdu9fYgXje6lUmTnt,pQquPsKtJvGwa5V;eGiew,o4U;al,l,rG;se,t;aEi5u42;eJi4oItG;!o5rG;i6uc20;l2rt;mb7nt,r2;e4i5;air,eHlGo40reseB;a9y;at;aEemb0i3Wo2;aHeGi2y;a1nt;te,x;a5Dr4A;act1Yer,le6u1;a12ei2k5PoGyc7;gni2Cnci7rd;ch,li2Bs5N;i1nG;ge,k;aTerSiRlPoNrIuG;b21ll,mp,rGsh,t;cha1s4Q;ai1eJiBoG;cHdu9greChibAmi1te4vG;e,i2U;eClaim;di6pa5ss,veB;iBp,rtr43sGur;e,t;a3RuG;g,n3;ck,le;fo32mAsi4;ck,iBrt4Mss,u1y;bIccur,ff0pera8utweHverGwe;co47lap,ta3Qu1whelm;igh;ser2taE;eHotG;e,i9;ed,gle6;aLeKiIoHuG;ltip3Frd0;nit14ve;nGrr13;d,g7us;asu5lt,n0Qr3ssa3;intaEke d40na3rHtG;ch,t0;ch,k39ry;aMeLiIoGu1F;aGck,ok,ve;d,n;ft,ke,mAnHstGve;!en;e,k;a2Gc0Ht;b0Qck,uG;gh,nD;eIiHnoG;ck,w;ck,ll,ss;ep;am,oEuG;d3mp;gno5mQnGss3I;cOdica8flu0NhNsKtIvG;eGol2;nt,st;erGrodu9;a6fe5;i4tG;aGru6;ll;abAibA;lu1Fr1D;agi22pG;lemeBo20ro2;aKeIi5oHuG;nt,rry;ld fa4n03pe,st;aGlp;d,t;nd7ppGrm,te;en;aLet,loCoKrIuG;arGeCi14;ant39d;aGip,ow,umb7;b,sp;es,ve1I;in,th0ze;aQeaPiNlLoIracHuncG;ti3I;tu5;cus,lHrG;ce,eca4m,s30;d,l22;aFoG;at,od,w;gu5lGniFx;e,l;r,tu5;il,ll,vG;or;a13cho,dAle6mSnPstNvalua8xG;a0AcLerKi4pGte16;a15eHlaEoGreC;rt,se;ct,riG;en9;ci1t;el,han3;abGima8;liF;ab7couXdHfor9ga3han9j03riDsu5t0vG;isi2Vy;!u5;body,er3pG;hasiGow0;ze;a06eUiMoLrHuG;mp;aIeHiGop;ft;am,ss;g,in;!d3ubt;e,ff0p,re6sHvG;e,iXor9;aJcGli13miCpl18tinguiF;oGuC;uGv0;ra3;gr1YppG;ear,ro2;al,cNem,fLliv0ma0Cny,pKsHterG;mi0D;cribe,er2iHtrG;oy;gn,re;a08e07i6osA;eGi08y;at,ct;iIlHrG;ea1;a5i04;de;ma3n9re,te;a0Ae09h06i8l03oJrGut;aHeGoCuFy;a8dA;ck,ve;llYmSnHok,py,uGv0;gh,nt;cePdu6fMsKtIvG;eGin9;rt,y;aEin0XrG;a4ibu8ol;iGtitu8;d0st;iHoGroB;rm;gu5rm;rn;biKe,foJmaIpG;a5laE;re;nd;rt;ne;ap1e6;aHiGo1;ng,p;im,w;aHeG;at,ck,w;llen3n3r3se;a1nt0;ll,ncHrGt0u1;e,ry;el;aUeQloPoNrKuG;dgIlHrG;n,y;ly;et;aHuF;sh;ke;a4mb,o4rrGth0un9;ow;ck;ar,coSgElHnefAtrG;ay;ie2ong;in;nGse;!g;band0Jc0Bd06ffo05gr04id,l01mu1nYppTrQsKttGvoid,waA;acIeHra6;ct;m0Fnd;h,k;k,sG;eIiHocia8uG;me;gn,st;mb7rt;le;chHgGri2;ue;!i2;eaJlIroG;aDve;ch;aud,y;l,r;noun9sw0tG;icipa8;ce;lHt0;er;e3ow;ee;rd;aRdIju4mAoR;it;st;!reC;ss;cJhie2knowled3tiva8;te;ge;ve;eIouBu1;se;nt;pt;on|ActoraJbGcFdCengineIfAgardenIh9instructPjournalLlawyIm8nurse,opeOp5r3s1t0;echnCherapK;ailNcientJoldiGu0;pervKrgeon;e0oofE;ceptionGsearC;hotographClumbColi1r0sychologF;actitionBogrammB;cem6t5;echanic,inist9us4;airdress8ousekeep8;arm7ire0;fight6m2;eputy,iet0;ici0;an;arpent2lerk;ricklay1ut0;ch0;er;ccoun6d2ge7r0ssis6ttenda7;chitect,t0;ist;minist1v0;is1;rat0;or;ta0;nt|HonorificaObrigadiNcHdGexcellency,fiBking,liDmaAofficNp6queen,r3s0taoiseach,vice5;e0ultJ;c0rgeaC;ond liAretary;abbi,e0;ar0verend; adJ;astFr0;eside6i0ofessE;me ministEnce0;!ss;gistrate,r4yB;eld mar3rst l0;ady,i0;eutena0;nt;shA;oct5utchess;aptain,hance3o0;lonel,mmand4ngress0unci2;m0wom0;an;ll0;or;er;d0yatullah;mir0;al|SportsTeam0:1M;1:1T;2:1U;a1Rb1Dc0Zd0Qfc dallas,g0Nhouston 0Mindiana0Ljacksonville jagua0k0Il0Fm02newVoRpKqueens parkJrIsAt5utah jazz,vancouver whitecaps,w3yY;ashington 3est ham0Xh16;natio21redski1wizar12;ampa bay 6e5o3;ronto 3ttenham hotspur;blu1Hrapto0;nnessee tita1xasD;buccanee0ra1G;a7eattle 5heffield0Qporting kansas13t3;. louis 3oke12;c1Srams;mari02s3;eah1IounI;cramento Sn 3;antonio spu0diego 3francisco gi0Bjose earthquak2;char0EpaB;eal salt lake,o04; ran0C;a8h5ittsburgh 4ortland t3;imbe0rail blaze0;pirat2steele0;il3oenix su1;adelphia 3li2;eagl2philNunE;dr2;akland 4klahoma city thunder,r3;i10lando magic;athle0Trai3;de0; 3castle05;england 6orleans 5york 3;city fc,giUje0Lkn02me0Lred bul19y3;anke2;pelica1sain0J;patrio0Irevolut3;ion;aBe9i3ontreal impact;ami 7lwaukee b6nnesota 3;t4u0Rvi3;kings;imberwolv2wi1;re0Cuc0W;dolphi1heat,marli1;mphis grizz3ts;li2;nchester 5r3vN;i3li1;ne0;c00u0H;a4eicesterYos angeles 3;clippe0dodFlaA; galaxy,ke0;ansas city 3nH;chiefs,ro3;ya0M; pace0polis colX;astr0Edynamo,rockeWtexa1;i4olden state warrio0reen bay pac3;ke0;anT;.c.Aallas 7e3i0Cod5;nver 5troit 3;lio1pisto1ti3;ge0;bronc06nuggeO;cowboUmav3;er3;ic06; uX;arCelNh8incinnati 6leveland 5ol3;orado r3umbus crew sc;api5ocki2;brow1cavalie0india1;benga03re3;ds;arlotte horCicago 3;b4cubs,fire,wh3;iteE;ea0ulY;di3olina panthe0;ff3naW; c3;ity;altimore ElAoston 7r3uffalo bilT;av2e5ooklyn 3;ne3;ts;we0;cel4red3; sox;tics;ackburn rove0u3;e ja3;ys;rs;ori3rave1;ol2;rizona Ast8tlanta 3;brav2falco1h4u3;nited;aw9;ns;es;on villa,r3;os;c5di3;amondbac3;ks;ardi3;na3;ls|Uncountable0:1C;a1Hb1Bc12e0Wf0Qg0Mh0Gi0Dj0Cknowled1Gl07mYnXoWpRrOsCt8vi7w1;a5ea0Ai4o1;o2rld1;! seI;d,l;ldlife,ne;rmth,t0;neg0Xol08;e3hund0ime,oothpaste,r1una;affRou1;ble,sers,t;a,nnis;aAcene07e9h8il7now,o6p3te2u1;g0Rnshi0L;am,el;ace2e1;ciOed;!c12;ap,cc0ft0B;k,v0;eep,opp0O;riJ;d07fe0Wl1nd;m0Qt;ain,e1i0W;c1laxa0Csearch;ogni0Brea0B;a4e2hys0Elast9o1ress00;rk,w0;a1pp0trol;ce,nR;p0tiK;il,xygen;ews,oi0C;a7ea5i4o3u1;mps,s1;ic;nHo08;lk,st;sl1t;es;chine1il,themat00; learn02ry;aught0e3i2u1;ck,g07;ghtnZqu0CteratI;a1isH;th0;ewel7usti08;ce,mp1nformaOtself;ati1ortan06;en05;a4isto3o1;ck1mework,n1spitali01;ey;ry;ir,lib1ppi9;ut;o2r1um,ymnastJ;a7ound;l1ssip;d,f;i5lour,o2ruit,urnit1;ure;od,rgive1wl;ne1;ss;c6sh;conom9duca5lectriciMn3quip4th9very1;body,o1thB;ne;joy1tertain1;ment;tiC;a8elcius,h4iv3loth6o1urrency;al,ffee,ld w1nfusiAttA;ar;ics;aos,e1;e2w1;ing;se;ke,sh;a3eef,is2lood,read,utt0;er;on;g1ss;ga1;ge;c4dvi3irc2mnes1rt;ty;raft;ce;id|Unit0:17;a12b10c0Md0Le0Jf0Fg0Bh08in07joule0k01lZmOnNoMpIqHsqCt7volts,w6y4z321;g,s;c,f,n;b,e2;a0Lb,d0Rears old,o1;tt0F;att0b;able4b3e2on1sp;!ne0;a2r0B;!l,sp;spo03; ft,uare 1;c0Gd0Ff3i0Dkilo0Hm1ya0C;e0Kil1;e0li0F;eet0o0B;t,uart0;a3e2i1ou0Nt;c0Knt0;rcent,t00;!scals;hms,uVz;an0GewtR;/s,b,e7g,i3l,m2p1,;h,s;!;!/h,cro3l1;e1li05;! DsC;g05s0A;gPter1;! 2s1;! 1;per second;b,iZm,u1x;men0x0;b,elvin0g,ilo2m1nQ;!/h,ph,;byYgWmeter1;! 2s1;! 1;per hour;,;e1g,z;ct1rtz0;aWogP;al2b,ig9ra1;in0m0;!l1;on0;a3emtOl1tG; oz,uid ou1;nce0;hrenheit0rad0;b,x1;abyH;eciCg,l,mA;arat0eAg,l,m9oulomb0u1;bic 1p0;c5d4fo3i2meAya1;rd0;nch0;ot0;eci2;enti1;me4;!,;lsius0nti1;g2li1me1;ter0;ram0;bl,y1;te0;c4tt1;os1;eco1;nd0;re0;!s|Pronoun\'em,elle,h4i3me,ourselves,she5th1us,we,you0;!rself;e0ou;m,y;!l,t;e0im;!\'s|Organization0:44;a39b2Qc2Ad22e1Yf1Ug1Mh1Hi1Ej1Ak18l14m0Tn0Go0Dp07qu06rZsStFuBv8w3y1;amaha,m0You1w0Y;gov,tu2R;a3e1orld trade organizati3Z;lls fargo,st1;fie23inghou17;l1rner br3B;-m12gree30l street journ25m12;an halNeriz3Uisa,o1;dafo2Gl1;kswagLvo;bs,kip,n2ps,s1;a tod2Qps;es33i1;lev2Wted natio2T; mobi2Jaco bePd bMeAgi frida9h3im horto2Smz,o1witt2V;shiba,y1;ota,s r Y;e 1in lizzy;b3carpen31daily ma2Vguess w2holli0rolling st1Ns1w2;mashing pumpki2Nuprem0;ho;ea1lack eyed pe3Dyrds;ch bo1tl0;ys;l2s1;co,la m13;efoni08us;a6e4ieme2Fnp,o2pice gir5ta1ubaru;rbucks,to2L;ny,undgard1;en;a2Px pisto1;ls;few24insbu25msu1W;.e.m.,adiohead,b6e3oyal 1yan2V;b1dutch she4;ank;/max,aders dige1Ed 1vl30;bu1c1Thot chili peppe2Ilobst27;ll;c,s;ant2Tizno2D;an5bs,e3fiz23hilip morrBi2r1;emier25octer &amp; gamb1Qudenti14;nk floyd,zza hut;psi26tro1uge09;br2Ochina,n2O; 2ason1Wda2E;ld navy,pec,range juli2xf1;am;us;aAb9e5fl,h4i3o1sa,wa;kia,tre dame,vart1;is;ke,ntendo,ss0L;l,s;c,stl3tflix,w1; 1sweek;kids on the block,york09;e,;a,c;nd1Rs2t1;ional aca2Co,we0P;a,cYd0N;aAcdonald9e5i3lb,o1tv,yspace;b1Knsanto,ody blu0t1;ley crue,or0N;crosoft,t1;as,subisO;dica3rcedes2talli1;ca;!-benz;id,re;\'s,s;c\'s milk,tt11z1V;\'ore08a3e1g,ittle caesa1H;novo,x1;is,mark; pres5-z-boy,bour party;atv,fc,kk,m1od1H;art;iffy lu0Jo3pmorgan1sa;! cha1;se;hnson &amp; johns1Py d1O;bm,hop,n1tv;g,te1;l,rpol; &amp; m,asbro,ewlett-packaSi3o1sbc,yundai;me dep1n1G;ot;tac1zbollah;hi;eneral 6hq,l5mb,o2reen d0Gu1;cci,ns n ros0;ldman sachs,o1;dye1g09;ar;axo smith kliYencore;electr0Gm1;oto0S;a3bi,da,edex,i1leetwood mac,oFrito-l08;at,nancial1restoU; tim0;cebook,nnie mae;b04sa,u3xxon1; m1m1;ob0E;!rosceptics;aiml08e5isney,o3u1;nkin donuts,po0Tran dur1;an;j,w j1;on0;a,f leppa2ll,peche mode,r spiegXstiny\'s chi1;ld;rd;aEbc,hBi9nn,o3r1;aigsli5eedence clearwater reviv1ossra03;al;ca c5l4m1o08st03;ca2p1;aq;st;dplLgate;ola;a,sco1tigroup;! systems;ev2i1;ck fil-a,na daily;r0Fy;dbury,pital o1rl\'s jr;ne;aFbc,eBf9l5mw,ni,o1p,rexiteeV;ei3mbardiJston 1;glo1pizza;be;ng;ack &amp; deckFo2ue c1;roW;ckbuster video,omingda1;le; g1g1;oodriM;cht3e ge0n &amp; jer2rkshire hathaw1;ay;ryG;el;nana republ3s1xt5y5;f,kin robbi1;ns;ic;bWcRdidQerosmith,ig,lKmEnheuser-busDol,pple9r6s3t&amp;t,v2y1;er;is,on;hland1sociated F; o1;il;by4g2m1;co;os; compu2bee1;\'s;te1;rs;ch;c,d,erican3t1;!r1;ak; ex1;pre1;ss; 4catel2t1;air;!-luce1;nt;jazeera,qae1;da;as;/dc,a3er,t1;ivisi1;on;demy of scienc0;es;ba,c|Demonym0:16;1:13;a0Wb0Nc0Cd0Ae09f07g04h02iYjVkTlPmLnIomHpDqatari,rBs7t5u4v3wel0Rz2;am0Fimbabwe0;enezuel0ietnam0H;g9krai1;aiwThai,rinida0Iu2;ni0Qrkmen;a4cot0Ke3ingapoOlovak,oma0Tpa05udRw2y0X;edi0Kiss;negal0Br08;mo0uU;o6us0Lw2;and0;a3eru0Hhilipp0Po2;li0Ertugu06;kist3lesti1na2raguay0;ma1;ani;amiZi2orweP;caragu0geri2;an,en;a3ex0Mo2;ngo0Erocc0;cedo1la2;gasy,y08;a4eb9i2;b2thua1;e0Dy0;o,t02;azakh,eny0o2uwaiti;re0;a2orda1;ma0Bp2;anN;celandic,nd4r2sraeli,ta02vo06;a2iT;ni0qi;i0oneV;aiDin2ondur0unN;di;amDe2hanai0reek,uatemal0;or2rm0;gi0;i2ren7;lipino,n4;cuadoVgyp6ngliJsto1thiopi0urope0;a2ominXut4;niH;a9h6o4roa3ub0ze2;ch;ti0;lom2ngol5;bi0;a6i2;le0n2;ese;lifor1m2na3;bo2eroo1;di0;angladeshi,el8o6r3ul2;gaG;aziBi2;ti2;sh;li2s1;vi0;aru2gi0;si0;fAl7merBngol0r5si0us2;sie,tr2;a2i0;li0;gent2me1;ine;ba1ge2;ri0;ni0;gh0r2;ic0;an|Regiona20b1Sc1Id1Des1Cf19g13h10i0Xj0Vk0Tl0Qm0FnZoXpSqPrMsDtAut9v5w2y0zacatec22;o05u0;cat18kZ;a0est vir4isconsin,yomi14;rwick1Qshington0;! dc;er2i0;cto1Ir0;gin1R;acruz,mont;ah,tar pradesh;a1e0laxca1Cusca9;nnessee,x1Q;bas0Jmaulip1PsmI;a5i3o1taf0Nu0ylh12;ffUrrZs0X;me0Zno19uth 0;cRdQ;ber1Hc0naloa;hu0Rily;n1skatchew0Qxo0;ny; luis potosi,ta catari1H;a0hode6;j0ngp01;asth0Lshahi;inghai,u0;e0intana roo;bec,ensVreta0D;ara3e1rince edward0; isT;i,nnsylv0rnambu01;an13;!na;axa0Mdisha,h0klaho1Antar0reg3x03;io;ayarit,eAo2u0;evo le0nav0K;on;r0tt0Qva scot0W;f5mandy,th0; 0ampton0P;c2d1yo0;rk0N;ako0X;aroli0U;olk;bras0Wva00w0; 1foundland0;! and labrador;brunswick,hamp0Gjers0mexiIyork state;ey;a5i1o0;nta0Mrelos;ch2dlanAn1ss0;issippi,ouri;as geraFneso0L;igPoacP;dhya,harasht03ine,ni2r0ssachusetts;anhao,y0;land;p0toba;ur;anca03e0incoln03ouis7;e0iG;ds;a0entucky,hul09;ns07rnata0Cshmir;alis0iangxi;co;daho,llino1nd0owa;ia04;is;a1ert0idalDun9;fordS;mpRwaii;ansu,eorgVlou4u0;an1erre0izhou,jarat;ro;ajuato,gdo0;ng;cesterL;lori1uji0;an;da;sex;e3o1uran0;go;rs0;et;lawaDrbyC;a7ea6hi5o0umbrG;ahui3l2nnectic1rsi0ventry;ca;ut;iLorado;la;apDhuahua;ra;l7m0;bridge2peche;a4r3uck0;ingham0;shi0;re;emen,itish columb2;h1ja cal0sque,var1;iforn0;ia;guascalientes,l3r0;izo1kans0;as;na;a1ber0;ta;ba1s0;ka;ma|PossessiveanyAh5its,m3noCo1sometBthe0yo1;ir1mselves;ur0;!s;i8y0;!se4;er1i0;mse2s;!s0;!e0;lf;o1t0;hing;ne|Currency$,aud,bRcPdKeurJfIgbp,hkd,inr,jpy,kGlEp8r7s3usd,x2y1z0,,,,,,,,,,,;lotyR;en,uanQ;af,of;h0t5;e0il5;k0q0;elL;iel,oubleKp,upeeK;e2ound st0;er0;lingH;n0soG;ceFn0;ies,y;e0i7;i,mpi6;n,r0wanzaByatB;!onaAw;ori7ranc9t;!o8;en3i2kk,o0;b0ll2;ra5;me4n0rham4;ar3;ad,e0ny;nt1;aht,itcoin0;!s|Country0:38;1:2L;a2Wb2Dc21d1Xe1Rf1Lg1Bh19i13j11k0Zl0Um0Gn05om3CpZqat1JrXsKtCu6v4wal3yemTz2;a24imbabwe;es,lis and futu2X;a2enezue31ietnam;nuatu,tican city;.5gTkraiZnited 3ruXs2zbeE;a,sr;arab emirat0Kkingdom,states2;! of am2X;k.,s.2; 27a.;a7haBimor-les0Bo6rinidad4u2;nis0rk2valu;ey,me2Xs and caic1T; and 2-2;toba1J;go,kel0Ynga;iw2Vji2nz2R;ki2T;aCcotl1eBi8lov7o5pa2Bri lanka,u4w2yr0;az2ed9itzerl1;il1;d2Qriname;lomon1Vmal0uth 2;afr2IkLsud2O;ak0en0;erra leoEn2;gapo1Wt maart2;en;negKrb0ychellY;int 2moa,n marino,udi arab0;hele24luc0mart1Z;epublic of ir0Com2Cuss0w2;an25;a3eHhilippinTitcairn1Ko2uerto riM;l1rtugE;ki2Bl3nama,pua new0Tra2;gu6;au,esti2;ne;aAe8i6or2;folk1Gth3w2;ay; k2ern mariana1B;or0M;caragua,ger2ue;!ia;p2ther18w zeal1;al;mib0u2;ru;a6exi5icro09o2yanm04;ldova,n2roc4zamb9;a3gol0t2;enegro,serrat;co;c9dagascZl6r4urit3yot2;te;an0i14;shall0Vtin2;ique;a3div2i,ta;es;wi,ys0;ao,ed00;a5e4i2uxembourg;b2echtenste10thu1E;er0ya;ban0Gsotho;os,tv0;azakh1De2iriba02osovo,uwait,yrgyz1D;eling0Jnya;a2erF;ma15p1B;c6nd5r3s2taly,vory coast;le of m19rael;a2el1;n,q;ia,oI;el1;aiSon2ungary;dur0Mg kong;aAermany,ha0Pibralt9re7u2;a5ern4inea2ya0O;!-biss2;au;sey;deloupe,m,tema0P;e2na0M;ce,nl1;ar;bTmb0;a6i5r2;ance,ench 2;guia0Dpoly2;nes0;ji,nl1;lklandTroeT;ast tim6cu5gypt,l salv5ngl1quatorial3ritr4st2thiop0;on0; guin2;ea;ad2;or;enmark,jibou4ominica3r con2;go;!n B;ti;aAentral african 9h7o4roat0u3yprQzech2; 8ia;ba,racao;c3lo2morPngo-brazzaville,okFsta r03te d\'ivoiK;mb0;osD;i2ristmasF;le,na;republic;m2naTpe verde,yman9;bod0ero2;on;aFeChut00o8r4u2;lgar0r2;kina faso,ma,undi;azil,itish 2unei;virgin2; is2;lands;liv0nai4snia and herzegoviGtswaGuvet2; isl1;and;re;l2n7rmuF;ar2gium,ize;us;h3ngladesh,rbad2;os;am3ra2;in;as;fghaFlCmAn5r3ustr2zerbaijH;al0ia;genti2men0uba;na;dorra,g4t2;arct6igua and barbu2;da;o2uil2;la;er2;ica;b2ger0;an0;ia;ni2;st2;an|Citya2Wb26c1Wd1Re1Qf1Og1Ih1Ai18jakar2Hk0Zl0Tm0Gn0Co0ApZquiYrVsLtCuBv8w3y1z0;agreb,uri1Z;ang1Te0okohama;katerin1Hrev34;ars3e2i0rocl3;ckl0Vn0;nipeg,terth0W;llingt1Oxford;aw;a1i0;en2Hlni2Z;lenc2Uncouv0Gr2G;lan bat0Dtrecht;a6bilisi,e5he4i3o2rondheim,u0;nVr0;in,ku;kyo,ronIulouC;anj23l13miso2Jra2A; haJssaloni0X;gucigalpa,hr2Ol av0L;i0llinn,mpe2Bngi07rtu;chu22n2MpT;a3e2h1kopje,t0ydney;ockholm,uttga12;angh1Fenzh1X;o0KvZ;int peters0Ul3n0ppo1F; 0ti1B;jo0salv2;se;v0z0Q;adU;eykjavik,i1o0;me,t25;ga,o de janei17;to;a8e6h5i4o2r0ueb1Qyongya1N;a0etor24;gue;rt0zn24; elizabe3o;ls1Grae24;iladelph1Znom pe07oenix;r0tah tik19;th;lerJr0tr10;is;dessa,s0ttawa;a1Hlo;a2ew 0is;delTtaip0york;ei;goya,nt0Upl0Uv1R;a5e4i3o1u0;mb0Lni0I;nt0scH;evideo,real;l1Mn01skolc;delln,lbour0S;drid,l5n3r0;ib1se0;ille;or;chest0dalWi0Z;er;mo;a4i1o0vAy01;nd00s angel0F;ege,ma0nz,sbZverpo1;!ss0;ol; pla0Iusan0F;a5hark4i3laipeda,o1rak0uala lump2;ow;be,pavog0sice;ur;ev,ng8;iv;b3mpa0Kndy,ohsiu0Hra0un03;c0j;hi;ncheMstanb0zmir;ul;a5e3o0; chi mi1ms,u0;stI;nh;lsin0rakliG;ki;ifa,m0noi,va0A;bu0SiltD;alw4dan3en2hent,iza,othen1raz,ua0;dalaj0Gngzhou;bu0P;eUoa;sk;ay;es,rankfu0;rt;dmont4indhovU;a1ha01oha,u0;blRrb0Eshanbe;e0kar,masc0FugavpiJ;gu,je0;on;a7ebu,h2o0raioJuriti01;lo0nstanJpenhagNrk;gFmbo;enn3i1ristchur0;ch;ang m1c0ttagoL;ago;ai;i0lgary,pe town,rac4;ro;aHeBirminghWogoAr5u0;char3dap3enos air2r0sZ;g0sa;as;es;est;a2isba1usse0;ls;ne;silPtisla0;va;ta;i3lgrade,r0;g1l0n;in;en;ji0rut;ng;ku,n3r0sel;celo1ranquil0;la;na;g1ja lu0;ka;alo0kok;re;aBb9hmedabad,l7m4n2qa1sh0thens,uckland;dod,gabat;ba;k0twerp;ara;m5s0;terd0;am;exandr0maty;ia;idj0u dhabi;an;lbo1rh0;us;rg|PlaceaMbKcIdHeFfEgBhAi9jfk,kul,l7m5new eng4ord,p2s1the 0upJyyz;bronx,hamptons;fo,oho,under2yd;acifMek,h0;l,x;land;a0co,idDuc;libu,nhattK;a0gw,hr;s,x;ax,cn,ndianGst;arlem,kg,nd;ay village,re0;at 0enwich;britain,lak2;co,ra;urope,verglad0;es;en,fw,own1xb;dg,gk,hina0lt;town;cn,e0kk,rooklyn;l air,verly hills;frica,m5ntar1r1sia,tl0;!ant1;ct0;ic0; oce0;an;ericas,s|FemaleName0:G0;1:G4;2:FT;3:FF;4:FE;5:FU;6:ER;7:GH;8:F1;9:ET;A:GD;B:E7;C:GA;D:FQ;E:FN;F:EI;G:C8;aE4bD6cB9dAJe9Hf92g8Ih85i7Uj6Wk61l4Pm3An2Vo2Sp2Hqu2Fr1Ps0Rt05ursu9vVwPyMzH;aKeIoH;e,la,ra;lHna;da,ma;da,ra;as7GeIol1UvH;et6onBA;le0sen3;an8endBPhiB5iH;lJnH;if3BniHo0;e,f3A;a,helmi0lHma;a,ow;aNeKiH;cIviH;an9YenG4;kD1tor3;da,l8Wnus,rH;a,nHoniD4;a,iDE;leHnesEF;nDOrH;i1y;aTeQhOiNoKrHu9y4;acG6iHu0F;c3na,sH;h9Nta;nIrH;a,i;i9Kya;a5KffaCIna,s5;al3eHomasi0;a,l8Ho6Zres1;g7Vo6YrIssH;!a,ie;eFi,ri7;bOliNmLnJrIs5tHwa0;ia0um;a,yn;iHya;a,ka,s5;a4e4iHmCCra;!ka;a,t5;at5it5;a06carlet2Ze05hViTkye,oRtNuIyH;bFMlvi1;e,sIzH;an2Uet6ie,y;anHi7;!a,e,nH;aEe;aJeH;fHl3EphH;an2;cFBr73;f3nHphi1;d4ia,ja,ya;er4lv3mon1nHobh76;dy;aLeHirlBNo0y9;ba,e0i9lJrH;iHrBRyl;!d71;ia,lBX;ki4nJrIu0w0yH;la,na;i,leAon,ron;a,da,ia,nHon;a,on;l60re0;bNdMi8lLmJndIrHs5vannaE;aEi0;ra,y;aHi4;nt5ra;lBPome;e,ie;in1ri0;a03eYhWiUoIuH;by,thBM;bRcQlPnOsIwe0xH;an95ie,y;aIeHie,lC;ann7ll1marBHtB;!lHnn1;iHyn;e,nH;a,d7X;da,i,na;an8;hel55io;bin,erByn;a,cHkki,na,ta;helC2ki;ea,iannE0oH;da,n13;an0bJgi0i0nHta,y0;aHee;!e,ta;a,eH;cATkaE;chHe,i0mo0n5FquCGvDy0;aCFelHi8;!e,le;een2iH;a0nn;aNeMhKoJrH;iHudenAX;scil1Uyamva8;lly,rt3;ilome0oebe,ylH;is,lis;arl,ggy,nelope,r9t4;ige,m0Fn4Po9rvaBDtIulH;a,et6in1;ricHsy,tA9;a,e,ia;ctav3deIf86lHph86;a,ga,iv3;l3t6;aReQiKoHy9;eIrH;aEeDma;ll1mi;aLcJkHla,na,s5ta;iHki;!ta;hoB4k8ColH;a,eBJ;!mh;l7Una,risF;dJi5PnIo23taH;li1s5;cy,et6;eAiCQ;a01ckenz2eViLoIrignayani,uriBIyrH;a,na,tAV;i4ll9ZnH;a,iH;ca,ka,qB7;a,chPkaOlKmi,nJrHtzi;aHiam;!n8;a,dy,erva,h,n2;a,dJi9LlH;iHy;cent,e;red;!e9;ae9el3I;ag4LgLi,lIrH;edi62isFyl;an2iHliF;nHsAP;a,da;!an,han;b09c9Gd07e,g05i04l02n00rLtKuIv6TxGyHz2;a,bell,ra;de,rH;a,eD;h77il8t2;a,cTgPiKjor2l6Jn2s5tJyH;!aHbe5RjaAlou;m,n9V;a,ha,i0;!aJbAOeIja,lCna,sHt54;!a,ol,sa;!l07;!h,m,nH;!a,e,n1;arJeIie,oHr3Lueri6;!t;!ry;et3JiB;elHi62y;a,l1;dHon,ue9;akranBy;iHlo97;a,ka,n8;a,re,s2;daHg2;!l2Y;alCd2elHge,isBJon0;eiAin1yn;el,le;a0Je09iXoRuLyH;d3la,nH;!a,dIe9VnHsAT;!a,e9U;a,sAR;aB4cKelJiFlIna,pHz;e,iB;a,u;a,la;iHy;a2Ce,l27n8;is,l1IrItt2uH;el9is1;aJeIi7na,rH;aGi7;lei,n1tB;!in1;aRbQd3lMnJsIv3zH;!a,be4Let6z2;a,et6;a,dH;a,sHy;ay,ey,i,y;a,iaJlH;iHy;a8Je;!n4G;b7Verty;!n5T;aOda,e0iMla,nLoJslAUtHx2;iHt2;c3t3;la,nHra;a,ie,o4;a,or1;a,gh,laH;!ni;!h,nH;a,d4e,n4O;cOdon7Ui9kes5na,rNtLurJvIxHy9;mi;ern1in3;a,eHie,yn;l,n;as5is5oH;nya,ya;a,isF;ey,ie,y;a01eWhadija,iOoNrJyH;lHra;a,ee,ie;isHy5D;!tH;a,en,iHy;!e,n48;ri,urtn9C;aNerMl9BmJrHzzy;a,stH;en,in;!berlH;eHi,y;e,y;a,stD;!na,ra;el6QiKlJnIrH;a,i,ri;d4na;ey,i,l9Ss2y;ra,s5;c8Yi5YlPma9nyakumari,rNss5MtKviByH;!e,lH;a,eH;e,i7A;a5FeIhHi3PlCri0y;arGerGie,leDr9Hy;!lyn75;a,en,iHl4Vyn;!ma,n31sF;ei74i,l2;a05eWilUoNuH;anLdKliHstG;aIeHsF;!nAt0W;!n8Z;e,i2Ry;a,iB;!anMcelCd5Wel73han6JlKni,sIva0yH;a,ce;eHie;fi0lCphG;eHie;en,n1;!a,e,n36;!i10lH;!i0Z;anMle0nJrIsH;i5Rsi5R;i,ri;!a,el6Rif1RnH;a,et6iHy;!e,f1P;a,e74iInH;a,e73iH;e,n1;cMd1mi,nIqueliAsmin2Uvie4yAzH;min7;a7eIiH;ce,e,n1s;!lHsFt06;e,le;inIk2lCquelH;in1yn;da,ta;da,lQmOnNo0rMsIvaH;!na;aIiHob6W;do4;!belHdo4;!a,e,l2G;en1i0ma;a,di4es,gr5T;el8ogH;en1;a,eAia0o0se;aNeKilIoHyacin1N;ll2rten1H;a5HdHla5H;a,egard;ath0XiIlHnrietBrmiAst0X;en25ga;di;il78lLnKrHtt2yl78z6G;iHmo4Hri4I;etH;!te;aEnaE;ey,l2;aZeUiPlNold13rJwH;enHyne19;!dolC;acIetHisel8;a,chD;e,ieH;!la;adys,enHor3yn1Z;a,da,na;aKgi,lIna,ov74selH;a,e,le;da,liH;an;!n0;mZnJorgIrH;aldGi,m2Utru76;et6i5W;a,eHna;s1Ovieve;briel3Hil,le,rnet,yle;aSePio0loNrH;anIe8iH;da,e8;!cH;esIiHoi0H;n1s3X;!ca;!rH;a,en45;lIrnH;!an8;ec3ic3;rItiHy7;ma;ah,rah;d0GileDkBl01mVn4DrSsNtMuLvH;aJelIiH;e,ta;in0Byn;!ngelG;geni1la,ni3T;h55ta;meral8peranKtH;eIhHrel9;er;l2Rr;za;iHma,nestGyn;cHka,n;a,ka;eKilJmH;aHie,y;!liA;ee,i1y;lHrald;da,y;aUeSiNlMma,no4oKsJvH;a,iH;na,ra;a,ie;iHuiH;se;a,en,ie,y;a0c3da,nKsHzaI;aHe;!beH;th;!a,or;anor,nH;!a;in1na;en,iHna,wi0;e,th;aXeLiKoHul2W;lor54miniq41n32rHtt2;a,eDis,la,othHthy;ea,y;an0AnaEonAx2;anQbPde,eOiMja,lJmetr3nHsir4X;a,iH;ce,se;a,iIla,orHphiA;es,is;a,l5M;dHrdH;re;!d4Pna;!b2EoraEra;a,d4nH;!a,e;hl3i0mNnLphn1rIvi1YyH;le,na;a,by,cIia,lH;a,en1;ey,ie;a,et6iH;!ca,el1Cka;arHia;is;a0Se0Oh06i04lWoKrIynH;di,th3;istHy06;al,i0;lQnNrIurH;tn1F;aKdJiHnJriA;!nH;a,e,n1;el3;!l1T;n2sH;tanHuelo;ce,za;eHleD;en,t6;aJeoIotH;il4D;!pat4;ir7rJudH;et6iH;a,ne;a,e,iH;ce,sY;a4er4ndH;i,y;aQeNloe,rH;isIyH;stal;sy,tH;aIen,iHy;!an1e,n1;!l;lseIrH;!i7yl;a,y;nMrH;isKlImH;aiA;a,eHot6;n1t6;!sa;d4el1RtH;al,el1Q;cIlH;es6i3H;el3ilH;e,ia,y;iZlYmilXndWrOsMtHy9;aKeJhHri0;erGleDrCy;in1;ri0;li0ri0;a2IsH;a2Hie;a,iNlLmeJolIrH;ie,ol;!e,in1yn;lHn;!a,la;a,eHie,y;ne,y;na,sF;a0Ei0E;a,e,l1;isBl2;tlH;in,yn;arb0DeZianYlWoUrH;andSeQiJoIyH;an0nn;nwCok7;an2PdgLg0KtH;n29tH;!aInH;ey,i,y;ny;etH;!t7;an0e,nH;da,na;i7y;bbi7nH;iBn2;ancHossom,ythe;a,he;ca;aScky,lin8niBrOssNtJulaEvH;!erlH;ey,y;hIsy,tH;e,i11y7;!anH;ie,y;!ie;nHt5yl;adIiH;ce;et6iA;!triH;ce,z;a4ie,ra;aliy2Bb26d1Ng1Ji1Bl0Um0Pn03rYsPthe0uLvJyH;anHes5;a,na;a,eHr27;ry;drJgusIrH;el3o4;ti0;a,ey,i,y;hItrH;id;aLlHt1Q;eIi7yH;!n;e,iHy;gh;!nH;ti;iJleIpiB;ta;en,n1t6;an1AelH;le;aZdXeVgRiPja,nItoHya;inet6n3;!aKeIiHmJ;e,ka;!mHt6;ar2;!belIliFmU;sa;!le;ka,sHta;a,sa;elHie;a,iH;a,ca,n1qH;ue;!t6;te;je9rea;la;!bImHstas3;ar3;el;aJberIel3iHy;e,na;!ly;l3n8;da;aUba,eOiLlJma,ta,yH;a,c3sH;a,on,sa;iHys0K;e,s0J;a,cIna,sHza;a,ha,on,sa;e,ia;c3is5jaJna,ssaJxH;aHia;!nd4;nd4;ra;ia;i0nIyH;ah,na;a,is,naE;c5da,leDmMnslLsH;haElH;inHyX;g,n;!h;ey;ee;en;at5g2nH;es;ie;ha;aWdiTelMrH;eJiH;anMenH;a,e,ne;an0;na;aLeKiIyH;nn;a,n1;a,e;!ne;!iH;de;e,lCsH;on;yn;!lH;iAyn;ne;agaKbIiH;!gaJ;ey,i7y;!e;il;ah|Persona01bZcTdQeOfMgJhHinez,jFkEleDmAnettPo9p7r4s3t2uncle,v0womL;a0irgin maH;lentino rossi,n go3;heresa may,iger woods,yra banks;addam hussaQcarlett johanssRistZlobodan milosevic,omeone,tepGuC;ay romano,eese witherspoQo1ush limbau0;gh;d stewart,naldinho,sario;a0ipV;lmUris hiltM;prah winfrOra;an,essiaen,itt romnNo0ubarek;m0thR;!my;bron james,e;anye west,iefer sutherland,obe bryaN;aime,effersFk rowli0;ng;alle ber0ulk hog3;ry;astBentlem1irl,rand0uy;fa2mo2;an;a0ella;thF;ff0meril lagasse,zekiel;ie;a0enzel washingt4ick wolf,ude;d0lt3nte;!dy;ar2lint1ous0ruz;in;on;dinal wols1son0;! palm5;ey;arack obama,oy,ro0;!ck,th2;dolf hitl1shton kutch1u0;nt;er|WeekDayfri4mon4s2t1wed0;!nesd4;hurs2ues2;at0un1;!urd1;!d0;ay0;!s|Dateautumn,daylight9eom,one d8s5t2w0yesterd8;eek0int5;d6end;mr1o0;d4morrow;!w;ome 1tandard3umm0;er;d0point;ay; time|Timea6breakfast 5dinner5e3lunch5m2n0oclock,some5to7;i7o0;on,w;id4or1;od,ve0;ning;time;fternoon,go,ll day,t 0;ni0;ght|Holiday0:1Q;1:1P;a1Fb1Bc12d0Ye0Of0Kg0Hh0Di09june07kwanzaa,l04m00nYoVpRrPsFt9v6w4xm03y2;om 2ule;hasho16kippur;hit2int0Xomens equalit8; 0Ss0T;alentines3e2ictor1E;r1Bteran1;! 0;-0ax 0h6isha bav,rinityMu2; b3rke2;y 0;ish2she2;vat;a0Xe prophets birth0;a6eptember14h4imchat tor0Ut 3u2;kk4mmer T;a8p7s6valentines day ;avu2mini atzeret;ot;int 2mhain;a4p3s2valentine1;tephen1;atrick1;ndrew1;amadan,ememberanc0Yos2;a park1h hashana;a3entecost,reside0Zur2;im,ple heart 0;lm2ssovE; s04;rthodox 2stara;christma1easter2goOhoJn0C;! m07;ational 2ew years09;freedom 0nurse1;a2emorial 0lHoOuharram;bMr2undy thurs0;ch0Hdi gr2tin luther k0B;as;a2itRughnassadh;bour 0g baom2ilat al-qadr;er; 2teenth;soliU;d aJmbolc,n2sra and miraj;augurGd2;ependen2igenous people1;c0Bt1;a3o2;ly satur0;lloween,nukkUrvey mil2;k 0;o3r2;ito de dolores,oundhoW;odW;a4east of 2;our lady of guadalupe,the immaculate concepti2;on;ther1;aster8id 3lectYmancip2piphany;atX;al-3u2;l-f3;ad3f2;itr;ha;! 2;m8s2;un0;ay of the dead,ecemb3i2;a de muertos,eciseis de septiembre,wali;er sol2;stice;anad8h4inco de mayo,o3yber m2;on0;lumbu1mmonwealth 0rpus christi;anuk4inese n3ristmas2;! N;ew year;ah;a 0ian tha2;nksgiving;astillCeltaine,lack4ox2;in2;g 0; fri0;dvent,ll 9pril fools,rmistic8s6u2;stral4tum2;nal2; equinox;ia 0;cens2h wednes0sumption of mary;ion 0;e 0;hallows 6s2;ai2oul1t1;nt1;s 0;day;eve|MonthaBdec9feb7j2mar,nov9oct1sep0;!t8;!o8;an3u0;l1n0;!e;!y;!u1;!ru0;ary;!em0;ber;pr1ug0;!ust;!il|Durationcentur4d2hour3m0seconds,week3year3;i0onth2;llisecond1nute1;ay0ecade0;!s;ies,y|FirstNameaEblair,cCdevBj8k6lashawn,m3nelly,re2sh0;ay,e0iloh;a,lby;g1ne;ar1el,org0;an;ion,lo;as8e0;ls7nyatta,rry;am0ess1;ie,m0;ie;an,on;as0heyenne;ey,sidy;lexis,ndra,ubr0;ey|LastName0:35;1:3C;2:3A;3:2Z;4:2F;a3Bb31c2Od2Ee2Bf25g1Zh1Oi1Jj1Dk16l0Ym0Mn0Io0Fp04rXsLtGvEwBxAy7zh5;a5ou,u;ng,o;a5eun2Uoshi1Jun;ma5ng;da,guc1Zmo27sh21zaQ;iao,u;a6eb0il5o3right,u;li3Bs2;gn0lk0ng,tanabe;a5ivaldi;ssilj37zqu1;a8h7i2Go6r5sui,urn0;an,ynisI;lst0Orr1Uth;at1Uomps2;kah0Unaka,ylor;aDchCeBhimizu,iAmi9o8t6u5zabo;ar1lliv2AzuD;a5ein0;l23rm0;sa,u3;rn4th;lva,mmo24ngh;mjon4rrano;midt,neid0ulz;ito,n6sa5to;ki;ch1dKtos,z;amAeag1Zi8o6u5;bio,iz,sC;b5dri1MgHj0Sme24osevelt,sZux;erts,ins2;c5ve0E;ci,hards2;ir1os;aDe9h7ic5ow20;as5hl0;so;a5illips;m,n1T;ders20et7r6t5;e0Nr4;ez,ry;ers;h21rk0t5vl4;el,te0J;baAg0Alivei00r5;t5w1O;ega,iz;a5eils2guy1Rix2owak,ym1E;gy,ka5var1K;ji5muV;ma;aDeBiAo7u5;ll0n5rr0Bssolini,5;oz;lina,oJr5zart;al0Me5r0U;au,no;hhail4ll0;rci0s5y0;si;eVmmad4r5tsu07;in5tin1;!o;aBe7i5op1uo;!n5u;coln,dholm;fe6n0Qr5w0J;oy;bv5v5;re;mmy,rs14u;aAennedy,imu9le0Lo7u6wo5;k,n;mar,znets4;bay5vacs;asY;ra;hn,rl8to,ur,zl4;a9en8ha3imen1o5u3;h5nYu3;an5ns2;ss2;ki0Es0S;cks2nsse0D;glesi8ke7noue,shik6to,vano5;u,v;awa;da;as;aBe8it7o6u5;!a3b0ghNynh;a3ffmann,rvat;chcock,l0;mingw6nde5rM;rs2;ay;ns0ErrPs6y5;asCes;an4hi5;moI;a8il,o7r6u5;o,tierr1;ayli3ub0;m1nzal1;nd5o,rcia;hi;er9is8lor7o6uj5;ita;st0urni0;es;ch0;nand1;d6insteGsposi5vaK;to;is2wards;aBeAi8omin7u5;bo5rand;is;gu1;az,mitr4;ov;lgado,vi;nkula,rw6vi5;es,s;in;aEhAlark9o5;hKl5op0rbyn,x;em6li5;ns;an;!e;an7e6iu,o5ristensFu3we;i,ng,u3w,y;!n,on5u3;!g;mpb6rt0st5;ro;ell;aAe7ha3lanco,oyko,r5yrne;ooks,yant;ng;ck6ethov5nnett;en;er,ham;ch,h7iley,rn5;es,i0;er;k,ng;dCl8nd5;ers5r9;en,on,s2;on;eks6iy7var1;ez;ej5;ev;ams|MaleName0:CE;1:BK;2:C2;3:BS;4:B4;5:BZ;6:AT;7:9V;8:BC;9:AW;A:AO;B:8W;aB5bA9c98d88e7Hf6Zg6Hh5Wi5Ij4Lk4Bl3Rm2Pn2Eo28p22qu20r1As0Qt07u06v01wOxavi3yHzC;aCor0;cCh8Jne;hDkC;!a5Z;ar51e5Y;ass2i,oDuC;sEu25;nFsEusC;oCsD;uf;ef;at0g;aKeIiDoCyaAQ;lfgang,odrow;lCn1O;bEey,frBJlC;aA6iC;am,e,s;e8Aur;i,nde7sC;!l6t1;de,lDrr5yC;l1ne;lCt3;a94y;aFern1iC;cDha0nceCrg9Cva0;!nt;ente,t5B;lentin49n8Zughn;lyss4Msm0;aTeOhLiJoFrDyC;!l3ro8s1;av9ReCist0oy,um0;nt9Jv55y;bEd7YmCny;!as,mCoharu;aAYie,y;iBy;mCt9;!my,othy;adDeoCia7EomB;!do7O;!de9;dFrC;en8JrC;an8IeCy;ll,n8H;!dy;dgh,ic9Unn3req,ts46;aScotQeOhKiIoGpenc3tCur1Pylve8Jzym1;anEeCua7D;f0phAGvCwa7C;e59ie;!islaw,l6;lom1nA4uC;leyma8ta;dClBm1;!n6;aEeC;lCrm0;d1t1;h6Une,qu0Vun,wn,y8;aCbasti0k1Yl42rg41th,ymo9J;m9n;!tC;!ie,y;lDmCnti22q4Kul;!mAu4;ik,vato6X;aXeThe94iPoGuDyC;an,ou;b6NdDf9pe6SssC;!elAK;ol2Vy;an,bJcIdHel,geGh0landA4mFnEry,sDyC;!ce;coe,s;!a96nA;an,eo;l3Kr;e4Sg3n6oA5ri6A;co,ky;bAe9V;cCl6;ar5Qc5PhDkCo;!ey,ie,y;a87ie;gDid,ub5x,yCza;ansh,nT;g8XiC;na8Ts;ch60fa4lEmDndCpha4sh6Wul,ymo72;alA0ol2Cy;i9Jon;f,ph;ent2inC;cy,t1;aGeEhilDier64ol,reC;st1;!ip,lip;d9Crcy,tC;ar,e2W;b3Udra6Ht46ul;ctav2Wliv3m97rGsDtCum8Vw5;is,to;aDc8TvC;al54;ma;i,l4BvK;athKeIiEoC;aCel,l0ma0r2Y;h,m;cDg4i3KkC;h6Wola;holBkColB;!olB;al,d,il,ls1vC;il52;anCy;!a4i4;aXeUiLoGuDyC;l22r1;hamDr61staC;fa,p4I;ed,mG;dibo,e,hamEis1YntDsCussa;es,he;e,y;ad,ed,mC;ad,ed;cHgu4kFlEnDtchC;!e7;a7Aik;o04t1;e,olC;aj;ah,hCk6;a4eC;al,l;hDlv2rC;le,ri7v2;di,met;ck,hOlMmPnu4rIs1tEuricDxC;!imilian87we7;e,io;eo,hDiBtC;!eo,hew,ia;eCis;us,w;cEio,k81lDqu6Isha7tCv2;i2Jy;in,on;!el,oLus;achCcolm,ik;ai,y;amCdi,moud;adC;ou;aSeOiNlo2ToJuDyC;le,nd1;cFiEkCth3;aCe;!s;gi,s;as,iaC;no;g0nn6SrenEuCwe7;!iC;e,s;!zo;am,on4;a7Cevi,la4UnEoCst3vi;!nC;!a62el;!ny;mDnCr16ur4Vwr4V;ce,d1;ar,o4P;aJeEhaled,iCrist4Xu4Ay3D;er0p,rC;by,k,ollos;en0iFnCrmit,v2;!dDnCt5E;e10y;a7ri4P;r,th;na69rCthem;im,l;aZeRiPoEuC;an,liCst2;an,o,us;aqu2eKhnJnHrFsC;eDhCi7Due;!ua;!ph;dCge;an,i,on;!aCny;h,s,th4Z;!ath4Yie,nA;!l,sCy;ph;an,e,mC;!mA;d,ffHrEsC;sCus;!e;a5KemDmai8oCry;me,ni0Q;i6Wy;!e07rC;ey,y;cId5kHmGrEsDvi3yC;!d5s1;on,p3;ed,od,rCv4O;e51od;al,es,is1;e,ob,ub;k,ob,quC;es;aObrahNchika,gLkeKlija,nuJrHsEtCv0;ai,sC;uki;aCha0i6Hma4sac;ac,iaC;h,s;a,vinCw2;!g;k,nngu53;!r;nacCor;io;im;in,n;aLeGina4WoEuCyd57;be27gCmber4EsE;h,o;m3ra35sCwa3Z;se2;aFctEitEnDrC;be22m0;ry;or;th;bLlKmza,nJo,rEsDyC;a44d5;an,s0;lFo4FrEuCv6;hi41ki,tC;a,o;is1y;an,ey;k,s;!im;ib;aReNiMlenLoJrFuC;illerDsC;!tavo;mo;aEegCov3;!g,orC;io,y;dy,h58nt;nzaCrd1;lo;!n;lbe4Qno,ovan4S;ne,oErC;aCry;ld,rd4O;ffr6rge;bri4l5rCv2;la20r3Fth,y;aSeOiMlKorr0JrC;anEedCitz;!dAeCri25;ri24;cEkC;!ie,lC;in,yn;esKisC;!co,zek;etch3oC;yd;d4lConn;ip;deriEliDng,rnC;an02;pe,x;co;bi0di;ar00dVfrUit0lOmHnGo2rDsteb0th0uge8vCym5zra;an,ere2W;gi,iDnCrol,v2w2;est3Zie;c08k;och,rique,zo;aHerGiDmC;aGe2Q;lDrC;!h0;!io;s1y;nu4;be0Ad1iFliEmDt1viCwood;n,s;er,o;ot1Us;!as,j44sC;ha;a2en;!dAg32mFuDwC;a26in;arC;do;o0Tu0T;l,nC;est;aZePiMoFrEuDwCyl0;ay8ight;a8dl6nc0st2;ag0ew;minGnEri0ugDyC;le;!lB;!a29nCov0;e7ie,y;go,icC;!k;armuDeCll1on,rk;go;id;anJj0lbeImetri9nGon,rFsEvDwCxt3;ay8ey;en,in;hawn,mo09;ek,ri0G;is,nCv3;is,y;rt;!dC;re;lLmJnIrEvC;e,iC;!d;en,iEne7rCyl;eCin,yl;l2Wn;n,o,us;!e,i4ny;iCon;an,en,on;e,lB;as;a07e05hXiar0lMoHrFuDyrC;il,us;rtC;!is;aCistobal;ig;dy,lFnDrC;ey,neli9y;or,rC;ad;by,e,in,l2t1;aHeEiCyJ;fCnt;fo0Dt1;meDt9velaC;nd;nt;rEuDyC;!t1;de;enC;ce;aGeFrisDuC;ck;!tC;i0oph3;st3;d,rlCs;eCie;s,y;cCdric,s11;il;lFmer1rC;ey,lDro7y;ll;!os,t1;eb,v2;ar03eVilUlaToQrDuCyr1;ddy,rtJ;aKeFiEuDyC;an,ce,on;ce,no;an,ce;nDtC;!t;dDtC;!on;an,on;dDndC;en,on;!foCl6y;rd;bDrCyd;is;!by;i8ke;al,lA;nGrCshoi;at,nDtC;!r11;aCie;rd0M;!edict,iDjam2nA;ie,y;to;n6rCt;eCy;tt;ey;ar0Yb0Od0Kgust2hm0Hid5ja0FlZmXnPputsiOrFsaEuCya0ziz;gust9st2;us;hi;aJchIi4jun,maGnEon,tCy0;hCu07;ur;av,oC;ld;an,nd05;el;ie;ta;aq;dHgel00tC;hoFoC;i8nC;!iXy;ne;ny;reCy;!as,s,w;ir,mCos;ar;an,bePd5eJfGi,lFonEphonIt1vC;aNin;on;so,zo;an,en;onDrC;edK;so;c,jaFksandEssaFxC;!and3;er;ar,er;ndC;ro;rtC;!o;ni;en;ad,eC;d,t;in;aDoCri0vik;lfo;mCn;!a;dGeFraDuC;!bakr,lfazl;hCm;am;!l;allFel,oulaye,ulC;!lDrahm0;an;ah,o;ah;av,on|Verbawak9born,cannot,fr8g7h5k3le2m1s0wors9;e8h3;ake sure,sg;ngth6ss6;eep tabs,n0;own;as0e2;!t2;iv1onna;ight0;en|PhrasalVerb0:71;1:6P;2:7D;3:73;4:6I;5:7G;6:75;7:6O;8:6B;9:6C;A:5H;B:70;C:6Z;a7Gb62c5Cd59e57f45g3Nh37iron0j33k2Yl2Km2Bn29o27p1Pr1Es09tQuOvacuum 1wGyammerCzD;eroAip EonD;e0k0;by,up;aJeGhFiEorDrit52;d 1k2Q;mp0n49pe0r8s8;eel Bip 7K;aEiD;gh 06rd0;n Br 3C;it 5Jk8lk6rm 0Qsh 73t66v4O;rgeCsD;e 9herA;aRePhNiJoHrFuDype 0N;ckArn D;d2in,o3Fup;ade YiDot0y 32;ckle67p 79;ne66p Ds4C;d2o6Kup;ck FdEe Dgh5Sme0p o0Dre0;aw3ba4d2in,up;e5Jy 1;by,o6U;ink Drow 5U;ba4ov7up;aDe 4Hll4N;m 1r W;ckCke Elk D;ov7u4N;aDba4d2in,o30up;ba4ft7p4Sw3;a0Gc0Fe09h05i02lYmXnWoVpSquare RtJuHwD;earFiD;ngEtch D;aw3ba4o6O; by;ck Dit 1m 1ss0;in,up;aIe0RiHoFrD;aigh1LiD;ke 5Xn2X;p Drm1O;by,in,o6A;n2Yr 1tc3H;c2Xmp0nd Dr6Gve6y 1;ba4d2up;d2o66up;ar2Uell0ill4TlErDurC;ingCuc8;a32it 3T;be4Brt0;ap 4Dow B;ash 4Yoke0;eep EiDow 9;c3Mp 1;in,oD;ff,v7;gn Eng2Yt Dz8;d2o5up;in,o5up;aFoDu4E;ot Dut0w 5W;aw3ba4f36o5Q;c2EdeAk4Rve6;e Hll0nd GtD; Dtl42;d2in,o5upD;!on;aw3ba4d2in,o1Xup;o5to;al4Kout0rap4K;il6v8;at0eKiJoGuD;b 4Dle0n Dstl8;aDba4d2in52o3Ft2Zu3D;c1Ww3;ot EuD;g2Jnd6;a1Wf2Qo5;ng 4Np6;aDel6inAnt0;c4Xd D;o2Su0C;aQePiOlMoKrHsyc29uD;ll Ft D;aDba4d2in,o1Gt33up;p38w3;ap37d2in,o5t31up;attleCess EiGoD;p 1;ah1Gon;iDp 52re3Lur44wer 52;nt0;ay3YuD;gAmp 9;ck 52g0leCn 9p3V;el 46ncilA;c3Oir 2Hn0ss FtEy D;ba4o4Q; d2c1X;aw3ba4o11;pDw3J;e3It B;arrow3Serd0oD;d6te3R;aJeHiGoEuD;ddl8ll36;c16p 1uth6ve D;al3Ad2in,o5up;ss0x 1;asur8lt 9ss D;a19up;ke Dn 9r2Zs1Kx0;do,o3Xup;aOeMiHoDuck0;a16c36g 0AoDse0;k Dse34;aft7ba4d2forw2Ain3Vov7uD;nd7p;e GghtFnEsDv1T;ten 4D;e 1k 1; 1e2Y;ar43d2;av1Ht 2YvelD; o3L;p 1sh DtchCugh6y1U;in3Lo5;eEick6nock D;d2o3H;eDyA;l2Hp D;aw3ba4d2fSin,o05to,up;aFoEuD;ic8mpA;ke2St2W;c31zz 1;aPeKiHoEuD;nker2Ts0U;lDneArse2O;d De 1;ba4d2oZup;de Et D;ba4on,up;aw3o5;aDlp0;d Fr Dt 1;fDof;rom;in,oO;cZm 1nDve it;d Dg 27kerF;d2in,o5;aReLive Jloss1VoFrEunD; f0M;in39ow 23; Dof 0U;aEb17it,oDr35t0Ou12;ff,n,v7;bo5ft7hJw3;aw3ba4d2in,oDup,w3;ff,n,ut;a17ek0t D;aEb11d2oDr2Zup;ff,n,ut,v7;cEhDl1Pr2Xt,w3;ead;ross;d aEnD;g 1;bo5;a08e01iRlNoJrFuD;cDel 1;k 1;eEighten DownCy 1;aw3o2L;eDshe1G; 1z8;lFol D;aDwi19;bo5r2I;d 9;aEeDip0;sh0;g 9ke0mDrD;e 2K;gLlJnHrFsEzzD;le0;h 2H;e Dm 1;aw3ba4up;d0isD;h 1;e Dl 11;aw3fI;ht ba4ure0;eInEsD;s 1;cFd D;fDo1X;or;e B;dQl 1;cHll Drm0t0O;apYbFd2in,oEtD;hrough;ff,ut,v7;a4ehi1S;e E;at0dge0nd Dy8;o1Mup;o09rD;ess 9op D;aw3bNin,o15;aShPlean 9oDross But 0T;me FoEuntD; o1M;k 1l6;aJbIforGin,oFtEuD;nd7;ogeth7;ut,v7;th,wD;ard;a4y;pDr19w3;art;eDipA;ck BeD;r 1;lJncel0rGsFtch EveA; in;o16up;h Bt6;ry EvD;e V;aw3o12;l Dm02;aDba4d2o10up;r0Vw3;a0He08l01oSrHuD;bbleFcklTilZlEndlTrn 05tDy 10zz6;t B;k 9; ov7;anMeaKiDush6;ghHng D;aEba4d2forDin,o5up;th;bo5lDr0Lw3;ong;teD;n 1;k D;d2in,o5up;ch0;arKgJil 9n8oGssFttlEunce Dx B;aw3ba4;e 9; ar0B;k Bt 1;e 1;d2up; d2;d 1;aIeed0oDurt0;cFw D;aw3ba4d2o5up;ck;k D;in,oK;ck0nk0st6; oJaGef 1nd D;d2ov7up;er;up;r0t D;d2in,oDup;ff,ut;ff,nD;to;ck Jil0nFrgEsD;h B;ainCe B;g BkC; on;in,o5; o5;aw3d2o5up;ay;cMdIsk Fuction6; oD;ff;arDo5;ouD;nd;d D;d2oDup;ff,n;own;t D;o5up;ut|Modalc5lets,m4ought3sh1w0;ill,o5;a0o4;ll,nt;! to;ay,ight,ust;an,o0;uld|Adjective0:74;1:7J;2:7P;3:7I;4:7B;5:5B;6:4R;7:49;8:48;9:7G;A:60;B:72;C:6Z;D:6Y;a6Hb63c5Pd55e4Rf48g3Zh3Oi33j31k30l2Pm2En25o1Pp19quack,r0Zs0Ft08uPvMwEyear5;arp0eIholeHiGoE;man5oEu6A;d6Czy;despr73s5E;!sa7;eFlEste24;co1Gl o4J;!k5;aFiEola4A;b7Rce versa,ol53;ca2gabo61nilla;ltVnIpFrb58su4tterE;!moD; f32b1MpFsEti1F;ca7et,ide dLtairs;er,i3L;aObeco6Pconvin25deLeKfair,ivers4knJprecedXrHsFwE;iel1Yritt5X;i1TuE;pervis0specti3;eEu5;cognKgul6Fl6F;own;ndi3v5Rxpect0;cid0rE;!grou5MsE;iz0tood;b7ppeaKssu6EuthorE;iz0;i22ra;aIeGhough4NoFrE;i1oubl0;geth6p,rpC;en5OlEm4Yrr2Sst0;li3;boo,lEn;ent0;aWcVeThSiQmug,nobbi3DoOpNqueami3DtIuEymb62;bGi gener53pErprisi3;erEre0J;! dup6b,i27;du0seq4S;anda6SeHi0NrEy37;aightEip0; fEfE;or59;adfaDreotyp0;a4Xec2Eir1HlendCot on; call0le,mb6phist1VrEu0Vvi40;dCry;gnifica2nE;ce4Tg7;am2Oe6ocki3ut;cEda1em5lfi2Xni1Upa67re8;o1Er3U;at56ient26reec56;cr0me,ns serif;aLeHiFoE;buDtt4SuRy4;ghtEv4;!-27fA;ar,bel,condi1du61fres50lGpublic3UsEta2C;is46oE;lu1na2;e1Cuc44;bCciE;al,st;aOeMicayu8lacCopuliDrFuE;bl58mp0;eIiFoE;!b08fuBmi30p6;mFor,sEva1;ti8;a4Ue;ciBmE;a0Gi5I;ac20rEti1;fe9ma2Tplexi3v33;rEst;allelGtE;-tiEi4;me;!ed;bPffNkMld fashion0nLpKrg1Gth6utJvE;al,erE;!aGniFt,wE;eiErouE;ght;ll;do0Uer,g2Lsi45;en,posi1; boa5Fg2Jli8;!ay; gua5DbEli8;eat;eGsE;cEer0Gole1;e8u3J;d2Sse;ak0eLiKoEua4O;nIrFtE;ab7;thE;!eE;rn;chala2descri4Zstop;ght5;arby,cessa3Wighbor5xt;aMeKiHoEultip7;bi7derFlEnth5ot,st;dy;a1n;nEx0;iaEor;tu32;di4EnaEre;ci3;cEgenta,in,j02keshift,le,mmoth,ny,sculi8;ab2Yho;aNeIiFoEu13;uti12vi3;mFteraE;l,te;it0;ftHgEth4;al,eFitiE;ma1;nda3C;!-0B;nguCst,tt6;ap1Sind5no09;agg0uE;niNstifi0veni7;de4gno4Blleg4mRnGpso 1VrE;a1releE;va2; MaLbr0corKdIfluenSiSnHsGtE;a9enBoxE;ic36;a8i2R;a1er,oce2;iFoE;or;re9;deq3Jppr2Y;fEsitu,vitro;ro2;mIpE;arGerfe9oErop6;li1rtE;a2ed;ti4;eEi0Q;d2QnB;aJelIiGoEumdr3B;neDok0rrEs07ur5;if2S;ghfalut1OspE;an2Q;liZpfA;lHnGrE;d05roE;wi3;dy,gi3;f,low0;ainfAener2Jiga22lLoKraHuE;aFilEng ho;ty;rd0;cFtE;efAis;efA;ne,od;ea2Cob4;aTeNinMlLoGrE;a1SeEoz1J;e2Cq11tfA;oGrE; keeps,eEm6tuna1;g03ign;liE;sh;ag2Yue2;al,i1;dImFrE;ti7;a7ini8;ne;le; up;bl0i2lBr Eux,vori1;oEreac1E;ff;aNfficie2lMmiLnJre9there4veIxE;a9cess,peGtraFuE;be2Ll0H;!va1D;ct0rt;n,ryday; Ecouragi3ti0P;rou1sui1;ne2;abo22dPe17i1;g6sE;t,ygE;oi3;er;aUeMiGoErea14ue;mina2ne,ubE;le,tfA;dact1Afficu1NsFvE;erB;creGeas0gruntl0honeDordFtE;a2ress0;er5;et; KadpJfIgene1OliGrang0spe1OtFvoE;ut;ail0ermin0;be1Lca1ghE;tfA;ia2;an;facto;i5magEngeroYs0H;ed,i3;ly;ertaQhief,ivil,oGrE;aEowd0u0G;mp0v01z0;loMmKnFoi3rrEve0O;e9u1H;cre1grHsGtE;emEra0E;po0C;ta2;ue2;mer07pleE;te,x;ni4ss4;in;aOeKizarJlIoFrE;and new,isk,okO;gFna fiVttom,urgeoE;is;us;ank,iH;re;autifAhiFlov0nEst,yoF;eUt;nd;ul;ckFnkru0WrrE;en;!wards; priori,b0Mc0Jd09fraCg04h03lYma05ntiquXpTrNsLttracti06utheKvHwE;aFkE;wa0T;ke,re;ant garFerE;age;de;ntU;leep,tonisE;hi3;ab,bitHroGtiE;fiE;ci4;ga2;raE;ry;pEt;are2etiOrE;oprE;ia1;at0;arHcohFeEiLl,oof;rt;olE;ic;mi3;ead;ainDgressiFoniE;zi3;ve;st;id; LeJuIvE;aFerB;se;nc0;ed;lt;pt,qE;ua1;hoc,infinitE;um;cuFtu4u1;al;ra1;erOlNoLruKsFuE;nda2;e2oFtra9;ct;lu1rbi3;ng;te;pt;aEve;rd;aze,e;ra2;nt|Comparable0:41;1:4I;2:45;3:4B;4:3X;5:2Y;a4Ob44c3Od3De35f2Rg2Fh24i1Vj1Uk1Rl1Im1Cn16o14p0Tqu0Rr0IsRtKuIvFw7y6za12;ell27ou3;aBe9hi1Yi7r6;o3y;ck0Mde,l6n1ry,se;d,y;a6i4Mt;k,ry;n1Tr6sI;m,y;a7e6ulgar;nge4rda2xi3;gue,in,st;g0n6pco3Mse4;like0ti1;aAen9hi8i7ough,r6;anqu2Qen1ue;dy,g3Ume0ny,r09;ck,n,rs2R;d42se;ll,me,rt,s6wd47;te4;aVcarUeThRiQkin0GlMmKoHpGqua1HtAu7w6;eet,ift;b7dd15per0Hr6;e,re2J;sta2Ht5;aAe9iff,r7u6;pXr1;a6ict,o3;ig3Hn0W;a1ep,rn;le,rk;e24i3Hright0;ci2Aft,l7o6re,ur;n,thi3;emn,id;a6el0ooth;ll,rt;e8i6ow,y;ck,g37m6;!y;ek,nd3F;ck,l0mp5;a6iUort,rill,y;dy,ll0Zrp;cu0Tve0Txy;ce,ed,y;d,fe,int0l1Xv16;aBe9i8o6ude;mantic,o1Ksy,u6;gh,nd;ch,pe,tzy;a6d,mo0J;dy,l;gg7ndom,p6re,w;id;ed;ai2i6;ck,et;aFhoEi1SlCoBr8u6;ny,r6;e,p5;egna2ic7o6;fou00ud;ey,k0;li06or,te1D;a6easa2;in,nt;ny;in4le;dd,f6i0ld,ranR;fi11;aAe8i7o6;b5isy,rm16sy;ce,mb5;a6w;r,t;ive,rr02;aAe8ild,o7u6;nda1Ate;ist,o1;a6ek,llY;n,s0ty;d,tuR;aCeBi9o6ucky;f0Vn7o1Eu6ve0w18y0U;d,sy;e0g;g1Uke0tt5v6;e0i3;an,wd;me,r6te;ge;e7i6;nd;en;ol0ui1P;cy,ll,n6;sBt6;e6ima8;llege2r6;es7media6;te;ti3;ecu6ta2;re;aEeBiAo8u6;ge,m6ng1R;b5id;ll6me0t;ow;gh,l0;a6f04sita2;dy,v6;en0y;nd1Hppy,r6te4;d,sh;aGenFhDiClBoofy,r6;a9e8is0o6ue1E;o6ss;vy;at,en,y;nd,y;ad,ib,ooI;a2d1;a6o6;st0;t5uiY;u1y;aIeeb5iDlat,oAr8u6;ll,n6r14;!ny;aHe6iend0;e,sh;a7r6ul;get4mG;my;erce8n6rm,t;an6e;ciC;! ;le;ir,ke,n0Fr,st,t,ulA;aAerie,mp9sse7v6xtre0Q;il;nti6;al;ty;r7s6;tern,y;ly,th0;aFeCi9r7u6;ll,mb;u6y;nk;r7vi6;ne;e,ty;a6ep,nD;d6f,r;!ly;mp,pp03rk;aHhDlAo8r7u6;dd0r0te;isp,uel;ar6ld,mmon,ol,st0ward0zy;se;e6ou1;a6vW;n,r;ar8e6il0;ap,e6;sy;mi3;gey,lm8r6;e4i3;ful;!i3;aNiLlIoEr8u6;r0sy;ly;aAi7o6;ad,wn;ef,g7llia2;nt;ht;sh,ve;ld,r7un6;cy;ed,i3;ng;a7o6ue;nd,o1;ck,nd;g,tt6;er;d,ld,w1;dy;bsu9ng8we6;so6;me;ry;rd|Adverba07by 05d01eYfShQinPjustOkinda,mMnJoEpCquite,r9s5t2up1very,w0Bye0;p,s; to,wards5;h1o0wiO;o,t6ward;en,us;everal,o0uch;!me1rt0; of;hXtimes,w07;a1e0;alS;ndomRthN;ar excellDer0oint blank; Mhaps;f3n0;ce0ly;! 0;ag00moU; courHten;ewJo0; longEt 0;onHwithstanding;aybe,eanwhiAore0;!ovB;! aboS;deed,steT;en0;ce;or2u0;l9rther0;!moH; 0ev3;examp0good,suF;le;n mas1v0;er;se;e0irect1; 1finite0;ly;ju7trop;far,n0;ow; CbroBd nauseam,gAl5ny2part,side,t 0w3;be5l0mo5wor5;arge,ea4;mo1w0;ay;re;l 1mo0one,ready,so,ways;st;b1t0;hat;ut;ain;ad;lot,posteriori|Expressiona02b01dXeVfuck,gShLlImHnGoDpBshAu7voi04w3y0;a1eLu0;ck,p;!a,hoo,y;h1ow,t0;af,f;e0oa;e,w;gh,h0;! 0h,m;huh,oh;eesh,hh,it;ff,hew,l0sst;ease,z;h1o0w,y;h,o,ps;!h;ah,ope;eh,mm;m1ol0;!s;ao,fao;a4e2i,mm,oly1urr0;ah;! mo6;e,ll0y;!o;ha0i;!ha;ah,ee,o0rr;l0odbye;ly;e0h,t cetera,ww;k,p;\'oh,a0uh;m0ng;mit,n0;!it;ah,oo,ye; 1h0rgh;!em;la|Preposition\'o,-,aKbHcGdFexcept,fEinDmidPnotwithstandiQoBpRqua,sAt6u3vi2w0;/o,hereMith0;!in,oQ;a,s-a-vis;n1p0;!on;like,til;h0ill,owards;an,r0;ough0u;!oI;ans,ince,o that;\',f0n1ut;!f;!to;or,rom;espite,own,u3;hez,irca;ar1e0oAy;low,sides,tween;ri6;\',bo7cross,ft6lo5m3propos,round,s1t0;!op;! long 0;as;id0ong0;!st;ng;er;ut|ConjunctionaEbAcuz,how8in caDno7o6p4supposing,t1vers5wh0yet;eth8ile;h0o;eref9o0;!uC;l0rovided that;us;r,therwi6; matt1r;!ev0;er;e0ut;cau1f0;ore;se;lthou1nd,s 0;far as,if;gh|DetermineraAboth,d8e5few,l3mu7neiCown,plenty,some,th2various,wh0;at0ich0;evB;at,e3is,ose;a,e0;!ast,s;a1i6l0nough,very;!se;ch;e0u;!s;!n0;!o0y;th0;er","conjugations":"t:ake,ook|:can,could,can,_|free:_,,,ing|puk:e,,,ing|ar:ise,ose,,,isen|babys:it,at|:be,was,is,am,been|:is,was,is,being|beat:_,,,ing,en|beg:in,an,,inning,un|ban:_,ned,,ning|bet:_,,,,_|bit:e,_,,ing,ten|ble:ed,d,,,d|bre:ed,d|br:ing,ought,,,ought|broadcast:_,_|buil:d,t,,,t|b:uy,ought,,,ought|cho:ose,se,,osing,sen|cost:_,_|deal:_,t,,,t|d:ie,ied,,ying|d:ig,ug,,igging,ug|dr:aw,ew,,,awn|dr:ink,ank,,,unk|dr:ive,ove,,iving,iven|:eat,ate,,eating,eaten|f:all,ell,,,allen|fe:ed,d,,,d|fe:el,lt|f:ight,ought,,,ought|f:ind,ound|fl:y,ew,,,own|bl:ow,ew,,,own|forb:id,ade|edit:_,,,ing|forg:et,ot,,eting,otten|forg:ive,ave,,iving,iven|fr:eeze,oze,,eezing,ozen|g:et,ot|g:ive,ave,,iving,iven|:go,went,goes,,gone|h:ang,ung,,,ung|ha:ve,d,s,ving,d|hear:_,d,,,d|hid:e,_,,,den|h:old,eld,,,eld|hurt:_,_,,,_|la:y,id,,,id|le:ad,d,,,d|le:ave,ft,,,ft|l:ie,ay,,ying|li:ght,t,,,t|los:e,t,,ing|ma:ke,de,,,de|mean:_,t,,,t|me:et,t,,eting,t|pa:y,id,,,id|read:_,_,,,_|r:ing,ang,,,ung|r:ise,ose,,ising,isen|r:un,an,,unning,un|sa:y,id,ys,,id|s:ee,aw,,eeing,een|s:ell,old,,,old|sh:ine,one,,,one|sho:ot,t,,,t|show:_,ed|s:ing,ang,,,ung|s:ink,ank|s:it,at|slid:e,_,,,_|sp:eak,oke,,,oken|sp:in,un,,inning,un|st:and,ood|st:eal,ole|st:ick,uck|st:ing,ung|:stream,,,,|str:ike,uck,,iking|sw:ear,ore|sw:im,am,,imming|sw:ing,ung|t:each,aught,eaches|t:ear,ore|t:ell,old|th:ink,ought|underst:and,ood|w:ake,oke|w:ear,ore|w:in,on,,inning|withdr:aw,ew|wr:ite,ote,,iting,itten|t:ie,ied,,ying|ski:_,ied|:boil,,,,|miss:_,,_|:act,,,,|compet:e,ed,,ing|:being,were,are,are|impl:y,ied,ies|ic:e,ed,,ing|develop:_,ed,,ing|wait:_,ed,,ing|aim:_,ed,,ing|spil:l,t,,,led|drop:_,ped,,ping|log:_,ged,,ging|rub:_,bed,,bing|smash:_,,es|egg:_,ed|suit:_,ed,,ing|age:_,d,s,ing|shed:_,_,s,ding|br:eak,oke|ca:tch,ught|d:o,id,oes|b:ind,ound|spread:_,_|become:_,,,,_|ben:d,,,,t|br:ake,,,,oken|burn:_,,,,ed|burst:_,,,,_|cl:ing,,,,ung|c:ome,ame,,,ome|cre:ep,,,,pt|cut:_,,,,_|dive:_,,,,d|dream:_,,,,t|fle:e,,,eing,d|fl:ing,,,,ung|got:_,,,,ten|grow:_,,,,n|hit:_,,,,_|ke:ep,,,,pt|kne:el,,,,lt|know:_,,,,n|leap:_,,,,t|len:d,,,,t|lo:ose,,,,st|prove:_,,,,n|put:_,,,,_|quit:_,,,,_|rid:e,,,,den|s:eek,,,,ought|sen:d,,,,t|set:_,,,,_|sew:_,,,,n|shake:_,,,,n|shave:_,,,,d|shut:_,,,,_|s:eat,,,,at|sla:y,,,,in|sle:ep,,,,pt|sn:eak,,,,uck|spe:ed,,,,d|spen:d,,,,t|sp:it,,,,at|split:_,,,,_|spr:ing,,,,ung|st:ink,unk,,,unk|strew:_,,,,n|sw:are,,,,orn|swe:ep,,,,pt|thrive:_,,,,d|undergo:_,,,,ne|upset:_,,,,_|w:eave,,,,oven|we:ep,,,,pt|w:ind,,,,ound|wr:ing,,,,ung","plurals":"addend|um|a,alga|e,alumna|e,alumn|us|i,appendi|x|ces,avocado|s,bacill|us|i,barracks|,beau|x,bus|es,cact|us|i,chateau|x,analys|is|es,diagnos|is|es,parenthes|is|es,prognos|is|es,synops|is|es,thes|is|es,child|ren,circus|es,clothes|,corp|us|ora,criteri|on|a,curricul|um|a,database|s,deer|,echo|es,embargo|es,epoch|s,f|oot|eet,gen|us|era,g|oose|eese,halo|s,hippopotam|us|i,ind|ex|ices,larva|e,lea|f|ves,librett|o|i,loa|f|ves,m|an|en,matri|x|ces,memorand|um|a,modul|us|i,mosquito|es,move|s,op|us|era,ov|um|a,ox|en,pe|rson|ople,phenomen|on|a,quiz|zes,radi|us|i,referend|um|a,rodeo|s,sex|es,shoe|s,sombrero|s,stomach|s,syllab|us|i,tableau|x,thie|f|ves,t|ooth|eeth,tornado|s,tuxedo|s,zero|s","patterns":{"Person":["master of #Noun","captain of the #Noun"]},"regex":{"HashTag":["^#[a-z]+"],"Gerund":["^[a-z]+n[\']$"],"PhoneNumber":["^[0-9]{3}-[0-9]{4}$","^[0-9]{3}[ -]?[0-9]{3}-[0-9]{4}$"],"Time":["^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])$","^[012]?[0-9](:[0-5][0-9])?(:[0-5][0-9])? ?(am|pm)$","^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])? ?(am|pm)?$","^[PMCE]ST$","^utc ?[+-]?[0-9]+?$","^[a-z0-9]*? o\'?clock$"],"Date":["^[0-9]{1,4}-[0-9]{1,2}-[0-9]{1,4}$","^[0-9]{1,4}/[0-9]{1,2}/[0-9]{1,4}$"],"Money":["^[-+]?[$][0-9]+(.[0-9]{1,2})?$","^[-+]?[$][0-9]{1,3}(,[0-9]{3})+(.[0-9]{1,2})?$"],"Value":["^[-+]?[$][0-9]+(.[0-9]{1,2})?$","^[-+]?[$][0-9]{1,3}(,[0-9]{3})+(.[0-9]{1,2})?$","^[0-9.]{1,2}[-][0-9]{1,2}$"],"NumberRange":["^[0-9.]{1,4}(st|nd|rd|th)?[-][0-9.]{1,4}(st|nd|rd|th)?$","^[0-9.]{1,2}[-][0-9]{1,2}$"],"NiceNumber":["^[-+]?[0-9.,]{1,3}(,[0-9.,]{3})+(.[0-9]+)?$"],"NumericValue":["^[-+]?[0-9]+(.[0-9]+)?$","^.?[0-9]+([0-9,.]+)?%$"],"Percent":["^.?[0-9]+([0-9,.]+)?%$"],"Cardinal":["^.?[0-9]+([0-9,.]+)?%$"],"Fraction":["^[0-9]{1,4}/[0-9]{1,4}$"],"LastName":["^ma?c\'.*","^o\'[drlkn].*"]}}'},{}],209:[function(t,e,r){"use strict";var o=t("../subset/verbs/methods/conjugate/faster.js");e.exports=function(a){var i=this;return Object.keys(a).forEach(function(r){i.conjugations[r]=i.conjugations[r]||{},i.words[r]=i.words[r]||"Infinitive",Object.keys(a[r]).forEach(function(t){var e=a[r][t];i.conjugations[r][t]=e,i.words[e]=i.words[e]||t,i.cache.toInfinitive[a[r][t]]=r});var n=o(r,i);Object.keys(n).forEach(function(t){var e=n[t];!1===i.words.hasOwnProperty(e)&amp;&amp;(i.words[e]=t)})}),a}},{"../subset/verbs/methods/conjugate/faster.js":79}],210:[function(t,e,r){"use strict";e.exports=function(e){var r=this;return Object.keys(e).forEach(function(t){r.patterns[t]=e[t]}),e}},{}],211:[function(t,e,r){"use strict";e.exports=function(r){var n=this;return Object.keys(r).forEach(function(t){var e=r[t];n.plurals[t]=e,n.words[e]=n.words[e]||"Plural",n.words[t]=n.words[t]||"Singular",n.cache.toSingular[e]=t}),r}},{}],212:[function(t,e,r){"use strict";e.exports=function(e){var r=this;Object.keys(e).forEach(function(t){r.regex.push({reg:new RegExp(t,"i"),tag:e[t]})})}},{}],213:[function(t,e,r){"use strict";var a=t("../tags/addDownward");e.exports=function(r){var n=this;return Object.keys(r).forEach(function(t){var e=r[t];e.notA=e.notA||[],e.downward=e.downward||[],n.tags[t]=e}),a(this.tags),r}},{"../tags/addDownward":135}],214:[function(t,e,r){"use strict";var h=t("../term/methods/normalize/normalize").normalize,f=t("../subset/nouns/methods/pluralize"),m=t("../subset/verbs/methods/conjugate/faster.js"),d=t("../subset/adjectives/methods"),p=/ /;e.exports=function(l){var c=this;return Object.keys(l).forEach(function(t){var e=l[t];if(t=h(t).replace(/\s+/," ").replace(/[.\?,;\!]/g,""),c.words[t]=e,!0===p.test(t)){var r=t.split(p);c.cache.firstWords[r[0]]=!0}if("Singular"!==e)if("Infinitive"!==e)if("PhrasalVerb"!==e){if("Comparable"===e){var n=d.toComparative(t);n&amp;&amp;t!==n&amp;&amp;(c.words[n]="Comparative");var a=d.toSuperlative(t);a&amp;&amp;t!==a&amp;&amp;(c.words[a]="Superlative")}}else{var i=t.split(/ /),o=m(i[0],c);Object.keys(o).forEach(function(t){var e=o[t]+" "+i[1];c.words[e]="PhrasalVerb",c.cache.firstWords[o[t]]=!0})}else{var s=m(t,c);Object.keys(s).forEach(function(t){c.words[s[t]]=t})}else{var u=f(t,{});u&amp;&amp;u!==t&amp;&amp;(c.words[u]="Plural")}}),l}},{"../subset/adjectives/methods":11,"../subset/nouns/methods/pluralize":44,"../subset/verbs/methods/conjugate/faster.js":79,"../term/methods/normalize/normalize":149}],215:[function(t,e,r){"use strict";var n=t("../fns"),a=t("./_data"),i=t("./more-data"),o=t("../tags"),s=t("./unpack"),u=t("./addTags"),l=t("./addWords"),c=t("./addRegex"),h=t("./addConjugations"),f=t("./addPatterns"),m=t("./addPlurals"),d=t("./more-data/misc"),p=function(t,e){for(var r=Object.keys(e),n=0;n&lt;r.length;n++)t[r[n]]=e[r[n]];return t},g=function(){this.words={},this.tags=o,this.regex=[],this.patterns={},this.conjugations={},this.plurals={},this.cache={firstWords:{},toInfinitive:{},toSingular:{}}};g.prototype.addTags=u,g.prototype.addWords=l,g.prototype.addRegex=c,g.prototype.addConjugations=h,g.prototype.addPlurals=m,g.prototype.addPatterns=f,g.prototype.clone=function(){var e=this,r=new g;return["words","firstWords","tagset","regex","patterns","conjugations","plurals"].forEach(function(t){e[t]&amp;&amp;(r[t]=n.copy(e[t]))}),r},g.prototype.plugin=function(t){(t=s(t)).tags&amp;&amp;this.addTags(t.tags),t.regex&amp;&amp;this.addRegex(t.regex),t.patterns&amp;&amp;this.addPatterns(t.patterns),t.conjugations&amp;&amp;this.addConjugations(t.conjugations),t.plurals&amp;&amp;this.addPlurals(t.plurals),t.words&amp;&amp;this.addWords(t.words)};var v=new g;v.plugin(a),v.addWords(d),i.forEach(function(t){p(v.words,t)}),e.exports={w:v,reBuild:function(){var e=new g;return e.plugin(a),e.addWords(d),i.forEach(function(t){p(e.words,t)}),e}}},{"../fns":3,"../tags":137,"./_data":208,"./addConjugations":209,"./addPatterns":210,"./addPlurals":211,"./addRegex":212,"./addTags":213,"./addWords":214,"./more-data":217,"./more-data/misc":219,"./unpack":223}],216:[function(t,e,r){"use strict";for(var n={Noun:["arc","al","exp","fy","pd","pl","plz","tce","bl","ma","ba","lit","ex","eg","ie","ca","cca","vs","etc","esp","ft","bc","ad","md","corp","col"],Organization:["dept","univ","assn","bros","inc","ltd","co","yahoo","joomla","jeopardy"],Place:["rd","st","dist","mt","ave","blvd","cl","ct","cres","hwy","ariz","cal","calif","colo","conn","fla","fl","ga","ida","ia","kan","kans","minn","neb","nebr","okla","penna","penn","pa","dak","tenn","tex","ut","vt","va","wis","wisc","wy","wyo","usafa","alta","ont","que","sask"],Month:["jan","feb","mar","apr","jun","jul","aug","sep","sept","oct","nov","dec"],Date:["circa"],Honorific:["adj","adm","adv","asst","atty","bldg","brig","capt","cmdr","comdr","cpl","det","dr","esq","gen","gov","hon","jr","llb","lt","maj","messrs","mister","mlle","mme","mr","mrs","ms","mstr","op","ord","phd","prof","pvt","rep","reps","res","rev","sen","sens","sfc","sgt","sir","sr","supt","surg"],Value:["no"]},a={},i=Object.keys(n),o=0;o&lt;i.length;o++)for(var s=n[i[o]],u=0;u&lt;s.length;u++)a[s[u]]=[i[o],"Abbreviation"];e.exports=a},{}],217:[function(t,e,r){"use strict";e.exports=[t("./abbreviations"),t("./irregularAdjectives").lexicon,t("./numbers").lexicon,t("./orgWords")]},{"./abbreviations":216,"./irregularAdjectives":218,"./numbers":220,"./orgWords":221}],218:[function(t,e,r){"use strict";var n={bad:"badly",best:"best",early:"early",fast:"fast",good:"well",hard:"hard",icy:"icily",idle:"idly",late:"late",latter:"latter",little:"little",long:"long",low:"low",male:"manly",public:"publicly",simple:"simply",single:"singly",special:"especially",straight:"straight",vague:"vaguely",well:"well",whole:"wholly",wrong:"wrong"},a={grey:"greyer",gray:"grayer",green:"greener",yellow:"yellower",red:"redder",good:"better",well:"better",bad:"worse",sad:"sadder",big:"bigger"},i={nice:"nicest",late:"latest",hard:"hardest",inner:"innermost",outer:"outermost",far:"furthest",worse:"worst",bad:"worst",good:"best",big:"biggest",large:"largest"},o=function(t,e,r){for(var n=Object.keys(e),a=0;a&lt;n.length;a++)t[n[a]]="Comparable",void 0===t[e[n[a]]]&amp;&amp;(t[e[n[a]]]=r);return t},s=o({},i,"Superlative");s=o(s=o(s,a,"Comparative"),n,"Adverb"),e.exports={lexicon:s,toAdverb:n,toComparative:a,toSuperlative:i}},{}],219:[function(t,e,r){"use strict";e.exports={"20th century fox":"Organization","3m":"Organization","7 eleven":"Organization","7-eleven":"Organization",g8:"Organization","motel 6":"Organization",vh1:"Organization",q1:"Date",q2:"Date",q3:"Date",q4:"Date",records:"Plural","&amp;":"Conjunction"}},{}],220:[function(t,e,r){"use strict";var a={ones:{zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9},teens:{ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19},tens:{twenty:20,thirty:30,forty:40,fourty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90},multiples:{hundred:100,thousand:1e3,million:1e6,billion:1e9,trillion:1e12,quadrillion:1e15,quintillion:1e18,sextillion:1e21,septillion:1e24}},i={ones:{zeroth:0,first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9},teens:{tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19},tens:{twentieth:20,thirtieth:30,fortieth:40,fourtieth:40,fiftieth:50,sixtieth:60,seventieth:70,eightieth:80,ninetieth:90},multiples:{hundredth:100,thousandth:1e3,millionth:1e6,billionth:1e9,trillionth:1e12,quadrillionth:1e15,quintillionth:1e18,sextillionth:1e21,septillionth:1e24}},o={},s={},u={};Object.keys(i).forEach(function(t){for(var e=Object.keys(i[t]),r=Object.keys(a[t]),n=0;n&lt;r.length;n++)o[r[n]]=e[n],s[e[n]]=r[n],u[e[n]]=["Ordinal","TextValue"],u[r[n]]=["Cardinal","TextValue"],"multiples"===t&amp;&amp;(u[e[n]].push("Multiple"),u[r[n]].push("Multiple"))}),e.exports={toOrdinal:o,toCardinal:s,cardinal:a,ordinal:i,prefixes:{yotta:1,zetta:1,exa:1,peta:1,tera:1,giga:1,mega:1,kilo:1,hecto:1,deka:1,deci:1,centi:1,milli:1,micro:1,nano:1,pico:1,femto:1,atto:1,zepto:1,yocto:1,square:1,cubic:1,quartic:1},lexicon:u}},{}],221:[function(t,e,r){"use strict";e.exports=["administration","agence","agences","agencies","agency","airlines","airways","army","assoc","associates","association","assurance","authority","autorite","aviation","bank","banque","board","boys","brands","brewery","brotherhood","brothers","building society","bureau","cafe","caisse","capital","care","cathedral","center","central bank","centre","chemicals","choir","chronicle","church","circus","clinic","clinique","club","co","coalition","coffee","collective","college","commission","committee","communications","community","company","comprehensive","computers","confederation","conference","conseil","consulting","containers","corporation","corps","corp","council","crew","daily news","data","departement","department","department store","departments","design","development","directorate","division","drilling","education","eglise","electric","electricity","energy","ensemble","enterprise","enterprises","entertainment","estate","etat","evening news","faculty","federation","financial","fm","foundation","fund","gas","gazette","girls","government","group","guild","health authority","herald","holdings","hospital","hotel","hotels","inc","industries","institut","institute","institute of technology","institutes","insurance","international","interstate","investment","investments","investors","journal","laboratory","labs","liberation army","limited","local authority","local health authority","machines","magazine","management","marine","marketing","markets","media","memorial","mercantile exchange","ministere","ministry","military","mobile","motor","motors","musee","museum","news","news service","observatory","office","oil","optical","orchestra","organization","partners","partnership","people's party","petrol","petroleum","pharmacare","pharmaceutical","pharmaceuticals","pizza","plc","police","polytechnic","post","power","press","productions","quartet","radio","regional authority","regional health authority","reserve","resources","restaurant","restaurants","savings","school","securities","service","services","social club","societe","society","sons","standard","state police","state university","stock exchange","subcommittee","syndicat","systems","telecommunications","telegraph","television","times","tribunal","tv","union","university","utilities","workers"].reduce(function(t,e){return t[e]="Noun",t},{})},{}],222:[function(t,e,r){"use strict";var u=[null,"PastTense","PresentTense","Gerund","Participle"];e.exports=function(t){return t.split("|").reduce(function(t,e){var r=e.split(":"),n=r[0],a=r[1].split(","),i=n+a[0];"_"===a[0]&amp;&amp;(i=n),t[i]={};for(var o=1;o&lt;u.length;o++){var s=r[0]+a[o];"_"===a[o]&amp;&amp;(s=r[0]),a[o]&amp;&amp;(t[i][u[o]]=s)}return t},{})}},{}],223:[function(t,e,r){"use strict";var n={words:t("efrt-unpack"),plurals:t("./plurals"),conjugations:t("./conjugations"),keyValue:t("./key-value")};e.exports=function(t){var e=t;return"string"==typeof t&amp;&amp;(e=JSON.parse(t)),e.words&amp;&amp;"string"==typeof e.words&amp;&amp;(e.words=n.words(e.words)),e.patterns&amp;&amp;(e.patterns=n.keyValue(e.patterns)),e.regex&amp;&amp;(e.regex=n.keyValue(e.regex)),e.plurals&amp;&amp;"string"==typeof e.plurals&amp;&amp;(e.plurals=n.plurals(e.plurals)),e.conjugations&amp;&amp;"string"==typeof e.conjugations&amp;&amp;(e.conjugations=n.conjugations(e.conjugations)),e}},{"./conjugations":222,"./key-value":224,"./plurals":225,"efrt-unpack":1}],224:[function(t,e,r){"use strict";e.exports=function(t){var e=Object.keys(t),n=!0;return e[0]&amp;&amp;"string"==typeof t[e[0]]&amp;&amp;(n=!1),e.reduce(function(e,r){return!0===n?t[r].forEach(function(t){e[t]?("string"==typeof e[t]&amp;&amp;(e[t]=[e[t]]),e[t].push(r)):e[t]=r}):e[r]=t[r],e},{})}},{}],225:[function(t,e,r){"use strict";e.exports=function(t){return t.split(/,/g).reduce(function(t,e){var r=e.split(/\|/g);return 3===r.length?t[r[0]+r[1]]=r[0]+r[2]:2===r.length?t[r[0]]=r[0]+r[1]:t[r[0]]=r[0],t},{})}},{}]},{},[4])(4)});</td></tr><tr><td class="line-number" value="530"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="531"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="532"></td><td class="line-content">    window.__nlpCompromise = window.nlp;</td></tr><tr><td class="line-number" value="533"></td><td class="line-content">    delete window.nlp;</td></tr><tr><td class="line-number" value="534"></td><td class="line-content">  <span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="535"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="536"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="537"></td><td class="line-content">//by Eamon Nerbonne (from http://home.nerbonne.org/A-vs-An), Apache 2.0 license</td></tr><tr><td class="line-number" value="538"></td><td class="line-content">var __AvsAnSimple = (function (root) {</td></tr><tr><td class="line-number" value="539"></td><td class="line-content">	var dict = "2h.#2.a;i;&amp;1.N;*4.a;e;i;o;/9.a;e;h1.o.i;l1./;n1.o.o;r1.e.s1./;01.8;12.1a;01.0;12.8;9;2.31.7;4.5.6.7.8.9.8a;0a.0;1;2;3;4;5;6;7;8;9;11; .22; ..31; .42; ..55; .,.h.k.m.62; .k.72; ..82; .,.92; ..8;&lt;2.m1.d;o;=1.=1.E;@;A6;A1;A1.S;i1;r1;o.m1;a1;r1; .n1;d1;a1;l1;u1;c1.i1.a1.n;s1;t1;u1;r1;i1;a1;s.t1;h1;l1;e1;t1;e1.s;B2.h2.a1.i1;r1;a.;o1.r1.d1. ;C3.a1.i1.s1.s.h4.a2.i1.s1;e.o1.i;l1.;r1.o1.;u2.i;r1.r1.a;o1.n1.g1.j;D7.a1.o1.q;i2.n1.a1.s;o1.t;u1.a1.l1.c;1. ;;;;E7;U1;R.b1;o1;l1;i.m1;p1;e1;z.n1;a1;m.s1;p5.a1.c;e;h;o;r;u1.l1;o.w1;i.F11. ;,;.;/;0;1;2;3;4;5;6;71.0.8;9;Ae;B.C.D.F.I2.L.R.K.L.M.N.P.Q.R.S.T.B;C1;M.D;E2.C;I;F1;r.H;I3.A1;T.R1. ;U;J;L3.C;N;P;M;O1. ;P1;..R2.A1. ;S;S;T1;S.U2.,;.;X;Y1;V.c;f1.o.h;;G7.e1.r1.n1.e;h1.a3.e;i;o;i1.a1.n1.g;o2.f1. ;t1.t1. ;r1.i1.a;w1.a1.r1.r;;Hs. ;&amp;;,;.2;A.I.1;2;3;5;7;B1;P.C;D;F;G;H1;I.I6;C.G.N.P.S1.D;T.K1.9;L;M1;..N;O2. ;V;P;R1;T.S1.F.T;V;e2.i1.r;r1.r1.n;o2.n6;d.e1.s;g.k.o2;l.r1;i1.f;v.u1.r;I3;I2;*.I.n1;d1;e1;p1;e1;n1;d2;e1;n1;c1;i..s1;l1;a1;n1;d1;s.J1.i1.a1.o;Ly. ;,;.;1;2;3;4;8;A3. ;P;X;B;C;D;E2. ;D;F1;T.G;H1.D.I1.R;L;M;N;P;R;S1;m.T;U1. ;V1;C.W1.T;Z;^;a1.o1.i1.g;o1.c1.h1.a1;b.p;u1.s1.h1;o.;M15. ;&amp;;,;.1;A1;.1;S./;1;2;3;4;5;6;7;8;Ai;B.C.D.F.G.J.L.M.N.P.R.S.T.V.W.X.Y.Z.B1;S1;T.C;D;E3.P1;S.W;n;F;G;H;I4. ;5;6;T1;M.K;L;M;N;O1.U;P;Q;R;S;T1;R.U2. ;V;V;X;b1.u1.m;f;h;o2.D1.e.U1;..p1.3;s1.c;Ny. ;+;.1.E.4;7;8;:;A3.A1;F.I;S1.L;B;C;D;E3.A;H;S1. ;F1;U.G;H;I7.C.D1. ;K.L.N.O.S.K;L;M1;M.N2.R;T;P1.O1.V1./1.B;R2;J.T.S1;W.T1;L1.D.U1.S;V;W2.A;O1.H;X;Y3.C1.L;P;U;a1.s1.a1.n;t1.h;v;;;O5;N1;E.l1;v.n2;c1.e.e1.i;o1;p.u1;i.P1.h2.i1.a;o2.b2;i.o.i;Q1.i1.n1.g1.x;Rz. ;&amp;;,;.1;J./;1;4;6;A3. ;.;F1;T.B1;R.C;D;E3. ;S1.P;U;F;G;H1.S;I2.A;C1. ;J;K;L1;P.M5;1.2.3.5.6.N;O2.H;T2;A.O.P;Q;R1;F.S4;,...?.T.T;U4;B.M.N.S.V;X;c;f1;M1...h2.A;B;;S11. ;&amp;;,;.4.E;M;O;T1..3.B;D;M;1;3;4;5;6;8;9;A3. ;8;S2;E.I.B;C3.A1. ;R2.A.U.T;D;E6. ;5;C3;A.O.R.I1.F.O;U;F3;&amp;.H.O1.S.G1;D.H3.2;3;L;I2. ;S1.O.K2.I.Y.L3;A2. ;.;I1. ;O.M3;A1. ;I.U1.R.N5.A.C3.A.B.C.E.F.O.O5. ;A1.I;E;S1;U.V;P7;A7;A.C.D.M.N.R.S.E1. ;I4;C.D.N.R.L1;O.O.U.Y.Q1. ;R;S1;W.T9.A1. ;C;D;F;I;L;M;S;V;U7.B.L.M.N.P.R.S.V;W1.R;X1.M;h1.i1.g1.a1.o;p1.i1.o1;n.t2.B;i1.c1.i;T4.a2.i2.g1.a.s1.c;v1.e1.s;e1.a1.m1.p;u1.i2.l;r;;Um..1.N1..1.C;/1.1;11. .21.1;L1.T;M1.N;N4.C1.L;D2. .P.K;R1. .a;b2;a.i.d;g1.l;i1.g.l2;i.y.m;no. ;a1.n.b;c;d;e1;s.f;g;h;i2.d;n;j;k;l;m;n;o;p;q;r;s;t;u;v;w;p;r3;a.e.u1.k;s3. ;h;t1;r.t4.h;n;r;t;x;z;;W2.P1.:4.A1.F;I2.B;N1.H.O1.V;R1.F1.C2.N.U.i1.k1.i1.E1.l1.i;X7;a.e.h.i.o.u.y.Y3.e1.t1.h;p;s;[5.A;E;I;a;e;_2._1.i;e;`3.a;e;i;a7; .m1;a1;r1. .n1;d2; ..p1;r1;t.r1;t1;.u1;s1;s1;i1. .v1;u1;t.d3.a1.s1. ;e2.m1. ;r1. ;i2.c1.h1. ;e1.s1.e2.m;r;e8;c1;o1;n1;o1;m1;i1;a.e1;w.l1;i1;t1;e1;i.m1;p1;e1;z.n1;t1;e1;n1;d.s2;a1. .t4;a1; .e1; .i1;m1;a1;r.r1;u1.t.u1.p1. ;w.f3. ;M;y1.i;h9. ;,;.;C;a1.u1.t1;b.e2.i1.r1;a.r1.m1.a1.n;o4.m2.a1; .m;n8; .b.d.e3; .d.y.g.i.k.v.r1.s1. ;u1.r;r1. ;t1;t1;p1;:.i6;b1;n.e1;r.n2;f2;l1;u1;.o1;a.s1;t1;a1;l1;a.r1; .s1; .u.k1.u1. ;l3.c1.d;s1. ;v1.a;ma. ;,;R;b1.a.e1.i1.n;f;p;t1.a.u1.l1.t1.i1.c1.a1.m1.p1.i;;n6. ;V;W;d1; .t;;o8;c2;h1;o.u1;p.d1;d1;y.f1; .g1;g1;i.no. ;';,;/;a;b;c1.o;d;e2.i;r;f;g;i;l;m;n;o;r;s;t;u;w;y;z;;r1;i1;g1;e.t1;r1.s;u1;i.r3. ;&amp;;f;s9.,;?;R;f2.e.o.i1.c1.h;l1. ;p2.3;i1. ;r1.g;v3.a.e.i.t2.A;S;uc; ...b2.e;l;f.k2.a;i;m1;a1. .n3;a3; .n5.a;c;n;s;t;r1;y.e2; .i.i8.c2.o1.r1.p;u1.m;d1;i1.o;g1.n;l1.l;m1;o.n;s1.s;v1.o1;c.r5;a.e.i.l.o.s3. ;h;u1.r2;e.p3;a.e.i.t2.m;t;v.w1.a;xb. ;';,;.;8;b;k;l;m1;a.t;y1. ;y1.l;{1.a;|1.a;1.8;;;;;;;;;;;;;;;1;t3.a;o;u;;;1; .;;;;;;;;;;;;;2.e;i;;";</td></tr><tr><td class="line-number" value="540"></td><td class="line-content">	function fill(node) {</td></tr><tr><td class="line-number" value="541"></td><td class="line-content">		var kidCount = parseInt(dict, 36) || 0,</td></tr><tr><td class="line-number" value="542"></td><td class="line-content">			offset = kidCount &amp;&amp; kidCount.toString(36).length;</td></tr><tr><td class="line-number" value="543"></td><td class="line-content">		node.article = dict[offset] == "." ? "a" : "an";</td></tr><tr><td class="line-number" value="544"></td><td class="line-content">		dict = dict.substr(1 + offset);</td></tr><tr><td class="line-number" value="545"></td><td class="line-content">		for (var i = 0; i &lt; kidCount; i++) {</td></tr><tr><td class="line-number" value="546"></td><td class="line-content">			var kid = node[dict[0]] = {}</td></tr><tr><td class="line-number" value="547"></td><td class="line-content">			dict = dict.substr(1);</td></tr><tr><td class="line-number" value="548"></td><td class="line-content">			fill(kid);</td></tr><tr><td class="line-number" value="549"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="550"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="551"></td><td class="line-content">	fill(root);</td></tr><tr><td class="line-number" value="552"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="553"></td><td class="line-content">	return {</td></tr><tr><td class="line-number" value="554"></td><td class="line-content">		raw: root,</td></tr><tr><td class="line-number" value="555"></td><td class="line-content">		//Usage example: AvsAnSimple.query("example") </td></tr><tr><td class="line-number" value="556"></td><td class="line-content">		//example returns: "an"</td></tr><tr><td class="line-number" value="557"></td><td class="line-content">		query: function (word) {</td></tr><tr><td class="line-number" value="558"></td><td class="line-content">			var node = root, sI = 0, result, c;</td></tr><tr><td class="line-number" value="559"></td><td class="line-content">			do {</td></tr><tr><td class="line-number" value="560"></td><td class="line-content">				c = word[sI++];</td></tr><tr><td class="line-number" value="561"></td><td class="line-content">			} while ('"$\''.indexOf(c) &gt;= 0);//also terminates on end-of-string "undefined".</td></tr><tr><td class="line-number" value="562"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="563"></td><td class="line-content">			while (1) {</td></tr><tr><td class="line-number" value="564"></td><td class="line-content">				result = node.article || result;</td></tr><tr><td class="line-number" value="565"></td><td class="line-content">				node = node[c];</td></tr><tr><td class="line-number" value="566"></td><td class="line-content">				if (!node) return result;</td></tr><tr><td class="line-number" value="567"></td><td class="line-content">				c = word[sI++] || " ";</td></tr><tr><td class="line-number" value="568"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="569"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="570"></td><td class="line-content">	};</td></tr><tr><td class="line-number" value="571"></td><td class="line-content">})({});</td></tr><tr><td class="line-number" value="572"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="573"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="574"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="575"></td><td class="line-content">  <span class="html-comment">&lt;!-- &lt;script src="lib/axios-0.15.3.min.js"&gt;&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="576"></td><td class="line-content"><span class="html-comment">  &lt;script src="lib/cloner.max.js"&gt;&lt;/script&gt; --&gt;</span></td></tr><tr><td class="line-number" value="577"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="578"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="579"></td><td class="line-content">let textTransformNames = [];</td></tr><tr><td class="line-number" value="580"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="581"></td><td class="line-content">function __addNodeMethods(node) {</td></tr><tr><td class="line-number" value="582"></td><td class="line-content">  // NOTE: Object.defineProperty is used so that these properties aren't enumerable, since only child items should be enumerable.</td></tr><tr><td class="line-number" value="583"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="584"></td><td class="line-content">  // REMEMBER TO UPDATE stringAndNumberModifications and arrayModifications if you add more methods</td></tr><tr><td class="line-number" value="585"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="586"></td><td class="line-content">  Object.defineProperty(node, "$odds", {get:__$oddsMethod, configurable:true});</td></tr><tr><td class="line-number" value="587"></td><td class="line-content">  Object.defineProperty(node, "getOdds", {get:__$oddsMethod, configurable:true});</td></tr><tr><td class="line-number" value="588"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="589"></td><td class="line-content">  Object.defineProperty(node, "getName", {get:function() { return this.$text; }, configurable:true});</td></tr><tr><td class="line-number" value="590"></td><td class="line-content">  Object.defineProperty(node, "getParent", {get:function() { return this.$parent; }, configurable:true});</td></tr><tr><td class="line-number" value="591"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="592"></td><td class="line-content">  // This is incorrect because it counts properties that have been added by the user at runtime with code like `list.foo = 10`</td></tr><tr><td class="line-number" value="593"></td><td class="line-content">  // Object.defineProperty(node, "getLength", {get:function() { return Object.keys(this).length; }, configurable:true});</td></tr><tr><td class="line-number" value="594"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="595"></td><td class="line-content">  Object.defineProperty(node, "getLength", {get:function() { return this.$children.length; }, configurable:true});</td></tr><tr><td class="line-number" value="596"></td><td class="line-content">  Object.defineProperty(node, "getRawListText", {get:function() { return this.$perchanceCode; }, configurable:true});</td></tr><tr><td class="line-number" value="597"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="598"></td><td class="line-content">  // Workaround for the problem of a node not being resolved (mainly for use in functions) (I put this in the execution properties of the proxy)</td></tr><tr><td class="line-number" value="599"></td><td class="line-content">  Object.defineProperty(node, "getSelf", {get:function() { return this; }, configurable:true});</td></tr><tr><td class="line-number" value="600"></td><td class="line-content">  Object.defineProperty(node, "getPropertyKeys", {get:function() { return this.$valueChildren.slice(0); }, configurable:true}); // deprecated, but staying for backwards-compat. use getPropertyNames instead</td></tr><tr><td class="line-number" value="601"></td><td class="line-content">  Object.defineProperty(node, "getPropertyNames", {get:function() { return this.$valueChildren.slice(0); }, configurable:true});</td></tr><tr><td class="line-number" value="602"></td><td class="line-content">  Object.defineProperty(node, "getChildNames", {get:function() { return this.$children.slice(0); }, configurable:true});</td></tr><tr><td class="line-number" value="603"></td><td class="line-content">  Object.defineProperty(node, "getFunctionNames", {get:function() { return this.$functionChildren.slice(0); }, configurable:true});</td></tr><tr><td class="line-number" value="604"></td><td class="line-content">  Object.defineProperty(node, "getAllKeys", {get:function() { return this.$allKeys.slice(0); }, configurable:true});</td></tr><tr><td class="line-number" value="605"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="606"></td><td class="line-content">  // Object.defineProperty(node, "isConsumable", {value:false, writable:true, configurable:true})</td></tr><tr><td class="line-number" value="607"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="608"></td><td class="line-content">  Object.defineProperty(node, "toString", {value:__toStringMethod, configurable:true});</td></tr><tr><td class="line-number" value="609"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="610"></td><td class="line-content">  // we need this otherwise if they have:</td></tr><tr><td class="line-number" value="611"></td><td class="line-content">  //   num = {1-1000}</td></tr><tr><td class="line-number" value="612"></td><td class="line-content">  // and they type [num.toLocaleString()], the JS engine calls toString on the object (since that's the default thing to do with objects, I guess), which results in a string.</td></tr><tr><td class="line-number" value="613"></td><td class="line-content">  Object.defineProperty(node, "toLocaleString", {value:function(...args) {</td></tr><tr><td class="line-number" value="614"></td><td class="line-content">    let result = String(this.toString()); // String()-ing because apparently toString can return a number?? no time to look into it right now</td></tr><tr><td class="line-number" value="615"></td><td class="line-content">    if(String(Number(result)) === result) { </td></tr><tr><td class="line-number" value="616"></td><td class="line-content">      result = Number(result);</td></tr><tr><td class="line-number" value="617"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="618"></td><td class="line-content">    return result.toLocaleString(...args);</td></tr><tr><td class="line-number" value="619"></td><td class="line-content">  }, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="620"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="621"></td><td class="line-content">  Object.defineProperty(node, "evaluateItem", {get:function() {</td></tr><tr><td class="line-number" value="622"></td><td class="line-content">    return this.valueOf();</td></tr><tr><td class="line-number" value="623"></td><td class="line-content">  }, configurable:true});</td></tr><tr><td class="line-number" value="624"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="625"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="626"></td><td class="line-content">  // TODO: add a setter method for $odds which changes the node data? wait, shouldn't $odds just return the string? or not?</td></tr><tr><td class="line-number" value="627"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="628"></td><td class="line-content">  // TODO: these need fixing (see funciton declaration for notes)</td></tr><tr><td class="line-number" value="629"></td><td class="line-content">  // Object.defineProperty(node, "$addChild", {get:$addChildMethod});</td></tr><tr><td class="line-number" value="630"></td><td class="line-content">  // Object.defineProperty(node, "$removeChild", {get:$removeChildMethod});</td></tr><tr><td class="line-number" value="631"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="632"></td><td class="line-content">  Object.defineProperty(node, "selectOne", {get:__selectOneMethod, configurable:true});</td></tr><tr><td class="line-number" value="633"></td><td class="line-content">  Object.defineProperty(node, "selectAll", {get:__selectAllMethod, configurable:true});</td></tr><tr><td class="line-number" value="634"></td><td class="line-content">  Object.defineProperty(node, "selectMany", {value:__selectManyMethod, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="635"></td><td class="line-content">  Object.defineProperty(node, "selectUnique", {value:__selectUniqueMethod, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="636"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="637"></td><td class="line-content">  Object.defineProperty(node, "joinItems", {value:__joinItemsMethod, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="638"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="639"></td><td class="line-content">  Object.defineProperty(node, "sumItems", {get:function() {</td></tr><tr><td class="line-number" value="640"></td><td class="line-content">    return this.selectAll.reduce((a, v) =&gt; a+v.evaluateItem, 0);</td></tr><tr><td class="line-number" value="641"></td><td class="line-content">  }, configurable:true});</td></tr><tr><td class="line-number" value="642"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="643"></td><td class="line-content">  Object.defineProperty(node, "valueOf", {value:__valueOfMethod, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="644"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="645"></td><td class="line-content">  //Object.defineProperty(node, "shuffleItems", {value:shuffleMethod, configurable:true});</td></tr><tr><td class="line-number" value="646"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="647"></td><td class="line-content">  // TEXT TRANSFORMS:</td></tr><tr><td class="line-number" value="648"></td><td class="line-content">  Object.defineProperty(node, "pluralForm", {get:__pluralFormMethod, configurable:true});</td></tr><tr><td class="line-number" value="649"></td><td class="line-content">  Object.defineProperty(node, "singularForm", {get:__singularFormMethod, configurable:true});</td></tr><tr><td class="line-number" value="650"></td><td class="line-content">  Object.defineProperty(node, "pastTense", {get:__pastTenseMethod, configurable:true});</td></tr><tr><td class="line-number" value="651"></td><td class="line-content">  Object.defineProperty(node, "presentTense", {get:__presentTenseMethod, configurable:true});</td></tr><tr><td class="line-number" value="652"></td><td class="line-content">  Object.defineProperty(node, "futureTense", {get:__futureTenseMethod, configurable:true});</td></tr><tr><td class="line-number" value="653"></td><td class="line-content">  Object.defineProperty(node, "negativeForm", {get:__negativeFormMethod, configurable:true});</td></tr><tr><td class="line-number" value="654"></td><td class="line-content">  // TODO**: should have seperate "soft" versions of sentence and title case which DON'T call toLowerCase on the whole string first? (i.e. to leave current capitalisations there)</td></tr><tr><td class="line-number" value="655"></td><td class="line-content">  Object.defineProperty(node, "sentenceCase", {get:__sentenceCaseMethod, configurable:true});</td></tr><tr><td class="line-number" value="656"></td><td class="line-content">  Object.defineProperty(node, "titleCase", {get:__titleCaseMethod, configurable:true});</td></tr><tr><td class="line-number" value="657"></td><td class="line-content">  Object.defineProperty(node, "lowerCase", {get:__lowerCaseMethod, configurable:true});</td></tr><tr><td class="line-number" value="658"></td><td class="line-content">  Object.defineProperty(node, "upperCase", {get:__upperCaseMethod, configurable:true});</td></tr><tr><td class="line-number" value="659"></td><td class="line-content">  Object.defineProperty(node, "replaceText", {value:__replaceTextMethod, configurable:true});</td></tr><tr><td class="line-number" value="660"></td><td class="line-content">  // REMEMBER: add text transform names here if you add new ones:</td></tr><tr><td class="line-number" value="661"></td><td class="line-content">  if(textTransformNames.length === 0) {</td></tr><tr><td class="line-number" value="662"></td><td class="line-content">    textTransformNames.push("pluralForm");</td></tr><tr><td class="line-number" value="663"></td><td class="line-content">    textTransformNames.push("singularForm");</td></tr><tr><td class="line-number" value="664"></td><td class="line-content">    textTransformNames.push("pastTense");</td></tr><tr><td class="line-number" value="665"></td><td class="line-content">    textTransformNames.push("presentTense");</td></tr><tr><td class="line-number" value="666"></td><td class="line-content">    textTransformNames.push("futureTense");</td></tr><tr><td class="line-number" value="667"></td><td class="line-content">    textTransformNames.push("negativeForm");</td></tr><tr><td class="line-number" value="668"></td><td class="line-content">    textTransformNames.push("sentenceCase");</td></tr><tr><td class="line-number" value="669"></td><td class="line-content">    textTransformNames.push("titleCase");</td></tr><tr><td class="line-number" value="670"></td><td class="line-content">    textTransformNames.push("lowerCase");</td></tr><tr><td class="line-number" value="671"></td><td class="line-content">    textTransformNames.push("upperCase");</td></tr><tr><td class="line-number" value="672"></td><td class="line-content">    textTransformNames.push("replaceText");</td></tr><tr><td class="line-number" value="673"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="674"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="675"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="676"></td><td class="line-content">  //Object.defineProperty(node, "createClone", {get:createCloneMethod, configurable:true});</td></tr><tr><td class="line-number" value="677"></td><td class="line-content">  Object.defineProperty(node, "consumableList", {get:__consumableListMethod, configurable:true});</td></tr><tr><td class="line-number" value="678"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="679"></td><td class="line-content">  Object.defineProperty(node, "createClone", {get:function() { return __duplicatePerchanceNode(this); }, configurable:true});</td></tr><tr><td class="line-number" value="680"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="681"></td><td class="line-content">  // Object.defineProperty(node, "ordinal", {get:ordinalMethod});</td></tr><tr><td class="line-number" value="682"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="683"></td><td class="line-content">  // Object.defineProperty(node, "$withArticle", {get:withArticleMethod});</td></tr><tr><td class="line-number" value="684"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="685"></td><td class="line-content">  // TODO: add the rest of the default methods for version 1 (including getters like ".itemCount" (which gets the length of the $children array))</td></tr><tr><td class="line-number" value="686"></td><td class="line-content">  // TODO: .hideOutput transform?</td></tr><tr><td class="line-number" value="687"></td><td class="line-content">  // TODO: .replaceText("blah","na") transform (alias for .replace() except it always replaces ALL occurances unless you use regex and not the global flag)</td></tr><tr><td class="line-number" value="688"></td><td class="line-content">  // TODO: add any newly added execution properties to the proxy executionProperties array (e.g. replaceText)</td></tr><tr><td class="line-number" value="689"></td><td class="line-content">  // TODO***: remember that you'll need to move the `apply`s along with the text transforms that have an `apply` (e.g. replaceText)</td></tr><tr><td class="line-number" value="690"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="691"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="692"></td><td class="line-content">let __replaceTextMethod = function(needle, replacement) {</td></tr><tr><td class="line-number" value="693"></td><td class="line-content">  if(needle instanceof RegExp) {</td></tr><tr><td class="line-number" value="694"></td><td class="line-content">    return this.toString().replace(needle, replacement.toString());</td></tr><tr><td class="line-number" value="695"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="696"></td><td class="line-content">    //needle = new RegExp(needle.toString(), "g");</td></tr><tr><td class="line-number" value="697"></td><td class="line-content">    //return this.toString().replace(needle, replacement.toString());</td></tr><tr><td class="line-number" value="698"></td><td class="line-content">    return this.toString().split(needle.toString()).join(replacement.toString());</td></tr><tr><td class="line-number" value="699"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="700"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="701"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="702"></td><td class="line-content">// let createCloneMethod = function() {</td></tr><tr><td class="line-number" value="703"></td><td class="line-content">//   // TODO*****: This would try to clone $moduleSpace, $parent, $root, etc.???????????????????!!!!!!!!!!!!!!!!</td></tr><tr><td class="line-number" value="704"></td><td class="line-content">//   //              --&gt; test by putting in debugger and testing `this.$parent === clone.parent`</td></tr><tr><td class="line-number" value="705"></td><td class="line-content">//   //              --&gt; need to temporarily remove properties which reference other node objects directly? then add them back after</td></tr><tr><td class="line-number" value="706"></td><td class="line-content">//   //            At least it DOESN'T make copies of functions</td></tr><tr><td class="line-number" value="707"></td><td class="line-content">//   //            I think I need to make my own cloner... either that or really make sure this is working like I expect</td></tr><tr><td class="line-number" value="708"></td><td class="line-content">//   let clone = cloner.deep.copy(this);</td></tr><tr><td class="line-number" value="709"></td><td class="line-content">//   if(!this.___isLocalCall) {</td></tr><tr><td class="line-number" value="710"></td><td class="line-content">//     return clone;</td></tr><tr><td class="line-number" value="711"></td><td class="line-content">//   } else {</td></tr><tr><td class="line-number" value="712"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="713"></td><td class="line-content">//     let proxiedThisRef;</td></tr><tr><td class="line-number" value="714"></td><td class="line-content">//     proxiedThisRef = new Proxy(clone, {</td></tr><tr><td class="line-number" value="715"></td><td class="line-content">//       // NOTE: if you edit this, edit the same one in evaluateSquareBlock</td></tr><tr><td class="line-number" value="716"></td><td class="line-content">//       get: function(target, property, receiver) {</td></tr><tr><td class="line-number" value="717"></td><td class="line-content">//         if(property === "$output") {</td></tr><tr><td class="line-number" value="718"></td><td class="line-content">//           return undefined;</td></tr><tr><td class="line-number" value="719"></td><td class="line-content">//         } else if(property === "___isLocalCall") {</td></tr><tr><td class="line-number" value="720"></td><td class="line-content">//           return true;</td></tr><tr><td class="line-number" value="721"></td><td class="line-content">//         } else {</td></tr><tr><td class="line-number" value="722"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="723"></td><td class="line-content">//           let desc = Object.getOwnPropertyDescriptor(target, property);</td></tr><tr><td class="line-number" value="724"></td><td class="line-content">//           if(!desc) {</td></tr><tr><td class="line-number" value="725"></td><td class="line-content">//             perchanceError(`The '${property}' property doesn't exist within '${target.getName}'.`, ctxInfo.declarationLineNumber);</td></tr><tr><td class="line-number" value="726"></td><td class="line-content">//             return;</td></tr><tr><td class="line-number" value="727"></td><td class="line-content">//           }</td></tr><tr><td class="line-number" value="728"></td><td class="line-content">//           if(desc.get) {</td></tr><tr><td class="line-number" value="729"></td><td class="line-content">//             return desc.get.bind(proxiedThisRef)();</td></tr><tr><td class="line-number" value="730"></td><td class="line-content">//           } else if(desc.value &amp;&amp; typeof desc.value === 'function') {</td></tr><tr><td class="line-number" value="731"></td><td class="line-content">//             return desc.value.bind(proxiedThisRef);</td></tr><tr><td class="line-number" value="732"></td><td class="line-content">//           } else {</td></tr><tr><td class="line-number" value="733"></td><td class="line-content">//             return target[property];</td></tr><tr><td class="line-number" value="734"></td><td class="line-content">//           }</td></tr><tr><td class="line-number" value="735"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="736"></td><td class="line-content">//         }</td></tr><tr><td class="line-number" value="737"></td><td class="line-content">//       }</td></tr><tr><td class="line-number" value="738"></td><td class="line-content">//     });</td></tr><tr><td class="line-number" value="739"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="740"></td><td class="line-content">//     return proxiedThisRef;</td></tr><tr><td class="line-number" value="741"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="742"></td><td class="line-content">//   }</td></tr><tr><td class="line-number" value="743"></td><td class="line-content">// };</td></tr><tr><td class="line-number" value="744"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="745"></td><td class="line-content">let __consumableListMethod = function() {</td></tr><tr><td class="line-number" value="746"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="747"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="748"></td><td class="line-content">  // it's called consumable*List* because it only makes sense to call it on a list-oriented node</td></tr><tr><td class="line-number" value="749"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="750"></td><td class="line-content">  // let list = this.createClone;</td></tr><tr><td class="line-number" value="751"></td><td class="line-content">  // Object.defineProperty(list, "isConsumable", {value:true, configurable:true, writable:true}); // not $-prefixed because it should be publicly changable</td></tr><tr><td class="line-number" value="752"></td><td class="line-content">  // return list;</td></tr><tr><td class="line-number" value="753"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="754"></td><td class="line-content">  // If this node is wrapped in the $output-hider (See REF:kjhfw927f63ohwkgw82g in evaluateSquareBlock.js), then we unwrap it and do the unhiding ourself in the proxy we create below.</td></tr><tr><td class="line-number" value="755"></td><td class="line-content">  // This is needed due to this problem: https://www.reddit.com/r/perchance/comments/fx7exs/how_to_have_multiple_lists_point_to_the_same/fmxzccb/ Basically, if we have something like `$output = [this.consumableList.selectMany(3)]`, then, target[property] will be returned (in the below proxy's getter) *bound to the $output-hider proxy* rather than this one, and so there is no consumableList from the perspective of selectMany. So we make this proxy handle the $output hiding stuff. Remember than binding is different to proxying! This is some chef's kiss spaghetti </td></tr><tr><td class="line-number" value="756"></td><td class="line-content">  let thisRef = this;</td></tr><tr><td class="line-number" value="757"></td><td class="line-content">  let $outputShouldBeHidden = false;</td></tr><tr><td class="line-number" value="758"></td><td class="line-content">  if(thisRef.___$outputShouldBeHidden) {</td></tr><tr><td class="line-number" value="759"></td><td class="line-content">    thisRef = thisRef.___proxyTarget;</td></tr><tr><td class="line-number" value="760"></td><td class="line-content">    $outputShouldBeHidden = true;</td></tr><tr><td class="line-number" value="761"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="762"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="763"></td><td class="line-content">  let proxy = new Proxy(thisRef, {</td></tr><tr><td class="line-number" value="764"></td><td class="line-content">    alreadyConsumedItems:new Set(),</td></tr><tr><td class="line-number" value="765"></td><td class="line-content">    get: function(target, property) {</td></tr><tr><td class="line-number" value="766"></td><td class="line-content">      if(property === "selectOne") {</td></tr><tr><td class="line-number" value="767"></td><td class="line-content">        // NOTE: inline consumable lists are handled in the toStringMethod</td></tr><tr><td class="line-number" value="768"></td><td class="line-content">        let selectedNode = __selectOneMethod.bind(proxy)();</td></tr><tr><td class="line-number" value="769"></td><td class="line-content">        if(selectedNode &amp;&amp; selectedNode.$nodeType) { // make sure it's a node (could be an error string)</td></tr><tr><td class="line-number" value="770"></td><td class="line-content">          this.alreadyConsumedItems.add(selectedNode);</td></tr><tr><td class="line-number" value="771"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="772"></td><td class="line-content">        return selectedNode;</td></tr><tr><td class="line-number" value="773"></td><td class="line-content">      } else if(property === "evaluateItem") {</td></tr><tr><td class="line-number" value="774"></td><td class="line-content">        return __valueOfMethod.bind(proxy)();</td></tr><tr><td class="line-number" value="775"></td><td class="line-content">      } else if(property === "getLength") {</td></tr><tr><td class="line-number" value="776"></td><td class="line-content">        if(Object.keys(target).includes("getLength")) return target["getLength"];</td></tr><tr><td class="line-number" value="777"></td><td class="line-content">        else return target.$children.length - this.alreadyConsumedItems.size;</td></tr><tr><td class="line-number" value="778"></td><td class="line-content">        // else return Object.keys(target).length - this.alreadyConsumedItems.size;</td></tr><tr><td class="line-number" value="779"></td><td class="line-content">      } else if(property === "$alreadyConsumedItems") {</td></tr><tr><td class="line-number" value="780"></td><td class="line-content">        return this.alreadyConsumedItems;</td></tr><tr><td class="line-number" value="781"></td><td class="line-content">      } else if(textTransformNames.includes(property)) {</td></tr><tr><td class="line-number" value="782"></td><td class="line-content">        return proxy.selectOne[property]; // added due to this problem: https://www.reddit.com/r/perchance/comments/7uw0sp/errors_with_consumablelist_and_uppercase_together/</td></tr><tr><td class="line-number" value="783"></td><td class="line-content">      } else if(property === "getSelf") {</td></tr><tr><td class="line-number" value="784"></td><td class="line-content">        return proxy;</td></tr><tr><td class="line-number" value="785"></td><td class="line-content">      } else if($outputShouldBeHidden &amp;&amp; property === "$output") {</td></tr><tr><td class="line-number" value="786"></td><td class="line-content">        return undefined;</td></tr><tr><td class="line-number" value="787"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="788"></td><td class="line-content">        // TODO: strangely, the return value here seems to be automatically bound to this proxy.</td></tr><tr><td class="line-number" value="789"></td><td class="line-content">        // so it also handles toString and valueOf methods like we want it to.</td></tr><tr><td class="line-number" value="790"></td><td class="line-content">        // I think it's because in `foo().bar()`, bar is by default bound to the thing returned by foo?</td></tr><tr><td class="line-number" value="791"></td><td class="line-content">        return target[property];</td></tr><tr><td class="line-number" value="792"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="793"></td><td class="line-content">    },</td></tr><tr><td class="line-number" value="794"></td><td class="line-content">  });</td></tr><tr><td class="line-number" value="795"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="796"></td><td class="line-content">  return proxy;</td></tr><tr><td class="line-number" value="797"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="798"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="799"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="800"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="801"></td><td class="line-content">let __valueOfMethod = function(key) {</td></tr><tr><td class="line-number" value="802"></td><td class="line-content">  let str = this.toString();</td></tr><tr><td class="line-number" value="803"></td><td class="line-content">  if(String(Number(str)) === str) {</td></tr><tr><td class="line-number" value="804"></td><td class="line-content">    return Number(str);</td></tr><tr><td class="line-number" value="805"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="806"></td><td class="line-content">    return str;</td></tr><tr><td class="line-number" value="807"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="808"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="809"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="810"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="811"></td><td class="line-content">// let idMethod = function(key) {</td></tr><tr><td class="line-number" value="812"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="813"></td><td class="line-content">//   if(typeof key !== 'string') {</td></tr><tr><td class="line-number" value="814"></td><td class="line-content">//     key = key.toString();</td></tr><tr><td class="line-number" value="815"></td><td class="line-content">//   }</td></tr><tr><td class="line-number" value="816"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="817"></td><td class="line-content">//   // TODO***: (BIG ONE): clone `this` and set its toString method so it</td></tr><tr><td class="line-number" value="818"></td><td class="line-content">//   // always returns the $child string that was selected below BUT ALSO can</td></tr><tr><td class="line-number" value="819"></td><td class="line-content">//   // still have its sub-properties accessed. (i.e. the only difference between</td></tr><tr><td class="line-number" value="820"></td><td class="line-content">//   // the clone and the original is that the clone always returns a static string</td></tr><tr><td class="line-number" value="821"></td><td class="line-content">//   // when toString is called (instead of selecting a random child - or returning the</td></tr><tr><td class="line-number" value="822"></td><td class="line-content">//   // evaluated $value text in the case of a $value node))</td></tr><tr><td class="line-number" value="823"></td><td class="line-content">//   // BUT HERE'S THING THING: if a child node is selected and it's "the {cat|dog}", do</td></tr><tr><td class="line-number" value="824"></td><td class="line-content">//   // future requests to that id return "the {cat|dog}" or the EVALUATED version of</td></tr><tr><td class="line-number" value="825"></td><td class="line-content">//   // that text? So we can store either:</td></tr><tr><td class="line-number" value="826"></td><td class="line-content">//   //  - the node itself</td></tr><tr><td class="line-number" value="827"></td><td class="line-content">//   //  - the text of the node</td></tr><tr><td class="line-number" value="828"></td><td class="line-content">//   //  - the *evaluated* text of the node</td></tr><tr><td class="line-number" value="829"></td><td class="line-content">//   // and return it next time that id is called again. Which one? The ideal one seems</td></tr><tr><td class="line-number" value="830"></td><td class="line-content">//   // to depend on the context:</td></tr><tr><td class="line-number" value="831"></td><td class="line-content">//   /*</td></tr><tr><td class="line-number" value="832"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="833"></td><td class="line-content">//   // here, the node one doesn't make sense, but the other two work fine</td></tr><tr><td class="line-number" value="834"></td><td class="line-content">//   animal</td></tr><tr><td class="line-number" value="835"></td><td class="line-content">//     dog</td></tr><tr><td class="line-number" value="836"></td><td class="line-content">//     cat</td></tr><tr><td class="line-number" value="837"></td><td class="line-content">//     pig</td></tr><tr><td class="line-number" value="838"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="839"></td><td class="line-content">//   // here, the node one doesn't make sense, and the other two behave differently.</td></tr><tr><td class="line-number" value="840"></td><td class="line-content">//   // it seems like storing the *evaluated* text would make the most sense in this case.</td></tr><tr><td class="line-number" value="841"></td><td class="line-content">//   sentence</td></tr><tr><td class="line-number" value="842"></td><td class="line-content">//     I'm {going|running} to the {shops|hotel}.</td></tr><tr><td class="line-number" value="843"></td><td class="line-content">//     That's a {great|silly|quaint} handbag you've got there.</td></tr><tr><td class="line-number" value="844"></td><td class="line-content">//   // and actually, I can't think of an example where storing the un-evaluated text would</td></tr><tr><td class="line-number" value="845"></td><td class="line-content">//   // make sense.</td></tr><tr><td class="line-number" value="846"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="847"></td><td class="line-content">//   NEW TACK: curly notation for the id thing because it will be so common:</td></tr><tr><td class="line-number" value="848"></td><td class="line-content">//   {animal#1} -&gt; [animal.$id(1)]</td></tr><tr><td class="line-number" value="849"></td><td class="line-content">//   but wait - I still need to decide on id behavior...</td></tr><tr><td class="line-number" value="850"></td><td class="line-content">//   -----</td></tr><tr><td class="line-number" value="851"></td><td class="line-content">//   The cloning behaviour makes the most sense? Need to bite the bullet and spend a day perfecting this.</td></tr><tr><td class="line-number" value="852"></td><td class="line-content">//   It's an integral part of the last big trio (id/unique/remember)</td></tr><tr><td class="line-number" value="853"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="854"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="855"></td><td class="line-content">//   */</td></tr><tr><td class="line-number" value="856"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="857"></td><td class="line-content">//   if(this.$idStore[key]) {</td></tr><tr><td class="line-number" value="858"></td><td class="line-content">//     return this.$idStore[key];</td></tr><tr><td class="line-number" value="859"></td><td class="line-content">//   } else {</td></tr><tr><td class="line-number" value="860"></td><td class="line-content">//     let child = this.$child;</td></tr><tr><td class="line-number" value="861"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="862"></td><td class="line-content">//     // if its text is dynamic, we need to evaluate it (they expect the same text each time!).</td></tr><tr><td class="line-number" value="863"></td><td class="line-content">//     // if it's not, there's no need to evaluate it.</td></tr><tr><td class="line-number" value="864"></td><td class="line-content">//     // note that if it IS dynamic, then there won't be any child properties, so we can just store</td></tr><tr><td class="line-number" value="865"></td><td class="line-content">//     // and return a plain old string!</td></tr><tr><td class="line-number" value="866"></td><td class="line-content">//     let blocks = splitTextAtAllBlocks(child.$text);</td></tr><tr><td class="line-number" value="867"></td><td class="line-content">//     if(blocks.length &gt; 1 || blocks[0][0] === "[" || blocks[0][0] === "{") {</td></tr><tr><td class="line-number" value="868"></td><td class="line-content">//       child = child.toString();</td></tr><tr><td class="line-number" value="869"></td><td class="line-content">//     }</td></tr><tr><td class="line-number" value="870"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="871"></td><td class="line-content">//     this.$idStore[key] = child;</td></tr><tr><td class="line-number" value="872"></td><td class="line-content">//     return this.$idStore[key];</td></tr><tr><td class="line-number" value="873"></td><td class="line-content">//   }</td></tr><tr><td class="line-number" value="874"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="875"></td><td class="line-content">// };</td></tr><tr><td class="line-number" value="876"></td><td class="line-content">// let setIdMethod = function(key) {</td></tr><tr><td class="line-number" value="877"></td><td class="line-content">//   if(this.$idStore[key]) {</td></tr><tr><td class="line-number" value="878"></td><td class="line-content">//     delete this.$idStore[key];</td></tr><tr><td class="line-number" value="879"></td><td class="line-content">//   }</td></tr><tr><td class="line-number" value="880"></td><td class="line-content">//   return this.$id(key);</td></tr><tr><td class="line-number" value="881"></td><td class="line-content">// };</td></tr><tr><td class="line-number" value="882"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="883"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="884"></td><td class="line-content">let __selectAllMethod = function() {</td></tr><tr><td class="line-number" value="885"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="886"></td><td class="line-content">  // This methos gets ALL items, regarless of whether they have odds == 0</td></tr><tr><td class="line-number" value="887"></td><td class="line-content">  // If one wants to exlude `odds==0` items: list.selectAll.filter(item =&gt; item.getOdds &gt; 0)</td></tr><tr><td class="line-number" value="888"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="889"></td><td class="line-content">  let $output = this.$output;</td></tr><tr><td class="line-number" value="890"></td><td class="line-content">  if($output !== undefined) {</td></tr><tr><td class="line-number" value="891"></td><td class="line-content">    return [$output]; // make it an array because why not. (consistency is nice)</td></tr><tr><td class="line-number" value="892"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="893"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="894"></td><td class="line-content">  if(this.$nodeType === "value") {</td></tr><tr><td class="line-number" value="895"></td><td class="line-content">    let text = this.$value;</td></tr><tr><td class="line-number" value="896"></td><td class="line-content">    if(text[0] === "{" &amp;&amp; text[text.length-1] === "}") {</td></tr><tr><td class="line-number" value="897"></td><td class="line-content">      let items = __splitUpCurlyOrBlock(text.substr(1, text.length-2));</td></tr><tr><td class="line-number" value="898"></td><td class="line-content">      if(items) { // i.e. if it's a valid curly OR block</td></tr><tr><td class="line-number" value="899"></td><td class="line-content">        return items;</td></tr><tr><td class="line-number" value="900"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="901"></td><td class="line-content">        __perchanceError(`You've called 'selectAll' on something that doesn't appear to be a list?`, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});</td></tr><tr><td class="line-number" value="902"></td><td class="line-content">        return;</td></tr><tr><td class="line-number" value="903"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="904"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="905"></td><td class="line-content">      __perchanceError(`You've called 'selectAll' on something that doesn't appear to be a list?`, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});</td></tr><tr><td class="line-number" value="906"></td><td class="line-content">      return;</td></tr><tr><td class="line-number" value="907"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="908"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="909"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="910"></td><td class="line-content">  let arr = [];</td></tr><tr><td class="line-number" value="911"></td><td class="line-content">  for(let key of this.$children) {</td></tr><tr><td class="line-number" value="912"></td><td class="line-content">    arr.push(this[key]);</td></tr><tr><td class="line-number" value="913"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="914"></td><td class="line-content">  arr.toString = function() { return this.join(""); }; // This makes sense, right? Who would selectAll, but then expect a single random item? That would be silly.</td></tr><tr><td class="line-number" value="915"></td><td class="line-content">  return arr;</td></tr><tr><td class="line-number" value="916"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="917"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="918"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="919"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="920"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="921"></td><td class="line-content">let __selectOneMethod = function() {</td></tr><tr><td class="line-number" value="922"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="923"></td><td class="line-content">  const isConsumableList = !!this.$alreadyConsumedItems;</td></tr><tr><td class="line-number" value="924"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="925"></td><td class="line-content">  let consumedNodes = new Set();</td></tr><tr><td class="line-number" value="926"></td><td class="line-content">  if(isConsumableList) {</td></tr><tr><td class="line-number" value="927"></td><td class="line-content">    consumedNodes = this.$alreadyConsumedItems; // this is a property of the consumableList proxy handler that we expose</td></tr><tr><td class="line-number" value="928"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="929"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="930"></td><td class="line-content">  let $output = this.$output; // cache it so we don't "execute" it twice if it's something like `$output = [this.age++]`</td></tr><tr><td class="line-number" value="931"></td><td class="line-content">  if($output !== undefined) {</td></tr><tr><td class="line-number" value="932"></td><td class="line-content">    return $output;</td></tr><tr><td class="line-number" value="933"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="934"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="935"></td><td class="line-content">  if(this.$nodeType === "value") {</td></tr><tr><td class="line-number" value="936"></td><td class="line-content">    // I'm pretty sure we want to `toString` (evaulate) it because why would you call selectOne on a value node otherwise?</td></tr><tr><td class="line-number" value="937"></td><td class="line-content">    // Consider these two examples:</td></tr><tr><td class="line-number" value="938"></td><td class="line-content">    // height = {1-10}</td></tr><tr><td class="line-number" value="939"></td><td class="line-content">    // height</td></tr><tr><td class="line-number" value="940"></td><td class="line-content">    //   {1-10}</td></tr><tr><td class="line-number" value="941"></td><td class="line-content">    // You might think we should treat the former the same way as the latter (i.e. NOT evaluate it), but that doesn't make sense in terms of the user's intention.</td></tr><tr><td class="line-number" value="942"></td><td class="line-content">    // I'm pretty sure I've made the right decision here but hopefully the beta testers will surface any mistakes in my reasoning.</td></tr><tr><td class="line-number" value="943"></td><td class="line-content">    let result = this.toString();</td></tr><tr><td class="line-number" value="944"></td><td class="line-content">    if(String(Number(result)) === result) return Number(result);</td></tr><tr><td class="line-number" value="945"></td><td class="line-content">    else return result;</td></tr><tr><td class="line-number" value="946"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="947"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="948"></td><td class="line-content">  let textNodes = [];</td></tr><tr><td class="line-number" value="949"></td><td class="line-content">  let oddsSum = 0;</td></tr><tr><td class="line-number" value="950"></td><td class="line-content">  let oddsArray = [];</td></tr><tr><td class="line-number" value="951"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="952"></td><td class="line-content">  for(let key of this.$children) {</td></tr><tr><td class="line-number" value="953"></td><td class="line-content">    let node = this[key];</td></tr><tr><td class="line-number" value="954"></td><td class="line-content">    if(!consumedNodes.has(node)) {</td></tr><tr><td class="line-number" value="955"></td><td class="line-content">      let odds = node.$odds; // remember, $odds is a getter and could be dynamic, so we musn't call it multiple times and expect the same result</td></tr><tr><td class="line-number" value="956"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="957"></td><td class="line-content">      // if it has odds of zero, leave it out - but don't consume it, because it hasn't been consumed (zero odds could be temporary, for example)</td></tr><tr><td class="line-number" value="958"></td><td class="line-content">      // EDIT: turns this doesn't really make sense for non-consumable lists (because you end up with problems like this: https://www.reddit.com/r/perchance/comments/co6msx/bug_list_name_being_included_in_output_of_list/)</td></tr><tr><td class="line-number" value="959"></td><td class="line-content">      //       and it's not really that useful for cosumableLists either except to help people find bugs where their list ran out of non-zero-odds items. So I think</td></tr><tr><td class="line-number" value="960"></td><td class="line-content">      //       due to the problems it causes with peoples' code it's not worth the trouble. So I'm commenting it out for now.</td></tr><tr><td class="line-number" value="961"></td><td class="line-content">      //if(odds === 0 &amp;&amp; isConsumableList) continue;</td></tr><tr><td class="line-number" value="962"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="963"></td><td class="line-content">      if(odds &lt; 0 || isNaN(odds)) {</td></tr><tr><td class="line-number" value="964"></td><td class="line-content">        __perchanceError(`The item on this line has the following odds: &lt;code&gt;${node.$oddsText}&lt;/code&gt;. This has resulted in an odds value of &lt;code&gt;${odds}&lt;/code&gt;, which is not valid. It should be a positive number.`, {declarationLineNumber:node.$declarationLineNumber, moduleName:node.$moduleName, node});</td></tr><tr><td class="line-number" value="965"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="966"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="967"></td><td class="line-content">      textNodes.push(node);</td></tr><tr><td class="line-number" value="968"></td><td class="line-content">      oddsSum += odds;</td></tr><tr><td class="line-number" value="969"></td><td class="line-content">      oddsArray.push(odds);</td></tr><tr><td class="line-number" value="970"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="971"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="972"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="973"></td><td class="line-content">  if(textNodes.length === 0) {</td></tr><tr><td class="line-number" value="974"></td><td class="line-content">    if(consumedNodes.size &gt; 0) return `(no more items in the consumable '${this.$text}' list)`;</td></tr><tr><td class="line-number" value="975"></td><td class="line-content">    else {</td></tr><tr><td class="line-number" value="976"></td><td class="line-content">      let out = __evaluateText(this.$root, this.$parent, this.$text, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this}); // we need to return the text if no children, otherwise we can't do nice stuff like this: https://www.reddit.com/r/perchance/comments/6g1uqk/fixed_variables/dio2da4/</td></tr><tr><td class="line-number" value="977"></td><td class="line-content">      if(window.generatorLastEditTime &gt; 1716337636385) { // May 22nd 2024 bugfix, ensures only generators edited after this time get it, to prevent breaking old generators that rely on the bug</td></tr><tr><td class="line-number" value="978"></td><td class="line-content">        out = __processEscapedCharacters(out);</td></tr><tr><td class="line-number" value="979"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="980"></td><td class="line-content">      return out;</td></tr><tr><td class="line-number" value="981"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="982"></td><td class="line-content">    // and we need to *evaluate* the text because otherwise we couldn't do `c = b.selectOne.selectOne` in this example: https://www.reddit.com/r/perchance/comments/6qqc4d/items_in_shorthand_lists_arent_always_stored/dl01lkv/</td></tr><tr><td class="line-number" value="983"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="984"></td><td class="line-content">    //else return `('${this.$text}' is not a list)`;</td></tr><tr><td class="line-number" value="985"></td><td class="line-content">    // don't throw error because it's okay for a node not to have children</td></tr><tr><td class="line-number" value="986"></td><td class="line-content">    //console.error(`Error trying to get child nodes of '${this.$text}' which was declared on line number ${this.$declarationLineNumber}.`);</td></tr><tr><td class="line-number" value="987"></td><td class="line-content">    // if(this.isConsumable) return `(no more items in the consumable '${this.$text}' list)`;</td></tr><tr><td class="line-number" value="988"></td><td class="line-content">    // else return `('${this.$text}' is not a list)`; // TODO***: return `this.$text` here since it's not consumable and has no children?</td></tr><tr><td class="line-number" value="989"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="990"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="991"></td><td class="line-content">  // choose random position in oddsSum range</td></tr><tr><td class="line-number" value="992"></td><td class="line-content">  let oddsSumStopPoint = oddsSum*Math.random();</td></tr><tr><td class="line-number" value="993"></td><td class="line-content">  let selectedTextNode = null;</td></tr><tr><td class="line-number" value="994"></td><td class="line-content">  let oddsSumForChoice = 0;</td></tr><tr><td class="line-number" value="995"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="996"></td><td class="line-content">  for(let i = 0; i &lt; textNodes.length; i++) {</td></tr><tr><td class="line-number" value="997"></td><td class="line-content">    oddsSumForChoice += oddsArray[i];</td></tr><tr><td class="line-number" value="998"></td><td class="line-content">    if(oddsSumForChoice &gt;= oddsSumStopPoint) {</td></tr><tr><td class="line-number" value="999"></td><td class="line-content">      selectedTextNode = textNodes[i];</td></tr><tr><td class="line-number" value="1000"></td><td class="line-content">      break;</td></tr><tr><td class="line-number" value="1001"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1002"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1003"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1004"></td><td class="line-content">  if(selectedTextNode === null) {</td></tr><tr><td class="line-number" value="1005"></td><td class="line-content">    __perchanceError(`This shouldn't happen! This may be a problem with the Perchance engine. Please report this bug to &lt;a href='https://lemmy.world/c/perchance'&gt;lemmy.world/c/perchance&lt;/a&gt;. A text node couldn't be picked during a random selection in a node's .toString() function. Here's some extra details for the bug report: this.$text=${this.$text}; this.$children=${this.$children.join(",")}; this.$declarationLineNumber=${this.$declarationLineNumber}`, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});</td></tr><tr><td class="line-number" value="1006"></td><td class="line-content">    console.log(this, textNodes);</td></tr><tr><td class="line-number" value="1007"></td><td class="line-content">    console.error("Returning first text node rather than random one to prevent crashing while debugging.");</td></tr><tr><td class="line-number" value="1008"></td><td class="line-content">    return textNodes[0];</td></tr><tr><td class="line-number" value="1009"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1010"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1011"></td><td class="line-content">  // if(this.isConsumable) {</td></tr><tr><td class="line-number" value="1012"></td><td class="line-content">  //   let text = selectedTextNode.$text;</td></tr><tr><td class="line-number" value="1013"></td><td class="line-content">  //   this.$children = this.$children.filter(c =&gt; c !== text);</td></tr><tr><td class="line-number" value="1014"></td><td class="line-content">  //   delete this[text];</td></tr><tr><td class="line-number" value="1015"></td><td class="line-content">  // }</td></tr><tr><td class="line-number" value="1016"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1017"></td><td class="line-content">  return selectedTextNode;</td></tr><tr><td class="line-number" value="1018"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1019"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1020"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1021"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1022"></td><td class="line-content">let __toStringMethod = function(opts={}) {</td></tr><tr><td class="line-number" value="1023"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1024"></td><td class="line-content">  // NOTE: We can't call processEscapedCharacters on the text before returning it because this method gets called</td></tr><tr><td class="line-number" value="1025"></td><td class="line-content">  //       DURING the evaluateSquareBlock calls that are inside evaluateText, and so processEscapedCharacters would get</td></tr><tr><td class="line-number" value="1026"></td><td class="line-content">  //       called multiple times on the same text. We actually (sort of counterintuitively) want to keep all the backslashes</td></tr><tr><td class="line-number" value="1027"></td><td class="line-content">  //       in the input until just before the whole string is returned.</td></tr><tr><td class="line-number" value="1028"></td><td class="line-content">  //       I was previously doing this by calling processEscapedCharacters in the updateTemplatedNodes function, but the</td></tr><tr><td class="line-number" value="1029"></td><td class="line-content">  //       problem with that is that if you have something like onclick="outputEl.innerHTML = animal.description" it won't</td></tr><tr><td class="line-number" value="1030"></td><td class="line-content">  //       remove the backslashes from the animal.description text. I was previously solving that by using the MutationObserver</td></tr><tr><td class="line-number" value="1031"></td><td class="line-content">  //       stuff, but that still doesn't cut it, because when you grab the text from a Perchance node and manipulate it with JS,</td></tr><tr><td class="line-number" value="1032"></td><td class="line-content">  //       you obviously don't expect it to have the escape characters in it.</td></tr><tr><td class="line-number" value="1033"></td><td class="line-content">  //   --&gt; WAIT. I haven't slept in way too long, but I have a crazy theory that we actually don't want to strip the backslashes</td></tr><tr><td class="line-number" value="1034"></td><td class="line-content">  //       when the text is "viewed" from JavaScript. JavaScript is the "engine" so it makes sense that we'd see the text in its</td></tr><tr><td class="line-number" value="1035"></td><td class="line-content">  //       most "raw" state - no processing at all. Oh, so I just need to make evaluateItem strip the backslashes??</td></tr><tr><td class="line-number" value="1036"></td><td class="line-content">  //   --&gt; WAIT AGAIN: I don't think that makes sense. When we convert a node/item to a string, we expect it to just be a plain</td></tr><tr><td class="line-number" value="1037"></td><td class="line-content">  //       string. It's "out of perchance" at that point. It's just meant to be a plain old string. So I think the obvious thing</td></tr><tr><td class="line-number" value="1038"></td><td class="line-content">  //       to do here (regarding the above note about this being used in the evaluateText function - and wanting to preserve</td></tr><tr><td class="line-number" value="1039"></td><td class="line-content">  //       backslashes until right before the final string is returned from this function) is just to use a version of this method</td></tr><tr><td class="line-number" value="1040"></td><td class="line-content">  //       which specifically doesn't remove backslashes, right? Should this function just take an options object? Yep, I'm going</td></tr><tr><td class="line-number" value="1041"></td><td class="line-content">  //       with that.</td></tr><tr><td class="line-number" value="1042"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1043"></td><td class="line-content">  // TODO***: use getOwnPropertyDescriptor to detect $output? since it could be defined and yet return undefined</td></tr><tr><td class="line-number" value="1044"></td><td class="line-content">  //          make sure you update other methods too</td></tr><tr><td class="line-number" value="1045"></td><td class="line-content">  let $output = this.$output;</td></tr><tr><td class="line-number" value="1046"></td><td class="line-content">  if($output !== undefined) {</td></tr><tr><td class="line-number" value="1047"></td><td class="line-content">    $output = typeof $output === "number" ? $output.toString() : $output.toString({keepEscapes:opts.keepEscapes}); // only pass the keepEscapes object if it's not a number (because numbers expect a radix as the param of toString)</td></tr><tr><td class="line-number" value="1048"></td><td class="line-content">    let result = __evaluateText(this.$root, this.$parent, $output, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});</td></tr><tr><td class="line-number" value="1049"></td><td class="line-content">    if(opts.keepEscapes) return result;</td></tr><tr><td class="line-number" value="1050"></td><td class="line-content">    else return __processEscapedCharacters(result);</td></tr><tr><td class="line-number" value="1051"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1052"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1053"></td><td class="line-content">  if(this.$nodeType === "value") {</td></tr><tr><td class="line-number" value="1054"></td><td class="line-content">    if(typeof this.$value === "number")  { return this.$value; }</td></tr><tr><td class="line-number" value="1055"></td><td class="line-content">    else {</td></tr><tr><td class="line-number" value="1056"></td><td class="line-content">      // if it's a consumableList and is plain inline notation like {1|2|3|4|...} with nothing before or after, then let's consume it</td></tr><tr><td class="line-number" value="1057"></td><td class="line-content">      let text = this.$value;</td></tr><tr><td class="line-number" value="1058"></td><td class="line-content">      if(this.$alreadyConsumedItems &amp;&amp; text[0] === "{" &amp;&amp; text[text.length-1] === "}") {</td></tr><tr><td class="line-number" value="1059"></td><td class="line-content">        let items = __splitUpCurlyOrBlock(text.substr(1, text.length-2));</td></tr><tr><td class="line-number" value="1060"></td><td class="line-content">        if(items) { // i.e. if it's a valid curly OR block</td></tr><tr><td class="line-number" value="1061"></td><td class="line-content">          // remove already consumed items</td></tr><tr><td class="line-number" value="1062"></td><td class="line-content">          items = items.filter(i =&gt; !this.$alreadyConsumedItems.has( __getTextOddsDetails(i).textWithoutOdds || i )); // "|| i" needed because getTextOddsDetails returns false if no odds details</td></tr><tr><td class="line-number" value="1063"></td><td class="line-content">          if(items.length === 0) return `(inline consumable list '${this.$key}' has no more items)`;</td></tr><tr><td class="line-number" value="1064"></td><td class="line-content">          // choose an item</td></tr><tr><td class="line-number" value="1065"></td><td class="line-content">          let chosenItem = __chooseRandomTextByOdds(this.$root, this.$parent, items, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});</td></tr><tr><td class="line-number" value="1066"></td><td class="line-content">          // add the chosen item to $alreadyConsumedItems</td></tr><tr><td class="line-number" value="1067"></td><td class="line-content">          this.$alreadyConsumedItems.add(chosenItem);</td></tr><tr><td class="line-number" value="1068"></td><td class="line-content">          // return the chosen item</td></tr><tr><td class="line-number" value="1069"></td><td class="line-content">          if(opts.keepEscapes) return chosenItem;</td></tr><tr><td class="line-number" value="1070"></td><td class="line-content">          else return __processEscapedCharacters(chosenItem);</td></tr><tr><td class="line-number" value="1071"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1072"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1073"></td><td class="line-content">      if(this.$alreadyConsumedItems) __perchanceError(`You tried to make this into a consumable list: &lt;code&gt;${__escapeHTMLSpecialChars(this.$key)} = ${__escapeHTMLSpecialChars(this.$value)}&lt;/code&gt;, but for an inline item to be consumable, it must be of the format &lt;code&gt;a = {b|c|d}&lt;/code&gt; and cannot have anything outside of the curly brackets (e.g. you could not make &lt;code&gt;a = {b|c|d}efg&lt;/code&gt; consumable).`, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});</td></tr><tr><td class="line-number" value="1074"></td><td class="line-content">      let result = __evaluateText(this.$root, this.$parent, this.$value, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});</td></tr><tr><td class="line-number" value="1075"></td><td class="line-content">      if(opts.keepEscapes) return result;</td></tr><tr><td class="line-number" value="1076"></td><td class="line-content">      else return __processEscapedCharacters(result);</td></tr><tr><td class="line-number" value="1077"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1078"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1079"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1080"></td><td class="line-content">  // toString treats childless nodes differently to ones that have children (i.e. items that are themselves lists)</td></tr><tr><td class="line-number" value="1081"></td><td class="line-content">  // this sounds like a terrible idea at first, but I've put a bit of thought into it and it seems like the best option</td></tr><tr><td class="line-number" value="1082"></td><td class="line-content">  // so that newbies don't have to understand how the engine works just to simply do: [f = flower.selectOne]. The</td></tr><tr><td class="line-number" value="1083"></td><td class="line-content">  // alternative would be to make them do [f = flower.selectOne.itemName] which is ridiculous.</td></tr><tr><td class="line-number" value="1084"></td><td class="line-content">  // If you think about it, this approach actually makes a bit of sense. If `this` node is itself a list, then that's</td></tr><tr><td class="line-number" value="1085"></td><td class="line-content">  // an important fundamental difference, and so a difference in behaviour isn't really too unexpected.</td></tr><tr><td class="line-number" value="1086"></td><td class="line-content">  // What we're basically saying is that leaves are treated differently to branches. The awesome part about this</td></tr><tr><td class="line-number" value="1087"></td><td class="line-content">  // approach is that it alls us to do `[a = animal.selectOne] ... [a.genus]` - i.e. we can access the *properties*</td></tr><tr><td class="line-number" value="1088"></td><td class="line-content">  // of the selected animal. [a=animal.outputText] doesn't allow us to do this.</td></tr><tr><td class="line-number" value="1089"></td><td class="line-content">  if(this.$children.length === 0) {</td></tr><tr><td class="line-number" value="1090"></td><td class="line-content">    let result = __evaluateText(this.$root, this.$parent, this.$text, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});</td></tr><tr><td class="line-number" value="1091"></td><td class="line-content">    if(opts.keepEscapes) return result;</td></tr><tr><td class="line-number" value="1092"></td><td class="line-content">    else return __processEscapedCharacters(result);</td></tr><tr><td class="line-number" value="1093"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1094"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1095"></td><td class="line-content">  if(this.$children.length &gt; 0) {</td></tr><tr><td class="line-number" value="1096"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1097"></td><td class="line-content">    let child = this.selectOne;</td></tr><tr><td class="line-number" value="1098"></td><td class="line-content">    if(typeof child === 'string') { // e.g., if it is an error message</td></tr><tr><td class="line-number" value="1099"></td><td class="line-content">      return child;</td></tr><tr><td class="line-number" value="1100"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1101"></td><td class="line-content">    let text = child.$text;</td></tr><tr><td class="line-number" value="1102"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1103"></td><td class="line-content">    let result = __evaluateText(this.$root, child.$parent, text, {declarationLineNumber:child.$declarationLineNumber, moduleName:child.$moduleName, node:child});</td></tr><tr><td class="line-number" value="1104"></td><td class="line-content">    if(opts.keepEscapes) return result;</td></tr><tr><td class="line-number" value="1105"></td><td class="line-content">    else return __processEscapedCharacters(result);</td></tr><tr><td class="line-number" value="1106"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1107"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1108"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1109"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1110"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1111"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1112"></td><td class="line-content">// let addItemMethod = function(key) {</td></tr><tr><td class="line-number" value="1113"></td><td class="line-content">//   this.$children.push(key);</td></tr><tr><td class="line-number" value="1114"></td><td class="line-content">//   this[key] = undefined;</td></tr><tr><td class="line-number" value="1115"></td><td class="line-content">//   console.log("THIS NEEDS FIXING! (see TODO, below this line)")</td></tr><tr><td class="line-number" value="1116"></td><td class="line-content">//   // TODO: fix this? what if they want to add a child of the added child? needs to be a *proper* node?</td></tr><tr><td class="line-number" value="1117"></td><td class="line-content">//   // TODO: implement $addChildren and $removeChildren methods ($addChild and $removeChild should really just be aliases of these)</td></tr><tr><td class="line-number" value="1118"></td><td class="line-content">// };</td></tr><tr><td class="line-number" value="1119"></td><td class="line-content">// let removeItemMethod = function(key) {</td></tr><tr><td class="line-number" value="1120"></td><td class="line-content">//   this.$children.filter(k =&gt; k !== key);</td></tr><tr><td class="line-number" value="1121"></td><td class="line-content">//   delete this[key];</td></tr><tr><td class="line-number" value="1122"></td><td class="line-content">//   // TODO: verify that this works and makes sense</td></tr><tr><td class="line-number" value="1123"></td><td class="line-content">// };</td></tr><tr><td class="line-number" value="1124"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1125"></td><td class="line-content">let __$oddsMethod = function() {</td></tr><tr><td class="line-number" value="1126"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1127"></td><td class="line-content">  if(this.$oddsText == '1') return 1;</td></tr><tr><td class="line-number" value="1128"></td><td class="line-content">  if( String(Number(this.$oddsText)) === this.$oddsText ) return Number(this.$oddsText);</td></tr><tr><td class="line-number" value="1129"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1130"></td><td class="line-content">  // NOTE: must use $oddsText odds rather than this.$odds, because this is the definition of $odds! (it'd be recursive)</td></tr><tr><td class="line-number" value="1131"></td><td class="line-content">  if(typeof this.$oddsText !== 'string') {</td></tr><tr><td class="line-number" value="1132"></td><td class="line-content">    __perchanceError(`This shouldn't happen. This may be a problem with the Perchance engine. Please report this bug to &lt;a href='https://lemmy.world/c/perchance'&gt;lemmy.world/c/perchance&lt;/a&gt;. The odds property of this node isn't a string. Here's some extra details for the bug report: this.$text=${__escapeHTMLSpecialChars(this.$text)}; this.$children=${__escapeHTMLSpecialChars(this.$children.join(","))}; this.$declarationLineNumber=${__escapeHTMLSpecialChars(this.$declarationLineNumber)}; this.$oddsText=${__escapeHTMLSpecialChars(this.$oddsText)}`, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});</td></tr><tr><td class="line-number" value="1133"></td><td class="line-content">    return 1;</td></tr><tr><td class="line-number" value="1134"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1135"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1136"></td><td class="line-content">  let evaluatedOdds = __oddsTextToNumber(this.$root, this.$parent, this.$oddsText, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});</td></tr><tr><td class="line-number" value="1137"></td><td class="line-content">  if(typeof evaluatedOdds === 'number') {</td></tr><tr><td class="line-number" value="1138"></td><td class="line-content">    return evaluatedOdds;</td></tr><tr><td class="line-number" value="1139"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="1140"></td><td class="line-content">    // TODO: potentially convert strings to numbers using eval (if it is a number, obviously). The reason</td></tr><tr><td class="line-number" value="1141"></td><td class="line-content">    // I'm not doing it yet is because I may do string-&gt;number conversions automatically across the whole system.</td></tr><tr><td class="line-number" value="1142"></td><td class="line-content">    // i.e. in the evaluateSquareBlock function itself.</td></tr><tr><td class="line-number" value="1143"></td><td class="line-content">    __perchanceError(`The '^' character is used to specify how likely an item is of being chosen during a random selection. This line appears to have a '^' character, but the text after that character (&lt;b&gt;${__escapeHTMLSpecialChars(this.$oddsText)}&lt;/b&gt;) isn't a number, or didn't evaluate to a number. You're allowed to use square and curly bracket expressions to randomly/dynamically determine the odds, but these expressions must evaluate to a number. In this case your odds expression didn't result in a number.`, {declarationLineNumber:this.$declarationLineNumber, moduleName:this.$moduleName, node:this});</td></tr><tr><td class="line-number" value="1144"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1145"></td><td class="line-content">    return 1;</td></tr><tr><td class="line-number" value="1146"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1147"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1148"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1149"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1150"></td><td class="line-content">// let shuffleMethod = function(numShuffles) {</td></tr><tr><td class="line-number" value="1151"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1152"></td><td class="line-content">//   // TODO***: can't order object keys, so this method is useless on nodes (but useful for arrays and strings)</td></tr><tr><td class="line-number" value="1153"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1154"></td><td class="line-content">//   if(numShuffles === undefined) {</td></tr><tr><td class="line-number" value="1155"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1156"></td><td class="line-content">//     var array = this.$children;</td></tr><tr><td class="line-number" value="1157"></td><td class="line-content">//     var currentIndex = array.length, temporaryValue, randomIndex;</td></tr><tr><td class="line-number" value="1158"></td><td class="line-content">//     // While there remain elements to shuffle...</td></tr><tr><td class="line-number" value="1159"></td><td class="line-content">//     while (0 !== currentIndex) {</td></tr><tr><td class="line-number" value="1160"></td><td class="line-content">//       // Pick a remaining element...</td></tr><tr><td class="line-number" value="1161"></td><td class="line-content">//       randomIndex = Math.floor(Math.random() * currentIndex);</td></tr><tr><td class="line-number" value="1162"></td><td class="line-content">//       currentIndex -= 1;</td></tr><tr><td class="line-number" value="1163"></td><td class="line-content">//       // And swap it with the current element.</td></tr><tr><td class="line-number" value="1164"></td><td class="line-content">//       temporaryValue = array[currentIndex];</td></tr><tr><td class="line-number" value="1165"></td><td class="line-content">//       array[currentIndex] = array[randomIndex];</td></tr><tr><td class="line-number" value="1166"></td><td class="line-content">//       array[randomIndex] = temporaryValue;</td></tr><tr><td class="line-number" value="1167"></td><td class="line-content">//     }</td></tr><tr><td class="line-number" value="1168"></td><td class="line-content">//     array = array.map(c =&gt; this[c]); // map to actual node objects</td></tr><tr><td class="line-number" value="1169"></td><td class="line-content">//     array.toString = function() { this.join(""); }</td></tr><tr><td class="line-number" value="1170"></td><td class="line-content">//     return array;</td></tr><tr><td class="line-number" value="1171"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1172"></td><td class="line-content">//   } else {</td></tr><tr><td class="line-number" value="1173"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1174"></td><td class="line-content">//     let text = this.toString().split("");</td></tr><tr><td class="line-number" value="1175"></td><td class="line-content">//     for(let i = 0; i &lt; numShuffles; i++) {</td></tr><tr><td class="line-number" value="1176"></td><td class="line-content">//       let i1 = Math.floor(text.length*Math.random());</td></tr><tr><td class="line-number" value="1177"></td><td class="line-content">//       let i2 = Math.floor(text.length*Math.random());</td></tr><tr><td class="line-number" value="1178"></td><td class="line-content">//       let c1 = text[i1];</td></tr><tr><td class="line-number" value="1179"></td><td class="line-content">//       let c2 = text[i2];</td></tr><tr><td class="line-number" value="1180"></td><td class="line-content">//       text[i1] = c2;</td></tr><tr><td class="line-number" value="1181"></td><td class="line-content">//       text[i2] = c1;</td></tr><tr><td class="line-number" value="1182"></td><td class="line-content">//     }</td></tr><tr><td class="line-number" value="1183"></td><td class="line-content">//     return text.join("");</td></tr><tr><td class="line-number" value="1184"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1185"></td><td class="line-content">//   }</td></tr><tr><td class="line-number" value="1186"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1187"></td><td class="line-content">// }</td></tr><tr><td class="line-number" value="1188"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1189"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1190"></td><td class="line-content">let __joinItemsMethod = function(str) {</td></tr><tr><td class="line-number" value="1191"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1192"></td><td class="line-content">  let $output = this.$output;</td></tr><tr><td class="line-number" value="1193"></td><td class="line-content">  if($output !== undefined) {</td></tr><tr><td class="line-number" value="1194"></td><td class="line-content">    return $output.toString();</td></tr><tr><td class="line-number" value="1195"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1196"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1197"></td><td class="line-content">  let arr = [];</td></tr><tr><td class="line-number" value="1198"></td><td class="line-content">  for(let c of this.$children) {</td></tr><tr><td class="line-number" value="1199"></td><td class="line-content">    arr.push(this[c].getName);</td></tr><tr><td class="line-number" value="1200"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1201"></td><td class="line-content">  return arr.joinItems(str+"");</td></tr><tr><td class="line-number" value="1202"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1203"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1204"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1205"></td><td class="line-content">let __selectUniqueMethod = function(...a) {</td></tr><tr><td class="line-number" value="1206"></td><td class="line-content">  return this.consumableList.selectMany(...a);</td></tr><tr><td class="line-number" value="1207"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1208"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1209"></td><td class="line-content">let __selectManyMethod = function(...a) {</td></tr><tr><td class="line-number" value="1210"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1211"></td><td class="line-content">  let num;</td></tr><tr><td class="line-number" value="1212"></td><td class="line-content">  if(a.length === 1) {</td></tr><tr><td class="line-number" value="1213"></td><td class="line-content">    if(Array.isArray(a[0])) {</td></tr><tr><td class="line-number" value="1214"></td><td class="line-content">      num = Number(a[0][Math.floor(Math.random()*a[0].length)]);</td></tr><tr><td class="line-number" value="1215"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="1216"></td><td class="line-content">      num = Number(a[0]);</td></tr><tr><td class="line-number" value="1217"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1218"></td><td class="line-content">  } else if(a.length === 2) {</td></tr><tr><td class="line-number" value="1219"></td><td class="line-content">    num = Number(a[0]) + Math.round(Math.random()*(a[1]-a[0]));</td></tr><tr><td class="line-number" value="1220"></td><td class="line-content">  } else if(a.length &gt; 2) {</td></tr><tr><td class="line-number" value="1221"></td><td class="line-content">    num = Number(a[Math.floor(Math.random()*a.length)]);</td></tr><tr><td class="line-number" value="1222"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1223"></td><td class="line-content">  if(isNaN(num) || typeof num !== 'number') {</td></tr><tr><td class="line-number" value="1224"></td><td class="line-content">    if(a.length === 0) {</td></tr><tr><td class="line-number" value="1225"></td><td class="line-content">      __perchanceError(`You didn't give the selectMany() function any inputs when you used it on the node with the text "${__escapeHTMLSpecialChars(this.$text || this)}". You need to give it at least one input so it knows how long the list/array should be.`, {moduleName:this.$moduleName});</td></tr><tr><td class="line-number" value="1226"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="1227"></td><td class="line-content">      __perchanceError(`There's a problem with the inputs that you provided to the "selectMany" function when you used it on the node with the text "${__escapeHTMLSpecialChars(this.$text || this)}". You have given it the following input${a.length == 1 ? "" : "s"}: &lt;b&gt;${__escapeHTMLSpecialChars(a.join("&lt;/b&gt;, &lt;b&gt;"))}&lt;/b&gt;. ${a.length == 1 ? "This" : "These"} input${a.length == 1 ? "" : "s"} should be numeric (i.e. ${a.length == 1 ? "it" : "they"} should be${a.length == 1 ? " a " : " "} number${a.length == 1 ? "" : "s"}).`, {moduleName:this.$moduleName});</td></tr><tr><td class="line-number" value="1228"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1229"></td><td class="line-content">    return ["(syntax error)"];</td></tr><tr><td class="line-number" value="1230"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1231"></td><td class="line-content">  let arr = [];</td></tr><tr><td class="line-number" value="1232"></td><td class="line-content">  for(let i = 0; i &lt; num; i++) {</td></tr><tr><td class="line-number" value="1233"></td><td class="line-content">    arr.push(this.selectOne);</td></tr><tr><td class="line-number" value="1234"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1235"></td><td class="line-content">  // overwrite default array behaviour (selects a random one)</td></tr><tr><td class="line-number" value="1236"></td><td class="line-content">  // in the case where they don't specify a join() after the repeat:</td></tr><tr><td class="line-number" value="1237"></td><td class="line-content">  arr.toString = function() { return this.join(""); };</td></tr><tr><td class="line-number" value="1238"></td><td class="line-content">  return arr;</td></tr><tr><td class="line-number" value="1239"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1240"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1241"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1242"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1243"></td><td class="line-content">let __titleCaseMethod = function() {</td></tr><tr><td class="line-number" value="1244"></td><td class="line-content">  return this.toString().split(' ').map((s) =&gt; (s.slice(0, 1).toUpperCase() + s.slice(1).toLowerCase())).join(' ');</td></tr><tr><td class="line-number" value="1245"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1246"></td><td class="line-content">let __sentenceCaseMethod = function() {</td></tr><tr><td class="line-number" value="1247"></td><td class="line-content">  return this.toString().split(/([!?.]+)/g).map((s) =&gt; {</td></tr><tr><td class="line-number" value="1248"></td><td class="line-content">    let i = s.search(/[a-zA-Z]/);</td></tr><tr><td class="line-number" value="1249"></td><td class="line-content">    let a = s.slice(0, i);</td></tr><tr><td class="line-number" value="1250"></td><td class="line-content">    let b = s.slice(i, i+1).toUpperCase();</td></tr><tr><td class="line-number" value="1251"></td><td class="line-content">    let c = s.slice(i+1);</td></tr><tr><td class="line-number" value="1252"></td><td class="line-content">    return a + b + c;</td></tr><tr><td class="line-number" value="1253"></td><td class="line-content">  }).join("");</td></tr><tr><td class="line-number" value="1254"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1255"></td><td class="line-content">let __upperCaseMethod = function() {</td></tr><tr><td class="line-number" value="1256"></td><td class="line-content">  //debugger;</td></tr><tr><td class="line-number" value="1257"></td><td class="line-content">  return this.toString().toUpperCase();</td></tr><tr><td class="line-number" value="1258"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1259"></td><td class="line-content">let __lowerCaseMethod = function() {</td></tr><tr><td class="line-number" value="1260"></td><td class="line-content">  return this.toString().toLowerCase();</td></tr><tr><td class="line-number" value="1261"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1262"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1263"></td><td class="line-content">!function(e,a){"function"==typeof require&amp;&amp;"object"==typeof exports&amp;&amp;"object"==typeof module?module.exports=a():"function"==typeof define&amp;&amp;define.amd?define(function(){return a()}):e.pluralize=a()}(this,function(){var e=[],a=[],i={},r={},s={};function o(e){return"string"==typeof e?new RegExp("^"+e+"$","i"):e}function t(e,a){return e===a?a:e===e.toLowerCase()?a.toLowerCase():e===e.toUpperCase()?a.toUpperCase():e[0]===e[0].toUpperCase()?a.charAt(0).toUpperCase()+a.substr(1).toLowerCase():a.toLowerCase()}function n(e,a){return e.replace(a[0],function(i,r){var s,o,n=(s=a[1],o=arguments,s.replace(/\$(\d{1,2})/g,function(e,a){return o[a]||""}));return t(""===i?e[r-1]:i,n)})}function u(e,a,r){if(!e.length||i.hasOwnProperty(e))return a;for(var s=r.length;s--;){var o=r[s];if(o[0].test(a))return n(a,o)}return a}function l(e,a,i){return function(r){var s=r.toLowerCase();return a.hasOwnProperty(s)?t(r,s):e.hasOwnProperty(s)?t(r,e[s]):u(s,r,i)}}function c(e,a,i,r){return function(r){var s=r.toLowerCase();return!!a.hasOwnProperty(s)||!e.hasOwnProperty(s)&amp;&amp;u(s,s,i)===s}}function h(e,a,i){return(i?a+" ":"")+(1===a?h.singular(e):h.plural(e))}return h.plural=l(s,r,e),h.isPlural=c(s,r,e),h.singular=l(r,s,a),h.isSingular=c(r,s,a),h.addPluralRule=function(a,i){e.push([o(a),i])},h.addSingularRule=function(e,i){a.push([o(e),i])},h.addUncountableRule=function(e){"string"!=typeof e?(h.addPluralRule(e,"$0"),h.addSingularRule(e,"$0")):i[e.toLowerCase()]=!0},h.addIrregularRule=function(e,a){a=a.toLowerCase(),e=e.toLowerCase(),s[e]=a,r[a]=e},[["I","we"],["me","us"],["he","they"],["she","they"],["them","them"],["myself","ourselves"],["yourself","yourselves"],["itself","themselves"],["herself","themselves"],["himself","themselves"],["themself","themselves"],["is","are"],["was","were"],["has","have"],["this","these"],["that","those"],["echo","echoes"],["dingo","dingoes"],["volcano","volcanoes"],["tornado","tornadoes"],["torpedo","torpedoes"],["genus","genera"],["viscus","viscera"],["stigma","stigmata"],["stoma","stomata"],["dogma","dogmata"],["lemma","lemmata"],["schema","schemata"],["anathema","anathemata"],["ox","oxen"],["axe","axes"],["die","dice"],["yes","yeses"],["foot","feet"],["eave","eaves"],["goose","geese"],["tooth","teeth"],["quiz","quizzes"],["human","humans"],["proof","proofs"],["carve","carves"],["valve","valves"],["looey","looies"],["thief","thieves"],["groove","grooves"],["pickaxe","pickaxes"],["passerby","passersby"]].forEach(function(e){return h.addIrregularRule(e[0],e[1])}),[[/s?$/i,"s"],[/[^\u0000-\u007F]$/i,"$0"],[/([^aeiou]ese)$/i,"$1"],[/(ax|test)is$/i,"$1es"],[/(alias|[^aou]us|t[lm]as|gas|ris)$/i,"$1es"],[/(e[mn]u)s?$/i,"$1s"],[/([^l]ias|[aeiou]las|[ejzr]as|[iu]am)$/i,"$1"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1i"],[/(alumn|alg|vertebr)(?:a|ae)$/i,"$1ae"],[/(seraph|cherub)(?:im)?$/i,"$1im"],[/(her|at|gr)o$/i,"$1oes"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)(?:a|um)$/i,"$1a"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)(?:a|on)$/i,"$1a"],[/sis$/i,"ses"],[/(?:(kni|wi|li)fe|(ar|l|ea|eo|oa|hoo)f)$/i,"$1$2ves"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/([^ch][ieo][ln])ey$/i,"$1ies"],[/(x|ch|ss|sh|zz)$/i,"$1es"],[/(matr|cod|mur|sil|vert|ind|append)(?:ix|ex)$/i,"$1ices"],[/\b((?:tit)?m|l)(?:ice|ouse)$/i,"$1ice"],[/(pe)(?:rson|ople)$/i,"$1ople"],[/(child)(?:ren)?$/i,"$1ren"],[/eaux$/i,"$0"],[/m[ae]n$/i,"men"],["thou","you"]].forEach(function(e){return h.addPluralRule(e[0],e[1])}),[[/s$/i,""],[/(ss)$/i,"$1"],[/(wi|kni|(?:after|half|high|low|mid|non|night|[^\w]|^)li)ves$/i,"$1fe"],[/(ar|(?:wo|[ae])l|[eo][ao])ves$/i,"$1f"],[/ies$/i,"y"],[/(dg|ss|ois|lk|ok|wn|mb|th|ch|ec|oal|is|ck|ix|sser|ts|wb)ies$/i,"$1ie"],[/\b(l|(?:neck|cross|hog|aun)?t|coll|faer|food|gen|goon|group|hipp|junk|vegg|(?:pork)?p|charl|calor|cut)ies$/i,"$1ie"],[/\b(mon|smil)ies$/i,"$1ey"],[/\b((?:tit)?m|l)ice$/i,"$1ouse"],[/(seraph|cherub)im$/i,"$1"],[/(x|ch|ss|sh|zz|tto|go|cho|alias|[^aou]us|t[lm]as|gas|(?:her|at|gr)o|[aeiou]ris)(?:es)?$/i,"$1"],[/(analy|diagno|parenthe|progno|synop|the|empha|cri|ne)(?:sis|ses)$/i,"$1sis"],[/(movie|twelve|abuse|e[mn]u)s$/i,"$1"],[/(test)(?:is|es)$/i,"$1is"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1us"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|quor)a$/i,"$1um"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)a$/i,"$1on"],[/(alumn|alg|vertebr)ae$/i,"$1a"],[/(cod|mur|sil|vert|ind)ices$/i,"$1ex"],[/(matr|append)ices$/i,"$1ix"],[/(pe)(rson|ople)$/i,"$1rson"],[/(child)ren$/i,"$1"],[/(eau)x?$/i,"$1"],[/men$/i,"man"]].forEach(function(e){return h.addSingularRule(e[0],e[1])}),["adulthood","advice","agenda","aid","aircraft","alcohol","ammo","analytics","anime","athletics","audio","bison","blood","bream","buffalo","butter","carp","cash","chassis","chess","clothing","cod","commerce","cooperation","corps","debris","diabetes","digestion","elk","energy","equipment","excretion","expertise","firmware","flounder","fun","furniture","gallows","garbage","graffiti","hardware","headquarters","health","herpes","highjinks","homework","housework","information","jeans","justice","kudos","labour","literature","machinery","mackerel","mail","media","mews","moose","music","mud","manga","news","only","personnel","pike","plankton","pliers","police","pollution","premises","rain","research","rice","salmon","scissors","series","sewage","shambles","shrimp","software","staff","swine","tennis","traffic","transportation","trout","tuna","wealth","welfare","whiting","wildebeest","wildlife","you",/pok[e]mon$/i,/[^aeiou]ese$/i,/deer$/i,/fish$/i,/measles$/i,/o[iu]s$/i,/pox$/i,/sheep$/i].forEach(h.addUncountableRule),h});</td></tr><tr><td class="line-number" value="1264"></td><td class="line-content">window.__pluralize396795627295786 = window.pluralize; // winning</td></tr><tr><td class="line-number" value="1265"></td><td class="line-content">delete window.pluralize;</td></tr><tr><td class="line-number" value="1266"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1267"></td><td class="line-content">let __pluralFormMethod = function() {</td></tr><tr><td class="line-number" value="1268"></td><td class="line-content">  let input = this.toString();</td></tr><tr><td class="line-number" value="1269"></td><td class="line-content">  return __pluralize396795627295786(input);</td></tr><tr><td class="line-number" value="1270"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1271"></td><td class="line-content">  //let output = nlp(input).nouns().toPlural().out("text");</td></tr><tr><td class="line-number" value="1272"></td><td class="line-content">  //return output === "" ? input : output; // don't add "s" by default because the lib should already do it, and sometimes plural is same as singular (e.g. furniture)</td></tr><tr><td class="line-number" value="1273"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1274"></td><td class="line-content">let __singularFormMethod = function() {</td></tr><tr><td class="line-number" value="1275"></td><td class="line-content">  let input = this.toString();</td></tr><tr><td class="line-number" value="1276"></td><td class="line-content">  return __pluralize396795627295786(input, 1);</td></tr><tr><td class="line-number" value="1277"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1278"></td><td class="line-content">  // let output = nlp(input).nouns().toSingular().out("text");</td></tr><tr><td class="line-number" value="1279"></td><td class="line-content">  // return output === "" ? input : output;</td></tr><tr><td class="line-number" value="1280"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1281"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1282"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1283"></td><td class="line-content">let nlpCompromiseAddedWords = {abolish:"Verb",abound:"Verb",abstract:"Verb",accent:"Verb",accomplish:"Verb",admonish:"Verb",alert:"Verb",ally:"Verb",appropriate:"Verb",astonish:"Verb",auction:"Verb",audition:"Verb",average:"Verb",awake:"Verb",award:"Verb",back:"Verb",backpedal:"Verb",banish:"Verb",bank:"Verb",bankrupt:"Verb",better:"Verb",bill:"Verb",blacklist:"Verb",bless:"Verb",blind:"Verb",bloody:"Verb",blossom:"Verb",board:"Verb",bob:"Verb",bombard:"Verb",bottle:"Verb",brave:"Verb",breakfast:"Verb",brief:"Verb",bus:"Verb",busy:"Verb",butcher:"Verb",butter:"Verb",cake:"Verb",calm:"Verb",captain:"Verb",care:"Verb",cash:"Verb",caution:"Verb",center:"Verb",cherish:"Verb",christen:"Verb",chronicle:"Verb",chuck:"Verb",circumvent:"Verb",clean:"Verb",clear:"Verb",club:"Verb",commission:"Verb",complete:"Verb",comply:"Verb",conceal:"Verb",condition:"Verb",content:"Verb",contrive:"Verb",cool:"Verb",correct:"Verb",corrupt:"Verb",critique:"Verb",cup:"Verb",dawn:"Verb",degenerate:"Verb",demolish:"Verb",deprive:"Verb",derive:"Verb",design:"Verb",diminish:"Verb",disable:"Verb",discard:"Verb",disregard:"Verb",don:"Verb",double:"Verb",down:"Verb",dry:"Verb",dull:"Verb",elaborate:"Verb",embellish:"Verb",empty:"Verb",engineer:"Verb",enlist:"Verb",equal:"Verb",erect:"Verb",exact:"Verb",faint:"Verb",fake:"Verb",fancy:"Verb",fine:"Verb",firm:"Verb",fish:"Verb",fit:"Verb",flatter:"Verb",flicker:"Verb",flourish:"Verb",fly:"Verb",ford:"Verb",forward:"Verb",foster:"Verb",foul:"Verb",free:"Verb",frequent:"Verb",fund:"Verb",furnish:"Verb",further:"Verb",garnish:"Verb",gossip:"Verb",grace:"Verb",grant:"Verb",ground:"Verb",group:"Verb",herald:"Verb",hoist:"Verb",hollow:"Verb",hope:"Verb",house:"Verb",hum:"Verb",humble:"Verb",ice:"Verb",impoverish:"Verb",indent:"Verb",index:"Verb",initial:"Verb",institute:"Verb",inventory:"Verb",knot:"Verb",last:"Verb",lavish:"Verb",lean:"Verb",light:"Verb",lobby:"Verb",long:"Verb",lower:"Verb",lunch:"Verb",mail:"Verb",man:"Verb",mark:"Verb",marshal:"Verb",mature:"Verb",mean:"Verb",mellow:"Verb",milk:"Verb",mimic:"Verb",mine:"Verb",model:"Verb",moderate:"Verb",motion:"Verb",mute:"Verb",narrow:"Verb",near:"Verb",nestle:"Verb",nick:"Verb",number:"Verb",nurse:"Verb",obscure:"Verb",oil:"Verb",open:"Verb",outlive:"Verb",overcrowd:"Verb",overdo:"Verb",overeat:"Verb",overflow:"Verb",overhaul:"Verb",overhear:"Verb",overheat:"Verb",overload:"Verb",overlook:"Verb",overpower:"Verb",overrule:"Verb",oversee:"Verb",overshadow:"Verb",oversleep:"Verb",overthrow:"Verb",overturn:"Verb",own:"Verb",panic:"Verb",part:"Verb",partition:"Verb",patent:"Verb",patrol:"Verb",pedal:"Verb",pepper:"Verb",perfect:"Verb",perish:"Verb",petition:"Verb",plant:"Verb",please:"Verb",ply:"Verb",police:"Verb",polish:"Verb",position:"Verb",post:"Verb",pound:"Verb",power:"Verb",press:"Verb",pressure:"Verb",prime:"Verb",pucker:"Verb",punish:"Verb",query:"Verb",quiz:"Verb",rain:"Verb",rally:"Verb",ration:"Verb",rear:"Verb",rebel:"Verb",rebound:"Verb",refurbish:"Verb",relish:"Verb",repeal:"Verb",replenish:"Verb",requisition:"Verb",research:"Verb",reserve:"Verb",rev:"Verb",revive:"Verb",right:"Verb",ring:"Verb",rival:"Verb",round:"Verb",salt:"Verb",sanction:"Verb",scent:"Verb",school:"Verb",secure:"Verb",separate:"Verb",service:"Verb",shut:"Verb",signal:"Verb",silhouette:"Verb",single:"Verb",slow:"Verb",smooth:"Verb",snicker:"Verb",snow:"Verb",sour:"Verb",space:"Verb",spare:"Verb",speed:"Verb",spike:"Verb",spiral:"Verb",spy:"Verb",square:"Verb",stable:"Verb",station:"Verb",steady:"Verb",steam:"Verb",stuff:"Verb",sue:"Verb",tame:"Verb",tan:"Verb",taper:"Verb",tarnish:"Verb",tender:"Verb",tense:"Verb",thin:"Verb",thunder:"Verb",till:"Verb",time:"Verb",top:"Verb",total:"Verb",trouble:"Verb",undercut:"Verb",underline:"Verb",undertake:"Verb",undervalue:"Verb",up:"Verb",upset:"Verb",utter:"Verb",vanish:"Verb",varnish:"Verb",void:"Verb",wade:"Verb",warm:"Verb",water:"Verb",weather:"Verb",wed:"Verb",welcome:"Verb",woo:"Verb",wound:"Verb"};</td></tr><tr><td class="line-number" value="1284"></td><td class="line-content">let __pastTenseMethod = function() {</td></tr><tr><td class="line-number" value="1285"></td><td class="line-content">  let word = this.toString();</td></tr><tr><td class="line-number" value="1286"></td><td class="line-content">  if(word === "hope" || word === "hopes" || word === "hoped" || word === "hoping") return "hoped";</td></tr><tr><td class="line-number" value="1287"></td><td class="line-content">  if(word === "bill" || word === "bills" || word === "billed" || word === "billing") return "billed";</td></tr><tr><td class="line-number" value="1288"></td><td class="line-content">  if(word === "dawn" || word === "dawns" || word === "dawned" || word === "dawning") return "dawned";</td></tr><tr><td class="line-number" value="1289"></td><td class="line-content">  //return nlp(this.toString(), nlpCompromiseAddedWords).sentences().toPastTense().out("text")</td></tr><tr><td class="line-number" value="1290"></td><td class="line-content">  let out = __nlpCompromise("They "+this.toString(), nlpCompromiseAddedWords).verbs().conjugate()[0];</td></tr><tr><td class="line-number" value="1291"></td><td class="line-content">  return out ? out.PastTense : this.toString()+"ed";</td></tr><tr><td class="line-number" value="1292"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1293"></td><td class="line-content">let __futureTenseMethod = function() {</td></tr><tr><td class="line-number" value="1294"></td><td class="line-content">  let word = this.toString();</td></tr><tr><td class="line-number" value="1295"></td><td class="line-content">  if(word === "hope" || word === "hopes" || word === "hoped" || word === "hoping") return "will hope";</td></tr><tr><td class="line-number" value="1296"></td><td class="line-content">  if(word === "bill" || word === "bills" || word === "billed" || word === "billing") return "will bill";</td></tr><tr><td class="line-number" value="1297"></td><td class="line-content">  if(word === "dawn" || word === "dawns" || word === "dawned" || word === "dawning") return "will dawn";</td></tr><tr><td class="line-number" value="1298"></td><td class="line-content">  //return nlp(this.toString(), nlpCompromiseAddedWords).sentences().toFutureTense().out("text")</td></tr><tr><td class="line-number" value="1299"></td><td class="line-content">  let out = __nlpCompromise("They "+this.toString(), nlpCompromiseAddedWords).verbs().conjugate()[0];</td></tr><tr><td class="line-number" value="1300"></td><td class="line-content">  return out ? out.FutureTense : this.toString()+"ed";</td></tr><tr><td class="line-number" value="1301"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1302"></td><td class="line-content">let __presentTenseMethod = function() {</td></tr><tr><td class="line-number" value="1303"></td><td class="line-content">  let word = this.toString();</td></tr><tr><td class="line-number" value="1304"></td><td class="line-content">  if(word === "hope" || word === "hopes" || word === "hoped" || word === "hoping") return "hopes";</td></tr><tr><td class="line-number" value="1305"></td><td class="line-content">  if(word === "bill" || word === "bills" || word === "billed" || word === "billing") return "bills";</td></tr><tr><td class="line-number" value="1306"></td><td class="line-content">  if(word === "dawn" || word === "dawns" || word === "dawned" || word === "dawning") return "dawns";</td></tr><tr><td class="line-number" value="1307"></td><td class="line-content">  //return nlp(this.toString(), nlpCompromiseAddedWords).sentences().toPresentTense().out("text")</td></tr><tr><td class="line-number" value="1308"></td><td class="line-content">  let out = __nlpCompromise("They "+this.toString(), nlpCompromiseAddedWords).verbs().conjugate()[0];</td></tr><tr><td class="line-number" value="1309"></td><td class="line-content">  return out ? out.PresentTense : this.toString()+"ed";</td></tr><tr><td class="line-number" value="1310"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1311"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1312"></td><td class="line-content">let __negativeFormMethod = function() {</td></tr><tr><td class="line-number" value="1313"></td><td class="line-content">  return __nlpCompromise(this.toString()).sentences().toNegative().out("text");</td></tr><tr><td class="line-number" value="1314"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="1315"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1316"></td><td class="line-content">// let ordinalMethod = function() {</td></tr><tr><td class="line-number" value="1317"></td><td class="line-content">//   return nlp.getOrdinal(this.toString());</td></tr><tr><td class="line-number" value="1318"></td><td class="line-content">// };</td></tr><tr><td class="line-number" value="1319"></td><td class="line-content">// let withArticleMethod = function() {</td></tr><tr><td class="line-number" value="1320"></td><td class="line-content">//   return nlp.getWithArticle(this.toString());</td></tr><tr><td class="line-number" value="1321"></td><td class="line-content">// };</td></tr><tr><td class="line-number" value="1322"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1323"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="1324"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="1325"></td><td class="line-content">function __evaluateSquareBlock(root, thisRef, expression, ctxInfo={}) {</td></tr><tr><td class="line-number" value="1326"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1327"></td><td class="line-content">  // NOTE: if the `with` keyword ever gets actually deprecated (very, very unlikely - 2ality's</td></tr><tr><td class="line-number" value="1328"></td><td class="line-content">  // article is a bit misleading I think), you can just craft up a function declaration with each</td></tr><tr><td class="line-number" value="1329"></td><td class="line-content">  // of the root variables so they get passed in as the evaled function's arguments (simple!)</td></tr><tr><td class="line-number" value="1330"></td><td class="line-content">  // new Function(param1, ..., paramN, funcBody) -&gt; http://www.2ality.com/2014/01/eval.html</td></tr><tr><td class="line-number" value="1331"></td><td class="line-content">  // only thing is: i need to make sure the getters are still triggered on the proxy when I grab the properties (why wouldn't they be?). hmm</td></tr><tr><td class="line-number" value="1332"></td><td class="line-content">  // oh but also I don't want to trigger ALL of them (could be a couple of thousand params for every single square bloc executed...)</td></tr><tr><td class="line-number" value="1333"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1334"></td><td class="line-content">  let originalExpression = expression;</td></tr><tr><td class="line-number" value="1335"></td><td class="line-content">  expression = expression.trim();</td></tr><tr><td class="line-number" value="1336"></td><td class="line-content">  //expression = prependReturnKeywordIfNeeded(expression);</td></tr><tr><td class="line-number" value="1337"></td><td class="line-content">  //let evalJSCode = eval.bind(thisRef);</td></tr><tr><td class="line-number" value="1338"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1339"></td><td class="line-content">  if(window.__throwErrorIfNonDirectListReferenceIsFoundDuringEvaluateSquareBlock) {</td></tr><tr><td class="line-number" value="1340"></td><td class="line-content">    if(!__isValidJavaScriptIdentifier(expression)) {</td></tr><tr><td class="line-number" value="1341"></td><td class="line-content">      throw new Error("this is a harmless error - it's just used to break out of the direct-node-linking process createPerchanceTree");</td></tr><tr><td class="line-number" value="1342"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1343"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1344"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1345"></td><td class="line-content">  // **WITHIN a node**, we don't want references to `this` to result in "$output"</td></tr><tr><td class="line-number" value="1346"></td><td class="line-content">  // Otherwise we're very limited in terms of how we can interact with "local" items (can't use selectOne, etc. EVEN IN `$output` (since it would reference itself no matter what))</td></tr><tr><td class="line-number" value="1347"></td><td class="line-content">  // Note that we can't just temporarily set $output to undefined, because the square block that we're evaluating could reference another list which references THIS list and expects $output to work. We only want uses of `this` in this square block (and uses of `this` within chained methods like selectOne in this example: `[this.selectOne]` - hence the need to bind functions to this proxy)</td></tr><tr><td class="line-number" value="1348"></td><td class="line-content">  // REF:kjhfw927f63ohwkgw82g</td></tr><tr><td class="line-number" value="1349"></td><td class="line-content">  let proxiedThisRef = undefined;</td></tr><tr><td class="line-number" value="1350"></td><td class="line-content">  if(Object.getOwnPropertyDescriptor(thisRef, "$output")) {</td></tr><tr><td class="line-number" value="1351"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1352"></td><td class="line-content">    proxiedThisRef = new Proxy(thisRef, {</td></tr><tr><td class="line-number" value="1353"></td><td class="line-content">      get: function(target, property) {</td></tr><tr><td class="line-number" value="1354"></td><td class="line-content">        if(property === "$output") {</td></tr><tr><td class="line-number" value="1355"></td><td class="line-content">          return undefined; // &lt;-- we pretend that this list doesn't have an $output property so that node methods like toString don't use it.</td></tr><tr><td class="line-number" value="1356"></td><td class="line-content">        } else if(property === "___$outputShouldBeHidden") {</td></tr><tr><td class="line-number" value="1357"></td><td class="line-content">          return true; // this is a hack to tell the consumableList proxy to hide the $output property (since we can only bind a function to one of the proxies)</td></tr><tr><td class="line-number" value="1358"></td><td class="line-content">        } else if(property === "___proxyTarget") {</td></tr><tr><td class="line-number" value="1359"></td><td class="line-content">          return thisRef;</td></tr><tr><td class="line-number" value="1360"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="1361"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1362"></td><td class="line-content">          let desc = Object.getOwnPropertyDescriptor(target, property);</td></tr><tr><td class="line-number" value="1363"></td><td class="line-content">          if(!desc) {</td></tr><tr><td class="line-number" value="1364"></td><td class="line-content">            //perchanceError(`The '${property}' property doesn't exist within '${target.$text}'.`, ctxInfo.declarationLineNumber);</td></tr><tr><td class="line-number" value="1365"></td><td class="line-content">            return undefined;</td></tr><tr><td class="line-number" value="1366"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="1367"></td><td class="line-content">          </td></tr><tr><td class="line-number" value="1368"></td><td class="line-content">          if(desc.get) {</td></tr><tr><td class="line-number" value="1369"></td><td class="line-content">            return desc.get.bind(proxiedThisRef)(); // &lt;-- need to bind to this proxy so that the $output property is hidden from all successively chained functions - e.g. this.consumableList.selectOne.toString()</td></tr><tr><td class="line-number" value="1370"></td><td class="line-content">          } else if(desc.value &amp;&amp; typeof desc.value === 'function') {</td></tr><tr><td class="line-number" value="1371"></td><td class="line-content">            return desc.value.bind(proxiedThisRef);</td></tr><tr><td class="line-number" value="1372"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="1373"></td><td class="line-content">            return target[property];</td></tr><tr><td class="line-number" value="1374"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="1375"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1376"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1377"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1378"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="1379"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1380"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1381"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1382"></td><td class="line-content">  try {</td></tr><tr><td class="line-number" value="1383"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1384"></td><td class="line-content">    let tempHasHandlerHolder;</td></tr><tr><td class="line-number" value="1385"></td><td class="line-content">    if(root.___isProxy) {</td></tr><tr><td class="line-number" value="1386"></td><td class="line-content">      tempHasHandlerHolder = root.___proxyHandler.has;</td></tr><tr><td class="line-number" value="1387"></td><td class="line-content">      root.___proxyHandler.has = window.__rootProxyHasHandler_Greedy.bind(root.___proxyHandler);</td></tr><tr><td class="line-number" value="1388"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1389"></td><td class="line-content">    window.__currentEvaluateSquareBlockRoot = root; // this is for String.prototype.evaluateItem, etc. handlers because otherwise they have no way of accessing their root if they are from an *imported* generator.</td></tr><tr><td class="line-number" value="1390"></td><td class="line-content">    let result = (function(){ return eval(`with(${window.__withExportDebug83748 ? "root.___proxyTarget.withObjProxy" : "root"}){${expression}}`); }).apply(proxiedThisRef || thisRef); // NOTE: we can't change this to `with(root.getSelf)` because we're using the proxy to make it so [thingThatDoesntExist] returns undefined rather than throwing a syntax error.</td></tr><tr><td class="line-number" value="1391"></td><td class="line-content">    if(root.___isProxy) root.___proxyHandler.has = tempHasHandlerHolder; //.bind(root.___proxyHandler);</td></tr><tr><td class="line-number" value="1392"></td><td class="line-content">    window.__currentEvaluateSquareBlockRoot = null;</td></tr><tr><td class="line-number" value="1393"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1394"></td><td class="line-content">    if(result === undefined) {</td></tr><tr><td class="line-number" value="1395"></td><td class="line-content">      __perchanceError(`The expression '[${__escapeHTMLSpecialChars(originalExpression)}]' returned nothing (&lt;code&gt;undefined&lt;/code&gt;). You may be trying to reference a list, variable, or function that doesn't exist. Here are some common causes of this error: &lt;ul&gt;&lt;li&gt;You tried to reference a list/variable that you haven't created. For example, if you wrote [animal], but there was no top-level list called "animal", then you would get this error. Note that names are &lt;b&gt;case-sensitive&lt;/b&gt; - check your capitalization.&lt;/li&gt;&lt;li&gt;If you misspell a property/function name, then you'll get this error. For example "[noun.pluralFormm]" would produce this error because "pluralForm" has been misspelled.&lt;/li&gt;&lt;li&gt;If you try to access a property of an object that doesn't exist, or that evaluates to something which doesn't exist, then you'll get this error.&lt;/li&gt;&lt;/ul&gt; These errors can sometimes be hard to debug, so after you've given it your best shot, please post a question over on the &lt;a href="https://lemmy.world/c/perchance"&gt;perchance community&lt;/a&gt; and a friendly community member will help you out :)`, ctxInfo);</td></tr><tr><td class="line-number" value="1396"></td><td class="line-content">      return undefined;</td></tr><tr><td class="line-number" value="1397"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="1398"></td><td class="line-content">      if(typeof result === 'string' &amp;&amp; String(Number(result)) === result) {</td></tr><tr><td class="line-number" value="1399"></td><td class="line-content">        return Number(result);</td></tr><tr><td class="line-number" value="1400"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="1401"></td><td class="line-content">        return result;</td></tr><tr><td class="line-number" value="1402"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1403"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1404"></td><td class="line-content">  } catch(e) {</td></tr><tr><td class="line-number" value="1405"></td><td class="line-content">    if(window.__throwErrorIfNonDirectListReferenceIsFoundDuringEvaluateSquareBlock) {</td></tr><tr><td class="line-number" value="1406"></td><td class="line-content">      throw new Error("ignore this");</td></tr><tr><td class="line-number" value="1407"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1408"></td><td class="line-content">    if(e.message.toLowerCase().includes("call stack size")) {</td></tr><tr><td class="line-number" value="1409"></td><td class="line-content">      __perchanceError(`There's a problem with the syntax of this expression: '[${__escapeHTMLSpecialChars(originalExpression)}]'. Here's the message that was returned when execution failed: &lt;b&gt;${__escapeHTMLSpecialChars(e.message.slice(0, 5000))}&lt;/b&gt;. It may be that you've accidentally created an "infinite loop" by making a list reference itself, or something like that.`, ctxInfo);</td></tr><tr><td class="line-number" value="1410"></td><td class="line-content">    } else if(e.message.toLowerCase().includes("token") &amp;&amp; (originalExpression.includes("") || originalExpression.includes(""))) {</td></tr><tr><td class="line-number" value="1411"></td><td class="line-content">      __perchanceError(`There's a problem with the syntax of this expression: '[${__escapeHTMLSpecialChars(originalExpression)}]'. Here's the message that was returned when execution failed: &lt;b&gt;${__escapeHTMLSpecialChars(e.message.slice(0, 5000))}&lt;/b&gt;. It looks like you might be using "curly quotes" (like this: &lt;code&gt;blah&lt;/code&gt;) instead of normal quotes (like this: &lt;code&gt;"blah"&lt;/code&gt;)? Perchance requires that you use normal quotes for text inside square brackets (e.g. &lt;code&gt;[a = animal.selectOne,""]&lt;/code&gt;).`, ctxInfo);</td></tr><tr><td class="line-number" value="1412"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="1413"></td><td class="line-content">      __perchanceError(`There's a problem with the syntax of this expression: '[${__escapeHTMLSpecialChars(originalExpression)}]'. Here's the message that was returned when execution failed: &lt;b&gt;${__escapeHTMLSpecialChars(e.message)}&lt;/b&gt;. Here are some common mistakes: &lt;ul&gt;&lt;li&gt;you tried to reference a variable/list that you haven't created&lt;/li&gt;&lt;li&gt;list names are case-sensitive: "[animal]" is different to [Animal], and you should use underscores in list names instead of spaces&lt;/li&gt;&lt;/ul&gt;`, ctxInfo);</td></tr><tr><td class="line-number" value="1414"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1415"></td><td class="line-content">    return "(syntax error)";</td></tr><tr><td class="line-number" value="1416"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1417"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1418"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1419"></td><td class="line-content">// function prependReturnKeywordIfNeeded(expression) {</td></tr><tr><td class="line-number" value="1420"></td><td class="line-content">//   // if single line without return statement, add it</td></tr><tr><td class="line-number" value="1421"></td><td class="line-content">//   if(/\n/.test(expression) || /(^|\s|;|\}|\{|\)|\()return\s/.test(expression)) {</td></tr><tr><td class="line-number" value="1422"></td><td class="line-content">//     return expression;</td></tr><tr><td class="line-number" value="1423"></td><td class="line-content">//   } else {</td></tr><tr><td class="line-number" value="1424"></td><td class="line-content">//     return "return "+expression;</td></tr><tr><td class="line-number" value="1425"></td><td class="line-content">//   }</td></tr><tr><td class="line-number" value="1426"></td><td class="line-content">// }</td></tr><tr><td class="line-number" value="1427"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1428"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1429"></td><td class="line-content">// function expressionHasSemiColon(text) {</td></tr><tr><td class="line-number" value="1430"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1431"></td><td class="line-content">//   let escaped = false;</td></tr><tr><td class="line-number" value="1432"></td><td class="line-content">//   let inJSExprString1 = false;</td></tr><tr><td class="line-number" value="1433"></td><td class="line-content">//   let inJSExprString2 = false;</td></tr><tr><td class="line-number" value="1434"></td><td class="line-content">//   let inJSExprString3 = false;</td></tr><tr><td class="line-number" value="1435"></td><td class="line-content">//   let inRegExp = false;</td></tr><tr><td class="line-number" value="1436"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1437"></td><td class="line-content">//   for(let i = 0; i &lt; text.length; i++) {</td></tr><tr><td class="line-number" value="1438"></td><td class="line-content">//     if(i !== 0) {</td></tr><tr><td class="line-number" value="1439"></td><td class="line-content">//       if(text[i-1] !== "\\") { escaped = false; }</td></tr><tr><td class="line-number" value="1440"></td><td class="line-content">//     }</td></tr><tr><td class="line-number" value="1441"></td><td class="line-content">//     if(text[i] === "\\") { escaped = !escaped; }</td></tr><tr><td class="line-number" value="1442"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1443"></td><td class="line-content">//     ////////////////////////////////////</td></tr><tr><td class="line-number" value="1444"></td><td class="line-content">//     //           skip regexp          //</td></tr><tr><td class="line-number" value="1445"></td><td class="line-content">//     ////////////////////////////////////</td></tr><tr><td class="line-number" value="1446"></td><td class="line-content">//     if(!inRegExp &amp;&amp; !inJSExprString1 &amp;&amp; !inJSExprString2 &amp;&amp; !inJSExprString3 &amp;&amp; text[i] === "/") { inRegExp = true; continue; }</td></tr><tr><td class="line-number" value="1447"></td><td class="line-content">//     if(inRegExp &amp;&amp; text[i] !== "/") { continue; }</td></tr><tr><td class="line-number" value="1448"></td><td class="line-content">//     if(inRegExp &amp;&amp; !escaped &amp;&amp; text[i] === "/") { inRegExp = false; continue; }</td></tr><tr><td class="line-number" value="1449"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1450"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1451"></td><td class="line-content">//     ////////////////////////////////////</td></tr><tr><td class="line-number" value="1452"></td><td class="line-content">//     //          skip strings          //</td></tr><tr><td class="line-number" value="1453"></td><td class="line-content">//     ////////////////////////////////////</td></tr><tr><td class="line-number" value="1454"></td><td class="line-content">//     if(!inJSExprString1 &amp;&amp; !inRegExp &amp;&amp; text[i] === "\"") { inJSExprString1 = true; continue; }</td></tr><tr><td class="line-number" value="1455"></td><td class="line-content">//     if(inJSExprString1 &amp;&amp; !escaped &amp;&amp; text[i] !== "\"") { continue; }</td></tr><tr><td class="line-number" value="1456"></td><td class="line-content">//     if(inJSExprString1 &amp;&amp; !escaped &amp;&amp; text[i] === "\"") { inJSExprString1 = false; continue; }</td></tr><tr><td class="line-number" value="1457"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1458"></td><td class="line-content">//     if(!inJSExprString2 &amp;&amp; !inRegExp &amp;&amp; text[i] === "'") { inJSExprString2 = true; continue; }</td></tr><tr><td class="line-number" value="1459"></td><td class="line-content">//     if(inJSExprString2 &amp;&amp; !escaped &amp;&amp; text[i] !== "'") { continue; }</td></tr><tr><td class="line-number" value="1460"></td><td class="line-content">//     if(inJSExprString2 &amp;&amp; !escaped &amp;&amp; text[i] === "'") { inJSExprString2 = false; continue; }</td></tr><tr><td class="line-number" value="1461"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1462"></td><td class="line-content">//     if(!inJSExprString3 &amp;&amp; !inRegExp &amp;&amp; text[i] === "`") { inJSExprString3 = true; continue; }</td></tr><tr><td class="line-number" value="1463"></td><td class="line-content">//     if(inJSExprString3 &amp;&amp; !escaped &amp;&amp; text[i] !== "`") { continue; }</td></tr><tr><td class="line-number" value="1464"></td><td class="line-content">//     if(inJSExprString3 &amp;&amp; !escaped &amp;&amp; text[i] === "`") { inJSExprString3 = false; continue; }</td></tr><tr><td class="line-number" value="1465"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1466"></td><td class="line-content">//     if(!inJSExprString3 &amp;&amp; !escaped &amp;&amp; text[i] === "`") {</td></tr><tr><td class="line-number" value="1467"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1468"></td><td class="line-content">//     if(!inJSExprString1 &amp;&amp; !inJSExprString2 &amp;&amp; !inJSExprString3 &amp;&amp; !inRegExp) {</td></tr><tr><td class="line-number" value="1469"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1470"></td><td class="line-content">//     }</td></tr><tr><td class="line-number" value="1471"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1472"></td><td class="line-content">//   }</td></tr><tr><td class="line-number" value="1473"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1474"></td><td class="line-content">//   return false;</td></tr><tr><td class="line-number" value="1475"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="1476"></td><td class="line-content">// }</td></tr><tr><td class="line-number" value="1477"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1478"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="1479"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="1480"></td><td class="line-content">// Heads up: This code is extremely messy and hacked together. Many comments are outdated.</td></tr><tr><td class="line-number" value="1481"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1482"></td><td class="line-content">let NODE_ODDS_INDICATOR_CHARACTER = "^";</td></tr><tr><td class="line-number" value="1483"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1484"></td><td class="line-content">window.__rootProxyHasHandler; // &lt;-- gets set after rootProxy creation</td></tr><tr><td class="line-number" value="1485"></td><td class="line-content">window.__rootProxyHasHandler_Greedy = function(target, prop) {</td></tr><tr><td class="line-number" value="1486"></td><td class="line-content">  if(prop in window) {</td></tr><tr><td class="line-number" value="1487"></td><td class="line-content">    if(prop in this.executeChain(target, this.capturedCalls)) {</td></tr><tr><td class="line-number" value="1488"></td><td class="line-content">      return true;</td></tr><tr><td class="line-number" value="1489"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="1490"></td><td class="line-content">      return false; // don't be so greedy that we steal window's props even when `window` has it and `root` doesn't.</td></tr><tr><td class="line-number" value="1491"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1492"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="1493"></td><td class="line-content">    return true;</td></tr><tr><td class="line-number" value="1494"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1495"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="1496"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1497"></td><td class="line-content">// window.globalProxyLoopCount = 0;</td></tr><tr><td class="line-number" value="1498"></td><td class="line-content">// function proxyLoopCountResetLoop() {</td></tr><tr><td class="line-number" value="1499"></td><td class="line-content">//   window.globalProxyLoopCount = 0;</td></tr><tr><td class="line-number" value="1500"></td><td class="line-content">//   setTimeout(proxyLoopCountResetLoop, 1000);</td></tr><tr><td class="line-number" value="1501"></td><td class="line-content">// }</td></tr><tr><td class="line-number" value="1502"></td><td class="line-content">// proxyLoopCountResetLoop();</td></tr><tr><td class="line-number" value="1503"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1504"></td><td class="line-content">function __createPerchanceTree(text, moduleName, backupModuleName /*&lt;-- this is for the hacky node creation function*/, doNotPreprocess) {</td></tr><tr><td class="line-number" value="1505"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1506"></td><td class="line-content">  const functionStartTime = Date.now();</td></tr><tr><td class="line-number" value="1507"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1508"></td><td class="line-content">  /*</td></tr><tr><td class="line-number" value="1509"></td><td class="line-content">    There are two main steps in creating the tree:</td></tr><tr><td class="line-number" value="1510"></td><td class="line-content">    1. We split up the text into lines and collect all the data we need about each line (e.g. odds, line number, etc.) and tidy it up as necessary (e.g. .trim() it, or remove it completely if it's a comment). Then we group sets of lines that are below a function header into said function header. We create all the parent/child hierarchy links along the way.</td></tr><tr><td class="line-number" value="1511"></td><td class="line-content">    2. We turn all that node data into a neat "perchance tree" which has the properties required to make the DSL work nicely, and we attach all the perchance methods to each node. Then we return the root node in this tree.</td></tr><tr><td class="line-number" value="1512"></td><td class="line-content">  */</td></tr><tr><td class="line-number" value="1513"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1514"></td><td class="line-content">  // remove inline comments</td></tr><tr><td class="line-number" value="1515"></td><td class="line-content">  let lines = text.replace(/\r/g,"").split("\n");</td></tr><tr><td class="line-number" value="1516"></td><td class="line-content">  const commentRegex = /\/\//;</td></tr><tr><td class="line-number" value="1517"></td><td class="line-content">  for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1518"></td><td class="line-content">    if(!commentRegex.test(lines[i])) continue; // &lt;-- just an optimisation</td></tr><tr><td class="line-number" value="1519"></td><td class="line-content">    lines[i] = __stripCommentFromLine(lines[i]);</td></tr><tr><td class="line-number" value="1520"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1521"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1522"></td><td class="line-content">  // *trim* EMPTY lines (otherwise whitespace can throw indentation error in next step)</td></tr><tr><td class="line-number" value="1523"></td><td class="line-content">  // we need to keep blank lines so line numbers are preserved. they're removed in a bit</td></tr><tr><td class="line-number" value="1524"></td><td class="line-content">  lines = lines.map(text =&gt; /[^\s]/.test(text) ? text : text.trim());</td></tr><tr><td class="line-number" value="1525"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1526"></td><td class="line-content">  // mixed spaces and tabs -&gt; only tabs</td></tr><tr><td class="line-number" value="1527"></td><td class="line-content">  for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1528"></td><td class="line-content">    let normed = __normaliseLineIndentsToTabs(lines[i]);</td></tr><tr><td class="line-number" value="1529"></td><td class="line-content">    if(normed === false) {</td></tr><tr><td class="line-number" value="1530"></td><td class="line-content">      __perchanceError(`There appears to be an indenting error on this line near this text: "${__escapeHTMLSpecialChars(lines[i].substr(0,30))}". Perchance lists should be indented with either one tab or two spaces (per nesting level). If you want to have a space before a list item, then you should start the item with "\\s" (backslash + "s") which will be converted into a space (you can read more about this in the &lt;a href="/tutorial"&gt;tutorial&lt;/a&gt;).`, {declarationLineNumber:i+1, moduleName});</td></tr><tr><td class="line-number" value="1531"></td><td class="line-content">      return;</td></tr><tr><td class="line-number" value="1532"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="1533"></td><td class="line-content">      lines[i] = normed;</td></tr><tr><td class="line-number" value="1534"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1535"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1536"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1537"></td><td class="line-content">  // make lines objects</td></tr><tr><td class="line-number" value="1538"></td><td class="line-content">  for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1539"></td><td class="line-content">    lines[i] = {</td></tr><tr><td class="line-number" value="1540"></td><td class="line-content">      text: lines[i],</td></tr><tr><td class="line-number" value="1541"></td><td class="line-content">      indents: lines[i].search(/[^\t]/), //index of first non-tab</td></tr><tr><td class="line-number" value="1542"></td><td class="line-content">      lineNumber:i+1, // plus one because line num start at 1 by convention</td></tr><tr><td class="line-number" value="1543"></td><td class="line-content">      children:[],</td></tr><tr><td class="line-number" value="1544"></td><td class="line-content">      parent: null,</td></tr><tr><td class="line-number" value="1545"></td><td class="line-content">      // REMEMBER: if you add anything here you need to add it to root line bject and line objects created in inline declarations</td></tr><tr><td class="line-number" value="1546"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1547"></td><td class="line-content">    lines[i].text = lines[i].text.trim(); //trim away indents and end whitespace</td></tr><tr><td class="line-number" value="1548"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1549"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1550"></td><td class="line-content">  // remove blank lines, but keep track of them via a reference from the line above (which works fine for successive blank lines), so we can add them back for function bodies (since e.g. in multi-line string the blank lines matter)</td></tr><tr><td class="line-number" value="1551"></td><td class="line-content">  lines = lines.filter((l, i) =&gt; {</td></tr><tr><td class="line-number" value="1552"></td><td class="line-content">    if(l.text === "") {</td></tr><tr><td class="line-number" value="1553"></td><td class="line-content">      if(lines[i-1]) lines[i-1].blankLineBelow = l;</td></tr><tr><td class="line-number" value="1554"></td><td class="line-content">      return false;</td></tr><tr><td class="line-number" value="1555"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="1556"></td><td class="line-content">      return true;</td></tr><tr><td class="line-number" value="1557"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1558"></td><td class="line-content">  });</td></tr><tr><td class="line-number" value="1559"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1560"></td><td class="line-content">  // create parent-child hierarchy</td></tr><tr><td class="line-number" value="1561"></td><td class="line-content">  let root = {</td></tr><tr><td class="line-number" value="1562"></td><td class="line-content">    text:"&lt;root&gt;",</td></tr><tr><td class="line-number" value="1563"></td><td class="line-content">    indents:-1,</td></tr><tr><td class="line-number" value="1564"></td><td class="line-content">    lineNumber:-1,</td></tr><tr><td class="line-number" value="1565"></td><td class="line-content">    children:[],</td></tr><tr><td class="line-number" value="1566"></td><td class="line-content">    parent: null,</td></tr><tr><td class="line-number" value="1567"></td><td class="line-content">    nodeType: "text",</td></tr><tr><td class="line-number" value="1568"></td><td class="line-content">    odds: "1",</td></tr><tr><td class="line-number" value="1569"></td><td class="line-content">    perchanceCode:"",</td></tr><tr><td class="line-number" value="1570"></td><td class="line-content">    //expressionArray: ["&lt;root&gt;"],</td></tr><tr><td class="line-number" value="1571"></td><td class="line-content">  };</td></tr><tr><td class="line-number" value="1572"></td><td class="line-content">  let indentOwners = {0:root}; // maps # indents of current line to correct parent</td></tr><tr><td class="line-number" value="1573"></td><td class="line-content">  for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1574"></td><td class="line-content">    let line = lines[i];</td></tr><tr><td class="line-number" value="1575"></td><td class="line-content">    let indents = line.indents;</td></tr><tr><td class="line-number" value="1576"></td><td class="line-content">    if(indentOwners[indents]) {</td></tr><tr><td class="line-number" value="1577"></td><td class="line-content">      // this is child of indentOwners[indents]:</td></tr><tr><td class="line-number" value="1578"></td><td class="line-content">      indentOwners[indents].children.push(line);</td></tr><tr><td class="line-number" value="1579"></td><td class="line-content">      line.parent = indentOwners[indents];</td></tr><tr><td class="line-number" value="1580"></td><td class="line-content">      // this becomes owner of next indent level:</td></tr><tr><td class="line-number" value="1581"></td><td class="line-content">      indentOwners[indents+1] = line;</td></tr><tr><td class="line-number" value="1582"></td><td class="line-content">      // and *no one* owns the indent level after that:</td></tr><tr><td class="line-number" value="1583"></td><td class="line-content">      indentOwners[indents+2] = undefined;</td></tr><tr><td class="line-number" value="1584"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="1585"></td><td class="line-content">      __perchanceError(`There appears to be an indenting error on this line near this text: "${__escapeHTMLSpecialChars(line.text.substr(0,30))}". Perchance lists should be indented with either one tab or two spaces. If you want to have a space before a list item, then you should start the item with "\\s" (backslash + "s") which will be converted into a space (you can read more about this in the &lt;a href="/tutorial"&gt;tutorial&lt;/a&gt;).`, {declarationLineNumber:line.lineNumber, moduleName});</td></tr><tr><td class="line-number" value="1586"></td><td class="line-content">      return;</td></tr><tr><td class="line-number" value="1587"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1588"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1589"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1590"></td><td class="line-content">  // for each node, get the perchance text required to create it.</td></tr><tr><td class="line-number" value="1591"></td><td class="line-content">  for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1592"></td><td class="line-content">    // for each line (ordered top to bottom)...</td></tr><tr><td class="line-number" value="1593"></td><td class="line-content">    lines[i].perchanceCode = lines[i].text;</td></tr><tr><td class="line-number" value="1594"></td><td class="line-content">    let j = 0;</td></tr><tr><td class="line-number" value="1595"></td><td class="line-content">    let parent = lines[i].parent;</td></tr><tr><td class="line-number" value="1596"></td><td class="line-content">    let ancestor = parent;</td></tr><tr><td class="line-number" value="1597"></td><td class="line-content">    // append this line's text to *all* ancestors of this line (with appropriate indentation):</td></tr><tr><td class="line-number" value="1598"></td><td class="line-content">    while(1) {</td></tr><tr><td class="line-number" value="1599"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1600"></td><td class="line-content">      if(ancestor.parent === null) ancestor.perchanceCode += `${ancestor.perchanceCode ? "\n" : ""}` + lines[i].text; // handle case where ancestor === root node</td></tr><tr><td class="line-number" value="1601"></td><td class="line-content">      else ancestor.perchanceCode += "\n" + "  ".repeat(lines[i].indents - ancestor.indents) + lines[i].text;</td></tr><tr><td class="line-number" value="1602"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1603"></td><td class="line-content">      // EDIT: we also need to add blank lines back in because they matter e.g. for multi-line strings in function bodies:</td></tr><tr><td class="line-number" value="1604"></td><td class="line-content">      let blankLine = lines[i].blankLineBelow;</td></tr><tr><td class="line-number" value="1605"></td><td class="line-content">      while(blankLine) {</td></tr><tr><td class="line-number" value="1606"></td><td class="line-content">        ancestor.perchanceCode += "\n";</td></tr><tr><td class="line-number" value="1607"></td><td class="line-content">        blankLine = blankLine.blankLineBelow;</td></tr><tr><td class="line-number" value="1608"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1609"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1610"></td><td class="line-content">      ancestor = ancestor.parent;</td></tr><tr><td class="line-number" value="1611"></td><td class="line-content">      if(!ancestor) break;</td></tr><tr><td class="line-number" value="1612"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1613"></td><td class="line-content">      if(j++ &gt; 100000) {</td></tr><tr><td class="line-number" value="1614"></td><td class="line-content">        __perchanceError(`Some sort of looping/recursion error has occurred. Please make a post on the forum (lemmy.world/c/perchance) so I can take a look at this. Thanks!`, {moduleName});</td></tr><tr><td class="line-number" value="1615"></td><td class="line-content">        return;</td></tr><tr><td class="line-number" value="1616"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1617"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1618"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1619"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1620"></td><td class="line-content">  root.perchanceCode = text;</td></tr><tr><td class="line-number" value="1621"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1622"></td><td class="line-content">  // check for variable names wrapped in square brackets when they're already within a square block:</td></tr><tr><td class="line-number" value="1623"></td><td class="line-content">  const unnecessarySquareBracketsRegex = /([^\\]|^)\[([^\]]*?[^a-zA-Z0-9_$\]]|)\[[a-zA-Z][a-zA-Z0-9_$.]*?\][^\]]*?\]/;</td></tr><tr><td class="line-number" value="1624"></td><td class="line-content">  // above regex explained:</td></tr><tr><td class="line-number" value="1625"></td><td class="line-content">  //  - we need the [^a-zA-Z_$\]] part (character right before inner square brackets must not be a variable-name character) because we don't want to show a warning for `[myList[key]]`, for example.</td></tr><tr><td class="line-number" value="1626"></td><td class="line-content">  //  - we need the dot in [a-zA-Z_$.]+ because we of course want to be able to detect and warn about something like `[a &gt; 7 ? [list.subProp] : "blah"]`</td></tr><tr><td class="line-number" value="1627"></td><td class="line-content">  //  - this doesn't handle escaping properly (because the preceding backslash could itself be escaped), and doesn't properly handle the fact that square brackets could occur within strings/regex/etc. that are within the outer square block</td></tr><tr><td class="line-number" value="1628"></td><td class="line-content">  const singleEqualsInDynamicOddsRegex = /\^\[[^\]]*[^=!&lt;&gt;]=[^=&gt;][^\]]*\]\s*$/;</td></tr><tr><td class="line-number" value="1629"></td><td class="line-content">  const singleEqualsInIfElseConditionRegex = /\[if\s*\([^\)]*[^=&gt;&lt;!]=[^=&gt;][^\)]*\)\s*\{/;</td></tr><tr><td class="line-number" value="1630"></td><td class="line-content">  for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1631"></td><td class="line-content">    if(lines[i].text.length &gt; 5000) continue;</td></tr><tr><td class="line-number" value="1632"></td><td class="line-content">    if(lines[i].text.indexOf("[") === -1) continue; // &lt;-- just an optimisation</td></tr><tr><td class="line-number" value="1633"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1634"></td><td class="line-content">    // unnecessary square brackets:</td></tr><tr><td class="line-number" value="1635"></td><td class="line-content">    if(lines[i].text.indexOf("\"") !== -1 || lines[i].text.indexOf("'") !== -1 || lines[i].text.indexOf("'") !== -1) {</td></tr><tr><td class="line-number" value="1636"></td><td class="line-content">      if(lines[i].text.match(unnecessarySquareBracketsRegex)) { // don't use .test() --&gt; https://stackoverflow.com/a/21373261/11950764</td></tr><tr><td class="line-number" value="1637"></td><td class="line-content">        // try removing quoted parts to see if it's still a match (very hacky, but it's not a huuge deal if it causes us to miss some - it's better than false positives):</td></tr><tr><td class="line-number" value="1638"></td><td class="line-content">        let newText = lines[i].text;</td></tr><tr><td class="line-number" value="1639"></td><td class="line-content">        newText = newText.replace(/".*[^\\]?"/g, `""`);</td></tr><tr><td class="line-number" value="1640"></td><td class="line-content">        newText = newText.replace(/`.*[^\\]?`/g, "``");</td></tr><tr><td class="line-number" value="1641"></td><td class="line-content">        newText = newText.replace(/'.*[^\\]?'/g, `''`);</td></tr><tr><td class="line-number" value="1642"></td><td class="line-content">        if(newText.match(unnecessarySquareBracketsRegex)) { // if it still matches, then it's ~likely a true positive.</td></tr><tr><td class="line-number" value="1643"></td><td class="line-content">          if(!/\[ *\.\.\./.test(newText)) { // avoid triggering for e.g. [[...array].map(n =&gt; n+1)]</td></tr><tr><td class="line-number" value="1644"></td><td class="line-content">            window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"square-brackets-wrapping-variable-name-within-square-block"});</td></tr><tr><td class="line-number" value="1645"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="1646"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1647"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1648"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="1649"></td><td class="line-content">      if(lines[i].text.match(unnecessarySquareBracketsRegex)) {</td></tr><tr><td class="line-number" value="1650"></td><td class="line-content">        window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"square-brackets-wrapping-variable-name-within-square-block"});</td></tr><tr><td class="line-number" value="1651"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1652"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1653"></td><td class="line-content">    </td></tr><tr><td class="line-number" value="1654"></td><td class="line-content">    if(lines[i].text.match(singleEqualsInIfElseConditionRegex)) {</td></tr><tr><td class="line-number" value="1655"></td><td class="line-content">      window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"single-equals-in-if-else-condition"});</td></tr><tr><td class="line-number" value="1656"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1657"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1658"></td><td class="line-content">    // single equals in dynamic odds</td></tr><tr><td class="line-number" value="1659"></td><td class="line-content">    if(lines[i].text.indexOf("^[") === -1) continue; // &lt;-- just an optimisation</td></tr><tr><td class="line-number" value="1660"></td><td class="line-content">    if(lines[i].text.match(singleEqualsInDynamicOddsRegex)) {</td></tr><tr><td class="line-number" value="1661"></td><td class="line-content">      window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"single-equals-in-dynamic-odds"});</td></tr><tr><td class="line-number" value="1662"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1663"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1664"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1665"></td><td class="line-content">  // get node data for functions (pack all details into header node and remove children)</td></tr><tr><td class="line-number" value="1666"></td><td class="line-content">  // note that we need to handle functions first because otherwise lines of js will be</td></tr><tr><td class="line-number" value="1667"></td><td class="line-content">  // classed as other node types</td></tr><tr><td class="line-number" value="1668"></td><td class="line-content">  for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1669"></td><td class="line-content">    let funcHeaderDetails = __getFunctionHeaderDetails(lines[i].text);</td></tr><tr><td class="line-number" value="1670"></td><td class="line-content">    if(funcHeaderDetails) {</td></tr><tr><td class="line-number" value="1671"></td><td class="line-content">      lines[i].nodeType = "function";</td></tr><tr><td class="line-number" value="1672"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1673"></td><td class="line-content">      lines[i].functionName = funcHeaderDetails.name;</td></tr><tr><td class="line-number" value="1674"></td><td class="line-content">      lines[i].functionArgs = funcHeaderDetails.args; // &lt;-- array of arg names</td></tr><tr><td class="line-number" value="1675"></td><td class="line-content">      lines[i].functionIsAsync = funcHeaderDetails.isAsync;</td></tr><tr><td class="line-number" value="1676"></td><td class="line-content">      // recursively collect all children, grandchildren, etc into one flat array:</td></tr><tr><td class="line-number" value="1677"></td><td class="line-content">      let children = lines[i].children;</td></tr><tr><td class="line-number" value="1678"></td><td class="line-content">      let j = 0;</td></tr><tr><td class="line-number" value="1679"></td><td class="line-content">      while(1) {</td></tr><tr><td class="line-number" value="1680"></td><td class="line-content">        if(j &gt;= children.length) { break; }</td></tr><tr><td class="line-number" value="1681"></td><td class="line-content">        let c = children[j];</td></tr><tr><td class="line-number" value="1682"></td><td class="line-content">        children.splice(j+1, 0, ...c.children); // must put them in correct pos</td></tr><tr><td class="line-number" value="1683"></td><td class="line-content">        j++;</td></tr><tr><td class="line-number" value="1684"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1685"></td><td class="line-content">      // remove children/grandchildren/... from lines array:</td></tr><tr><td class="line-number" value="1686"></td><td class="line-content">      for(let c of children) {</td></tr><tr><td class="line-number" value="1687"></td><td class="line-content">        lines = lines.filter(l =&gt; l !== c);</td></tr><tr><td class="line-number" value="1688"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1689"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1690"></td><td class="line-content">      // concat children/grandchildren/... with newlines and add to functionBody property</td></tr><tr><td class="line-number" value="1691"></td><td class="line-content">      lines[i].functionBody = children.map(l =&gt; {</td></tr><tr><td class="line-number" value="1692"></td><td class="line-content">        let text = l.text;</td></tr><tr><td class="line-number" value="1693"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1694"></td><td class="line-content">        // add black lines back in since they matter for e.g. multi-line strings:</td></tr><tr><td class="line-number" value="1695"></td><td class="line-content">        let blankLine = l.blankLineBelow;</td></tr><tr><td class="line-number" value="1696"></td><td class="line-content">        while(blankLine) {</td></tr><tr><td class="line-number" value="1697"></td><td class="line-content">          text += "\n";</td></tr><tr><td class="line-number" value="1698"></td><td class="line-content">          blankLine = blankLine.blankLineBelow;</td></tr><tr><td class="line-number" value="1699"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1700"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1701"></td><td class="line-content">        return text;</td></tr><tr><td class="line-number" value="1702"></td><td class="line-content">      }).join("\n");</td></tr><tr><td class="line-number" value="1703"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1704"></td><td class="line-content">      // remove children</td></tr><tr><td class="line-number" value="1705"></td><td class="line-content">      lines[i].children = [];</td></tr><tr><td class="line-number" value="1706"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1707"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1708"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1709"></td><td class="line-content">  // get node data for inline functions</td></tr><tr><td class="line-number" value="1710"></td><td class="line-content">  const functionNodeRegex = /=&gt;/;</td></tr><tr><td class="line-number" value="1711"></td><td class="line-content">  for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1712"></td><td class="line-content">    if(lines[i].nodeType) continue;</td></tr><tr><td class="line-number" value="1713"></td><td class="line-content">    if(!functionNodeRegex.test(lines[i].text)) continue; // &lt;-- just an optimisation</td></tr><tr><td class="line-number" value="1714"></td><td class="line-content">    let inlineFuncDetails = __getInlineFunctionDetails(lines[i].text);</td></tr><tr><td class="line-number" value="1715"></td><td class="line-content">    if(inlineFuncDetails) {</td></tr><tr><td class="line-number" value="1716"></td><td class="line-content">      lines[i].nodeType = "function";</td></tr><tr><td class="line-number" value="1717"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1718"></td><td class="line-content">      // inline functions shouldn't have children</td></tr><tr><td class="line-number" value="1719"></td><td class="line-content">      if(lines[i].children.length &gt; 0) {</td></tr><tr><td class="line-number" value="1720"></td><td class="line-content">        __perchanceError(`It appears that you've tried to give an inline function children (child items). At this point, inline functions are not allowed to have children (though I could change this in the future if people need this feature). There's also the possibility that you accidentally created an inline function. Inline functions have the form: &lt;b&gt;functionName(input1, input2, ...) =&amp;gt; functionBody&lt;/b&gt;. If you'd like to use "=" in a literal sense, put a backslash character right before it like this: "\\=".`, {declarationLineNumber:lines[i].lineNumber, moduleName});</td></tr><tr><td class="line-number" value="1721"></td><td class="line-content">        return;</td></tr><tr><td class="line-number" value="1722"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1723"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1724"></td><td class="line-content">      lines[i].functionName = inlineFuncDetails.name;</td></tr><tr><td class="line-number" value="1725"></td><td class="line-content">      lines[i].functionArgs = inlineFuncDetails.args; // &lt;-- array of arg names</td></tr><tr><td class="line-number" value="1726"></td><td class="line-content">      lines[i].functionBody = inlineFuncDetails.body;</td></tr><tr><td class="line-number" value="1727"></td><td class="line-content">      lines[i].functionIsAsync = inlineFuncDetails.isAsync;</td></tr><tr><td class="line-number" value="1728"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1729"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1730"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1731"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1732"></td><td class="line-content">  // TODO: process other node-types (list with args) here</td></tr><tr><td class="line-number" value="1733"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1734"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1735"></td><td class="line-content">  const unescapedEqualsSignSpecialCharsRegex = /[!"\#%&amp;'()*+,.\/:;&lt;&gt;?@\[\\\]^{|}~]/;</td></tr><tr><td class="line-number" value="1736"></td><td class="line-content">  const unescapedEqualsSignHtmlElement = /&lt;[a-zA-Z]+ /;</td></tr><tr><td class="line-number" value="1737"></td><td class="line-content">  const unescapedEqualsSignUrl = /https?:\/\/[^ ]+\?/;</td></tr><tr><td class="line-number" value="1738"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="1739"></td><td class="line-content">  const primitiveNodeRegex = /=/;</td></tr><tr><td class="line-number" value="1740"></td><td class="line-content">  let ignoreEqualsSignWarnings = false;</td></tr><tr><td class="line-number" value="1741"></td><td class="line-content">  let reenableEqualsSignWarningsAtIndentLevel = null;</td></tr><tr><td class="line-number" value="1742"></td><td class="line-content">  for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1743"></td><td class="line-content">    if(reenableEqualsSignWarningsAtIndentLevel !== null &amp;&amp; lines[i].indents &lt;= reenableEqualsSignWarningsAtIndentLevel) {</td></tr><tr><td class="line-number" value="1744"></td><td class="line-content">      ignoreEqualsSignWarnings = false;</td></tr><tr><td class="line-number" value="1745"></td><td class="line-content">      reenableEqualsSignWarningsAtIndentLevel = null;</td></tr><tr><td class="line-number" value="1746"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1747"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1748"></td><td class="line-content">    if(lines[i].nodeType) continue;</td></tr><tr><td class="line-number" value="1749"></td><td class="line-content">    if(!primitiveNodeRegex.test(lines[i].text)) continue; // &lt;-- just an optimisation</td></tr><tr><td class="line-number" value="1750"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1751"></td><td class="line-content">    let details = __getPrimitiveNodeDetails(lines[i].text);</td></tr><tr><td class="line-number" value="1752"></td><td class="line-content">    if(details) {</td></tr><tr><td class="line-number" value="1753"></td><td class="line-content">      // NOTE: We've discovered an inline/"primitive" thing, but here's the thing:</td></tr><tr><td class="line-number" value="1754"></td><td class="line-content">      //       If it's not a direct reference (i.e. value !== "[...]" or "{...}")</td></tr><tr><td class="line-number" value="1755"></td><td class="line-content">      //       but it DOES contain square/curly block(s), then we need to make it</td></tr><tr><td class="line-number" value="1756"></td><td class="line-content">      //       into a normal node with details.value as a child.</td></tr><tr><td class="line-number" value="1757"></td><td class="line-content">      //       See marker odj29hfi3j0d2kj0hx24f for the handling of $value nodes.</td></tr><tr><td class="line-number" value="1758"></td><td class="line-content">      //       The reason we need to do this is because if we had ``output = [prefix]-blah` (for example)</td></tr><tr><td class="line-number" value="1759"></td><td class="line-content">      //       then we couldn't call `output.selectMany(3)` on it if it was a $value node.</td></tr><tr><td class="line-number" value="1760"></td><td class="line-content">      //       Basically, the fact that I want to be able to create "direct references" with</td></tr><tr><td class="line-number" value="1761"></td><td class="line-content">      //       value nodes means a bunch of mucking around trying to make everything else work</td></tr><tr><td class="line-number" value="1762"></td><td class="line-content">      //       as expected.</td></tr><tr><td class="line-number" value="1763"></td><td class="line-content">      // let blocks = splitTextAtAllBlocks(details.value);</td></tr><tr><td class="line-number" value="1764"></td><td class="line-content">      // if(blocks.length &gt; 1) {</td></tr><tr><td class="line-number" value="1765"></td><td class="line-content">      //   lines[i].nodeType = "text";</td></tr><tr><td class="line-number" value="1766"></td><td class="line-content">      //   lines[i].text = details.key;</td></tr><tr><td class="line-number" value="1767"></td><td class="line-content">      //   //lines[i].expressionArray = [details.key];</td></tr><tr><td class="line-number" value="1768"></td><td class="line-content">      //   let child = {</td></tr><tr><td class="line-number" value="1769"></td><td class="line-content">      //     text: details.value,</td></tr><tr><td class="line-number" value="1770"></td><td class="line-content">      //     indents: lines[i].indents+1,</td></tr><tr><td class="line-number" value="1771"></td><td class="line-content">      //     lineNumber:lines[i].lineNumber,</td></tr><tr><td class="line-number" value="1772"></td><td class="line-content">      //     children:[],</td></tr><tr><td class="line-number" value="1773"></td><td class="line-content">      //     parent: lines[i],</td></tr><tr><td class="line-number" value="1774"></td><td class="line-content">      //     nodeType:"text",</td></tr><tr><td class="line-number" value="1775"></td><td class="line-content">      //     odds:"1",</td></tr><tr><td class="line-number" value="1776"></td><td class="line-content">      //     //expressionArray: splitTextAtSquareBlocks(details.value),</td></tr><tr><td class="line-number" value="1777"></td><td class="line-content">      //   }</td></tr><tr><td class="line-number" value="1778"></td><td class="line-content">      //   lines[i].children.push(child);</td></tr><tr><td class="line-number" value="1779"></td><td class="line-content">      //   lines.splice(i+1, 0, child);</td></tr><tr><td class="line-number" value="1780"></td><td class="line-content">      // } else {</td></tr><tr><td class="line-number" value="1781"></td><td class="line-content">        lines[i].nodeType = "primitiveKeyValue";</td></tr><tr><td class="line-number" value="1782"></td><td class="line-content">        lines[i].primitiveKey = details.key;</td></tr><tr><td class="line-number" value="1783"></td><td class="line-content">        lines[i].primitiveValue = details.value;</td></tr><tr><td class="line-number" value="1784"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1785"></td><td class="line-content">        if(!ignoreEqualsSignWarnings &amp;&amp; typeof details.value === "string" &amp;&amp; details.value.startsWith("[this.getRawListText")) {</td></tr><tr><td class="line-number" value="1786"></td><td class="line-content">          ignoreEqualsSignWarnings = true;</td></tr><tr><td class="line-number" value="1787"></td><td class="line-content">          reenableEqualsSignWarningsAtIndentLevel = lines[i].indents-1;</td></tr><tr><td class="line-number" value="1788"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1789"></td><td class="line-content">        </td></tr><tr><td class="line-number" value="1790"></td><td class="line-content">        if(!ignoreEqualsSignWarnings) {</td></tr><tr><td class="line-number" value="1791"></td><td class="line-content">          // NOTE: these if conditions have seemingly-redundant .includes(...) at the start as an optimization - may actually slow things down though, haven't tested</td></tr><tr><td class="line-number" value="1792"></td><td class="line-content">          // warn if key contains space AND previous line was a normal item in the same list. So users can avoid this warning by putting all their properties (that have spaces in their key) at the top of the list.</td></tr><tr><td class="line-number" value="1793"></td><td class="line-content">          if(details.key.trim().includes(" ") &amp;&amp; lines[i-1] &amp;&amp; lines[i-1].primitiveKey === undefined &amp;&amp; lines[i-1].indents === lines[i].indents) {</td></tr><tr><td class="line-number" value="1794"></td><td class="line-content">            window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"unescaped-equals-sign"});</td></tr><tr><td class="line-number" value="1795"></td><td class="line-content">          } else if(details.key.includes("&lt;") &amp;&amp; unescapedEqualsSignHtmlElement.test(details.key) &amp;&amp; (details.value.trim().startsWith(`"`) || details.value.trim().startsWith(`'`))) { // also warn if it looks like e.g. &lt;img src="..."</td></tr><tr><td class="line-number" value="1796"></td><td class="line-content">            window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"unescaped-equals-sign"});</td></tr><tr><td class="line-number" value="1797"></td><td class="line-content">          } else if(details.key.includes("?") &amp;&amp; unescapedEqualsSignUrl.test(details.key)) { // also warn if it looks like e.g. https://example.com?foo=bar</td></tr><tr><td class="line-number" value="1798"></td><td class="line-content">            window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"unescaped-equals-sign"});</td></tr><tr><td class="line-number" value="1799"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="1800"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1801"></td><td class="line-content">        /* else if(unescapedEqualsSignSpecialCharsRegex.test(details.key)) { // also warn if key has weird/special characters. This catches e.g. &lt;img src="..." even if it's the first item in the list (which would prevent above case from catching it)</td></tr><tr><td class="line-number" value="1802"></td><td class="line-content">          window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"unescaped-equals-sign"});</td></tr><tr><td class="line-number" value="1803"></td><td class="line-content">        }*/</td></tr><tr><td class="line-number" value="1804"></td><td class="line-content">      //}</td></tr><tr><td class="line-number" value="1805"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1806"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1807"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1808"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1809"></td><td class="line-content">  // extract all the node data (odds, expression array) for plain old text nodes</td></tr><tr><td class="line-number" value="1810"></td><td class="line-content">  const oddsDetailsRegex = /\^/;</td></tr><tr><td class="line-number" value="1811"></td><td class="line-content">  for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1812"></td><td class="line-content">    if(lines[i].nodeType) continue;</td></tr><tr><td class="line-number" value="1813"></td><td class="line-content">    if(!oddsDetailsRegex.test(lines[i].text)) { // &lt;-- just an optimisation</td></tr><tr><td class="line-number" value="1814"></td><td class="line-content">      lines[i].odds = "1";  // as string because all the others are strings - system is built to take strings and interpret them as expresions/numbers</td></tr><tr><td class="line-number" value="1815"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="1816"></td><td class="line-content">      // extract and remove odds stuff first:</td></tr><tr><td class="line-number" value="1817"></td><td class="line-content">      let oddsDetails = __getTextOddsDetails(lines[i].text);</td></tr><tr><td class="line-number" value="1818"></td><td class="line-content">      let odds, textWithoutOdds;</td></tr><tr><td class="line-number" value="1819"></td><td class="line-content">      if(oddsDetails) {</td></tr><tr><td class="line-number" value="1820"></td><td class="line-content">        lines[i].nodeType = "text";</td></tr><tr><td class="line-number" value="1821"></td><td class="line-content">        lines[i].odds = oddsDetails.odds;</td></tr><tr><td class="line-number" value="1822"></td><td class="line-content">        lines[i].text = oddsDetails.textWithoutOdds.trim(); // &lt;-- NOTE: spaces between end of text and odds notation are ignored in lists! thus we trim. (not in curly "or" blocks though)</td></tr><tr><td class="line-number" value="1823"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="1824"></td><td class="line-content">        lines[i].odds = "1"; // as string because all the others are strings - system is built to take strings and interpret them as expresions/numbers</td></tr><tr><td class="line-number" value="1825"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1826"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1827"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1828"></td><td class="line-content">    lines[i].nodeType = "text";</td></tr><tr><td class="line-number" value="1829"></td><td class="line-content">    // let arr = splitTextAtSquareBlocks(lines[i].text);</td></tr><tr><td class="line-number" value="1830"></td><td class="line-content">    // if(arr) {</td></tr><tr><td class="line-number" value="1831"></td><td class="line-content">    //   lines[i].nodeType = "text";</td></tr><tr><td class="line-number" value="1832"></td><td class="line-content">    //   lines[i].expressionArray = arr;</td></tr><tr><td class="line-number" value="1833"></td><td class="line-content">    //   // if((lines[i].expressionArray.length &gt; 1 || (lines[i].expressionArray.length === 1 &amp;&amp; lines[i].expressionArray[0][0] === "[")) &amp;&amp; lines[i].children.length &gt; 0) {</td></tr><tr><td class="line-number" value="1834"></td><td class="line-content">    //   //   console.error(`Error on line number ${lines[i].lineNumber}. Lines with random variables shouldn't have children.`);</td></tr><tr><td class="line-number" value="1835"></td><td class="line-content">    //   //   return;</td></tr><tr><td class="line-number" value="1836"></td><td class="line-content">    //   // }</td></tr><tr><td class="line-number" value="1837"></td><td class="line-content">    // }</td></tr><tr><td class="line-number" value="1838"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1839"></td><td class="line-content">    // if(oddsDetails &amp;&amp; !arr) {</td></tr><tr><td class="line-number" value="1840"></td><td class="line-content">    //   perchanceError(`It seems that you've got a '^' character where it shouldn't be. The '^' character is a special one that allows you to specify how likely a node is of being selected. This "odds notation" should not be present on functions or other non-text nodes because they aren't a part of the group which is randomly selected from (they are special children). If you want to use the odds character ("^") literally (i.e. not to declare likelihood), then you can put a backslash character before it like so: \\^`, lines[i].lineNumber);</td></tr><tr><td class="line-number" value="1841"></td><td class="line-content">    //   return;</td></tr><tr><td class="line-number" value="1842"></td><td class="line-content">    // }</td></tr><tr><td class="line-number" value="1843"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1844"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1845"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1846"></td><td class="line-content">  // // warn for unclassified lines and then set nodeType as "text"</td></tr><tr><td class="line-number" value="1847"></td><td class="line-content">  // for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1848"></td><td class="line-content">  //   if(!lines[i].nodeType) {</td></tr><tr><td class="line-number" value="1849"></td><td class="line-content">  //     perchanceError(`For some reason this line could not be classified properly. There may be something wrong with your syntax of this line, or it may be a bug with the Perchance engine. If you think that there's a bug, please report it here: &lt;a href="http://reddit.com/r/perchance"&gt;reddit.com/r/perchance&lt;/a&gt;. That would be very much appreciated! :)`, lines[i].lineNumber);</td></tr><tr><td class="line-number" value="1850"></td><td class="line-content">  //     lines[i].nodeType = "text";</td></tr><tr><td class="line-number" value="1851"></td><td class="line-content">  //     lines[i].expressionArray = [lines[i].text];</td></tr><tr><td class="line-number" value="1852"></td><td class="line-content">  //   }</td></tr><tr><td class="line-number" value="1853"></td><td class="line-content">  // }</td></tr><tr><td class="line-number" value="1854"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1855"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1856"></td><td class="line-content">  // next up, construct the actual perchance node tree.</td></tr><tr><td class="line-number" value="1857"></td><td class="line-content">  // first create a node for each line</td></tr><tr><td class="line-number" value="1858"></td><td class="line-content">  // then connect up parent/children</td></tr><tr><td class="line-number" value="1859"></td><td class="line-content">  //</td></tr><tr><td class="line-number" value="1860"></td><td class="line-content">  // we also the perchance methods including the .toString() function to each node.</td></tr><tr><td class="line-number" value="1861"></td><td class="line-content">  // the toString function is where the magic happens. calling</td></tr><tr><td class="line-number" value="1862"></td><td class="line-content">  // [myrootvar] will just return the myrootvar variable. when this</td></tr><tr><td class="line-number" value="1863"></td><td class="line-content">  // gets joined to a string, `myrootvar.toString()` is called which</td></tr><tr><td class="line-number" value="1864"></td><td class="line-content">  // recursively resolves it into an actual string value, taking into</td></tr><tr><td class="line-number" value="1865"></td><td class="line-content">  // account odds and other expressions (in expressionArrays) that it</td></tr><tr><td class="line-number" value="1866"></td><td class="line-content">  // finds along the way</td></tr><tr><td class="line-number" value="1867"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1868"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1869"></td><td class="line-content">  // 1. convert lines to perchance nodes</td></tr><tr><td class="line-number" value="1870"></td><td class="line-content">  let allNodes = [];</td></tr><tr><td class="line-number" value="1871"></td><td class="line-content">  lines.unshift(root);</td></tr><tr><td class="line-number" value="1872"></td><td class="line-content">  for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1873"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1874"></td><td class="line-content">    lines[i].node = {};</td></tr><tr><td class="line-number" value="1875"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1876"></td><td class="line-content">    lines[i].node[Symbol.for("node data")] = { // TODO: why use symbol? just put it in a non-enumerable $data property? then fix up all references to it? TODO: can this be deleted after we're done creating tree?</td></tr><tr><td class="line-number" value="1877"></td><td class="line-content">      parentNode:null,</td></tr><tr><td class="line-number" value="1878"></td><td class="line-content">      childNodes:[],</td></tr><tr><td class="line-number" value="1879"></td><td class="line-content">      root:root,</td></tr><tr><td class="line-number" value="1880"></td><td class="line-content">      declarationLineNumber: lines[i].lineNumber,</td></tr><tr><td class="line-number" value="1881"></td><td class="line-content">      odds: null,</td></tr><tr><td class="line-number" value="1882"></td><td class="line-content">    };</td></tr><tr><td class="line-number" value="1883"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1884"></td><td class="line-content">    // make default function properties writable (not needed because we use simple objects now)</td></tr><tr><td class="line-number" value="1885"></td><td class="line-content">    // Object.defineProperty(lines[i].node, "name", {writable:true});</td></tr><tr><td class="line-number" value="1886"></td><td class="line-content">    // Object.defineProperty(lines[i].node, "length", {writable:true});</td></tr><tr><td class="line-number" value="1887"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1888"></td><td class="line-content">    // NOTE TO SELF: Object.defineProperty seems to cause some bad performance slow-downs, but I'm pretty sure</td></tr><tr><td class="line-number" value="1889"></td><td class="line-content">    // we need to make these properties non-enumerable - at least, I think that was the original idea. Might be worth</td></tr><tr><td class="line-number" value="1890"></td><td class="line-content">    // thinking about this at some point because the perf gains are definitely significant if you can somehow avoid defineProperty.</td></tr><tr><td class="line-number" value="1891"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1892"></td><td class="line-content">    Object.defineProperty(lines[i].node, "$root", {value:root.node, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="1893"></td><td class="line-content">    Object.defineProperty(lines[i].node, "$declarationLineNumber", {value:lines[i].lineNumber, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="1894"></td><td class="line-content">    Object.defineProperty(lines[i].node, "$moduleName", {value:moduleName, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="1895"></td><td class="line-content">    Object.defineProperty(lines[i].node, Symbol.toPrimitive, {value:function(hint) {</td></tr><tr><td class="line-number" value="1896"></td><td class="line-content">      return this.valueOf();</td></tr><tr><td class="line-number" value="1897"></td><td class="line-content">      // if(hint === "default" || hint === "string") {</td></tr><tr><td class="line-number" value="1898"></td><td class="line-content">      //   return this.toString();</td></tr><tr><td class="line-number" value="1899"></td><td class="line-content">      // } else {</td></tr><tr><td class="line-number" value="1900"></td><td class="line-content">      //   return this.valueOf();</td></tr><tr><td class="line-number" value="1901"></td><td class="line-content">      // }</td></tr><tr><td class="line-number" value="1902"></td><td class="line-content">    }, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="1903"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1904"></td><td class="line-content">    // add $valueChildren array which contains all children of type 'value' so we can get the "properties" of a node (for stuff like 'generateInstance' plugin or build-in feature)</td></tr><tr><td class="line-number" value="1905"></td><td class="line-content">    Object.defineProperty(lines[i].node, "$valueChildren", {value:[], writable:true, configurable:true});</td></tr><tr><td class="line-number" value="1906"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1907"></td><td class="line-content">    // this is used in isFunctionNode in the proxy stuff:</td></tr><tr><td class="line-number" value="1908"></td><td class="line-content">    Object.defineProperty(lines[i].node, "$functionChildren", {value:[], writable:true, configurable:true});</td></tr><tr><td class="line-number" value="1909"></td><td class="line-content">    </td></tr><tr><td class="line-number" value="1910"></td><td class="line-content">    Object.defineProperty(lines[i].node, "$allKeys", {value:[], writable:true, configurable:true});</td></tr><tr><td class="line-number" value="1911"></td><td class="line-content">    Object.defineProperty(lines[i].node, "$allKeysSet", {value:new Set(), writable:true, configurable:true});</td></tr><tr><td class="line-number" value="1912"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1913"></td><td class="line-content">    Object.defineProperty(lines[i].node, "$perchanceCode", {value:lines[i].perchanceCode, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="1914"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1915"></td><td class="line-content">    __addNodeMethods(lines[i].node);</td></tr><tr><td class="line-number" value="1916"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1917"></td><td class="line-content">    allNodes.push(lines[i].node);</td></tr><tr><td class="line-number" value="1918"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1919"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1920"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1921"></td><td class="line-content">  // 2. fill in parent/child references:</td></tr><tr><td class="line-number" value="1922"></td><td class="line-content">  for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1923"></td><td class="line-content">    let node = lines[i].node;</td></tr><tr><td class="line-number" value="1924"></td><td class="line-content">    let nodeData = node[Symbol.for("node data")];</td></tr><tr><td class="line-number" value="1925"></td><td class="line-content">    if(i === 0) { // i.e. if root - (since root has no parent)</td></tr><tr><td class="line-number" value="1926"></td><td class="line-content">      nodeData.parentNode = null;</td></tr><tr><td class="line-number" value="1927"></td><td class="line-content">      Object.defineProperty(node, "$parent", {value:null, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="1928"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="1929"></td><td class="line-content">      nodeData.parentNode = lines[i].parent.node;</td></tr><tr><td class="line-number" value="1930"></td><td class="line-content">      Object.defineProperty(node, "$parent", {value:lines[i].parent.node, writable:true, configurable:true}); // &lt;-- give it a public reference to its parent that *isn't* enumerable</td></tr><tr><td class="line-number" value="1931"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1932"></td><td class="line-content">    nodeData.childNodes = lines[i].children.map(line =&gt; line.node);</td></tr><tr><td class="line-number" value="1933"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="1934"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1935"></td><td class="line-content">  // 3. fill in the rest of the node details depending on the node type</td></tr><tr><td class="line-number" value="1936"></td><td class="line-content">  let alreadyWarnedAboutDuplicateTopLevelListNameCount = 0;</td></tr><tr><td class="line-number" value="1937"></td><td class="line-content">  for(let i = 0; i &lt; lines.length; i++) {</td></tr><tr><td class="line-number" value="1938"></td><td class="line-content">    let node = lines[i].node;</td></tr><tr><td class="line-number" value="1939"></td><td class="line-content">    let nodeData = lines[i].node[Symbol.for("node data")];</td></tr><tr><td class="line-number" value="1940"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1941"></td><td class="line-content">    // add normal text nodes</td></tr><tr><td class="line-number" value="1942"></td><td class="line-content">    if(lines[i].nodeType === "text") {</td></tr><tr><td class="line-number" value="1943"></td><td class="line-content">      nodeData.type = "text";</td></tr><tr><td class="line-number" value="1944"></td><td class="line-content">      nodeData.odds = lines[i].odds;</td></tr><tr><td class="line-number" value="1945"></td><td class="line-content">      //nodeData.expressionArray = lines[i].expressionArray;</td></tr><tr><td class="line-number" value="1946"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1947"></td><td class="line-content">      Object.defineProperty(lines[i].node, "$nodeType", {value:"normal", writable:true, configurable:true});</td></tr><tr><td class="line-number" value="1948"></td><td class="line-content">      Object.defineProperty(lines[i].node, "$oddsText", {value:lines[i].odds, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="1949"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1950"></td><td class="line-content">      Object.defineProperty(lines[i].node, "$text", {value:lines[i].text, writable:true, configurable:true}); // &lt;-- give it a public reference to its text that *isn't* enumerable</td></tr><tr><td class="line-number" value="1951"></td><td class="line-content">      if(node.$parent) { // i.e. if not root</td></tr><tr><td class="line-number" value="1952"></td><td class="line-content">        let key = node.$text;</td></tr><tr><td class="line-number" value="1953"></td><td class="line-content">        // while(node.$parent[key] !== undefined) {// if there's already one called this, add {|} (hacky, but I think it's fine since they're just text nodes?)</td></tr><tr><td class="line-number" value="1954"></td><td class="line-content">        while(node.$parent.$allKeysSet.has(key)) { // if there's already one called this, add {|} (hacky, but I think it's fine since they're just text nodes?)</td></tr><tr><td class="line-number" value="1955"></td><td class="line-content">          key += "{|}";</td></tr><tr><td class="line-number" value="1956"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1957"></td><td class="line-content">          if(alreadyWarnedAboutDuplicateTopLevelListNameCount &lt; 3 &amp;&amp; node.$parent.$parent === null) {</td></tr><tr><td class="line-number" value="1958"></td><td class="line-content">            window.codeWarningsArray.push({lineNumber:lines[i].lineNumber, generatorName:moduleName, warningId:"duplicate-top-level-list-name"});</td></tr><tr><td class="line-number" value="1959"></td><td class="line-content">            alreadyWarnedAboutDuplicateTopLevelListNameCount++;</td></tr><tr><td class="line-number" value="1960"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="1961"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="1962"></td><td class="line-content">        node.$parent[key] = node; // not via defineProperty, therefore it's enumerable</td></tr><tr><td class="line-number" value="1963"></td><td class="line-content">        nodeData.parentNode.$allKeys.push(key);</td></tr><tr><td class="line-number" value="1964"></td><td class="line-content">        nodeData.parentNode.$allKeysSet.add(key);</td></tr><tr><td class="line-number" value="1965"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="1966"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1967"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="1968"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1969"></td><td class="line-content">    // add user-defined functions</td></tr><tr><td class="line-number" value="1970"></td><td class="line-content">    if(lines[i].nodeType === "function") {</td></tr><tr><td class="line-number" value="1971"></td><td class="line-content">      nodeData.type = "function";</td></tr><tr><td class="line-number" value="1972"></td><td class="line-content">      nodeData.functionName = lines[i].functionName;</td></tr><tr><td class="line-number" value="1973"></td><td class="line-content">      nodeData.functionArgs = lines[i].functionArgs;</td></tr><tr><td class="line-number" value="1974"></td><td class="line-content">      nodeData.functionBody = lines[i].functionBody;</td></tr><tr><td class="line-number" value="1975"></td><td class="line-content">      nodeData.functionIsAsync = lines[i].functionIsAsync;</td></tr><tr><td class="line-number" value="1976"></td><td class="line-content">      //let withStr = `window.root.$imports.includes("${moduleName}") ? window.root.$imports[window.root.$imports.indexOf("${moduleName}")] : window.root`;</td></tr><tr><td class="line-number" value="1977"></td><td class="line-content">      let moduleRefStr = `window.moduleSpace["${moduleName || backupModuleName}"]`;</td></tr><tr><td class="line-number" value="1978"></td><td class="line-content">      let finalFunctionBody = `</td></tr><tr><td class="line-number" value="1979"></td><td class="line-content">        let tempHasHandlerRememberer927394 = ${moduleRefStr}.___proxyHandler.has;</td></tr><tr><td class="line-number" value="1980"></td><td class="line-content">        ${moduleRefStr}.___proxyHandler.has = window.__rootProxyHasHandler; /* .bind(${moduleRefStr}.___proxyHandler); */</td></tr><tr><td class="line-number" value="1981"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1982"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1983"></td><td class="line-content">        ${nodeData.functionArgs.map(a =&gt; __isValidJavaScriptIdentifier(a) ? `if(${a} &amp;&amp; ${a}.getSelf) ${a} = ${a}.getSelf;` : '').join("")}</td></tr><tr><td class="line-number" value="1984"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1985"></td><td class="line-content">        // make a proxy for the module so we can "exclude" this function's inputs from the "with" statement.</td></tr><tr><td class="line-number" value="1986"></td><td class="line-content">        // this allows us to have inputs that are the same name as module globals and they won't be "overwritten" by those globals.</td></tr><tr><td class="line-number" value="1987"></td><td class="line-content">        // I had to add the Number stuff because my numbers were acting funny after messing with their prototype: https://stackoverflow.com/questions/52580398/why-doesnt-new-arraynew-number3-produce-an-array-of-length-3  (edit: originally had just !isNaN(a), but I had to add the toPrecision and $nodeType type stuff because isNaN was executing valueOf on list objects/nodes, which obviously causes trouble)</td></tr><tr><td class="line-number" value="1988"></td><td class="line-content">        let moduleRefProxy = new Proxy(${moduleRefStr}.___proxyTarget.${window.__withExportDebug83748 ? "withObjProxy" : "obj"}, {</td></tr><tr><td class="line-number" value="1989"></td><td class="line-content">          get: function(target, name) {</td></tr><tr><td class="line-number" value="1990"></td><td class="line-content">            if(false) {} // &lt;-- just to make the next line easier to write</td></tr><tr><td class="line-number" value="1991"></td><td class="line-content">            ${nodeData.functionArgs.map(a =&gt; { a = a.split("=")[0]; if(a.startsWith("...")) { a = a.slice(3); } return `else if (name === "${a}") { return typeof ${a} !== "undefined" &amp;&amp; typeof ${a} !== "object" &amp;&amp; !${a}.$nodeType &amp;&amp; ${a}.toPrecision &amp;&amp; ${a}.toExponential &amp;&amp; !isNaN(${a}) ? Number(${a}) : ${a}; }` }).join("\n")}</td></tr><tr><td class="line-number" value="1992"></td><td class="line-content">            /*else if (name === "b") { return 10; }*/</td></tr><tr><td class="line-number" value="1993"></td><td class="line-content">            else { return target[name]; }</td></tr><tr><td class="line-number" value="1994"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="1995"></td><td class="line-content">        });</td></tr><tr><td class="line-number" value="1996"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1997"></td><td class="line-content">        let returnValue;</td></tr><tr><td class="line-number" value="1998"></td><td class="line-content">        with(moduleRefProxy) {</td></tr><tr><td class="line-number" value="1999"></td><td class="line-content">          let root = ${moduleRefStr}.___proxyTarget.obj; // &lt;-- because for some reason 'root' was referencing window.root (which is different to this modules root if this is an imported module) </td></tr><tr><td class="line-number" value="2000"></td><td class="line-content">          window.__lastPerchanceFnExecutionDetails = {async:${nodeData.functionIsAsync ? "true" : "false"}, time:Date.now(), declarationLineNumber:${lines[i].lineNumber}, moduleName:"${moduleName}"};</td></tr><tr><td class="line-number" value="2001"></td><td class="line-content">          returnValue = (${nodeData.functionIsAsync ? "async " : ""}function(${nodeData.functionArgs.join(",")}) {</td></tr><tr><td class="line-number" value="2002"></td><td class="line-content">            ${nodeData.functionBody}</td></tr><tr><td class="line-number" value="2003"></td><td class="line-content">          }).apply(this, [${nodeData.functionArgs.join(",")}])</td></tr><tr><td class="line-number" value="2004"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2005"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2006"></td><td class="line-content">        ${moduleRefStr}.___proxyHandler.has = tempHasHandlerRememberer927394;</td></tr><tr><td class="line-number" value="2007"></td><td class="line-content">        return returnValue;</td></tr><tr><td class="line-number" value="2008"></td><td class="line-content">      `;</td></tr><tr><td class="line-number" value="2009"></td><td class="line-content">      // ${nodeData.functionIsAsync ? `.catch(e =&gt; { console.error(e); __perchanceError("An error occurred somewhere within the function defined at line ${lines[i].lineNumber}. Here is the error message: &lt;b&gt;"+e.message+"&lt;/b&gt;", {declarationLineNumber:${lines[i].lineNumber}, moduleName:"${moduleName}"}); throw e; })` : ""};</td></tr><tr><td class="line-number" value="2010"></td><td class="line-content">      try {</td></tr><tr><td class="line-number" value="2011"></td><td class="line-content">        if(nodeData.functionIsAsync) {</td></tr><tr><td class="line-number" value="2012"></td><td class="line-content">          // Note: I don't think we actually need to make the "outer" function async, since it will always return a promise (made by the inner async function). But doing it anyway in case people try to write code like `myCoolFunction.constructor.name === "AsyncFunction"` or something.</td></tr><tr><td class="line-number" value="2013"></td><td class="line-content">          let AsyncFunction = (async function () {}).constructor;</td></tr><tr><td class="line-number" value="2014"></td><td class="line-content">          nodeData.functionRef = new AsyncFunction(nodeData.functionArgs.join(","), finalFunctionBody).bind(nodeData.parentNode);</td></tr><tr><td class="line-number" value="2015"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="2016"></td><td class="line-content">          nodeData.functionRef = new Function(nodeData.functionArgs.join(","), finalFunctionBody).bind(nodeData.parentNode);</td></tr><tr><td class="line-number" value="2017"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2018"></td><td class="line-content">      } catch(e) {</td></tr><tr><td class="line-number" value="2019"></td><td class="line-content">        console.error(e);</td></tr><tr><td class="line-number" value="2020"></td><td class="line-content">        __perchanceError(`There appears to be a syntax error in the function called '${nodeData.functionName}'. Here's the error message: "${e.message}".`, {declarationLineNumber:lines[i].lineNumber, moduleName});</td></tr><tr><td class="line-number" value="2021"></td><td class="line-content">        throw new Error(e);</td></tr><tr><td class="line-number" value="2022"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2023"></td><td class="line-content">      //nodeData.parentNode[nodeData.functionName] = new Function(nodeData.functionArgs.join(","), nodeData.functionBody).bind(nodeData.parentNode);</td></tr><tr><td class="line-number" value="2024"></td><td class="line-content">      Object.defineProperty(lines[i].node, "$nodeType", {value:"function", writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2025"></td><td class="line-content">      Object.defineProperty(nodeData.parentNode, nodeData.functionName, {value:nodeData.functionRef, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2026"></td><td class="line-content">      Object.defineProperty(lines[i].node, "$text", {value:nodeData.functionName, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2027"></td><td class="line-content">      Object.defineProperty(lines[i].node, "$function", {value:nodeData.functionRef, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2028"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2029"></td><td class="line-content">      nodeData.parentNode.$functionChildren.push(lines[i].functionName);</td></tr><tr><td class="line-number" value="2030"></td><td class="line-content">      nodeData.parentNode.$allKeys.push(lines[i].functionName);</td></tr><tr><td class="line-number" value="2031"></td><td class="line-content">      nodeData.parentNode.$allKeysSet.add(lines[i].functionName);</td></tr><tr><td class="line-number" value="2032"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2033"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2034"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2035"></td><td class="line-content">    if(lines[i].nodeType === "primitiveKeyValue") {</td></tr><tr><td class="line-number" value="2036"></td><td class="line-content">      nodeData.type = "primitiveKeyValue";</td></tr><tr><td class="line-number" value="2037"></td><td class="line-content">      nodeData.primitiveKey = lines[i].primitiveKey;</td></tr><tr><td class="line-number" value="2038"></td><td class="line-content">      nodeData.primitiveValue = lines[i].primitiveValue;</td></tr><tr><td class="line-number" value="2039"></td><td class="line-content">      // NOTE: it appears that then we write "[apple*10]" where apple={1|2|3}, JS implicitely calls toString on apple (even though it's a multiplication operation). so we don't need to worry about implementing valueOf</td></tr><tr><td class="line-number" value="2040"></td><td class="line-content">      //node.$value = lines[i].primitiveValue;</td></tr><tr><td class="line-number" value="2041"></td><td class="line-content">      //node.$key = lines[i].primitiveKey;</td></tr><tr><td class="line-number" value="2042"></td><td class="line-content">      let value = lines[i].primitiveValue;</td></tr><tr><td class="line-number" value="2043"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2044"></td><td class="line-content">      // if it's just plain text, process escaped characters (remove backslashes)</td></tr><tr><td class="line-number" value="2045"></td><td class="line-content">      // EDIT: NO! That's a terrible idea. Why remove escaped characters?! If you do, `output = \[wassup\]` throws an error (obviously). Was there a reason I previously thought this was a good idea?</td></tr><tr><td class="line-number" value="2046"></td><td class="line-content">      if(typeof value === 'string') {</td></tr><tr><td class="line-number" value="2047"></td><td class="line-content">        let split = __splitTextAtAllBlocks(value, {declarationLineNumber:lines[i].lineNumber, moduleName});</td></tr><tr><td class="line-number" value="2048"></td><td class="line-content">        if(typeof value === 'string' &amp;&amp; split.length === 1 &amp;&amp; split[0][0] !== "[" &amp;&amp; split[0][0] !== "{") { // only need to check start bracket because it it exists, then it is unescaped, then the last character *must* be a closing bracket (since splitted text array has length of 1) else the first bracket would be unclosed</td></tr><tr><td class="line-number" value="2049"></td><td class="line-content">          //value = processEscapedCharacters(value);</td></tr><tr><td class="line-number" value="2050"></td><td class="line-content">          Object.defineProperty(lines[i].node, "$isPlainPrimitive", {value:true, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2051"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2052"></td><td class="line-content">      } else if(typeof value === "number" || typeof value === "boolean") {</td></tr><tr><td class="line-number" value="2053"></td><td class="line-content">        Object.defineProperty(lines[i].node, "$isPlainPrimitive", {value:true, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2054"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="2055"></td><td class="line-content">        throw new Error("unknown primitive type??");</td></tr><tr><td class="line-number" value="2056"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2057"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2058"></td><td class="line-content">      Object.defineProperty(lines[i].node, "$value", {value:value, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2059"></td><td class="line-content">      Object.defineProperty(lines[i].node, "$key", {value:lines[i].primitiveKey, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2060"></td><td class="line-content">      //Object.defineProperty(nodeData.parentNode, lines[i].primitiveKey, {value:node, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2061"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2062"></td><td class="line-content">      // Just to be helpful:</td></tr><tr><td class="line-number" value="2063"></td><td class="line-content">      if(typeof nodeData.primitiveValue === "string" &amp;&amp; nodeData.parentNode === nodeData.root.node &amp;&amp; nodeData.primitiveKey === "$output" &amp;&amp; nodeData.primitiveValue.substr(1, nodeData.primitiveValue.length-2).trim() === "this") {</td></tr><tr><td class="line-number" value="2064"></td><td class="line-content">        __perchanceError("The generator called &lt;code&gt;&lt;a href='/"+moduleName+"#edit'&gt;"+moduleName+"&lt;/a&gt;&lt;/code&gt; has &lt;code&gt;$output&lt;/code&gt; set to &lt;code&gt;[this]&lt;/code&gt;. Perchance does this by default, so this line should be removed. That is, if you don't specify a top-level &lt;code&gt;$output&lt;/code&gt; (the list you want to export) for your generator, then Perchance will export your &lt;i&gt;whole hierarchy&lt;/i&gt;.", {declarationLineNumber:nodeData.declarationLineNumber, moduleName});</td></tr><tr><td class="line-number" value="2065"></td><td class="line-content">        return;</td></tr><tr><td class="line-number" value="2066"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2067"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2068"></td><td class="line-content">      Object.defineProperty(nodeData.parentNode, lines[i].primitiveKey, {</td></tr><tr><td class="line-number" value="2069"></td><td class="line-content">        get:function() {</td></tr><tr><td class="line-number" value="2070"></td><td class="line-content">          // MARKER:odj29hfi3j0d2kj0hx24f</td></tr><tr><td class="line-number" value="2071"></td><td class="line-content">          if(node.$isPlainPrimitive) {</td></tr><tr><td class="line-number" value="2072"></td><td class="line-content">            // When a user writes `thing.prop` we want them to be able to access the proper string (with escape chars removed), but the problem</td></tr><tr><td class="line-number" value="2073"></td><td class="line-content">            // is that we use this same getter in the evaluateText process, and we definitely don't want to remove escapes during that process</td></tr><tr><td class="line-number" value="2074"></td><td class="line-content">            // because it gets recursively evaluated so we'd be removing backslashes and evaluating blocks that should be evaluated. The toString</td></tr><tr><td class="line-number" value="2075"></td><td class="line-content">            // method also had this problem, but I solved it by passing in a {keepEscapes:true} object when it is used in the evaluateText process,</td></tr><tr><td class="line-number" value="2076"></td><td class="line-content">            // but since this is a getter, we can't pass in arguments, so I've used mega hax to do it (use global var). See the evaluateText function</td></tr><tr><td class="line-number" value="2077"></td><td class="line-content">            // file for the actual location where this var is altered. It should always be false except for when it is used during the evaluateText process.</td></tr><tr><td class="line-number" value="2078"></td><td class="line-content">            if(typeof node.$value === "string" &amp;&amp; !window.__primitiveValueGetterKeepEscapesYolo) return __processEscapedCharacters(node.$value);</td></tr><tr><td class="line-number" value="2079"></td><td class="line-content">            else return node.$value;</td></tr><tr><td class="line-number" value="2080"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="2081"></td><td class="line-content">          if(typeof node.$value === 'number') {</td></tr><tr><td class="line-number" value="2082"></td><td class="line-content">            return node.$value;</td></tr><tr><td class="line-number" value="2083"></td><td class="line-content">          } else if(typeof node.$value === 'string') {</td></tr><tr><td class="line-number" value="2084"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2085"></td><td class="line-content">            // EDIT: (7th Aug 2019), realised due to [this post](https://www.reddit.com/r/perchance/comments/cmlfqh/imported_expression_returns_undefined/)</td></tr><tr><td class="line-number" value="2086"></td><td class="line-content">            // that they can have something like:</td></tr><tr><td class="line-number" value="2087"></td><td class="line-content">            //   name = BATMAN</td></tr><tr><td class="line-number" value="2088"></td><td class="line-content">            //   $output</td></tr><tr><td class="line-number" value="2089"></td><td class="line-content">            //     n = ["[name]"]</td></tr><tr><td class="line-number" value="2090"></td><td class="line-content">            // and the IMPORTING generator's `name` variable will be used instead, since we're only resolving the first "layer" of square brackets. If the</td></tr><tr><td class="line-number" value="2091"></td><td class="line-content">            // getter returns a string, I'm pretty sure it should be a FULLY RESOLVED string (otherwise why resolve the first layer at all?). If you really do</td></tr><tr><td class="line-number" value="2092"></td><td class="line-content">            // want to pass around unresolved strings, then you're probably a pro and you know how to use functions and stuff.</td></tr><tr><td class="line-number" value="2093"></td><td class="line-content">            // example:</td></tr><tr><td class="line-number" value="2094"></td><td class="line-content">            //  imported: https://perchance.org/imported-2324234#edit</td></tr><tr><td class="line-number" value="2095"></td><td class="line-content">            //  importer: https://perchance.org/importing-93845793#edit</td></tr><tr><td class="line-number" value="2096"></td><td class="line-content">            let ctxInfo = {declarationLineNumber:node.$declarationLineNumber, moduleName:node.$moduleName, node};</td></tr><tr><td class="line-number" value="2097"></td><td class="line-content">            let splitted = __splitTextAtAllBlocks(node.$value, ctxInfo);</td></tr><tr><td class="line-number" value="2098"></td><td class="line-content">            if(splitted.length === 1) {</td></tr><tr><td class="line-number" value="2099"></td><td class="line-content">              if(splitted[0][0] === "[" /*&amp;&amp; splitted[0][splitted[0].length-1] === "]"*/) {</td></tr><tr><td class="line-number" value="2100"></td><td class="line-content">                // we don't want to evaluateText on this because it'll be coerced into a string (we want to preserve "direct" references)</td></tr><tr><td class="line-number" value="2101"></td><td class="line-content">                let expression = node.$value.substr(1,node.$value.length-2);</td></tr><tr><td class="line-number" value="2102"></td><td class="line-content">                let result = __evaluateSquareBlock(node.$root, node.$parent, expression, ctxInfo);</td></tr><tr><td class="line-number" value="2103"></td><td class="line-content">                while(1) {</td></tr><tr><td class="line-number" value="2104"></td><td class="line-content">                  if(typeof result === "string") {</td></tr><tr><td class="line-number" value="2105"></td><td class="line-content">                    // if it is a single square block, we need to preserve direct references to other nodes - if not we can just evaluateText</td></tr><tr><td class="line-number" value="2106"></td><td class="line-content">                    let newSplitted = __splitTextAtAllBlocks(result, ctxInfo);</td></tr><tr><td class="line-number" value="2107"></td><td class="line-content">                    if(newSplitted.length === 1 &amp;&amp; newSplitted[0][0] === "[") {</td></tr><tr><td class="line-number" value="2108"></td><td class="line-content">                      let expression = result.substr(1,result.length-2);</td></tr><tr><td class="line-number" value="2109"></td><td class="line-content">                      result = __evaluateSquareBlock(node.$root, node.$parent, expression, ctxInfo);</td></tr><tr><td class="line-number" value="2110"></td><td class="line-content">                    } else if(newSplitted.length === 1 &amp;&amp; /^\{import:[a-z0-9\-]+\}$/.test(newSplitted[0])) {</td></tr><tr><td class="line-number" value="2111"></td><td class="line-content">                      let moduleName = result.slice(8, -1);</td></tr><tr><td class="line-number" value="2112"></td><td class="line-content">                      if(!window.moduleSpace[moduleName]) __perchanceError(`Tried to (dynamically?) load the module "${moduleName}" but it doesn't exist. Try adding &lt;b&gt;{import:${moduleName}}&lt;/b&gt; anywhere in your generator's code to preload the data. If you're already importing it, but still getting this error, this could be a bug in the Perchance engine. Potentially useful: &lt;a href="https://perchance.org/dynamic-import-plugin" target="_blank" style="color:blue;"&gt;perchance.org/dynamic-import-plugin&lt;/a&gt;`, {declarationLineNumber:node.$declarationLineNumber, moduleName:node.$moduleName, node});</td></tr><tr><td class="line-number" value="2113"></td><td class="line-content">                      let moduleRoot = window.moduleSpace[moduleName].getSelf;</td></tr><tr><td class="line-number" value="2114"></td><td class="line-content">                      return moduleRoot.hasOwnProperty("$output") ? moduleRoot.$output : moduleRoot;</td></tr><tr><td class="line-number" value="2115"></td><td class="line-content">                    } else {</td></tr><tr><td class="line-number" value="2116"></td><td class="line-content">                      // it's definitely not one lone square block, so it's definitely not a direct reference and thus we can just resolve it to plain text:</td></tr><tr><td class="line-number" value="2117"></td><td class="line-content">                      result = __evaluateText(node.$root, node.$parent, result, ctxInfo);</td></tr><tr><td class="line-number" value="2118"></td><td class="line-content">                      // if(window.generatorLastEditTime &gt; 1716337636385) { // May 22nd 2024 bugfix, ensures only generators edited after this time get it, to prevent breaking old generators that rely on the bug</td></tr><tr><td class="line-number" value="2119"></td><td class="line-content">                      //   out = __processEscapedCharacters(out);</td></tr><tr><td class="line-number" value="2120"></td><td class="line-content">                      // }</td></tr><tr><td class="line-number" value="2121"></td><td class="line-content">                      if(localStorage.test2974296 === "sfsdfdsdfss4") { // above bugfix causes issues with many generators, so this is for testing</td></tr><tr><td class="line-number" value="2122"></td><td class="line-content">                        result = __processEscapedCharacters(result);</td></tr><tr><td class="line-number" value="2123"></td><td class="line-content">                      }</td></tr><tr><td class="line-number" value="2124"></td><td class="line-content">                      break;</td></tr><tr><td class="line-number" value="2125"></td><td class="line-content">                    }</td></tr><tr><td class="line-number" value="2126"></td><td class="line-content">                  } else {</td></tr><tr><td class="line-number" value="2127"></td><td class="line-content">                    break;</td></tr><tr><td class="line-number" value="2128"></td><td class="line-content">                  }</td></tr><tr><td class="line-number" value="2129"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="2130"></td><td class="line-content">                return result;</td></tr><tr><td class="line-number" value="2131"></td><td class="line-content">              } else if(splitted[0][0] === "{" /*&amp;&amp; splitted[0][splitted[0].length-1] === "}"*/) {</td></tr><tr><td class="line-number" value="2132"></td><td class="line-content">                //let expression = node.$value.substr(1,node.$value.length-2);</td></tr><tr><td class="line-number" value="2133"></td><td class="line-content">                //return __evaluateCurlyBlock(node.$root, node.$parent, expression, {declarationLineNumber:node.$declarationLineNumber});</td></tr><tr><td class="line-number" value="2134"></td><td class="line-content">                //return "{"+expression+"}";</td></tr><tr><td class="line-number" value="2135"></td><td class="line-content">                // ---</td></tr><tr><td class="line-number" value="2136"></td><td class="line-content">                // return node; // for square blocks we evaluate it to get a direct reference, but there's no need for this with curly blocks (we let toString do the evalation)</td></tr><tr><td class="line-number" value="2137"></td><td class="line-content">                // EDIT: (read above 7th Aug 2019 realisation - we need to do the evaluation ourselves so that it's evaluated within THIS generator's scope (in terms of `this` and global variables)):</td></tr><tr><td class="line-number" value="2138"></td><td class="line-content">                // return evaluateText(node.$root, node.$parent, node.$value, {declarationLineNumber:node.$declarationLineNumber});</td></tr><tr><td class="line-number" value="2139"></td><td class="line-content">                // EDIT AGAIN: NOPE! Luckily, this is a *node*, not a string, so the future toString will keep the correct context. If we evaluateText here, then you end up not being able to make</td></tr><tr><td class="line-number" value="2140"></td><td class="line-content">                //             a consumableList from an "inline" list like `icecreamflavor = {chocolate|vanilla|pistachio}` because `icecreamflavor` immediately resolves to one of the flavours as reported here: https://www.reddit.com/r/perchance/comments/co6msx/bug_list_name_being_included_in_output_of_list/ewgjzmm/</td></tr><tr><td class="line-number" value="2141"></td><td class="line-content">                if(/^\{import:[a-z0-9\-]+\}$/.test(splitted[0])) {</td></tr><tr><td class="line-number" value="2142"></td><td class="line-content">                  let moduleName = splitted[0].slice(8, -1);</td></tr><tr><td class="line-number" value="2143"></td><td class="line-content">                  // return window.moduleSpace[moduleName].getSelf.$output;</td></tr><tr><td class="line-number" value="2144"></td><td class="line-content">                  if(!window.moduleSpace[moduleName]) __perchanceError(`Tried to (dynamically?) load the module "${moduleName}" but it doesn't exist. Try adding &lt;b&gt;{import:${moduleName}}&lt;/b&gt; anywhere in your generator's code to preload the data. If you're already importing it, but still getting this error, this could be a bug/problem in the Perchance engine. Potentially useful: &lt;a href="https://perchance.org/dynamic-import-plugin" target="_blank"&gt;perchance.org/dynamic-import-plugin&lt;/a&gt;`, {declarationLineNumber:node.$declarationLineNumber, moduleName:node.$moduleName, node});</td></tr><tr><td class="line-number" value="2145"></td><td class="line-content">                  let moduleRoot = window.moduleSpace[moduleName].getSelf;</td></tr><tr><td class="line-number" value="2146"></td><td class="line-content">                  return moduleRoot.hasOwnProperty("$output") ? moduleRoot.$output : moduleRoot;</td></tr><tr><td class="line-number" value="2147"></td><td class="line-content">                } else {</td></tr><tr><td class="line-number" value="2148"></td><td class="line-content">                  return node;</td></tr><tr><td class="line-number" value="2149"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="2150"></td><td class="line-content">              } else {</td></tr><tr><td class="line-number" value="2151"></td><td class="line-content">                // // plain text (no curly or square blocks) - LATER: why do we need to evaluate it then? not necessary?</td></tr><tr><td class="line-number" value="2152"></td><td class="line-content">                //return evaluateText(node.$root, node.$parent, node.$value, {declarationLineNumber:node.$declarationLineNumber});</td></tr><tr><td class="line-number" value="2153"></td><td class="line-content">                return __processEscapedCharacters(node.$value); // &lt;-- WAIT - this will never occur?? The if(node.$isPlainPrimitive) above will catch all plain text nodes.</td></tr><tr><td class="line-number" value="2154"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="2155"></td><td class="line-content">            } else {</td></tr><tr><td class="line-number" value="2156"></td><td class="line-content">              // we've found a non-direct reference that's not plain text.</td></tr><tr><td class="line-number" value="2157"></td><td class="line-content">              // we need to return the *actual node* because otherwise if we have `output = [prefix]-blah` (for example)</td></tr><tr><td class="line-number" value="2158"></td><td class="line-content">              // then we couldn't call `output.selectMany(3)` on it because `output` would be a plain string (like "pseudo-blah", for example).</td></tr><tr><td class="line-number" value="2159"></td><td class="line-content">              // note that when used on $value nodes, selectOne will just return the node itself</td></tr><tr><td class="line-number" value="2160"></td><td class="line-content">              return node;</td></tr><tr><td class="line-number" value="2161"></td><td class="line-content">              // var n = node.createClone;</td></tr><tr><td class="line-number" value="2162"></td><td class="line-content">              // n.$nodeType = "text";</td></tr><tr><td class="line-number" value="2163"></td><td class="line-content">              // Object.defineProperty(lines[i].node, "$text", {value:n.$value, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2164"></td><td class="line-content">              // Object.defineProperty(lines[i].node, "$oddsText", {value:"1", writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2165"></td><td class="line-content">              // delete n.$key;</td></tr><tr><td class="line-number" value="2166"></td><td class="line-content">              // delete n.$value;</td></tr><tr><td class="line-number" value="2167"></td><td class="line-content">              // return n;</td></tr><tr><td class="line-number" value="2168"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2169"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2170"></td><td class="line-content">          } else if(typeof node.$value === 'boolean') {</td></tr><tr><td class="line-number" value="2171"></td><td class="line-content">            return node.$value;</td></tr><tr><td class="line-number" value="2172"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="2173"></td><td class="line-content">            //console.error("Something went wrong? $value should be either a number, string, or boolean, right?");</td></tr><tr><td class="line-number" value="2174"></td><td class="line-content">            return node.$value; // June 11th 2019: It's a direct reference to another node, or a reference to an objext or something. (I thought I was tyding direct references up somewhere else, but that wouldn't cut it anyway because they can change the value now that there's a setter (e.g. to a POJO or whatever))</td></tr><tr><td class="line-number" value="2175"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="2176"></td><td class="line-content">        },</td></tr><tr><td class="line-number" value="2177"></td><td class="line-content">        set:function(v) { // June 11th 2019: Added this setter - why wasn't it set already? If it's not set then we can't change it and we get problems like this: https://www.reddit.com/r/perchance/comments/bz2smn/one_of_the_example_generator_is_broken_i_think_i/</td></tr><tr><td class="line-number" value="2178"></td><td class="line-content">          node.$value = v;</td></tr><tr><td class="line-number" value="2179"></td><td class="line-content">          return v;</td></tr><tr><td class="line-number" value="2180"></td><td class="line-content">        },</td></tr><tr><td class="line-number" value="2181"></td><td class="line-content">        configurable:true,</td></tr><tr><td class="line-number" value="2182"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="2183"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2184"></td><td class="line-content">      Object.defineProperty(lines[i].node, "$nodeType", {value:"value", writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2185"></td><td class="line-content">      Object.defineProperty(lines[i].node, "$text", {value:lines[i].primitiveKey, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2186"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2187"></td><td class="line-content">      nodeData.parentNode.$valueChildren.push(lines[i].primitiveKey);</td></tr><tr><td class="line-number" value="2188"></td><td class="line-content">      nodeData.parentNode.$allKeys.push(lines[i].primitiveKey);</td></tr><tr><td class="line-number" value="2189"></td><td class="line-content">      nodeData.parentNode.$allKeysSet.add(lines[i].primitiveKey);</td></tr><tr><td class="line-number" value="2190"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2191"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2192"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2193"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2194"></td><td class="line-content">  // add $children property to each node (an array of all of the keys of the node's non-primitive, non-function children that are leaf nodes (i.e. that are themselves childless))</td></tr><tr><td class="line-number" value="2195"></td><td class="line-content">  // TODO: final confirmation: this should be just the keys, right? or would it be more useful to people as nodes? what are use cases of this property? [animal.$children] - actually yeah, it makes sense that it returns a key - if it returned an object then a random child of THAT object would be chosen!</td></tr><tr><td class="line-number" value="2196"></td><td class="line-content">  for(let node of allNodes) {</td></tr><tr><td class="line-number" value="2197"></td><td class="line-content">    let keys = Object.keys(node).filter(k =&gt; node[k].$nodeType === 'normal').sort((k1,k2) =&gt; node[k1].$declarationLineNumber-node[k2].$declarationLineNumber); // filter out primitives and sort by the actual order of the list</td></tr><tr><td class="line-number" value="2198"></td><td class="line-content">    Object.defineProperty(node, "$children", {value:keys, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2199"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2200"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2201"></td><td class="line-content">  // // error if any of the **direct children of root** aren't valid javascript identifiers.</td></tr><tr><td class="line-number" value="2202"></td><td class="line-content">  // // this is necessary for two reasons:</td></tr><tr><td class="line-number" value="2203"></td><td class="line-content">  // // 1. calling [else] will throw an error - but [thing.else] will not</td></tr><tr><td class="line-number" value="2204"></td><td class="line-content">  // // 2. calling [my list] will throw an error - but [thing["my list"]] will not</td></tr><tr><td class="line-number" value="2205"></td><td class="line-content">  // let warnLineNumbers = [];</td></tr><tr><td class="line-number" value="2206"></td><td class="line-content">  // for(let key of root.node.$children) {</td></tr><tr><td class="line-number" value="2207"></td><td class="line-content">  //   if(!isValidJavaScriptIdentifier(key)) {</td></tr><tr><td class="line-number" value="2208"></td><td class="line-content">  //     warnLineNumbers.push( root.node[key].$declarationLineNumber );</td></tr><tr><td class="line-number" value="2209"></td><td class="line-content">  //   }</td></tr><tr><td class="line-number" value="2210"></td><td class="line-content">  // }</td></tr><tr><td class="line-number" value="2211"></td><td class="line-content">  // if(warnLineNumbers.length &gt; 0) {</td></tr><tr><td class="line-number" value="2212"></td><td class="line-content">  //   if(warnLineNumbers.length &gt; 10) {</td></tr><tr><td class="line-number" value="2213"></td><td class="line-content">  //     warnLineNumbers = warnLineNumbers.slice(1,9);</td></tr><tr><td class="line-number" value="2214"></td><td class="line-content">  //     warnLineNumbers.push("...");</td></tr><tr><td class="line-number" value="2215"></td><td class="line-content">  //   }</td></tr><tr><td class="line-number" value="2216"></td><td class="line-content">  //   console.warn(`Warning at line number${(warnLineNumbers.length &gt; 1 ? "s" : "")+" "+warnLineNumbers.join(", ")}. All *top-level* items must only include letters, numbers and underscore characters (no spaces or special characters). They also must not start with a number. They also must not be any of these "reserved" names: break, do, instanceof, typeof, case, else, new, var, catch, finally, return, void, continue, for, switch, while, debugger, function, this, with, default, if, throw, delete, in, try class, enum, extends, super, const, export, import, implements, interface, let, package, private, protected, public, static, yield`);</td></tr><tr><td class="line-number" value="2217"></td><td class="line-content">  // }</td></tr><tr><td class="line-number" value="2218"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2219"></td><td class="line-content">  // TODO: add module name to all errors, or print module name when you catch errors</td></tr><tr><td class="line-number" value="2220"></td><td class="line-content">  // TODO: add "need help?" link to all errors that links to community (reddit, probably)</td></tr><tr><td class="line-number" value="2221"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2222"></td><td class="line-content">  // extract import statements:</td></tr><tr><td class="line-number" value="2223"></td><td class="line-content">  let importedModuleNamesArray = [];</td></tr><tr><td class="line-number" value="2224"></td><td class="line-content">  __ignorePerchanceErrors = true;</td></tr><tr><td class="line-number" value="2225"></td><td class="line-content">  for(let line of lines) {</td></tr><tr><td class="line-number" value="2226"></td><td class="line-content">    if(line.nodeType === 'function' || line.node.$isPlainPrimitive) continue;</td></tr><tr><td class="line-number" value="2227"></td><td class="line-content">    let names = __collectImportedModuleNamesFromText(line.text);</td></tr><tr><td class="line-number" value="2228"></td><td class="line-content">    importedModuleNamesArray.push(...names);</td></tr><tr><td class="line-number" value="2229"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2230"></td><td class="line-content">  __ignorePerchanceErrors = false;</td></tr><tr><td class="line-number" value="2231"></td><td class="line-content">  Object.defineProperty(root.node, "$imports", {value:[...new Set(importedModuleNamesArray)], writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2232"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2233"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2234"></td><td class="line-content">  Object.defineProperty(root.node, "$allNodes", {value:allNodes, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2235"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2236"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2237"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2238"></td><td class="line-content">  // for(let node of allNodes) {</td></tr><tr><td class="line-number" value="2239"></td><td class="line-content">  //   if(node.$constructorFunction.prototype !== undefined) {debugger;}</td></tr><tr><td class="line-number" value="2240"></td><td class="line-content">  //   Object.defineProperties(node.$constructorFunction.prototype, Object.getOwnPropertyDescriptors(node));</td></tr><tr><td class="line-number" value="2241"></td><td class="line-content">  // }</td></tr><tr><td class="line-number" value="2242"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2243"></td><td class="line-content">  let alreadySeenTopLevelKeysToLineNum = new Map();</td></tr><tr><td class="line-number" value="2244"></td><td class="line-content">  const allowedDollarVariables = ["$output", "$preprocess"];</td></tr><tr><td class="line-number" value="2245"></td><td class="line-content">  for(let node of root.node.$allNodes) {</td></tr><tr><td class="line-number" value="2246"></td><td class="line-content">    if(node.$nodeType === "value" &amp;&amp; node.$text[0] === "$" &amp;&amp; !allowedDollarVariables.includes(node.$text)) {</td></tr><tr><td class="line-number" value="2247"></td><td class="line-content">      __perchanceError(`There's a problem with the '${moduleName}' generator. You've created a property with a name that starts with "$". This is highly discouraged because dollar-sign variables are reserved for special features such as $output and $preprocess. New features that are added to Perchance in the future may use other dollar-sign variable names and these may conflict with your variable-name choice and thus cause errors.`, {declarationLineNumber:node.$declarationLineNumber, moduleName, node});</td></tr><tr><td class="line-number" value="2248"></td><td class="line-content">      continue;</td></tr><tr><td class="line-number" value="2249"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2250"></td><td class="line-content">    let nodeName = node.$text;</td></tr><tr><td class="line-number" value="2251"></td><td class="line-content">    // I use `moduleName !== null` here to hackily exclude the name check if this run of createPerchanceTree is due to a call of the createClone function (the only case where no module name is allowed). In this case it's fine for top-level nodes to have names to be invalid JS identifiers, because they aren't referencable as if they were global variables.</td></tr><tr><td class="line-number" value="2252"></td><td class="line-content">    // Note that if this is a call to createClone, then `root` isn't the "real" root and is discarded once we've created the clone.</td></tr><tr><td class="line-number" value="2253"></td><td class="line-content">    if(moduleName !== null &amp;&amp; node.$parent === root.node &amp;&amp; (!__isValidJavaScriptIdentifier(nodeName) || node.$text === "update")) {</td></tr><tr><td class="line-number" value="2254"></td><td class="line-content">      __perchanceError(`There's a problem with the '${moduleName}' generator. You've created a top-level list called "&lt;b&gt;${__escapeHTMLSpecialChars(node.$text)}&lt;/b&gt;", which is not allowed. Unfortunately top-level list names are subject to some strict rules:&lt;ul&gt;&lt;li&gt;They must not contain any spaces&lt;/li&gt;&lt;li&gt;They must only contain letters (lower or upper case), numbers and underscores ("_")&lt;/li&gt;&lt;li&gt;They must not begin with a number&lt;/li&gt;&lt;li&gt;They must not be any of the following special "reserved" names: update, do, if, in, for, let, new, try, var, case, else, enum, eval, null, this, true, void, with, await, break, catch, class, const, false, super, throw, while, yield, delete, export, import, public, return, static, switch, typeof, default, extends, finally, package, private, continue, debugger, function, arguments, interface, protected, implements, instanceof&lt;/li&gt;&lt;/ul&gt; Sorry for the inconvenience! These rules may seem strange, but they're needed to make the more advanced features of the perchance engine work.`, {declarationLineNumber:node.$declarationLineNumber, moduleName, node});</td></tr><tr><td class="line-number" value="2255"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2256"></td><td class="line-content">    </td></tr><tr><td class="line-number" value="2257"></td><td class="line-content">    try { // new code, so try/catch</td></tr><tr><td class="line-number" value="2258"></td><td class="line-content">      if(node.$parent === node.$root) {</td></tr><tr><td class="line-number" value="2259"></td><td class="line-content">        if(alreadySeenTopLevelKeysToLineNum.has(node.$text)) {</td></tr><tr><td class="line-number" value="2260"></td><td class="line-content">          __perchanceError(`The list name '&lt;code&gt;${node.$text}&lt;/code&gt;' was used on line number &lt;b&gt;${alreadySeenTopLevelKeysToLineNum.get(node.$text)}&lt;/b&gt;, and again on line &lt;b&gt;${node.$declarationLineNumber}&lt;/b&gt;. Top-level list names should be unique.`, {declarationLineNumber:node.$declarationLineNumber, node, moduleName});</td></tr><tr><td class="line-number" value="2261"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="2262"></td><td class="line-content">          alreadySeenTopLevelKeysToLineNum.set(node.$text, node.$declarationLineNumber);</td></tr><tr><td class="line-number" value="2263"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2264"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2265"></td><td class="line-content">    } catch(e) { console.error(e); }</td></tr><tr><td class="line-number" value="2266"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2267"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2268"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2269"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2270"></td><td class="line-content">  let fn = function(){};</td></tr><tr><td class="line-number" value="2271"></td><td class="line-content">  fn.obj = root.node;</td></tr><tr><td class="line-number" value="2272"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="2273"></td><td class="line-content">  // for use in `with` statement, so it only exposes direct child names and not e.g. lowerCase, $imports, etc.</td></tr><tr><td class="line-number" value="2274"></td><td class="line-content">  let visiblePropertiesForWith = root.node.getAllKeys;</td></tr><tr><td class="line-number" value="2275"></td><td class="line-content">  visiblePropertiesForWith.push("$root", "$moduleName"); // since people are using these as if they're globals</td></tr><tr><td class="line-number" value="2276"></td><td class="line-content">  fn.withObjProxy = new Proxy(root.node, {</td></tr><tr><td class="line-number" value="2277"></td><td class="line-content">    get(target, prop, receiver) {</td></tr><tr><td class="line-number" value="2278"></td><td class="line-content">      if(visiblePropertiesForWith.includes(prop)) {</td></tr><tr><td class="line-number" value="2279"></td><td class="line-content">        return Reflect.get(target, prop, receiver);</td></tr><tr><td class="line-number" value="2280"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2281"></td><td class="line-content">      return undefined;</td></tr><tr><td class="line-number" value="2282"></td><td class="line-content">    },</td></tr><tr><td class="line-number" value="2283"></td><td class="line-content">    set(target, prop, value, receiver) {</td></tr><tr><td class="line-number" value="2284"></td><td class="line-content">      if(visiblePropertiesForWith.includes(prop)) {</td></tr><tr><td class="line-number" value="2285"></td><td class="line-content">        return Reflect.set(target, prop, value, receiver);</td></tr><tr><td class="line-number" value="2286"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2287"></td><td class="line-content">      return true; // ignore non-visible properties - seems like it's not really necessary though since `with` won't try setting non-visible properties due to `has` handler check. So it'll pass throught to `window`.</td></tr><tr><td class="line-number" value="2288"></td><td class="line-content">    },</td></tr><tr><td class="line-number" value="2289"></td><td class="line-content">    has(target, prop) {</td></tr><tr><td class="line-number" value="2290"></td><td class="line-content">      return visiblePropertiesForWith.includes(prop);</td></tr><tr><td class="line-number" value="2291"></td><td class="line-content">    },</td></tr><tr><td class="line-number" value="2292"></td><td class="line-content">    ownKeys(target) {</td></tr><tr><td class="line-number" value="2293"></td><td class="line-content">      return visiblePropertiesForWith;</td></tr><tr><td class="line-number" value="2294"></td><td class="line-content">    },</td></tr><tr><td class="line-number" value="2295"></td><td class="line-content">    getOwnPropertyDescriptor(target, prop) {</td></tr><tr><td class="line-number" value="2296"></td><td class="line-content">      if (visiblePropertiesForWith.includes(prop)) {</td></tr><tr><td class="line-number" value="2297"></td><td class="line-content">        return Reflect.getOwnPropertyDescriptor(target, prop);</td></tr><tr><td class="line-number" value="2298"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2299"></td><td class="line-content">      return undefined;</td></tr><tr><td class="line-number" value="2300"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2301"></td><td class="line-content">  });</td></tr><tr><td class="line-number" value="2302"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2303"></td><td class="line-content">  let rootProxy = new Proxy(fn, {</td></tr><tr><td class="line-number" value="2304"></td><td class="line-content">      capturedCalls: [],</td></tr><tr><td class="line-number" value="2305"></td><td class="line-content">      executionProperties: [</td></tr><tr><td class="line-number" value="2306"></td><td class="line-content">        "toString",</td></tr><tr><td class="line-number" value="2307"></td><td class="line-content">        "valueOf",</td></tr><tr><td class="line-number" value="2308"></td><td class="line-content">        Symbol.hasInstance,</td></tr><tr><td class="line-number" value="2309"></td><td class="line-content">        Symbol.isConcatSpreadable,</td></tr><tr><td class="line-number" value="2310"></td><td class="line-content">        Symbol.iterator,</td></tr><tr><td class="line-number" value="2311"></td><td class="line-content">        Symbol.match,</td></tr><tr><td class="line-number" value="2312"></td><td class="line-content">        Symbol.prototype,</td></tr><tr><td class="line-number" value="2313"></td><td class="line-content">        Symbol.replace,</td></tr><tr><td class="line-number" value="2314"></td><td class="line-content">        Symbol.search,</td></tr><tr><td class="line-number" value="2315"></td><td class="line-content">        Symbol.species,</td></tr><tr><td class="line-number" value="2316"></td><td class="line-content">        Symbol.split,</td></tr><tr><td class="line-number" value="2317"></td><td class="line-content">        Symbol.toPrimitive,</td></tr><tr><td class="line-number" value="2318"></td><td class="line-content">        Symbol.toStringTag,</td></tr><tr><td class="line-number" value="2319"></td><td class="line-content">        Symbol.unscopables,</td></tr><tr><td class="line-number" value="2320"></td><td class="line-content">        Symbol.for,</td></tr><tr><td class="line-number" value="2321"></td><td class="line-content">        Symbol.keyFor,</td></tr><tr><td class="line-number" value="2322"></td><td class="line-content">        "selectMany",</td></tr><tr><td class="line-number" value="2323"></td><td class="line-content">        "selectOne",</td></tr><tr><td class="line-number" value="2324"></td><td class="line-content">        "selectAll",</td></tr><tr><td class="line-number" value="2325"></td><td class="line-content">        "getSelf",</td></tr><tr><td class="line-number" value="2326"></td><td class="line-content">        "getName",</td></tr><tr><td class="line-number" value="2327"></td><td class="line-content">        "$imports",</td></tr><tr><td class="line-number" value="2328"></td><td class="line-content">        "$allNodes",</td></tr><tr><td class="line-number" value="2329"></td><td class="line-content">        "$odds",</td></tr><tr><td class="line-number" value="2330"></td><td class="line-content">        "$text",</td></tr><tr><td class="line-number" value="2331"></td><td class="line-content">        "$value",</td></tr><tr><td class="line-number" value="2332"></td><td class="line-content">        "$key",</td></tr><tr><td class="line-number" value="2333"></td><td class="line-content">        "$nodeType",</td></tr><tr><td class="line-number" value="2334"></td><td class="line-content">        "$oddsText",</td></tr><tr><td class="line-number" value="2335"></td><td class="line-content">        "$declarationLineNumber",</td></tr><tr><td class="line-number" value="2336"></td><td class="line-content">        "$moduleName",</td></tr><tr><td class="line-number" value="2337"></td><td class="line-content">        "$root",</td></tr><tr><td class="line-number" value="2338"></td><td class="line-content">        "$parent",</td></tr><tr><td class="line-number" value="2339"></td><td class="line-content">        "$children",</td></tr><tr><td class="line-number" value="2340"></td><td class="line-content">        "isConsumable",</td></tr><tr><td class="line-number" value="2341"></td><td class="line-content">        "consumableList",</td></tr><tr><td class="line-number" value="2342"></td><td class="line-content">        "createClone",</td></tr><tr><td class="line-number" value="2343"></td><td class="line-content">        "evaluateItem",</td></tr><tr><td class="line-number" value="2344"></td><td class="line-content">        "joinItems",</td></tr><tr><td class="line-number" value="2345"></td><td class="line-content">        //"listName",</td></tr><tr><td class="line-number" value="2346"></td><td class="line-content">        // TODO: add new items here whenever you add any new special properties</td></tr><tr><td class="line-number" value="2347"></td><td class="line-content">      ],</td></tr><tr><td class="line-number" value="2348"></td><td class="line-content">      organiseCalls: function(capturedCalls) {</td></tr><tr><td class="line-number" value="2349"></td><td class="line-content">        // CAREFUL: do not move `apply`s away from their correct `get`</td></tr><tr><td class="line-number" value="2350"></td><td class="line-content">        let textTransforms = [];</td></tr><tr><td class="line-number" value="2351"></td><td class="line-content">        let nonTextTransforms = [];</td></tr><tr><td class="line-number" value="2352"></td><td class="line-content">        let inApplyChain = false;</td></tr><tr><td class="line-number" value="2353"></td><td class="line-content">        for(let i = 0; i &lt; capturedCalls.length; i++) {</td></tr><tr><td class="line-number" value="2354"></td><td class="line-content">          let call = capturedCalls[i];</td></tr><tr><td class="line-number" value="2355"></td><td class="line-content">          if(call.type === "get" &amp;&amp; textTransformNames.includes(call.name)) {</td></tr><tr><td class="line-number" value="2356"></td><td class="line-content">            // if(i+1 &lt; capturedCalls.length &amp;&amp; capturedCalls[i+1].type === "apply") {</td></tr><tr><td class="line-number" value="2357"></td><td class="line-content">            //   perchanceError(`Tried to call a text transform '${call.name}' as a function/method. Text transforms like ${call.name}, pluralForm and titleCase are not functions. They shouldn't be followed by a pair brackets.`);</td></tr><tr><td class="line-number" value="2358"></td><td class="line-content">            // }</td></tr><tr><td class="line-number" value="2359"></td><td class="line-content">            textTransforms.push(call);</td></tr><tr><td class="line-number" value="2360"></td><td class="line-content">            inApplyChain = true; // any `apply`s after this text transform must be moved with it</td></tr><tr><td class="line-number" value="2361"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2362"></td><td class="line-content">          } else if(call.type === "apply" &amp;&amp; inApplyChain) {</td></tr><tr><td class="line-number" value="2363"></td><td class="line-content">            textTransforms.push(call);</td></tr><tr><td class="line-number" value="2364"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="2365"></td><td class="line-content">            nonTextTransforms.push(call);</td></tr><tr><td class="line-number" value="2366"></td><td class="line-content">            inApplyChain = false;</td></tr><tr><td class="line-number" value="2367"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="2368"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2369"></td><td class="line-content">        let organisedCalls = [];</td></tr><tr><td class="line-number" value="2370"></td><td class="line-content">        organisedCalls.push(...nonTextTransforms);</td></tr><tr><td class="line-number" value="2371"></td><td class="line-content">        organisedCalls.push(...textTransforms);</td></tr><tr><td class="line-number" value="2372"></td><td class="line-content">        // TODO***: should text transforms be applied before joinItems?</td></tr><tr><td class="line-number" value="2373"></td><td class="line-content">        return organisedCalls;</td></tr><tr><td class="line-number" value="2374"></td><td class="line-content">      },</td></tr><tr><td class="line-number" value="2375"></td><td class="line-content">      executeChain: function(target, calls) {</td></tr><tr><td class="line-number" value="2376"></td><td class="line-content">        let result = target.obj;</td></tr><tr><td class="line-number" value="2377"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2378"></td><td class="line-content">        // let disable$output = false;</td></tr><tr><td class="line-number" value="2379"></td><td class="line-content">        // if(calls.map(c=&gt;c.name).includes("disable$output")) {</td></tr><tr><td class="line-number" value="2380"></td><td class="line-content">        //   debugger;</td></tr><tr><td class="line-number" value="2381"></td><td class="line-content">        //   disable$output = true;</td></tr><tr><td class="line-number" value="2382"></td><td class="line-content">        // }</td></tr><tr><td class="line-number" value="2383"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2384"></td><td class="line-content">        if(calls.length === 0) {</td></tr><tr><td class="line-number" value="2385"></td><td class="line-content">          return target.obj;</td></tr><tr><td class="line-number" value="2386"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2387"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2388"></td><td class="line-content">        // move text transforms to end (importantly, this method doesn't change the this.capturedCalls array - it returns a new one)</td></tr><tr><td class="line-number" value="2389"></td><td class="line-content">        let capturedCalls = this.organiseCalls(calls);</td></tr><tr><td class="line-number" value="2390"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2391"></td><td class="line-content">        let lastResult, secondLastResult;</td></tr><tr><td class="line-number" value="2392"></td><td class="line-content">        for(let i = 0; i &lt; capturedCalls.length; i++) {</td></tr><tr><td class="line-number" value="2393"></td><td class="line-content">          let call = capturedCalls[i];</td></tr><tr><td class="line-number" value="2394"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2395"></td><td class="line-content">          secondLastResult = lastResult; // needed for `apply` (since LAST result is the actual function, and not the object/thing that it's being being called from)</td></tr><tr><td class="line-number" value="2396"></td><td class="line-content">          lastResult = result;</td></tr><tr><td class="line-number" value="2397"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2398"></td><td class="line-content">          if(call.type === "get") {</td></tr><tr><td class="line-number" value="2399"></td><td class="line-content">            result = result[call.name];</td></tr><tr><td class="line-number" value="2400"></td><td class="line-content">            if(result === undefined &amp;&amp; i === 0) {</td></tr><tr><td class="line-number" value="2401"></td><td class="line-content">              result = window[call.name]; // try to fallback to global `window` if there's no list/function/property found - e.g. if they did [Math.min(hp, 100)] - "Math" is not a list</td></tr><tr><td class="line-number" value="2402"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2403"></td><td class="line-content">          } else if(call.type === "apply") {</td></tr><tr><td class="line-number" value="2404"></td><td class="line-content">            // in my case the `this` variable should be the thing that the method is being called from</td></tr><tr><td class="line-number" value="2405"></td><td class="line-content">            // (this is done by default with getters)</td></tr><tr><td class="line-number" value="2406"></td><td class="line-content">            result = result.apply(secondLastResult, call.args);</td></tr><tr><td class="line-number" value="2407"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="2408"></td><td class="line-content">            console.error("How could this be?");</td></tr><tr><td class="line-number" value="2409"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="2410"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2411"></td><td class="line-content">          if(result === undefined) {</td></tr><tr><td class="line-number" value="2412"></td><td class="line-content">            // we DON'T return an error message because they may just want to check if the property exists.</td></tr><tr><td class="line-number" value="2413"></td><td class="line-content">            return undefined;</td></tr><tr><td class="line-number" value="2414"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="2415"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2416"></td><td class="line-content">          // Remember that `result` could be a Proxy (imagine `$output = [noun.pluralForm]` - root.$output is a proxy with `noun` and `pluralForm` in the capturedCalls array (because $value nodes are evaluated when called (using a `get` handler))).</td></tr><tr><td class="line-number" value="2417"></td><td class="line-content">          // If it IS a proxy, we want to append this proxy's capturedCalls array to the new one and execute it:</td></tr><tr><td class="line-number" value="2418"></td><td class="line-content">          if(result.___isProxy) {</td></tr><tr><td class="line-number" value="2419"></td><td class="line-content">            let leftOverCalls = capturedCalls.slice(i+1);</td></tr><tr><td class="line-number" value="2420"></td><td class="line-content">            let allCalls = [...result.___proxyHandler.capturedCalls, ...leftOverCalls];</td></tr><tr><td class="line-number" value="2421"></td><td class="line-content">            // TODO: just to confirm, we don't need to pass along secondLastResult do we? What if they called `apply` twice in a row? It's an edge case that might be annoying to debug later on</td></tr><tr><td class="line-number" value="2422"></td><td class="line-content">            return this.executeChain(result.___proxyTarget, allCalls);</td></tr><tr><td class="line-number" value="2423"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="2424"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2425"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2426"></td><td class="line-content">        return result;</td></tr><tr><td class="line-number" value="2427"></td><td class="line-content">      },</td></tr><tr><td class="line-number" value="2428"></td><td class="line-content">      userDefinedNonNodePropertyIds: {},</td></tr><tr><td class="line-number" value="2429"></td><td class="line-content">      getUserDefinedNonNodePropertyId: function(property, calls) {</td></tr><tr><td class="line-number" value="2430"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2431"></td><td class="line-content">        // In case you're wondering what on earth is going on here:</td></tr><tr><td class="line-number" value="2432"></td><td class="line-content">        // We need to get the proxy to return properies that the USER has set with scripts (in square blocks, functions, etc.).</td></tr><tr><td class="line-number" value="2433"></td><td class="line-content">        // So we need to keep track of when they add their own properties to `root`.</td></tr><tr><td class="line-number" value="2434"></td><td class="line-content">        // That way, when the proxy gets a `get` request for one of these "non-node" properties, it can return it straight up.</td></tr><tr><td class="line-number" value="2435"></td><td class="line-content">        // Basically, any properties added to root AFTER compilation will always be returned in get requests (rather than returning a proxy).</td></tr><tr><td class="line-number" value="2436"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2437"></td><td class="line-content">        // This will probably cause memory leaks if they're setting properties on root with dynamically generated names?</td></tr><tr><td class="line-number" value="2438"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2439"></td><td class="line-content">        let seperator = "_{9287234632&lt;&lt;prop-id-call-seperator&gt;&gt;4632877592}_";</td></tr><tr><td class="line-number" value="2440"></td><td class="line-content">        let id = "root";</td></tr><tr><td class="line-number" value="2441"></td><td class="line-content">        for(let call of calls) {</td></tr><tr><td class="line-number" value="2442"></td><td class="line-content">          if(call.type === "apply") {</td></tr><tr><td class="line-number" value="2443"></td><td class="line-content">            return false;</td></tr><tr><td class="line-number" value="2444"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="2445"></td><td class="line-content">          id += seperator + call.name;</td></tr><tr><td class="line-number" value="2446"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2447"></td><td class="line-content">        id += seperator + property;</td></tr><tr><td class="line-number" value="2448"></td><td class="line-content">        return id;</td></tr><tr><td class="line-number" value="2449"></td><td class="line-content">      },</td></tr><tr><td class="line-number" value="2450"></td><td class="line-content">      isUserDefinedNonNodeProperty: function(property, calls) {</td></tr><tr><td class="line-number" value="2451"></td><td class="line-content">        return this.userDefinedNonNodePropertyIds[ this.getUserDefinedNonNodePropertyId(property, calls) ] === true;</td></tr><tr><td class="line-number" value="2452"></td><td class="line-content">      },</td></tr><tr><td class="line-number" value="2453"></td><td class="line-content">      isFunctionNode: function(target, capturedCalls, property) {</td></tr><tr><td class="line-number" value="2454"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2455"></td><td class="line-content">        // If `property` is referencing a function node of target.obj, then we want to</td></tr><tr><td class="line-number" value="2456"></td><td class="line-content">        // return that function (not a proxy). That's why we need this function (we use it in the `get` handler)</td></tr><tr><td class="line-number" value="2457"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2458"></td><td class="line-content">        // if there are `apply`s in the capturedCalls, return false, since a function node can only be a</td></tr><tr><td class="line-number" value="2459"></td><td class="line-content">        // direct `get` chain from the root node (this is just an optimisation)</td></tr><tr><td class="line-number" value="2460"></td><td class="line-content">        for(let c of capturedCalls) {</td></tr><tr><td class="line-number" value="2461"></td><td class="line-content">          if(c.type === 'apply') return false;</td></tr><tr><td class="line-number" value="2462"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2463"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2464"></td><td class="line-content">        let root = target.obj;</td></tr><tr><td class="line-number" value="2465"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2466"></td><td class="line-content">        // NOTE: we don't need to worry about user-defined non-node properties, because we detect them in the `get` trap</td></tr><tr><td class="line-number" value="2467"></td><td class="line-content">        // NOTE: remember, all nodes are functions, so be careful with your typeof logic (not used here anyway)</td></tr><tr><td class="line-number" value="2468"></td><td class="line-content">        let ref = root;</td></tr><tr><td class="line-number" value="2469"></td><td class="line-content">        for(let c of capturedCalls) {</td></tr><tr><td class="line-number" value="2470"></td><td class="line-content">          if(ref.$children.includes(c.name)) ref = ref[c.name];</td></tr><tr><td class="line-number" value="2471"></td><td class="line-content">          else return false;</td></tr><tr><td class="line-number" value="2472"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2473"></td><td class="line-content">        if(ref.$functionChildren.includes(property)) return true; // the call path DOES reference a function node</td></tr><tr><td class="line-number" value="2474"></td><td class="line-content">        else return false;</td></tr><tr><td class="line-number" value="2475"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2476"></td><td class="line-content">        // OLD APPROACH: I have no idea why I was doing the reverse-lookup thing in this old approach. To get around proxy "looping" stuff???</td></tr><tr><td class="line-number" value="2477"></td><td class="line-content">        // // Here's what we do:</td></tr><tr><td class="line-number" value="2478"></td><td class="line-content">        // // 1. if there are `apply`s in the capturedCalls, return false, since a function node can only be a</td></tr><tr><td class="line-number" value="2479"></td><td class="line-content">        // //    direct `get` chain from the root node (this is just an optimisation)</td></tr><tr><td class="line-number" value="2480"></td><td class="line-content">        // // 2. For each occurrance of `property` in root.$allNodes that is a `value` or `function` node, trace</td></tr><tr><td class="line-number" value="2481"></td><td class="line-content">        // //    back up the $parent chain, checking at each stage that it matches the capturedCalls `get` names</td></tr><tr><td class="line-number" value="2482"></td><td class="line-content">        // //    in reverse order. If you get back to root, run the capturedCalls on root and see if it's a function.</td></tr><tr><td class="line-number" value="2483"></td><td class="line-content">        // //    If it is, return true. Otherwise continue.</td></tr><tr><td class="line-number" value="2484"></td><td class="line-content">        // // 3. If no matches, return false.</td></tr><tr><td class="line-number" value="2485"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2486"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2487"></td><td class="line-content">        // for(let c of capturedCalls) {</td></tr><tr><td class="line-number" value="2488"></td><td class="line-content">        //   if(c.type === 'apply') return false;</td></tr><tr><td class="line-number" value="2489"></td><td class="line-content">        // }</td></tr><tr><td class="line-number" value="2490"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2491"></td><td class="line-content">        // let root = target.obj;</td></tr><tr><td class="line-number" value="2492"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2493"></td><td class="line-content">        // for(let node of root.$allNodes) {</td></tr><tr><td class="line-number" value="2494"></td><td class="line-content">        //   if(node.$text !== property) continue;</td></tr><tr><td class="line-number" value="2495"></td><td class="line-content">        //   if(node.$nodeType !== 'value' &amp;&amp; node.$nodeType !== 'function') continue;</td></tr><tr><td class="line-number" value="2496"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2497"></td><td class="line-content">        //   // so we know it's a value or function node, and we know the `property` matches its name.</td></tr><tr><td class="line-number" value="2498"></td><td class="line-content">        //   // now we need to check if the node's ancestry chain back to root matches the capturedCalls array</td></tr><tr><td class="line-number" value="2499"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2500"></td><td class="line-content">        //   let traceNode = node.$parent;</td></tr><tr><td class="line-number" value="2501"></td><td class="line-content">        //   for(let i = capturedCalls.length-1; i &gt;= 0; i--) {</td></tr><tr><td class="line-number" value="2502"></td><td class="line-content">        //     if(capturedCalls[i].name !== traceNode.$text) break;</td></tr><tr><td class="line-number" value="2503"></td><td class="line-content">        //     traceNode = traceNode.$parent;</td></tr><tr><td class="line-number" value="2504"></td><td class="line-content">        //   }</td></tr><tr><td class="line-number" value="2505"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2506"></td><td class="line-content">        //   if(traceNode === root) { // found a full path/ancestry match</td></tr><tr><td class="line-number" value="2507"></td><td class="line-content">        //     // now we just need to check if it's a function:</td></tr><tr><td class="line-number" value="2508"></td><td class="line-content">        //     let ref = root;</td></tr><tr><td class="line-number" value="2509"></td><td class="line-content">        //     for(let c of capturedCalls) { ref = ref[c.name]; }</td></tr><tr><td class="line-number" value="2510"></td><td class="line-content">        //     // i replaced the below two commented out lines with the third to help solve some `get` loops happening in the proxy with this.isFunctionNode</td></tr><tr><td class="line-number" value="2511"></td><td class="line-content">        //       // ref = ref[property]; // the final `get`</td></tr><tr><td class="line-number" value="2512"></td><td class="line-content">        //       // if(typeof ref === 'function') return true; // found a function node!!!</td></tr><tr><td class="line-number" value="2513"></td><td class="line-content">        //     if(ref.$functionChildren.includes(property)) return true; // found a function node!!!</td></tr><tr><td class="line-number" value="2514"></td><td class="line-content">        //   }</td></tr><tr><td class="line-number" value="2515"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2516"></td><td class="line-content">        // }</td></tr><tr><td class="line-number" value="2517"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2518"></td><td class="line-content">        // return false;</td></tr><tr><td class="line-number" value="2519"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2520"></td><td class="line-content">      },</td></tr><tr><td class="line-number" value="2521"></td><td class="line-content">      isGetterProperty: function(target, property) {</td></tr><tr><td class="line-number" value="2522"></td><td class="line-content">        let desc = Object.getOwnPropertyDescriptor(target.obj, property);</td></tr><tr><td class="line-number" value="2523"></td><td class="line-content">        return desc &amp;&amp; desc.get;</td></tr><tr><td class="line-number" value="2524"></td><td class="line-content">      },</td></tr><tr><td class="line-number" value="2525"></td><td class="line-content">      get: function(target, property, receiver) {</td></tr><tr><td class="line-number" value="2526"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2527"></td><td class="line-content">        // commenting this out for now in favor of the perchance.org/my-generator#debugFreeze approach</td></tr><tr><td class="line-number" value="2528"></td><td class="line-content">        // if(window.globalProxyLoopCount &gt; 10000000) {</td></tr><tr><td class="line-number" value="2529"></td><td class="line-content">        //   throw new Error("It seems like you've got an infinite loop somewhere in your code. Are you referencing a list name within a child of that list, such that it creates an infinite loop?");</td></tr><tr><td class="line-number" value="2530"></td><td class="line-content">        // }</td></tr><tr><td class="line-number" value="2531"></td><td class="line-content">        // window.globalProxyLoopCount++;</td></tr><tr><td class="line-number" value="2532"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2533"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2534"></td><td class="line-content">        if(property === "___isProxy") { return true; }</td></tr><tr><td class="line-number" value="2535"></td><td class="line-content">        if(property === "___proxyTarget") { return target; }</td></tr><tr><td class="line-number" value="2536"></td><td class="line-content">        if(property === "___proxyHandler") { return this; }</td></tr><tr><td class="line-number" value="2537"></td><td class="line-content">        // if(property === "___addExecutionPath") {</td></tr><tr><td class="line-number" value="2538"></td><td class="line-content">        //   let last = this.capturedCalls[this.capturedCalls.length-1];</td></tr><tr><td class="line-number" value="2539"></td><td class="line-content">        //   this.capturedCalls.pop();</td></tr><tr><td class="line-number" value="2540"></td><td class="line-content">        //   this.userDefinedNonNodePropertyIds[ this.getUserDefinedNonNodePropertyId(last, this.capturedCalls) ] = true;</td></tr><tr><td class="line-number" value="2541"></td><td class="line-content">        // }</td></tr><tr><td class="line-number" value="2542"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2543"></td><td class="line-content">        //if(this.isGetterProperty(target, property) || this.executionProperties.includes(property) || this.isUserDefinedNonNodeProperty(property, this.capturedCalls) || this.isFunctionNode(target, this.capturedCalls, property)) {</td></tr><tr><td class="line-number" value="2544"></td><td class="line-content">        if(true) { // testing out resolving all `get`s (QUESTION: was the only reason why we needed proxies for stuff like `pluralAnimalList = [animal.pluralForm]`? because that's really not needed anyway, and I don't think it's even possible in perchance's current state)</td></tr><tr><td class="line-number" value="2545"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2546"></td><td class="line-content">          let result = this.executeChain(target, this.capturedCalls);</td></tr><tr><td class="line-number" value="2547"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2548"></td><td class="line-content">          // if(typeof result === 'string' || typeof result === 'number')</td></tr><tr><td class="line-number" value="2549"></td><td class="line-content">          //   return result;</td></tr><tr><td class="line-number" value="2550"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2551"></td><td class="line-content">          if(result === undefined) {</td></tr><tr><td class="line-number" value="2552"></td><td class="line-content">            if(property === Symbol.toPrimitive) {</td></tr><tr><td class="line-number" value="2553"></td><td class="line-content">              return function() { return undefined; }</td></tr><tr><td class="line-number" value="2554"></td><td class="line-content">            } else {</td></tr><tr><td class="line-number" value="2555"></td><td class="line-content">              __perchanceError(`the list/variable &lt;code&gt;${this.capturedCalls.map(c=&gt;c.name).join("")}&lt;/code&gt; doesn't seem to exist in the &lt;code&gt;${target.obj.$moduleName}&lt;/code&gt; generator.`, {moduleName:target.obj.$moduleName});</td></tr><tr><td class="line-number" value="2556"></td><td class="line-content">              // if(property === Symbol.toPrimitive) return function() { return "(error)"; }</td></tr><tr><td class="line-number" value="2557"></td><td class="line-content">              return "(error)";</td></tr><tr><td class="line-number" value="2558"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2559"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="2560"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2561"></td><td class="line-content">          let finalResult = result[property];</td></tr><tr><td class="line-number" value="2562"></td><td class="line-content">          if(typeof finalResult === 'function' &amp;&amp; !finalResult.___isProxy) {</td></tr><tr><td class="line-number" value="2563"></td><td class="line-content">  			    finalResult = finalResult.bind(result);</td></tr><tr><td class="line-number" value="2564"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="2565"></td><td class="line-content">          return finalResult;</td></tr><tr><td class="line-number" value="2566"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2567"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="2568"></td><td class="line-content">            // need to return new proxy</td></tr><tr><td class="line-number" value="2569"></td><td class="line-content">            let newHandler = {};</td></tr><tr><td class="line-number" value="2570"></td><td class="line-content">            Object.assign(newHandler, this);</td></tr><tr><td class="line-number" value="2571"></td><td class="line-content">            newHandler.capturedCalls = this.capturedCalls.slice(0);</td></tr><tr><td class="line-number" value="2572"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2573"></td><td class="line-content">            newHandler.capturedCalls.push({type:"get", name:property});</td></tr><tr><td class="line-number" value="2574"></td><td class="line-content">            let np = new Proxy(target, newHandler)</td></tr><tr><td class="line-number" value="2575"></td><td class="line-content">            return np;</td></tr><tr><td class="line-number" value="2576"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2577"></td><td class="line-content">      },</td></tr><tr><td class="line-number" value="2578"></td><td class="line-content">      apply: function(target, thisArg, args) {</td></tr><tr><td class="line-number" value="2579"></td><td class="line-content">          // // return a new proxy:</td></tr><tr><td class="line-number" value="2580"></td><td class="line-content">          // let newHandler = {};</td></tr><tr><td class="line-number" value="2581"></td><td class="line-content">          // Object.assign(newHandler, this);</td></tr><tr><td class="line-number" value="2582"></td><td class="line-content">          // newHandler.capturedCalls = this.capturedCalls.slice(0);</td></tr><tr><td class="line-number" value="2583"></td><td class="line-content">          // // add arguments to last call that was captured</td></tr><tr><td class="line-number" value="2584"></td><td class="line-content">          // newHandler.capturedCalls.push({type:"apply", args});</td></tr><tr><td class="line-number" value="2585"></td><td class="line-content">          // let np = new Proxy(target, newHandler);</td></tr><tr><td class="line-number" value="2586"></td><td class="line-content">          // return np;</td></tr><tr><td class="line-number" value="2587"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2588"></td><td class="line-content">          // i commented out the above code and added this because we always want functions to resolve immediately. otherwise we get this problem (see comment in bottom left): https://i.imgur.com/SY9MOt8.png -- as another example, people needed to write [a = dice("1d6").selectOne] instead of just [a = dice("1d6")]</td></tr><tr><td class="line-number" value="2589"></td><td class="line-content">          // maybe I should make exceptions for joinItems and those other inbuilt functions?</td></tr><tr><td class="line-number" value="2590"></td><td class="line-content">          this.capturedCalls.push({type:"apply", args});</td></tr><tr><td class="line-number" value="2591"></td><td class="line-content">          return this.executeChain(target, this.capturedCalls);</td></tr><tr><td class="line-number" value="2592"></td><td class="line-content">      },</td></tr><tr><td class="line-number" value="2593"></td><td class="line-content">      set: function(target, property, value, receiver) {</td></tr><tr><td class="line-number" value="2594"></td><td class="line-content">        // resolve it if it's a proxy (to prevent infinite loops when you do something like [abc=abc] (where abc is an already-defined top-level node), since that would set abc to its own proxy, so when you resolve it, it would resolve to the proxy, and the loop continues)</td></tr><tr><td class="line-number" value="2595"></td><td class="line-content">        if(value &amp;&amp; value.___isProxy) {</td></tr><tr><td class="line-number" value="2596"></td><td class="line-content">          value = value.___proxyHandler.executeChain(value.___proxyTarget, value.___proxyHandler.capturedCalls);</td></tr><tr><td class="line-number" value="2597"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2598"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2599"></td><td class="line-content">        let obj = this.executeChain(target, this.capturedCalls);</td></tr><tr><td class="line-number" value="2600"></td><td class="line-content">        if(typeof obj !== 'object') {</td></tr><tr><td class="line-number" value="2601"></td><td class="line-content">          __perchanceError(`You tried to set &lt;code&gt;${__escapeHTMLSpecialChars(this.capturedCalls.map(c=&gt;c.name).join("."))}&lt;/code&gt; to &lt;code&gt;${__escapeHTMLSpecialChars(value)}&lt;/code&gt;, but it appears that &lt;code&gt;${__escapeHTMLSpecialChars(this.capturedCalls.map(c=&gt;c.name).join("."))}&lt;/code&gt; does not exist, or some other strange error has occurred.`);</td></tr><tr><td class="line-number" value="2602"></td><td class="line-content">          return;</td></tr><tr><td class="line-number" value="2603"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2604"></td><td class="line-content">        Object.defineProperty(obj, property, {value, writable:true, configurable:true}); // importantly we're executing defineProperty on an actual object, NOT a proxy</td></tr><tr><td class="line-number" value="2605"></td><td class="line-content">        this.userDefinedNonNodePropertyIds[ this.getUserDefinedNonNodePropertyId(property, this.capturedCalls) ] = true;</td></tr><tr><td class="line-number" value="2606"></td><td class="line-content">        return value;</td></tr><tr><td class="line-number" value="2607"></td><td class="line-content">      },</td></tr><tr><td class="line-number" value="2608"></td><td class="line-content">      isExtensible: function(target) { return Object.isExtensible(this.executeChain(target, this.capturedCalls)); },</td></tr><tr><td class="line-number" value="2609"></td><td class="line-content">      preventExtensions: function(target) { return Object.preventExtensions(this.executeChain(target, this.capturedCalls)); },</td></tr><tr><td class="line-number" value="2610"></td><td class="line-content">      getOwnPropertyDescriptor: function(target, prop) { return Object.getOwnPropertyDescriptor(this.executeChain(target, this.capturedCalls), prop); },</td></tr><tr><td class="line-number" value="2611"></td><td class="line-content">      defineProperty: function(target, property, descriptor) { return Object.defineProperty(this.executeChain(target, this.capturedCalls), property, descriptor); },</td></tr><tr><td class="line-number" value="2612"></td><td class="line-content">      has: function(target, prop) { return (prop in this.executeChain(target, this.capturedCalls)); },</td></tr><tr><td class="line-number" value="2613"></td><td class="line-content">      deleteProperty: function(target, property) { return delete this.executeChain(target, this.capturedCalls)[property]; },</td></tr><tr><td class="line-number" value="2614"></td><td class="line-content">      ownKeys: function(target) { return Reflect.ownKeys(this.executeChain(target, this.capturedCalls)); }</td></tr><tr><td class="line-number" value="2615"></td><td class="line-content">  });</td></tr><tr><td class="line-number" value="2616"></td><td class="line-content">  window.__rootProxyHasHandler = rootProxy.___proxyHandler.has;</td></tr><tr><td class="line-number" value="2617"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2618"></td><td class="line-content">  // add this module to modulespace now otherwise our functions won't work for the direct-reference checks</td></tr><tr><td class="line-number" value="2619"></td><td class="line-content">  // yolo</td></tr><tr><td class="line-number" value="2620"></td><td class="line-content">  window.moduleSpace[moduleName] = rootProxy;</td></tr><tr><td class="line-number" value="2621"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2622"></td><td class="line-content">  // EDIT: don't need this any more now that we've got isFunctionNode?</td></tr><tr><td class="line-number" value="2623"></td><td class="line-content">  // make user-defined functions execute immediately upon being called (i.e. don't return a proxy)</td></tr><tr><td class="line-number" value="2624"></td><td class="line-content">  // for(let i = 0; i &lt; allNodes.length; i++) {</td></tr><tr><td class="line-number" value="2625"></td><td class="line-content">  //   if(allNodes[i].$nodeType === "function") {</td></tr><tr><td class="line-number" value="2626"></td><td class="line-content">  //     let node = allNodes[i];</td></tr><tr><td class="line-number" value="2627"></td><td class="line-content">  //     // we found a function, now lets build a call chain to it</td></tr><tr><td class="line-number" value="2628"></td><td class="line-content">  //     let calls = [];</td></tr><tr><td class="line-number" value="2629"></td><td class="line-content">  //     while(node.$parent) {</td></tr><tr><td class="line-number" value="2630"></td><td class="line-content">  //       calls.unshift(node.$parent.$text);</td></tr><tr><td class="line-number" value="2631"></td><td class="line-content">  //       node = node.$parent;</td></tr><tr><td class="line-number" value="2632"></td><td class="line-content">  //     }</td></tr><tr><td class="line-number" value="2633"></td><td class="line-content">  //     calls.shift(); // remove "&lt;root&gt;"</td></tr><tr><td class="line-number" value="2634"></td><td class="line-content">  //     let chain = [rootProxy];</td></tr><tr><td class="line-number" value="2635"></td><td class="line-content">  //     for(let c of calls) {</td></tr><tr><td class="line-number" value="2636"></td><td class="line-content">  //       chain.push(chain[chain.length-1][c]); // did it weirdly like this to prevent proxy setter being called</td></tr><tr><td class="line-number" value="2637"></td><td class="line-content">  //     }</td></tr><tr><td class="line-number" value="2638"></td><td class="line-content">  //     chain = chain[chain.length-1]; // the last element is the completed chain</td></tr><tr><td class="line-number" value="2639"></td><td class="line-content">  //     chain[allNodes[i].$text] = allNodes[i].$function; // EDIT: this calls the proxy setter and adds a "userDefinedNonNodeProperty" - was that the prupose?</td></tr><tr><td class="line-number" value="2640"></td><td class="line-content">  //   }</td></tr><tr><td class="line-number" value="2641"></td><td class="line-content">  // }</td></tr><tr><td class="line-number" value="2642"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2643"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2644"></td><td class="line-content">  // tie direct references to the actual nodes. e.g.:</td></tr><tr><td class="line-number" value="2645"></td><td class="line-content">  // animal = [african_animal]</td></tr><tr><td class="line-number" value="2646"></td><td class="line-content">  // $output = [person]</td></tr><tr><td class="line-number" value="2647"></td><td class="line-content">  // so rather than [animal] and [$output] being $value nodes, they'll directly reference [aftican_animal] and [person].</td></tr><tr><td class="line-number" value="2648"></td><td class="line-content">  // this is mainly needed to make $output behaviour sane.</td></tr><tr><td class="line-number" value="2649"></td><td class="line-content">  for(let node of allNodes) {</td></tr><tr><td class="line-number" value="2650"></td><td class="line-content">    if(node.$nodeType === "value" &amp;&amp; !node.$isPlainPrimitive) {</td></tr><tr><td class="line-number" value="2651"></td><td class="line-content">      let blocks = __splitTextAtAllBlocks(node.$value, {declarationLineNumber:node.$declarationLineNumber, moduleName:node.$moduleName, node});</td></tr><tr><td class="line-number" value="2652"></td><td class="line-content">      if(blocks.length === 1 &amp;&amp; blocks[0][0] === "[" &amp;&amp; blocks[0][blocks[0].length-1] === "]") {</td></tr><tr><td class="line-number" value="2653"></td><td class="line-content">        let expression = node.$value.substr(1,node.$value.length-2);</td></tr><tr><td class="line-number" value="2654"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2655"></td><td class="line-content">        // only create link if they're DIRECTLY referencing another list:</td></tr><tr><td class="line-number" value="2656"></td><td class="line-content">        if(__isValidJavaScriptIdentifier(expression)) {</td></tr><tr><td class="line-number" value="2657"></td><td class="line-content">          // intermediate values can be non-direct references, and we don't want to e.g. execute `[a++]`, so we make sure that if __evaluateSquareBlock comes across something like that in a multi-step "indirection chain", it aborts</td></tr><tr><td class="line-number" value="2658"></td><td class="line-content">          window.__throwErrorIfNonDirectListReferenceIsFoundDuringEvaluateSquareBlock = true; // epic</td></tr><tr><td class="line-number" value="2659"></td><td class="line-content">          try {</td></tr><tr><td class="line-number" value="2660"></td><td class="line-content">            __ignorePerchanceErrors = true; // it may fail because it could reference a function that hasn't been linked yet (i have no idea what's going on)</td></tr><tr><td class="line-number" value="2661"></td><td class="line-content">            let refNode; </td></tr><tr><td class="line-number" value="2662"></td><td class="line-content">            try { refNode = __evaluateSquareBlock(root.node, node.$parent, expression, {declarationLineNumber:node.$declarationLineNumber, moduleName:node.$moduleName, node}); } catch(e) {}</td></tr><tr><td class="line-number" value="2663"></td><td class="line-content">            __ignorePerchanceErrors = false;</td></tr><tr><td class="line-number" value="2664"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2665"></td><td class="line-content">            if(refNode &amp;&amp; refNode.$nodeType /*|| Array.isArray(refNode)*/) { // did it not abort, and did it resolve to a node?</td></tr><tr><td class="line-number" value="2666"></td><td class="line-content">              node.$parent[node.$text] = refNode;</td></tr><tr><td class="line-number" value="2667"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="2668"></td><td class="line-content">          } catch(e) {}</td></tr><tr><td class="line-number" value="2669"></td><td class="line-content">          delete window.__throwErrorIfNonDirectListReferenceIsFoundDuringEvaluateSquareBlock;</td></tr><tr><td class="line-number" value="2670"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="2671"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2672"></td><td class="line-content">        // NOTE: curly IMPORT blocks get tied to their actual module after all imports are compiled (in iframe html)</td></tr><tr><td class="line-number" value="2673"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2674"></td><td class="line-content">        // TODO**: does all this work by default now because of the new proxy approach? can I remove this part all together?</td></tr><tr><td class="line-number" value="2675"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2676"></td><td class="line-content">        // TODO***: we need to pre-evaluate $output so it's a *direct* reference to the thing it references,</td></tr><tr><td class="line-number" value="2677"></td><td class="line-content">        //          but if we do that with other $value nodes, things can get messy:</td></tr><tr><td class="line-number" value="2678"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2679"></td><td class="line-content">        // person</td></tr><tr><td class="line-number" value="2680"></td><td class="line-content">        //   name = [name.selectOne]</td></tr><tr><td class="line-number" value="2681"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2682"></td><td class="line-content">        // `person.name` will always be same node!!</td></tr><tr><td class="line-number" value="2683"></td><td class="line-content">        // if we call update it stays the same</td></tr><tr><td class="line-number" value="2684"></td><td class="line-content">        // if we do [a = new person], the selection remains the same</td></tr><tr><td class="line-number" value="2685"></td><td class="line-content">        // etc. - tonnes of problems</td></tr><tr><td class="line-number" value="2686"></td><td class="line-content">        // here's why we WANT to be able to do this in the first place:</td></tr><tr><td class="line-number" value="2687"></td><td class="line-content">        // person</td></tr><tr><td class="line-number" value="2688"></td><td class="line-content">        // 	 name = [name.selectOne]</td></tr><tr><td class="line-number" value="2689"></td><td class="line-content">        // 	 gender = [this.name.gender]</td></tr><tr><td class="line-number" value="2690"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2691"></td><td class="line-content">        // note that we can already do this sort of thing:</td></tr><tr><td class="line-number" value="2692"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2693"></td><td class="line-content">        // person</td></tr><tr><td class="line-number" value="2694"></td><td class="line-content">        // 	 age = {1-100}</td></tr><tr><td class="line-number" value="2695"></td><td class="line-content">        // 	 isAdult = [this.age &gt; 18]</td></tr><tr><td class="line-number" value="2696"></td><td class="line-content">        //</td></tr><tr><td class="line-number" value="2697"></td><td class="line-content">        // potential solution: only pre-evaluate it if it's a direct reference to another node</td></tr><tr><td class="line-number" value="2698"></td><td class="line-content">        // (just like $output always is).</td></tr><tr><td class="line-number" value="2699"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2700"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2701"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2702"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2703"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2704"></td><td class="line-content">  // give each node an id:</td></tr><tr><td class="line-number" value="2705"></td><td class="line-content">  for(let i = 0; i &lt; allNodes.length; i++) {</td></tr><tr><td class="line-number" value="2706"></td><td class="line-content">    Object.defineProperty(allNodes[i], "$id", {value:i, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2707"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2708"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2709"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2710"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2711"></td><td class="line-content">  // fix up $root references so they point to proxy instead of actual node</td></tr><tr><td class="line-number" value="2712"></td><td class="line-content">  // also remove node data symbol stuff</td></tr><tr><td class="line-number" value="2713"></td><td class="line-content">  // TODO***: what about $parent references - should they be proxied too?</td></tr><tr><td class="line-number" value="2714"></td><td class="line-content">  for(let i = 0; i &lt; allNodes.length; i++) {</td></tr><tr><td class="line-number" value="2715"></td><td class="line-content">    Object.defineProperty(allNodes[i], "$root", {value:rootProxy, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="2716"></td><td class="line-content">    delete allNodes[i][Symbol.for("node data")];</td></tr><tr><td class="line-number" value="2717"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2718"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2719"></td><td class="line-content">  // at the moment, this is mainly so that other users don't get confused about strange syntax - they can easily see there's a preprocessor,</td></tr><tr><td class="line-number" value="2720"></td><td class="line-content">  // but in the future I may speed up preprocessing by just grabbing the function from the top, compiling that, and then running the code through it.</td></tr><tr><td class="line-number" value="2721"></td><td class="line-content">  // (instead of compiling the whole thing just to get the $preprocess function, as is happening now.) EDIT: oh, don't forget they can *import* preprocessor too!</td></tr><tr><td class="line-number" value="2722"></td><td class="line-content">  if(root.node.$preprocess &amp;&amp; root.node.$allNodes[1].$text !== "$preprocess") {</td></tr><tr><td class="line-number" value="2723"></td><td class="line-content">    __perchanceError(`The special &lt;code&gt;$preprocess&lt;/code&gt; function must be placed above all your other lists - at the very top of the Perchance code editor.`, {moduleName});</td></tr><tr><td class="line-number" value="2724"></td><td class="line-content">    return;</td></tr><tr><td class="line-number" value="2725"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2726"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2727"></td><td class="line-content">  if(root.node.$preprocess &amp;&amp; !doNotPreprocess) {</td></tr><tr><td class="line-number" value="2728"></td><td class="line-content">    let preprocess;</td></tr><tr><td class="line-number" value="2729"></td><td class="line-content">    if(typeof root.node.$preprocess === 'function') {</td></tr><tr><td class="line-number" value="2730"></td><td class="line-content">      preprocess = root.node.$preprocess;</td></tr><tr><td class="line-number" value="2731"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="2732"></td><td class="line-content">      if(!root.node.$preprocess.$value &amp;&amp; root.node.$preprocess.$allKeys.includes("$preprocess")) return __perchanceError(`Looks like you've imported the '${root.node.$preprocess.$moduleName}' generator for use as a preprocessor, but the preprocessor should be defined as the &lt;code&gt;$output&lt;/code&gt; in '${root.node.$preprocess.$moduleName}', rather than as &lt;code&gt;$preprocess&lt;/code&gt;.`, {moduleName});</td></tr><tr><td class="line-number" value="2733"></td><td class="line-content">      if(!root.node.$preprocess.$value.startsWith("{import:")) return __perchanceError(`The special &lt;code&gt;$preprocess&lt;/code&gt; property must be defined as a function, or an imported function.`, {moduleName});</td></tr><tr><td class="line-number" value="2734"></td><td class="line-content">      let preprocessorName = root.node.$preprocess.$value.slice(8, -1);</td></tr><tr><td class="line-number" value="2735"></td><td class="line-content">      let module = window.moduleSpace[preprocessorName];</td></tr><tr><td class="line-number" value="2736"></td><td class="line-content">      if(!module) {</td></tr><tr><td class="line-number" value="2737"></td><td class="line-content">        __perchanceError(`The preprocessor '${preprocessorName}' could not be found?`, {moduleName});</td></tr><tr><td class="line-number" value="2738"></td><td class="line-content">        return;</td></tr><tr><td class="line-number" value="2739"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2740"></td><td class="line-content">      if(!module.$output || !module.$output.$nodeType === "function") return __perchanceError(`The '${preprocessorName}' was imported into '${moduleName}' as a preprocessor function, but the &lt;code&gt;$output&lt;/code&gt; of '${preprocessorName}' doesn't exist or is not a function?`, {moduleName});</td></tr><tr><td class="line-number" value="2741"></td><td class="line-content">      preprocess = module.$output;</td></tr><tr><td class="line-number" value="2742"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2743"></td><td class="line-content">    let newInputText = preprocess(root.perchanceCode);</td></tr><tr><td class="line-number" value="2744"></td><td class="line-content">    return __createPerchanceTree(newInputText, moduleName, backupModuleName, true);</td></tr><tr><td class="line-number" value="2745"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2746"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2747"></td><td class="line-content">  console.debug(`${moduleName} init: ${Date.now()-functionStartTime}ms`);</td></tr><tr><td class="line-number" value="2748"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2749"></td><td class="line-content">  return rootProxy;</td></tr><tr><td class="line-number" value="2750"></td><td class="line-content">  //return root.node;</td></tr><tr><td class="line-number" value="2751"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2752"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2753"></td><td class="line-content">  // notes:</td></tr><tr><td class="line-number" value="2754"></td><td class="line-content">  // TODO: remove todos that are already done...</td></tr><tr><td class="line-number" value="2755"></td><td class="line-content">  // TODO: primitive declarations using "=" and update toString so it ignores primitive-valued properties</td></tr><tr><td class="line-number" value="2756"></td><td class="line-content">  // TODO: in toString: add {a|b|c} notation handling (recusive)</td></tr><tr><td class="line-number" value="2757"></td><td class="line-content">  // TODO: add array handling: we just treat ["a", "b^2", "c"] like {a|b^2|c} when Array.toString() is called (use the same back-end function)</td></tr><tr><td class="line-number" value="2758"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2759"></td><td class="line-content">  // TODO: if we across duplicate sibling nodes, what do we do? just make the latter overwrite the prior? add the odds together?</td></tr><tr><td class="line-number" value="2760"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2761"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="2762"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2763"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2764"></td><td class="line-content">let ___clonedNodeToOriginalNodeWeakMap = new WeakMap();</td></tr><tr><td class="line-number" value="2765"></td><td class="line-content">function __duplicatePerchanceNode(originalNode) { // this is very hacky...</td></tr><tr><td class="line-number" value="2766"></td><td class="line-content">  originalNode = originalNode.getSelf;</td></tr><tr><td class="line-number" value="2767"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2768"></td><td class="line-content">  // NOTE: node will be unreferencable from parent (since the node to be duplicated already holds that key).</td></tr><tr><td class="line-number" value="2769"></td><td class="line-content">  //       I think this is fine? They can always add it to the parent if some weird situation required that.</td></tr><tr><td class="line-number" value="2770"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2771"></td><td class="line-content">  let root = __createPerchanceTree(originalNode.$perchanceCode, null, originalNode.$moduleName);</td></tr><tr><td class="line-number" value="2772"></td><td class="line-content">  root = root.getSelf; // get target object, not proxy</td></tr><tr><td class="line-number" value="2773"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2774"></td><td class="line-content">  for(let node of root.$allNodes) {</td></tr><tr><td class="line-number" value="2775"></td><td class="line-content">    if(node === root) continue;</td></tr><tr><td class="line-number" value="2776"></td><td class="line-content">    node.$id = originalNode.$root.getSelf.$allNodes.length;</td></tr><tr><td class="line-number" value="2777"></td><td class="line-content">    originalNode.$root.getSelf.$allNodes.push(node);</td></tr><tr><td class="line-number" value="2778"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2779"></td><td class="line-content">    node.$root = originalNode.$root.getSelf;</td></tr><tr><td class="line-number" value="2780"></td><td class="line-content">    node.$moduleName = originalNode.$moduleName;</td></tr><tr><td class="line-number" value="2781"></td><td class="line-content">    // I think this is causing some problems when it tries to get a node of a "directly linked" property:</td></tr><tr><td class="line-number" value="2782"></td><td class="line-content">    //node.$declarationLineNumber = getCorrespondingOriginalNode(node).$declarationLineNumber;</td></tr><tr><td class="line-number" value="2783"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2784"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2785"></td><td class="line-content">  // function getCorrespondingOriginalNode(clonedNode) {</td></tr><tr><td class="line-number" value="2786"></td><td class="line-content">  //   let propertyChain = [];</td></tr><tr><td class="line-number" value="2787"></td><td class="line-content">  //   let n = clonedNode;</td></tr><tr><td class="line-number" value="2788"></td><td class="line-content">  //   while(n.$parent) { // get chain up to cloned root</td></tr><tr><td class="line-number" value="2789"></td><td class="line-content">  //     propertyChain.unshift(n.$text);</td></tr><tr><td class="line-number" value="2790"></td><td class="line-content">  //     n = n.$parent;</td></tr><tr><td class="line-number" value="2791"></td><td class="line-content">  //   }</td></tr><tr><td class="line-number" value="2792"></td><td class="line-content">  //   n = originalNode.$parent.getSelf</td></tr><tr><td class="line-number" value="2793"></td><td class="line-content">  //   while(propertyChain.length) { // evaluate chain from original node's parent</td></tr><tr><td class="line-number" value="2794"></td><td class="line-content">  //     n = n[propertyChain[0]];</td></tr><tr><td class="line-number" value="2795"></td><td class="line-content">  //     propertyChain.shift();</td></tr><tr><td class="line-number" value="2796"></td><td class="line-content">  //   }</td></tr><tr><td class="line-number" value="2797"></td><td class="line-content">  //   return n;</td></tr><tr><td class="line-number" value="2798"></td><td class="line-content">  // }</td></tr><tr><td class="line-number" value="2799"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2800"></td><td class="line-content">  let node = root[originalNode.$text];</td></tr><tr><td class="line-number" value="2801"></td><td class="line-content">  node.$parent = originalNode.$parent.getSelf;</td></tr><tr><td class="line-number" value="2802"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2803"></td><td class="line-content">  ___clonedNodeToOriginalNodeWeakMap.set(node, originalNode);</td></tr><tr><td class="line-number" value="2804"></td><td class="line-content">  return node;</td></tr><tr><td class="line-number" value="2805"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2806"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="2807"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2808"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2809"></td><td class="line-content">// This function is PUBLIC - i.e. available for people to use in their generators</td></tr><tr><td class="line-number" value="2810"></td><td class="line-content">function createPerchanceTree(text, opts={}) {</td></tr><tr><td class="line-number" value="2811"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2812"></td><td class="line-content">  let root = __createPerchanceTree(text, opts.name ?? null, "&lt;null&gt;"); // &lt;null&gt; is a special value for nodes that technically don't belong to any module</td></tr><tr><td class="line-number" value="2813"></td><td class="line-content">  root = root.getSelf; // get target object, not proxy</td></tr><tr><td class="line-number" value="2814"></td><td class="line-content">  root.$moduleSpace = window.moduleSpace;</td></tr><tr><td class="line-number" value="2815"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2816"></td><td class="line-content">  return root;</td></tr><tr><td class="line-number" value="2817"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="2818"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2819"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2820"></td><td class="line-content">function __escapeHTMLSpecialChars(unsafe) {</td></tr><tr><td class="line-number" value="2821"></td><td class="line-content">    return unsafe.toString()</td></tr><tr><td class="line-number" value="2822"></td><td class="line-content">         .replace(/&amp;/g, "&amp;amp;")</td></tr><tr><td class="line-number" value="2823"></td><td class="line-content">         .replace(/&lt;/g, "&amp;lt;")</td></tr><tr><td class="line-number" value="2824"></td><td class="line-content">         .replace(/&gt;/g, "&amp;gt;")</td></tr><tr><td class="line-number" value="2825"></td><td class="line-content">         .replace(/"/g, "&amp;quot;")</td></tr><tr><td class="line-number" value="2826"></td><td class="line-content">         .replace(/'/g, "&amp;#039;");</td></tr><tr><td class="line-number" value="2827"></td><td class="line-content"> }</td></tr><tr><td class="line-number" value="2828"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2829"></td><td class="line-content">function __collectImportedModuleNamesFromText(text) {</td></tr><tr><td class="line-number" value="2830"></td><td class="line-content">  let blocks = __splitTextAtAllBlocks(text);</td></tr><tr><td class="line-number" value="2831"></td><td class="line-content">  let moduleNames = [];</td></tr><tr><td class="line-number" value="2832"></td><td class="line-content">  for(let b of blocks) {</td></tr><tr><td class="line-number" value="2833"></td><td class="line-content">    if(b[0] === "{") {</td></tr><tr><td class="line-number" value="2834"></td><td class="line-content">      let match = /^\{import:([a-z0-9\-]+)\}$/.exec(b);</td></tr><tr><td class="line-number" value="2835"></td><td class="line-content">      if(match &amp;&amp; match.length &gt; 1) {</td></tr><tr><td class="line-number" value="2836"></td><td class="line-content">        moduleNames.push( /^\{import:([a-z0-9\-]+)\}$/.exec(b)[1] );</td></tr><tr><td class="line-number" value="2837"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="2838"></td><td class="line-content">        moduleNames.push( ...__collectImportedModuleNamesFromText( b.substr(1, b.length-2) ) );</td></tr><tr><td class="line-number" value="2839"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2840"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2841"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2842"></td><td class="line-content">  return [...new Set(moduleNames)];</td></tr><tr><td class="line-number" value="2843"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="2844"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2845"></td><td class="line-content">// function evaluateTextAsNumber(rootNode, thisRef, text, ctxInfo) {</td></tr><tr><td class="line-number" value="2846"></td><td class="line-content">//   // NOTE: This function is NOT for evaluating odds expressions!</td></tr><tr><td class="line-number" value="2847"></td><td class="line-content">//   // NOTE: this only returns the number if it can be "exactly" converted</td></tr><tr><td class="line-number" value="2848"></td><td class="line-content">//   // into a number - it doesn't evaluate the string's mathematical operators</td></tr><tr><td class="line-number" value="2849"></td><td class="line-content">//   // or anything like that. It only returns if text === String(Number(text))</td></tr><tr><td class="line-number" value="2850"></td><td class="line-content">//   // because that mean indicates that the deliberately typed a number, and even if</td></tr><tr><td class="line-number" value="2851"></td><td class="line-content">//   // they didn't, the toString conversion that occurs when this number is output</td></tr><tr><td class="line-number" value="2852"></td><td class="line-content">//   // will give **exacttly the same result anyway**.</td></tr><tr><td class="line-number" value="2853"></td><td class="line-content">//   let value = __evaluateText(rootNode, thisRef, text, ctxInfo);</td></tr><tr><td class="line-number" value="2854"></td><td class="line-content">//   if(value === String(Number(value))) {</td></tr><tr><td class="line-number" value="2855"></td><td class="line-content">//     return Number(value);</td></tr><tr><td class="line-number" value="2856"></td><td class="line-content">//   } else {</td></tr><tr><td class="line-number" value="2857"></td><td class="line-content">//     return false;</td></tr><tr><td class="line-number" value="2858"></td><td class="line-content">//   }</td></tr><tr><td class="line-number" value="2859"></td><td class="line-content">// }</td></tr><tr><td class="line-number" value="2860"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2861"></td><td class="line-content">function __evaluateText(rootNode, thisRef, text, ctxInfo, previousEvaluationText) {</td></tr><tr><td class="line-number" value="2862"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2863"></td><td class="line-content">  // IMPORTANT: Some curly functions may "return themselves" i.e. {a} may return "{a}" rather than "a" or "an" - this</td></tr><tr><td class="line-number" value="2864"></td><td class="line-content">  //            behaviour is allowable because evaluateText is called recursively until no unescaped curly/square blocks</td></tr><tr><td class="line-number" value="2865"></td><td class="line-content">  //            exist. The reason curly functions may do this is because parts of their arguments (the two strings either side of</td></tr><tr><td class="line-number" value="2866"></td><td class="line-content">  //            "{a}" in the case of the "{a}" function) may not have been evaluated yet, and it may rely on those parts having</td></tr><tr><td class="line-number" value="2867"></td><td class="line-content">  //            been evaluated. e.g. in the text "{a} [animal] is over there", {a} must wait until [animal] has been evaluated.</td></tr><tr><td class="line-number" value="2868"></td><td class="line-content">  // ALSO NOTE: previousEvaluationText is needed because (for example) if we evaluate "created {a}", there's nothing after {a} for</td></tr><tr><td class="line-number" value="2869"></td><td class="line-content">  //            us to detemrine whether we should use "a" or "an". But "created {a}" is still valid because they could be using it</td></tr><tr><td class="line-number" value="2870"></td><td class="line-content">  //            as part of a larger sentence. If `text` evaluates to `previousEvaluationText`, then we just return it rather than</td></tr><tr><td class="line-number" value="2871"></td><td class="line-content">  //            recuring infinitely.</td></tr><tr><td class="line-number" value="2872"></td><td class="line-content">  // ALSO NOTE: I had to change this so that instead of [passing through once and then checking if there are any unevaluated blocks that would</td></tr><tr><td class="line-number" value="2873"></td><td class="line-content">  //            require another pass-over], it does the recursion *within* the loop - otherwise things get executed out of order (e.g. assignment of</td></tr><tr><td class="line-number" value="2874"></td><td class="line-content">  //            variables and stuff). The user expects their variable assignments to happen in the order that the final output text is printed in.</td></tr><tr><td class="line-number" value="2875"></td><td class="line-content">  //            Edit: Oh, but I still need to recurse at the end, because some curly blocks like {a} may only be executable once all the blocks are</td></tr><tr><td class="line-number" value="2876"></td><td class="line-content">  //            joined together into one string.</td></tr><tr><td class="line-number" value="2877"></td><td class="line-content">  // ALSO NOTE: This function DOESN'T call processEscapedCharacters on the output. That must be called on the result.</td></tr><tr><td class="line-number" value="2878"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2879"></td><td class="line-content">  var bracketRegex = /[\[\]{}]/; // note: this is used further down too</td></tr><tr><td class="line-number" value="2880"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2881"></td><td class="line-content">  if(!bracketRegex.test(text)) return text; // if it has no brackets, nothing needs evaluating</td></tr><tr><td class="line-number" value="2882"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2883"></td><td class="line-content">  var blocks = __splitTextAtAllBlocks(text, ctxInfo);</td></tr><tr><td class="line-number" value="2884"></td><td class="line-content">  // iterate through and evaluate each block</td></tr><tr><td class="line-number" value="2885"></td><td class="line-content">  var evaluatedBlocks = [];</td></tr><tr><td class="line-number" value="2886"></td><td class="line-content">  var block, leftBlocks, rightBlocks;</td></tr><tr><td class="line-number" value="2887"></td><td class="line-content">  for(let i = 0; i &lt; blocks.length; i++) {</td></tr><tr><td class="line-number" value="2888"></td><td class="line-content">    block = blocks[i];</td></tr><tr><td class="line-number" value="2889"></td><td class="line-content">    leftBlocks = blocks.slice(0,i);</td></tr><tr><td class="line-number" value="2890"></td><td class="line-content">    rightBlocks = blocks.slice(i+1);</td></tr><tr><td class="line-number" value="2891"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2892"></td><td class="line-content">    if(block[0] === "{") {</td></tr><tr><td class="line-number" value="2893"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2894"></td><td class="line-content">      let input = block.substr(1,block.length-2);</td></tr><tr><td class="line-number" value="2895"></td><td class="line-content">      let result = __evaluateCurlyBlock(rootNode, thisRef, input, leftBlocks, rightBlocks, ctxInfo);</td></tr><tr><td class="line-number" value="2896"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2897"></td><td class="line-content">      if(result &amp;&amp; (typeof result === "object" || typeof result === "function") &amp;&amp; result.$nodeType) {</td></tr><tr><td class="line-number" value="2898"></td><td class="line-content">        // This could be a Perchance node due to import blocks. See note below the `__evaluateSquareBlock` call below for explanation.</td></tr><tr><td class="line-number" value="2899"></td><td class="line-content">        result = result.toString({keepEscapes:true});</td></tr><tr><td class="line-number" value="2900"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="2901"></td><td class="line-content">        result = result + "";</td></tr><tr><td class="line-number" value="2902"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2903"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2904"></td><td class="line-content">      // the first few conditions here are just performance optimisations:</td></tr><tr><td class="line-number" value="2905"></td><td class="line-content">      if(result !== block &amp;&amp; bracketRegex.test(result) &amp;&amp; (result[0] === "[" || result[0] === "{" || __splitTextAtAllBlocks(result).length &gt; 1)) {</td></tr><tr><td class="line-number" value="2906"></td><td class="line-content">        result = __evaluateText(rootNode, thisRef, result, ctxInfo, result);</td></tr><tr><td class="line-number" value="2907"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2908"></td><td class="line-content">      evaluatedBlocks.push(result);</td></tr><tr><td class="line-number" value="2909"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2910"></td><td class="line-content">    } else if(block[0] === "[") {</td></tr><tr><td class="line-number" value="2911"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2912"></td><td class="line-content">      let input = block.substr(1,block.length-2);</td></tr><tr><td class="line-number" value="2913"></td><td class="line-content">      window.__primitiveValueGetterKeepEscapesYolo = true; // see MARKER:odj29hfi3j0d2kj0hx24f for explanation</td></tr><tr><td class="line-number" value="2914"></td><td class="line-content">      let result = __evaluateSquareBlock(rootNode, thisRef, input, ctxInfo);</td></tr><tr><td class="line-number" value="2915"></td><td class="line-content">      window.__primitiveValueGetterKeepEscapesYolo = false;</td></tr><tr><td class="line-number" value="2916"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2917"></td><td class="line-content">      if(result &amp;&amp; (typeof result === "object" || typeof result === "function") &amp;&amp; result.$nodeType) {</td></tr><tr><td class="line-number" value="2918"></td><td class="line-content">        // If it's a Perchance node, we keep the escape characters, since if we remove them here, then we would unescape square/curly character (for example) and</td></tr><tr><td class="line-number" value="2919"></td><td class="line-content">        // then they'd get executed (in the code that follows this block) even though that's obviously not what the user wants. See the comments at the top of the toString</td></tr><tr><td class="line-number" value="2920"></td><td class="line-content">        // function for more context.</td></tr><tr><td class="line-number" value="2921"></td><td class="line-content">        result = result.toString({keepEscapes:true});</td></tr><tr><td class="line-number" value="2922"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="2923"></td><td class="line-content">        result = result + "";</td></tr><tr><td class="line-number" value="2924"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2925"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2926"></td><td class="line-content">      // the first few conditions here are just performance optimisations:</td></tr><tr><td class="line-number" value="2927"></td><td class="line-content">      if(result !== block &amp;&amp; bracketRegex.test(result) &amp;&amp; (result[0] === "[" || result[0] === "{" || __splitTextAtAllBlocks(result).length &gt; 1)) {</td></tr><tr><td class="line-number" value="2928"></td><td class="line-content">        result = __evaluateText(rootNode, thisRef, result, ctxInfo, result);</td></tr><tr><td class="line-number" value="2929"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2930"></td><td class="line-content">      evaluatedBlocks.push(result);</td></tr><tr><td class="line-number" value="2931"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2932"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="2933"></td><td class="line-content">      evaluatedBlocks.push(block);</td></tr><tr><td class="line-number" value="2934"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2935"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2936"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2937"></td><td class="line-content">  if(previousEvaluationText === evaluatedBlocks.join("")) return previousEvaluationText; // see note at top of this function for explanation</td></tr><tr><td class="line-number" value="2938"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2939"></td><td class="line-content">  // if there's anything but plain text (i.e. if there's any curly/square blocks), recurse</td></tr><tr><td class="line-number" value="2940"></td><td class="line-content">  var b, completelyEvaluated = true;</td></tr><tr><td class="line-number" value="2941"></td><td class="line-content">  for(let i = 0; i &lt; evaluatedBlocks.length; i++) {</td></tr><tr><td class="line-number" value="2942"></td><td class="line-content">    b = evaluatedBlocks[i];</td></tr><tr><td class="line-number" value="2943"></td><td class="line-content">    if(!bracketRegex.test(b)) continue;</td></tr><tr><td class="line-number" value="2944"></td><td class="line-content">    //if(b === undefined) { b = evaluatedBlocks[i] = "(not found)"; }</td></tr><tr><td class="line-number" value="2945"></td><td class="line-content">    if(b[0] === "[" || b[0] === "{" || __splitTextAtAllBlocks(b).length &gt; 1) {</td></tr><tr><td class="line-number" value="2946"></td><td class="line-content">      completelyEvaluated = false;</td></tr><tr><td class="line-number" value="2947"></td><td class="line-content">      break;</td></tr><tr><td class="line-number" value="2948"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2949"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2950"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2951"></td><td class="line-content">  if(!completelyEvaluated) {</td></tr><tr><td class="line-number" value="2952"></td><td class="line-content">    return __evaluateText(rootNode, thisRef, evaluatedBlocks.join(""), ctxInfo, evaluatedBlocks.join(""));</td></tr><tr><td class="line-number" value="2953"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="2954"></td><td class="line-content">    return evaluatedBlocks.join("");</td></tr><tr><td class="line-number" value="2955"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="2956"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2957"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="2958"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2959"></td><td class="line-content">function __processEscapedCharacters(text) {</td></tr><tr><td class="line-number" value="2960"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2961"></td><td class="line-content">  //TODO***: when they have an item like `\ hello \` and they repeat it like [item][item][item]... you end up with `hello \ hello \ hello \ ...` because the two backslashes join up.</td></tr><tr><td class="line-number" value="2962"></td><td class="line-content">  //         I think this is pretty easy: if there's an unescaped backslash on the end, remove it when you create the node.</td></tr><tr><td class="line-number" value="2963"></td><td class="line-content">  //         If there's one at the start and it's just escaping a space, then remove that backslash too.</td></tr><tr><td class="line-number" value="2964"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2965"></td><td class="line-content">  // TODO***: allow them to escape forward slashes?</td></tr><tr><td class="line-number" value="2966"></td><td class="line-content">  // TODO***: empty character "\e"?</td></tr><tr><td class="line-number" value="2967"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2968"></td><td class="line-content">  // look for input characters that follow an unescaped backslash</td></tr><tr><td class="line-number" value="2969"></td><td class="line-content">  // and replace them with the output character and remove the backslash</td></tr><tr><td class="line-number" value="2970"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2971"></td><td class="line-content">  let escapableCharacters = [</td></tr><tr><td class="line-number" value="2972"></td><td class="line-content">    {input:"=", output:"="},</td></tr><tr><td class="line-number" value="2973"></td><td class="line-content">    {input:"{", output:"{"},</td></tr><tr><td class="line-number" value="2974"></td><td class="line-content">    {input:"}", output:"}"},</td></tr><tr><td class="line-number" value="2975"></td><td class="line-content">    {input:"[", output:"["},</td></tr><tr><td class="line-number" value="2976"></td><td class="line-content">    {input:"]", output:"]"},</td></tr><tr><td class="line-number" value="2977"></td><td class="line-content">    {input:"^", output:"^"},</td></tr><tr><td class="line-number" value="2978"></td><td class="line-content">    {input:"|", output:"|"},</td></tr><tr><td class="line-number" value="2979"></td><td class="line-content">    {input:"n", output:"\n"},</td></tr><tr><td class="line-number" value="2980"></td><td class="line-content">    {input:"t", output:"\t"},</td></tr><tr><td class="line-number" value="2981"></td><td class="line-content">    {input:"s", output:" "},</td></tr><tr><td class="line-number" value="2982"></td><td class="line-content">  ];</td></tr><tr><td class="line-number" value="2983"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2984"></td><td class="line-content">  let escaped = false;</td></tr><tr><td class="line-number" value="2985"></td><td class="line-content">  for(let i = 0; i &lt; text.length; i++) {</td></tr><tr><td class="line-number" value="2986"></td><td class="line-content">    if(i !== 0) {</td></tr><tr><td class="line-number" value="2987"></td><td class="line-content">      if(text[i-1] !== "\\") {</td></tr><tr><td class="line-number" value="2988"></td><td class="line-content">        escaped = false;</td></tr><tr><td class="line-number" value="2989"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="2990"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="2991"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2992"></td><td class="line-content">    if(text[i] === "\\") {</td></tr><tr><td class="line-number" value="2993"></td><td class="line-content">      if(escaped) { // handle the special case of the backslash character:</td></tr><tr><td class="line-number" value="2994"></td><td class="line-content">        escaped = false;</td></tr><tr><td class="line-number" value="2995"></td><td class="line-content">        text = text.substr(0, i-1) + "\\" + text.substr(i+1);</td></tr><tr><td class="line-number" value="2996"></td><td class="line-content">        i--;</td></tr><tr><td class="line-number" value="2997"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="2998"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="2999"></td><td class="line-content">        if(i === text.length-1) {</td></tr><tr><td class="line-number" value="3000"></td><td class="line-content">          return text.substr(0, text.length-1); // if last character is an unescaped backslash, return text without it</td></tr><tr><td class="line-number" value="3001"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="3002"></td><td class="line-content">          escaped = true;</td></tr><tr><td class="line-number" value="3003"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="3004"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3005"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3006"></td><td class="line-content">      continue;</td></tr><tr><td class="line-number" value="3007"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3008"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3009"></td><td class="line-content">    if(escaped) {</td></tr><tr><td class="line-number" value="3010"></td><td class="line-content">      for(let e of escapableCharacters) {</td></tr><tr><td class="line-number" value="3011"></td><td class="line-content">        if(text[i] === e.input) {</td></tr><tr><td class="line-number" value="3012"></td><td class="line-content">          text = text.substr(0, i-1) + e.output + text.substr(i+1);</td></tr><tr><td class="line-number" value="3013"></td><td class="line-content">          i--;</td></tr><tr><td class="line-number" value="3014"></td><td class="line-content">          break;</td></tr><tr><td class="line-number" value="3015"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="3016"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3017"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3018"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3019"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3020"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3021"></td><td class="line-content">  return text;</td></tr><tr><td class="line-number" value="3022"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3023"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3024"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3025"></td><td class="line-content">function __evaluateCurlyBlock(rootNode, thisRef, block, leftBlocks, rightBlocks, ctxInfo) {</td></tr><tr><td class="line-number" value="3026"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3027"></td><td class="line-content">  // `block` is a string of the *contents* of the curly block</td></tr><tr><td class="line-number" value="3028"></td><td class="line-content">  for(let fn of __curlyFunctions) {</td></tr><tr><td class="line-number" value="3029"></td><td class="line-content">    // note that recursion can occur here since some curly functions may neet to</td></tr><tr><td class="line-number" value="3030"></td><td class="line-content">    // resolve their arguments to plain text. So they'll call evaluatedText, which</td></tr><tr><td class="line-number" value="3031"></td><td class="line-content">    // will call this function (if curly brackets are found), and so the loop loops.</td></tr><tr><td class="line-number" value="3032"></td><td class="line-content">    let evaluatedBlock = fn(rootNode, thisRef, block, leftBlocks, rightBlocks, ctxInfo);</td></tr><tr><td class="line-number" value="3033"></td><td class="line-content">    if(evaluatedBlock !== false) {</td></tr><tr><td class="line-number" value="3034"></td><td class="line-content">      if(typeof evaluatedBlock === 'string' &amp;&amp; String(Number(evaluatedBlock)) === evaluatedBlock) {</td></tr><tr><td class="line-number" value="3035"></td><td class="line-content">        return Number(evaluatedBlock);</td></tr><tr><td class="line-number" value="3036"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="3037"></td><td class="line-content">        return evaluatedBlock;</td></tr><tr><td class="line-number" value="3038"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3039"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3040"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3041"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3042"></td><td class="line-content">  if(block === "s") {</td></tr><tr><td class="line-number" value="3043"></td><td class="line-content">    __perchanceError(`Your curly block "&lt;code&gt;{${__escapeHTMLSpecialChars(block)}}&lt;/code&gt;" doesn't appear to have the correct syntax. It is meant to be used for something like &lt;code&gt;I have {1-3} [fruit]{s}&lt;/code&gt;. Notice that there needs to be a number preceding the &lt;code&gt;[fruit]&lt;/code&gt; block. If you just want the plural of &lt;code&gt;[fruit]&lt;/code&gt; then you can use &lt;code&gt;[fruit.pluralForm]&lt;/code&gt;.`, {declarationLineNumber:ctxInfo.declarationLineNumber, moduleName:ctxInfo.moduleName, node:ctxInfo.node});</td></tr><tr><td class="line-number" value="3044"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="3045"></td><td class="line-content">    __perchanceError(`Your curly block "&lt;code&gt;{${__escapeHTMLSpecialChars(block)}}&lt;/code&gt;" doesn't appear to have the correct syntax. Curly brackets (these ones: {}) are special characters in Perchance. They're used to do all sorts of fancy stuff which you can learn about in the &lt;a href="/tutorial"&gt;tutorial&lt;/a&gt;. If you didn't intend to use a special function, and instead just wanted to actually use curly brackets as literal characters, then you can put a backslash character before them like so: \\{...\\}`, {declarationLineNumber:ctxInfo.declarationLineNumber, moduleName:ctxInfo.moduleName, node:ctxInfo.node});</td></tr><tr><td class="line-number" value="3046"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3047"></td><td class="line-content">  return "(invalid curly block)";</td></tr><tr><td class="line-number" value="3048"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3049"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3050"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3051"></td><td class="line-content">// function evaluateCurlylessBlock(rootNode, text) {</td></tr><tr><td class="line-number" value="3052"></td><td class="line-content">//   // TODO: allow passing in the declarationLineNumber and other details to this function?</td></tr><tr><td class="line-number" value="3053"></td><td class="line-content">//   let arr = splitTextAtSquareBlocks(text);</td></tr><tr><td class="line-number" value="3054"></td><td class="line-content">//   let resultText = "";</td></tr><tr><td class="line-number" value="3055"></td><td class="line-content">//   for(let e of arr) {</td></tr><tr><td class="line-number" value="3056"></td><td class="line-content">//     if(e[0] === "[") {</td></tr><tr><td class="line-number" value="3057"></td><td class="line-content">//       let jsExpr = e.substr(1, e.length-2);</td></tr><tr><td class="line-number" value="3058"></td><td class="line-content">//       resultText += evaluateSquareBlock(rootNode, rootNode, jsExpr, {declarationLineNumber:null});</td></tr><tr><td class="line-number" value="3059"></td><td class="line-content">//     } else {</td></tr><tr><td class="line-number" value="3060"></td><td class="line-content">//       resultText += e;</td></tr><tr><td class="line-number" value="3061"></td><td class="line-content">//     }</td></tr><tr><td class="line-number" value="3062"></td><td class="line-content">//   }</td></tr><tr><td class="line-number" value="3063"></td><td class="line-content">//   return resultText;</td></tr><tr><td class="line-number" value="3064"></td><td class="line-content">// }</td></tr><tr><td class="line-number" value="3065"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3066"></td><td class="line-content">function __getTextOddsDetails(text, ctxInfo={}) {</td></tr><tr><td class="line-number" value="3067"></td><td class="line-content">  // JUST returns text on either side of unescaped "^" that is in a TEXT block, with some minor validation (just to help users debug)</td></tr><tr><td class="line-number" value="3068"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3069"></td><td class="line-content">  let blocks = __splitTextAtAllBlocks(text, ctxInfo);</td></tr><tr><td class="line-number" value="3070"></td><td class="line-content">  let blockI = 0;</td></tr><tr><td class="line-number" value="3071"></td><td class="line-content">  let charI = 0;</td></tr><tr><td class="line-number" value="3072"></td><td class="line-content">  let overallI = 0;</td></tr><tr><td class="line-number" value="3073"></td><td class="line-content">  let currentBlock = blocks[0];</td></tr><tr><td class="line-number" value="3074"></td><td class="line-content">  let inText = null;</td></tr><tr><td class="line-number" value="3075"></td><td class="line-content">  function inTextBlock(checkI) {</td></tr><tr><td class="line-number" value="3076"></td><td class="line-content">    // NOTE: we hold the state outside of the function so that we can start from where we left off</td></tr><tr><td class="line-number" value="3077"></td><td class="line-content">    if(overallI &gt; checkI) {</td></tr><tr><td class="line-number" value="3078"></td><td class="line-content">      // start again if previous check state is past the current one</td></tr><tr><td class="line-number" value="3079"></td><td class="line-content">      blockI = 0;</td></tr><tr><td class="line-number" value="3080"></td><td class="line-content">      charI = 0;</td></tr><tr><td class="line-number" value="3081"></td><td class="line-content">      overallI = 0;</td></tr><tr><td class="line-number" value="3082"></td><td class="line-content">      currentBlock = blocks[0];</td></tr><tr><td class="line-number" value="3083"></td><td class="line-content">      inText = null;</td></tr><tr><td class="line-number" value="3084"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3085"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3086"></td><td class="line-content">    while(true) {</td></tr><tr><td class="line-number" value="3087"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3088"></td><td class="line-content">      if(blockI &gt; blocks.length-1) {</td></tr><tr><td class="line-number" value="3089"></td><td class="line-content">        console.error("The checkI value (index to be checked to see if it's within a TEXT block) seems to be greater than the length of the whole text.");</td></tr><tr><td class="line-number" value="3090"></td><td class="line-content">        return false;</td></tr><tr><td class="line-number" value="3091"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3092"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3093"></td><td class="line-content">      // skip block if checkI doesn't occur within it</td></tr><tr><td class="line-number" value="3094"></td><td class="line-content">      if(charI === 0) {</td></tr><tr><td class="line-number" value="3095"></td><td class="line-content">        if(overallI + blocks[blockI].length-1 &lt; checkI) {</td></tr><tr><td class="line-number" value="3096"></td><td class="line-content">          overallI += blocks[blockI].length; //don't subtract 1 because that would put overallI at last character of current block - we want it to be at the first character of nect block</td></tr><tr><td class="line-number" value="3097"></td><td class="line-content">          charI = 0; // not necessary since it already is zero, but just for expliciteness</td></tr><tr><td class="line-number" value="3098"></td><td class="line-content">          blockI++; // only increase block index after adding block size to overallI</td></tr><tr><td class="line-number" value="3099"></td><td class="line-content">          continue;</td></tr><tr><td class="line-number" value="3100"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="3101"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3102"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3103"></td><td class="line-content">      if(charI === 0) {</td></tr><tr><td class="line-number" value="3104"></td><td class="line-content">        if(blocks[blockI][0] === "[" || blocks[blockI][0] === "{") {</td></tr><tr><td class="line-number" value="3105"></td><td class="line-content">          inText = false;</td></tr><tr><td class="line-number" value="3106"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="3107"></td><td class="line-content">          inText = true;</td></tr><tr><td class="line-number" value="3108"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="3109"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3110"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3111"></td><td class="line-content">      if(overallI === checkI) {</td></tr><tr><td class="line-number" value="3112"></td><td class="line-content">        return inText;</td></tr><tr><td class="line-number" value="3113"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3114"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3115"></td><td class="line-content">      if(charI === blocks[blockI].length-1) { // if we've reached the end of a block</td></tr><tr><td class="line-number" value="3116"></td><td class="line-content">        overallI++;</td></tr><tr><td class="line-number" value="3117"></td><td class="line-content">        blockI++;</td></tr><tr><td class="line-number" value="3118"></td><td class="line-content">        charI = 0;</td></tr><tr><td class="line-number" value="3119"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="3120"></td><td class="line-content">        charI++;</td></tr><tr><td class="line-number" value="3121"></td><td class="line-content">        overallI++;</td></tr><tr><td class="line-number" value="3122"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3123"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3124"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3125"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3126"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3127"></td><td class="line-content">  //text = text.trim(); // &lt;-- I commented this out because inline OR notation like { a ^1| b ^2} would return "a " or "b " instead or " a " or " b "</td></tr><tr><td class="line-number" value="3128"></td><td class="line-content">  let escaped = false;</td></tr><tr><td class="line-number" value="3129"></td><td class="line-content">  for(let i = 0; i &lt; text.length; i++) {</td></tr><tr><td class="line-number" value="3130"></td><td class="line-content">    if(i !== 0) {</td></tr><tr><td class="line-number" value="3131"></td><td class="line-content">      if(text[i-1] !== "\\") { escaped = false; }</td></tr><tr><td class="line-number" value="3132"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3133"></td><td class="line-content">    if(text[i] === "\\") { escaped = !escaped; }</td></tr><tr><td class="line-number" value="3134"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3135"></td><td class="line-content">    if(!escaped &amp;&amp; text[i] === NODE_ODDS_INDICATOR_CHARACTER &amp;&amp; inTextBlock(i)) {</td></tr><tr><td class="line-number" value="3136"></td><td class="line-content">      let odds = text.substr(i+1).trim();</td></tr><tr><td class="line-number" value="3137"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3138"></td><td class="line-content">      // tiny bit of validation, just to help out users, but definitely not an full validation (which would be basically impossible to do, since we'd need to simulate every possible combination of potentially huge programs)</td></tr><tr><td class="line-number" value="3139"></td><td class="line-content">      if(!/[!0-9\[\{]/.test(odds[0])) {</td></tr><tr><td class="line-number" value="3140"></td><td class="line-content">        __perchanceError(`There is a problem with this odds declaration: "&lt;b&gt;${__escapeHTMLSpecialChars(odds)}&lt;/b&gt;" (the full text of the line with the error is "${__escapeHTMLSpecialChars(text)}"). The text after the "^" character defines the chance that that item will be selected (the higher the number the greater the chance). Odds declarations should only contain numbers, mathematical/logical operators, and are also allowed to have curly and square bracket blocks which will evaluate to number characters (these will be computed on-the-fly). If you'd like to use the "^" character literally (i.e. not to declare odds), you need to put a backslash character before it like so: "\\^"`, ctxInfo);</td></tr><tr><td class="line-number" value="3141"></td><td class="line-content">        return false;</td></tr><tr><td class="line-number" value="3142"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3143"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3144"></td><td class="line-content">      return {</td></tr><tr><td class="line-number" value="3145"></td><td class="line-content">        odds,</td></tr><tr><td class="line-number" value="3146"></td><td class="line-content">        textWithoutOdds: text.substr(0,i), // don't trim() - allow caller to decide, since different notations have difference whitespace preferences</td></tr><tr><td class="line-number" value="3147"></td><td class="line-content">      };</td></tr><tr><td class="line-number" value="3148"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3149"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3150"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3151"></td><td class="line-content">  return false;</td></tr><tr><td class="line-number" value="3152"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3153"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3154"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3155"></td><td class="line-content">function __oddsTextToNumber(rootNode, thisRef, text, ctxInfo={}) {</td></tr><tr><td class="line-number" value="3156"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3157"></td><td class="line-content">  // optimisations:</td></tr><tr><td class="line-number" value="3158"></td><td class="line-content">  if(text === "1") { // default value:</td></tr><tr><td class="line-number" value="3159"></td><td class="line-content">    return 1;</td></tr><tr><td class="line-number" value="3160"></td><td class="line-content">  } else if(!/[^0-9]/.test(text)) { // all digits:</td></tr><tr><td class="line-number" value="3161"></td><td class="line-content">    return Number(text);</td></tr><tr><td class="line-number" value="3162"></td><td class="line-content">  } else if(String(Number(text)) === text) {</td></tr><tr><td class="line-number" value="3163"></td><td class="line-content">    return Number(text);</td></tr><tr><td class="line-number" value="3164"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="3165"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3166"></td><td class="line-content">    // complex expressions:</td></tr><tr><td class="line-number" value="3167"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3168"></td><td class="line-content">    // NOTE: there's an important distinction between converting primitive declarations to numbers,</td></tr><tr><td class="line-number" value="3169"></td><td class="line-content">    // and converting odds declarations to numbers. We only convert primitive declarations to</td></tr><tr><td class="line-number" value="3170"></td><td class="line-content">    // numbers if Number.toString() would return the same string anyway. On the other hand, odds</td></tr><tr><td class="line-number" value="3171"></td><td class="line-content">    // declarations can contain strings with math symbols</td></tr><tr><td class="line-number" value="3172"></td><td class="line-content">    let evaluatedText = __evaluateText(rootNode, thisRef, text, ctxInfo);</td></tr><tr><td class="line-number" value="3173"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3174"></td><td class="line-content">    if(evaluatedText === "false") evaluatedText = "0";</td></tr><tr><td class="line-number" value="3175"></td><td class="line-content">    else if(evaluatedText === "true") evaluatedText = "1";</td></tr><tr><td class="line-number" value="3176"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3177"></td><td class="line-content">    // TODO: check that this works</td></tr><tr><td class="line-number" value="3178"></td><td class="line-content">    if(/[^0-9\/*&amp;|%!.\(\)e\-]/.test(evaluatedText)) {</td></tr><tr><td class="line-number" value="3179"></td><td class="line-content">      __perchanceError(`Your odds declaration: "&lt;b&gt;${__escapeHTMLSpecialChars(text)}&lt;/b&gt;", evaluated to: "&lt;b&gt;${__escapeHTMLSpecialChars(evaluatedText)}&lt;/b&gt;" which contains characters that aren't allowed in odds declarations. The text after the "^" character defines the chance that that item will be selected (the higher the number the greater the chance). Odds declarations should only contain numbers, mathematical/logical operators, and are also allowed to have curly and square bracket blocks which will evaluate to number characters (these will be computed on-the-fly). If you'd like to use the "^" character literally (i.e. not to declare odds), you need to put a backslash character before it like so: "\\^"`, ctxInfo);</td></tr><tr><td class="line-number" value="3180"></td><td class="line-content">      return false;</td></tr><tr><td class="line-number" value="3181"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3182"></td><td class="line-content">    let num = false;</td></tr><tr><td class="line-number" value="3183"></td><td class="line-content">    try { num = eval(evaluatedText); } catch(e) {/* no need to catch */}</td></tr><tr><td class="line-number" value="3184"></td><td class="line-content">    return num;</td></tr><tr><td class="line-number" value="3185"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3186"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3187"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3188"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3189"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3190"></td><td class="line-content">function __splitTextAtSquareBlocks(text, ctxInfo={}) {</td></tr><tr><td class="line-number" value="3191"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3192"></td><td class="line-content">  if(!text.includes("[") &amp;&amp; !text.includes("]")) return [text];</td></tr><tr><td class="line-number" value="3193"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3194"></td><td class="line-content">  let escaped = false;</td></tr><tr><td class="line-number" value="3195"></td><td class="line-content">  let unclosedBracketCount = 0;</td></tr><tr><td class="line-number" value="3196"></td><td class="line-content">  let inJSExpr = false;</td></tr><tr><td class="line-number" value="3197"></td><td class="line-content">  let inJSExprString1 = false, inJSExprString2 = false, inJSExprString3 = false;</td></tr><tr><td class="line-number" value="3198"></td><td class="line-content">  let expressionArray = [];</td></tr><tr><td class="line-number" value="3199"></td><td class="line-content">  for(let i = 0; i &lt; text.length; i++) {</td></tr><tr><td class="line-number" value="3200"></td><td class="line-content">    if(i !== 0) {</td></tr><tr><td class="line-number" value="3201"></td><td class="line-content">      if(text[i-1] !== "\\") { escaped = false; }</td></tr><tr><td class="line-number" value="3202"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3203"></td><td class="line-content">    if(text[i] === "\\") { escaped = !escaped; }</td></tr><tr><td class="line-number" value="3204"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3205"></td><td class="line-content">    // skip strings in js expressions (square brackets in strings would mess</td></tr><tr><td class="line-number" value="3206"></td><td class="line-content">    // with our unclosedBracketCount):</td></tr><tr><td class="line-number" value="3207"></td><td class="line-content">    if(inJSExpr &amp;&amp; !inJSExprString1 &amp;&amp; !inJSExprString2 &amp;&amp; !inJSExprString3 &amp;&amp; !escaped &amp;&amp; text[i] === "\"") { inJSExprString1 = true; continue; }</td></tr><tr><td class="line-number" value="3208"></td><td class="line-content">    if(inJSExprString1 &amp;&amp; !escaped &amp;&amp; text[i] !== "\"") { continue; }</td></tr><tr><td class="line-number" value="3209"></td><td class="line-content">    if(inJSExprString1 &amp;&amp; !escaped &amp;&amp; text[i] === "\"") { inJSExprString1 = false; continue; }</td></tr><tr><td class="line-number" value="3210"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3211"></td><td class="line-content">    if(inJSExpr &amp;&amp; !inJSExprString1 &amp;&amp; !inJSExprString2 &amp;&amp; !inJSExprString3 &amp;&amp; !escaped &amp;&amp; text[i] === "'") { inJSExprString2 = true; continue; }</td></tr><tr><td class="line-number" value="3212"></td><td class="line-content">    if(inJSExprString2 &amp;&amp; !escaped &amp;&amp; text[i] !== "'") { continue; }</td></tr><tr><td class="line-number" value="3213"></td><td class="line-content">    if(inJSExprString2 &amp;&amp; !escaped &amp;&amp; text[i] === "'") { inJSExprString2 = false; continue; }</td></tr><tr><td class="line-number" value="3214"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3215"></td><td class="line-content">    if(inJSExpr &amp;&amp; !inJSExprString1 &amp;&amp; !inJSExprString2 &amp;&amp; !inJSExprString3 &amp;&amp; !escaped &amp;&amp; text[i] === "`") { inJSExprString3 = true; continue; }</td></tr><tr><td class="line-number" value="3216"></td><td class="line-content">    if(inJSExprString3 &amp;&amp; !escaped &amp;&amp; text[i] !== "`") { continue; }</td></tr><tr><td class="line-number" value="3217"></td><td class="line-content">    if(inJSExprString3 &amp;&amp; !escaped &amp;&amp; text[i] === "`") { inJSExprString3 = false; continue; }</td></tr><tr><td class="line-number" value="3218"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3219"></td><td class="line-content">    // skip escaped brackets within js expressions (i.e. within regex declarations):</td></tr><tr><td class="line-number" value="3220"></td><td class="line-content">    if(inJSExpr &amp;&amp; escaped &amp;&amp; (text[i] === "[" || text[i] === "]")) { continue; }</td></tr><tr><td class="line-number" value="3221"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3222"></td><td class="line-content">    if(!escaped &amp;&amp; text[i] === "[") {</td></tr><tr><td class="line-number" value="3223"></td><td class="line-content">      unclosedBracketCount++;</td></tr><tr><td class="line-number" value="3224"></td><td class="line-content">      // if we weren't already inJSExpr, then this is the start of the a JSExpr:</td></tr><tr><td class="line-number" value="3225"></td><td class="line-content">      if(!inJSExpr &amp;&amp; i !== 0) {</td></tr><tr><td class="line-number" value="3226"></td><td class="line-content">        expressionArray.push(text.substr(0, i));</td></tr><tr><td class="line-number" value="3227"></td><td class="line-content">        text = text.substr(i);</td></tr><tr><td class="line-number" value="3228"></td><td class="line-content">        i = 0; // will be incremented to 0 on next loop, as required (we've already processed the first char, "[")</td></tr><tr><td class="line-number" value="3229"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3230"></td><td class="line-content">      inJSExpr = true;</td></tr><tr><td class="line-number" value="3231"></td><td class="line-content">      continue;</td></tr><tr><td class="line-number" value="3232"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3233"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3234"></td><td class="line-content">    if(!escaped &amp;&amp; text[i] === "]") {</td></tr><tr><td class="line-number" value="3235"></td><td class="line-content">      unclosedBracketCount--;</td></tr><tr><td class="line-number" value="3236"></td><td class="line-content">      // we're only out of the js expression when we've closed all brackets</td></tr><tr><td class="line-number" value="3237"></td><td class="line-content">      if(inJSExpr &amp;&amp; unclosedBracketCount === 0) {</td></tr><tr><td class="line-number" value="3238"></td><td class="line-content">        inJSExpr = false;</td></tr><tr><td class="line-number" value="3239"></td><td class="line-content">        expressionArray.push(text.substr(0, i+1));</td></tr><tr><td class="line-number" value="3240"></td><td class="line-content">        text = text.substr(i+1);</td></tr><tr><td class="line-number" value="3241"></td><td class="line-content">        i = -1; // will be incremented to 0 on next loop as required (we haven't yet processed the first character of the new string (the character after "]"))</td></tr><tr><td class="line-number" value="3242"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3243"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3244"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3245"></td><td class="line-content">    // last expression:</td></tr><tr><td class="line-number" value="3246"></td><td class="line-content">    if(i === text.length-1 &amp;&amp; text.length !== 0) {</td></tr><tr><td class="line-number" value="3247"></td><td class="line-content">      expressionArray.push(text);</td></tr><tr><td class="line-number" value="3248"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3249"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3250"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3251"></td><td class="line-content">  if(unclosedBracketCount !== 0) {</td></tr><tr><td class="line-number" value="3252"></td><td class="line-content">    __perchanceError(`It appears that you've got a &lt;b&gt;mismatch in your opening and closing square brackets&lt;/b&gt;. For each opening square bracket, there should be a closing one. If you'd like to use a &lt;i&gt;literal&lt;/i&gt; square bracket (i.e. you want to actually display one, rather than using them to output a random list item, then you need to put a "backslash" before it like "\\[ ... \\]". Here's the text that seems to be causing the error: &lt;blockquote&gt;${__escapeHTMLSpecialChars(text)}&lt;/blockquote&gt;`, ctxInfo);</td></tr><tr><td class="line-number" value="3253"></td><td class="line-content">    return false;</td></tr><tr><td class="line-number" value="3254"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3255"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3256"></td><td class="line-content">  return expressionArray;</td></tr><tr><td class="line-number" value="3257"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3258"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3259"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3260"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3261"></td><td class="line-content">function __getInlineFunctionDetails(lineText) {</td></tr><tr><td class="line-number" value="3262"></td><td class="line-content">  let isAsync = false;</td></tr><tr><td class="line-number" value="3263"></td><td class="line-content">  if(lineText.startsWith("async ")) {</td></tr><tr><td class="line-number" value="3264"></td><td class="line-content">    isAsync = true;</td></tr><tr><td class="line-number" value="3265"></td><td class="line-content">    lineText = lineText.substr(6);</td></tr><tr><td class="line-number" value="3266"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3267"></td><td class="line-content">  let escaped = false;</td></tr><tr><td class="line-number" value="3268"></td><td class="line-content">  let openIndex, opened = false;</td></tr><tr><td class="line-number" value="3269"></td><td class="line-content">  let closeIndex, closed = false;</td></tr><tr><td class="line-number" value="3270"></td><td class="line-content">  for(let i = 0; i &lt; lineText.length; i++) {</td></tr><tr><td class="line-number" value="3271"></td><td class="line-content">    if(i !== 0) {</td></tr><tr><td class="line-number" value="3272"></td><td class="line-content">      if(lineText[i-1] !== "\\") { escaped = false; }</td></tr><tr><td class="line-number" value="3273"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3274"></td><td class="line-content">    if(lineText[i] === "\\") { escaped = !escaped; }</td></tr><tr><td class="line-number" value="3275"></td><td class="line-content">    if(lineText[i] === "(" &amp;&amp; !escaped) { opened = true; openIndex = i; }</td></tr><tr><td class="line-number" value="3276"></td><td class="line-content">    if(lineText[i] === ")" &amp;&amp; !escaped &amp;&amp; opened) { closed = true; closeIndex = i; }</td></tr><tr><td class="line-number" value="3277"></td><td class="line-content">    if(lineText[i] === "=" &amp;&amp; !escaped &amp;&amp; opened &amp;&amp; closed &amp;&amp; lineText[i+1] === "&gt;") {</td></tr><tr><td class="line-number" value="3278"></td><td class="line-content">      let argString = lineText.substr(openIndex+1, closeIndex-openIndex-1);</td></tr><tr><td class="line-number" value="3279"></td><td class="line-content">      let args = argString.split(",").map(a =&gt; a.trim());</td></tr><tr><td class="line-number" value="3280"></td><td class="line-content">      let name = lineText.substr(0, openIndex).trim();</td></tr><tr><td class="line-number" value="3281"></td><td class="line-content">      let body = lineText.substr(i+2).trim();</td></tr><tr><td class="line-number" value="3282"></td><td class="line-content">      if(name.trim() === "") { return false; }</td></tr><tr><td class="line-number" value="3283"></td><td class="line-content">      if(body.trim() === "") { return false; }</td></tr><tr><td class="line-number" value="3284"></td><td class="line-content">      if(__areValidFunctionArguments(args) || argString === "") {</td></tr><tr><td class="line-number" value="3285"></td><td class="line-content">        if(!__isValidJavaScriptIdentifier(name)) return false;</td></tr><tr><td class="line-number" value="3286"></td><td class="line-content">        args = args.filter(a =&gt; a !== ""); // for zero arg case</td></tr><tr><td class="line-number" value="3287"></td><td class="line-content">        return { args, name, body, isAsync };</td></tr><tr><td class="line-number" value="3288"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3289"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3290"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3291"></td><td class="line-content">  return false;</td></tr><tr><td class="line-number" value="3292"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3293"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3294"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3295"></td><td class="line-content">function __getFunctionHeaderDetails(lineText) {</td></tr><tr><td class="line-number" value="3296"></td><td class="line-content">  let isAsync = false;</td></tr><tr><td class="line-number" value="3297"></td><td class="line-content">  if(lineText.startsWith("async ")) {</td></tr><tr><td class="line-number" value="3298"></td><td class="line-content">    isAsync = true;</td></tr><tr><td class="line-number" value="3299"></td><td class="line-content">    lineText = lineText.substr(6);</td></tr><tr><td class="line-number" value="3300"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3301"></td><td class="line-content">  lineText = lineText.trim();</td></tr><tr><td class="line-number" value="3302"></td><td class="line-content">  let l = lineText.length;</td></tr><tr><td class="line-number" value="3303"></td><td class="line-content">  if(lineText[l-2] === "=" &amp;&amp; lineText[l-1] === "&gt;") {</td></tr><tr><td class="line-number" value="3304"></td><td class="line-content">    lineText = lineText.substr(0, l-2).trim();</td></tr><tr><td class="line-number" value="3305"></td><td class="line-content">    l = lineText.length;</td></tr><tr><td class="line-number" value="3306"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="3307"></td><td class="line-content">    return false;</td></tr><tr><td class="line-number" value="3308"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3309"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3310"></td><td class="line-content">  let escaped = false;</td></tr><tr><td class="line-number" value="3311"></td><td class="line-content">  let opened = false;</td></tr><tr><td class="line-number" value="3312"></td><td class="line-content">  let openIndex;</td></tr><tr><td class="line-number" value="3313"></td><td class="line-content">  for(let i = 0; i &lt; lineText.length; i++) {</td></tr><tr><td class="line-number" value="3314"></td><td class="line-content">    if(i !== 0) {</td></tr><tr><td class="line-number" value="3315"></td><td class="line-content">      if(lineText[i-1] !== "\\") { escaped = false; }</td></tr><tr><td class="line-number" value="3316"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3317"></td><td class="line-content">    if(lineText[i] === "\\") { escaped = !escaped; }</td></tr><tr><td class="line-number" value="3318"></td><td class="line-content">    if(lineText[i] === "(" &amp;&amp; !escaped) { opened = true; openIndex = i; }</td></tr><tr><td class="line-number" value="3319"></td><td class="line-content">    if(lineText[i] === ")" &amp;&amp; !escaped &amp;&amp; opened) {</td></tr><tr><td class="line-number" value="3320"></td><td class="line-content">      let argString = lineText.substr(openIndex+1, i-openIndex-1);</td></tr><tr><td class="line-number" value="3321"></td><td class="line-content">      let args = argString.split(",").map(a =&gt; a.trim());</td></tr><tr><td class="line-number" value="3322"></td><td class="line-content">      let name = lineText.substr(0, openIndex).trim();</td></tr><tr><td class="line-number" value="3323"></td><td class="line-content">      if(name.trim() === "") { return false; }</td></tr><tr><td class="line-number" value="3324"></td><td class="line-content">      if(__areValidFunctionArguments(args) || argString === "") {</td></tr><tr><td class="line-number" value="3325"></td><td class="line-content">        if(!__isValidJavaScriptIdentifier(name)) return false;</td></tr><tr><td class="line-number" value="3326"></td><td class="line-content">        args = args.filter(a =&gt; a !== ""); // for zero arg case</td></tr><tr><td class="line-number" value="3327"></td><td class="line-content">        return { args, name, isAsync };</td></tr><tr><td class="line-number" value="3328"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3329"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3330"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3331"></td><td class="line-content">  return false;</td></tr><tr><td class="line-number" value="3332"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3333"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3334"></td><td class="line-content">function __areValidFunctionArguments(args) {</td></tr><tr><td class="line-number" value="3335"></td><td class="line-content">  for(let a of args) {</td></tr><tr><td class="line-number" value="3336"></td><td class="line-content">    if(!__isValidJavaScriptIdentifier(a.replace("...","").replace("=",""))) {</td></tr><tr><td class="line-number" value="3337"></td><td class="line-content">      return false;</td></tr><tr><td class="line-number" value="3338"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3339"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3340"></td><td class="line-content">  return true;</td></tr><tr><td class="line-number" value="3341"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3342"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3343"></td><td class="line-content">function __isValidJavaScriptIdentifier(str) {</td></tr><tr><td class="line-number" value="3344"></td><td class="line-content">  return /^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|null|this|true|void|with|await|break|catch|class|const|false|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D])(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF])*$/.test(str);</td></tr><tr><td class="line-number" value="3345"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3346"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3347"></td><td class="line-content">function __getPrimitiveNodeDetails(lineText) {</td></tr><tr><td class="line-number" value="3348"></td><td class="line-content">  // NOTE: this function interprets some strings as numbers and casts them using Number()</td></tr><tr><td class="line-number" value="3349"></td><td class="line-content">  //       note that this is *just a shorthand*. The reason it's okay to do is because it</td></tr><tr><td class="line-number" value="3350"></td><td class="line-content">  //       only interprets strings as numbers if Number(that_number).toString() would return</td></tr><tr><td class="line-number" value="3351"></td><td class="line-content">  //       the same string anyway. If the user wants to do something like:</td></tr><tr><td class="line-number" value="3352"></td><td class="line-content">  //            prop = [this.age]/[this.height]</td></tr><tr><td class="line-number" value="3353"></td><td class="line-content">  //       then they should do this instead:</td></tr><tr><td class="line-number" value="3354"></td><td class="line-content">  //            prop = [this.age/this.height]</td></tr><tr><td class="line-number" value="3355"></td><td class="line-content">  //       because the prior will return something like "10/140" (i.e. a string, rather than a number)</td></tr><tr><td class="line-number" value="3356"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3357"></td><td class="line-content">  // remember: the lineText could have square blocks which can of course have equals signs in them.</td></tr><tr><td class="line-number" value="3358"></td><td class="line-content">  // But since primitive node keys can't be dynamic we can just return false if we see an unescaped square</td></tr><tr><td class="line-number" value="3359"></td><td class="line-content">  // or curly bracket before we find an unescaped equals sign</td></tr><tr><td class="line-number" value="3360"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3361"></td><td class="line-content">  let escaped = false;</td></tr><tr><td class="line-number" value="3362"></td><td class="line-content">  for(let i = 0; i &lt; lineText.length; i++) {</td></tr><tr><td class="line-number" value="3363"></td><td class="line-content">    if(i !== 0) {</td></tr><tr><td class="line-number" value="3364"></td><td class="line-content">      if(lineText[i-1] !== "\\") { escaped = false; }</td></tr><tr><td class="line-number" value="3365"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3366"></td><td class="line-content">    if(lineText[i] === "\\") { escaped = !escaped; }</td></tr><tr><td class="line-number" value="3367"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3368"></td><td class="line-content">    if((lineText[i] === "[" || lineText[i] === "{") &amp;&amp; !escaped) {</td></tr><tr><td class="line-number" value="3369"></td><td class="line-content">      // found square or curly block before unescaped equals sign, so it's not a primitive node</td></tr><tr><td class="line-number" value="3370"></td><td class="line-content">      return false;</td></tr><tr><td class="line-number" value="3371"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3372"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3373"></td><td class="line-content">    if(lineText[i] === "=" &amp;&amp; !escaped) {</td></tr><tr><td class="line-number" value="3374"></td><td class="line-content">      let key = lineText.substr(0, i).trim();</td></tr><tr><td class="line-number" value="3375"></td><td class="line-content">      let valueText = lineText.substr(i+1).trim();</td></tr><tr><td class="line-number" value="3376"></td><td class="line-content">      if(key === "" || valueText === "") {</td></tr><tr><td class="line-number" value="3377"></td><td class="line-content">        return false;</td></tr><tr><td class="line-number" value="3378"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3379"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3380"></td><td class="line-content">      let value;</td></tr><tr><td class="line-number" value="3381"></td><td class="line-content">      if(valueText === String(Number(valueText))) {</td></tr><tr><td class="line-number" value="3382"></td><td class="line-content">        value = Number(valueText);</td></tr><tr><td class="line-number" value="3383"></td><td class="line-content">      } else if(valueText === "true") { // TODO: test that this works (with filter/where, etc.)</td></tr><tr><td class="line-number" value="3384"></td><td class="line-content">        value = true;</td></tr><tr><td class="line-number" value="3385"></td><td class="line-content">      } else if(valueText === "false") {</td></tr><tr><td class="line-number" value="3386"></td><td class="line-content">        value = false;</td></tr><tr><td class="line-number" value="3387"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="3388"></td><td class="line-content">        value = valueText;</td></tr><tr><td class="line-number" value="3389"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3390"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3391"></td><td class="line-content">      return {key, value};</td></tr><tr><td class="line-number" value="3392"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3393"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3394"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3395"></td><td class="line-content">  return false;</td></tr><tr><td class="line-number" value="3396"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3397"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3398"></td><td class="line-content">// function isMostLikelyAnIntentionalNumericString(valueText) {</td></tr><tr><td class="line-number" value="3399"></td><td class="line-content">//   if(isNaN(valueText)) { return false; }</td></tr><tr><td class="line-number" value="3400"></td><td class="line-content">//   if(/[^0-9.\-]+/.test(valueText)) { return false; }</td></tr><tr><td class="line-number" value="3401"></td><td class="line-content">//   if(valueText.split("-").length &gt; 2) { return false; }</td></tr><tr><td class="line-number" value="3402"></td><td class="line-content">//   if(valueText.split(".").length &gt; 2) { return false; }</td></tr><tr><td class="line-number" value="3403"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="3404"></td><td class="line-content">//   if(valueText.split("-").length === 2) {</td></tr><tr><td class="line-number" value="3405"></td><td class="line-content">//     if(valueText[0] !== "-") { return false; }</td></tr><tr><td class="line-number" value="3406"></td><td class="line-content">//     if(valueText[0] === "-" &amp;&amp; valueText[1] === ".") { return false; }</td></tr><tr><td class="line-number" value="3407"></td><td class="line-content">//   }</td></tr><tr><td class="line-number" value="3408"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="3409"></td><td class="line-content">//   if(valueText.split(".").length === 2) {</td></tr><tr><td class="line-number" value="3410"></td><td class="line-content">//     if(valueText[0] === ".") { return false; }</td></tr><tr><td class="line-number" value="3411"></td><td class="line-content">//     if(valueText[valueText.length-1] === ".") { return false; }</td></tr><tr><td class="line-number" value="3412"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="3413"></td><td class="line-content">//     let beforeDecimal = valueText.split(".")[0];</td></tr><tr><td class="line-number" value="3414"></td><td class="line-content">//     let afterDecimal = valueText.split(".")[1];</td></tr><tr><td class="line-number" value="3415"></td><td class="line-content">//     if(afterDecimal[afterDecimal.length-1] === "0") { return false; } // e.g. 20.0 shouldn't be treated as a number (they'd have just put in "20")</td></tr><tr><td class="line-number" value="3416"></td><td class="line-content">//     if(beforeDecimal[0] === "0" &amp;&amp; beforeDecimal.length &gt; 1) { return false; } // e.g. 020 shouldn't be treated as a number</td></tr><tr><td class="line-number" value="3417"></td><td class="line-content">//   }</td></tr><tr><td class="line-number" value="3418"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="3419"></td><td class="line-content">//   return true;</td></tr><tr><td class="line-number" value="3420"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="3421"></td><td class="line-content">// }</td></tr><tr><td class="line-number" value="3422"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3423"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3424"></td><td class="line-content">function __splitTextAtCurlyBlocks(text, ctxInfo={}) {</td></tr><tr><td class="line-number" value="3425"></td><td class="line-content">  // remember: we must ignore curly brackets if we're inside a js expression</td></tr><tr><td class="line-number" value="3426"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3427"></td><td class="line-content">  if(!text.includes("{") &amp;&amp; !text.includes("}")) return [text];</td></tr><tr><td class="line-number" value="3428"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3429"></td><td class="line-content">  let escaped = false;</td></tr><tr><td class="line-number" value="3430"></td><td class="line-content">  let lastCurlyOpenIndex = null;</td></tr><tr><td class="line-number" value="3431"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3432"></td><td class="line-content">  let inJSExpr = false;</td></tr><tr><td class="line-number" value="3433"></td><td class="line-content">  let unclosedSquareBracketCount = 0;</td></tr><tr><td class="line-number" value="3434"></td><td class="line-content">  let inJSExprString1 = false;</td></tr><tr><td class="line-number" value="3435"></td><td class="line-content">  let inJSExprString2 = false;</td></tr><tr><td class="line-number" value="3436"></td><td class="line-content">  let inJSExprString3 = false;</td></tr><tr><td class="line-number" value="3437"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3438"></td><td class="line-content">  let inCurlyExpr = false;</td></tr><tr><td class="line-number" value="3439"></td><td class="line-content">  let unclosedCurlyBracketCount = 0;</td></tr><tr><td class="line-number" value="3440"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3441"></td><td class="line-content">  let blocks = [];</td></tr><tr><td class="line-number" value="3442"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3443"></td><td class="line-content">  for(let i = 0; i &lt; text.length; i++) {</td></tr><tr><td class="line-number" value="3444"></td><td class="line-content">    if(i !== 0) {</td></tr><tr><td class="line-number" value="3445"></td><td class="line-content">      if(text[i-1] !== "\\") { escaped = false; }</td></tr><tr><td class="line-number" value="3446"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3447"></td><td class="line-content">    if(text[i] === "\\") { escaped = !escaped; }</td></tr><tr><td class="line-number" value="3448"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3449"></td><td class="line-content">    ////////////////////////////////////</td></tr><tr><td class="line-number" value="3450"></td><td class="line-content">    // skip strings in js expressions //</td></tr><tr><td class="line-number" value="3451"></td><td class="line-content">    ////////////////////////////////////</td></tr><tr><td class="line-number" value="3452"></td><td class="line-content">    //(square brackets in strings would mess with our unclosedSquareBracketCount which we use to skip js expressions):</td></tr><tr><td class="line-number" value="3453"></td><td class="line-content">    if(inJSExpr &amp;&amp; !inJSExprString1 &amp;&amp; !inJSExprString2 &amp;&amp; !inJSExprString3 &amp;&amp; !escaped &amp;&amp; text[i] === "\"") { inJSExprString1 = true; continue; }</td></tr><tr><td class="line-number" value="3454"></td><td class="line-content">    if(inJSExprString1 &amp;&amp; !escaped &amp;&amp; text[i] !== "\"") { continue; }</td></tr><tr><td class="line-number" value="3455"></td><td class="line-content">    if(inJSExprString1 &amp;&amp; !escaped &amp;&amp; text[i] === "\"") { inJSExprString1 = false; continue; }</td></tr><tr><td class="line-number" value="3456"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3457"></td><td class="line-content">    if(inJSExpr &amp;&amp; !inJSExprString1 &amp;&amp; !inJSExprString2 &amp;&amp; !inJSExprString3 &amp;&amp; !escaped &amp;&amp; text[i] === "'") { inJSExprString2 = true; continue; }</td></tr><tr><td class="line-number" value="3458"></td><td class="line-content">    if(inJSExprString2 &amp;&amp; !escaped &amp;&amp; text[i] !== "'") { continue; }</td></tr><tr><td class="line-number" value="3459"></td><td class="line-content">    if(inJSExprString2 &amp;&amp; !escaped &amp;&amp; text[i] === "'") { inJSExprString2 = false; continue; }</td></tr><tr><td class="line-number" value="3460"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3461"></td><td class="line-content">    if(inJSExpr &amp;&amp; !inJSExprString1 &amp;&amp; !inJSExprString2 &amp;&amp; !inJSExprString3 &amp;&amp; !escaped &amp;&amp; text[i] === "`") { inJSExprString3 = true; continue; }</td></tr><tr><td class="line-number" value="3462"></td><td class="line-content">    if(inJSExprString3 &amp;&amp; !escaped &amp;&amp; text[i] !== "`") { continue; }</td></tr><tr><td class="line-number" value="3463"></td><td class="line-content">    if(inJSExprString3 &amp;&amp; !escaped &amp;&amp; text[i] === "`") { inJSExprString3 = false; continue; }</td></tr><tr><td class="line-number" value="3464"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3465"></td><td class="line-content">    // skip escaped brackets within js expressions (i.e. escaped brackets within regex declarations):</td></tr><tr><td class="line-number" value="3466"></td><td class="line-content">    if(inJSExpr &amp;&amp; /*---&gt;*/escaped/*&lt;---*/ &amp;&amp; (text[i] === "[" || text[i] === "]")) { continue; }</td></tr><tr><td class="line-number" value="3467"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3468"></td><td class="line-content">    /////////////////////////////////////</td></tr><tr><td class="line-number" value="3469"></td><td class="line-content">    //      skip JS expressions        //</td></tr><tr><td class="line-number" value="3470"></td><td class="line-content">    /////////////////////////////////////</td></tr><tr><td class="line-number" value="3471"></td><td class="line-content">    // note that we're guarunteed to NOT be in a string for this block (since the</td></tr><tr><td class="line-number" value="3472"></td><td class="line-content">    // above block skips strings while we're in js expressions)</td></tr><tr><td class="line-number" value="3473"></td><td class="line-content">    if(!inJSExpr &amp;&amp; text[i] === "[" &amp;&amp; !escaped) {</td></tr><tr><td class="line-number" value="3474"></td><td class="line-content">      inJSExpr = true;</td></tr><tr><td class="line-number" value="3475"></td><td class="line-content">      unclosedSquareBracketCount++;</td></tr><tr><td class="line-number" value="3476"></td><td class="line-content">      continue;</td></tr><tr><td class="line-number" value="3477"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3478"></td><td class="line-content">    if(inJSExpr &amp;&amp; text[i] === "[") { // `escaped` is irrelevant, we're inJSExpr and not in string</td></tr><tr><td class="line-number" value="3479"></td><td class="line-content">      unclosedSquareBracketCount++;</td></tr><tr><td class="line-number" value="3480"></td><td class="line-content">      continue;</td></tr><tr><td class="line-number" value="3481"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3482"></td><td class="line-content">    if(inJSExpr &amp;&amp; text[i] === "]") { // `escaped` is irrelevant, we're inJSExpr and not in string</td></tr><tr><td class="line-number" value="3483"></td><td class="line-content">      unclosedSquareBracketCount--;</td></tr><tr><td class="line-number" value="3484"></td><td class="line-content">      if(unclosedSquareBracketCount === 0) { inJSExpr = false; }</td></tr><tr><td class="line-number" value="3485"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3486"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3487"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3488"></td><td class="line-content">    //////////////////////////////////////</td></tr><tr><td class="line-number" value="3489"></td><td class="line-content">    //      extract curly blocks        //</td></tr><tr><td class="line-number" value="3490"></td><td class="line-content">    //////////////////////////////////////</td></tr><tr><td class="line-number" value="3491"></td><td class="line-content">    if(text[i] === "{" &amp;&amp; !escaped &amp;&amp; !inJSExpr) {</td></tr><tr><td class="line-number" value="3492"></td><td class="line-content">      unclosedCurlyBracketCount++;</td></tr><tr><td class="line-number" value="3493"></td><td class="line-content">      // if we're not yet in a curly expression, then this is the start of one:</td></tr><tr><td class="line-number" value="3494"></td><td class="line-content">      if(!inCurlyExpr &amp;&amp; i !== 0) {</td></tr><tr><td class="line-number" value="3495"></td><td class="line-content">        blocks.push(text.substr(0, i));</td></tr><tr><td class="line-number" value="3496"></td><td class="line-content">        text = text.substr(i);</td></tr><tr><td class="line-number" value="3497"></td><td class="line-content">        i = 0;</td></tr><tr><td class="line-number" value="3498"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3499"></td><td class="line-content">      inCurlyExpr = true;</td></tr><tr><td class="line-number" value="3500"></td><td class="line-content">      continue;</td></tr><tr><td class="line-number" value="3501"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3502"></td><td class="line-content">    if(text[i] === "}" &amp;&amp; !escaped &amp;&amp; !inJSExpr) {</td></tr><tr><td class="line-number" value="3503"></td><td class="line-content">      unclosedCurlyBracketCount--;</td></tr><tr><td class="line-number" value="3504"></td><td class="line-content">      // we're only out of the curly expression when we've closed all curly brackets that were opened</td></tr><tr><td class="line-number" value="3505"></td><td class="line-content">      if(inCurlyExpr &amp;&amp; unclosedCurlyBracketCount === 0) {</td></tr><tr><td class="line-number" value="3506"></td><td class="line-content">        blocks.push(text.substr(0, i+1));</td></tr><tr><td class="line-number" value="3507"></td><td class="line-content">        text = text.substr(i+1);</td></tr><tr><td class="line-number" value="3508"></td><td class="line-content">        i = -1;</td></tr><tr><td class="line-number" value="3509"></td><td class="line-content">        inCurlyExpr = false;</td></tr><tr><td class="line-number" value="3510"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3511"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3512"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3513"></td><td class="line-content">    // add last expression (if it didn't end in a curly block - in that case text.length === 0)</td></tr><tr><td class="line-number" value="3514"></td><td class="line-content">    if(i === text.length-1 &amp;&amp; text.length !== 0) {</td></tr><tr><td class="line-number" value="3515"></td><td class="line-content">      blocks.push(text);</td></tr><tr><td class="line-number" value="3516"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3517"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3518"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3519"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3520"></td><td class="line-content">  if(unclosedSquareBracketCount !== 0) {</td></tr><tr><td class="line-number" value="3521"></td><td class="line-content">    __perchanceError(`It appears that you've got &lt;b&gt;a mismatch in your opening and closing square brackets&lt;/b&gt;. For each opening square bracket, there should be a closing one. If you'd like to use a &lt;i&gt;literal&lt;/i&gt; square bracket (i.e. you want to actually display one, rather than using them to output a random list item, then you need to put a "backslash" before it like "\\[ ... \\]". Here's the text that seems to be causing the error: &lt;blockquote&gt;${__escapeHTMLSpecialChars(text)}&lt;/blockquote&gt;`, ctxInfo);</td></tr><tr><td class="line-number" value="3522"></td><td class="line-content">    return ["(syntax error)"];</td></tr><tr><td class="line-number" value="3523"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3524"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3525"></td><td class="line-content">  if(unclosedCurlyBracketCount !== 0) {</td></tr><tr><td class="line-number" value="3526"></td><td class="line-content">    __perchanceError(`It appears that you've got &lt;b&gt;a mismatch in your opening and closing curly brackets&lt;/b&gt;. For each opening curly bracket, there should be a closing one. If you'd like to use a &lt;i&gt;literal&lt;/i&gt; curly bracket (i.e. you want to actually display one, rather than using them to do {import:noun} and stuff like that, then you need to put a "backslash" before it like "\\{ ... \\}". Here's the text that seems to be causing the error: &lt;blockquote&gt;${__escapeHTMLSpecialChars(text)}&lt;/blockquote&gt;`, ctxInfo);</td></tr><tr><td class="line-number" value="3527"></td><td class="line-content">    return ["(syntax error)"];</td></tr><tr><td class="line-number" value="3528"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3529"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3530"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3531"></td><td class="line-content">  return blocks;</td></tr><tr><td class="line-number" value="3532"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3533"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3534"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3535"></td><td class="line-content">function __splitTextAtAllBlocks(text, ctxInfo={}) {</td></tr><tr><td class="line-number" value="3536"></td><td class="line-content">  let curlySplitParts = __splitTextAtCurlyBlocks(text, ctxInfo);</td></tr><tr><td class="line-number" value="3537"></td><td class="line-content">  let blocks = []; // this array will contain curly blocks, text blocks, and square blocks</td></tr><tr><td class="line-number" value="3538"></td><td class="line-content">  for(let part of curlySplitParts) {</td></tr><tr><td class="line-number" value="3539"></td><td class="line-content">    if(part[0] !== "{") {</td></tr><tr><td class="line-number" value="3540"></td><td class="line-content">      let squareSplitParts = __splitTextAtSquareBlocks(part, ctxInfo);</td></tr><tr><td class="line-number" value="3541"></td><td class="line-content">      if(squareSplitParts) {</td></tr><tr><td class="line-number" value="3542"></td><td class="line-content">        blocks.push(...squareSplitParts);</td></tr><tr><td class="line-number" value="3543"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="3544"></td><td class="line-content">        console.error("Something is wrong?");</td></tr><tr><td class="line-number" value="3545"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3546"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="3547"></td><td class="line-content">      blocks.push(part);</td></tr><tr><td class="line-number" value="3548"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3549"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3550"></td><td class="line-content">  return blocks;</td></tr><tr><td class="line-number" value="3551"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3552"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3553"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3554"></td><td class="line-content">function __stripCommentFromLine(line) {</td></tr><tr><td class="line-number" value="3555"></td><td class="line-content">  // NOTE: comment must either start at start of line, or have a space before it.</td></tr><tr><td class="line-number" value="3556"></td><td class="line-content">  // e.g. in http://example.com , "//example.com" isn't considered a comment because</td></tr><tr><td class="line-number" value="3557"></td><td class="line-content">  // it doesn't have a preceding space</td></tr><tr><td class="line-number" value="3558"></td><td class="line-content">  let i, escaped = false;</td></tr><tr><td class="line-number" value="3559"></td><td class="line-content">  for(i = 0; i &lt; line.length; i++) {</td></tr><tr><td class="line-number" value="3560"></td><td class="line-content">    if(i !== 0) {</td></tr><tr><td class="line-number" value="3561"></td><td class="line-content">      if(line[i-1] !== "\\") { escaped = false; }</td></tr><tr><td class="line-number" value="3562"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3563"></td><td class="line-content">    if(line[i] === "\\") { escaped = !escaped; }</td></tr><tr><td class="line-number" value="3564"></td><td class="line-content">    if(line[i] === "/" &amp;&amp; !escaped &amp;&amp; line[i+1] === "/") {</td></tr><tr><td class="line-number" value="3565"></td><td class="line-content">      if(i === 0) {</td></tr><tr><td class="line-number" value="3566"></td><td class="line-content">        break;</td></tr><tr><td class="line-number" value="3567"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="3568"></td><td class="line-content">        if(line[i-1] === " " || line[i-1] === "\t") {</td></tr><tr><td class="line-number" value="3569"></td><td class="line-content">          break;</td></tr><tr><td class="line-number" value="3570"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="3571"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3572"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3573"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3574"></td><td class="line-content">  return line.substr(0,i);</td></tr><tr><td class="line-number" value="3575"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3576"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3577"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3578"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3579"></td><td class="line-content">function __normaliseLineIndentsToTabs(line) {</td></tr><tr><td class="line-number" value="3580"></td><td class="line-content">  let i, eqSpaceCount = 0; //equivalent spaces (1 tab = 2 spaces)</td></tr><tr><td class="line-number" value="3581"></td><td class="line-content">  for(i = 0; i &lt; line.length; i++) {</td></tr><tr><td class="line-number" value="3582"></td><td class="line-content">    if(line[i] === " ") { eqSpaceCount++; }</td></tr><tr><td class="line-number" value="3583"></td><td class="line-content">    else if(line[i] === "\t") { eqSpaceCount += 2; }</td></tr><tr><td class="line-number" value="3584"></td><td class="line-content">    else { break; }</td></tr><tr><td class="line-number" value="3585"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3586"></td><td class="line-content">  if(eqSpaceCount%2 !== 0) {</td></tr><tr><td class="line-number" value="3587"></td><td class="line-content">    return false; //odd number of spaces</td></tr><tr><td class="line-number" value="3588"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="3589"></td><td class="line-content">    return "\t".repeat(parseInt(eqSpaceCount/2)) + line.substr(i);</td></tr><tr><td class="line-number" value="3590"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3591"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3592"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="3593"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="3594"></td><td class="line-content">Object.defineProperty(String.prototype, "titleCase", {get:__titleCaseMethod});</td></tr><tr><td class="line-number" value="3595"></td><td class="line-content">Object.defineProperty(Number.prototype, "titleCase", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3596"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "titleCase", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3597"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3598"></td><td class="line-content">Object.defineProperty(String.prototype, "sentenceCase", {get:__sentenceCaseMethod});</td></tr><tr><td class="line-number" value="3599"></td><td class="line-content">Object.defineProperty(Number.prototype, "sentenceCase", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3600"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "sentenceCase", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3601"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3602"></td><td class="line-content">Object.defineProperty(String.prototype, "upperCase", {get:__upperCaseMethod});</td></tr><tr><td class="line-number" value="3603"></td><td class="line-content">Object.defineProperty(Number.prototype, "upperCase", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3604"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "upperCase", {get:function(){return this.valueOf();}})</td></tr><tr><td class="line-number" value="3605"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3606"></td><td class="line-content">Object.defineProperty(String.prototype, "lowerCase", {get:__lowerCaseMethod});</td></tr><tr><td class="line-number" value="3607"></td><td class="line-content">Object.defineProperty(Number.prototype, "lowerCase", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3608"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "lowerCase", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3609"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3610"></td><td class="line-content">Object.defineProperty(String.prototype, "replaceText", {value:__replaceTextMethod});</td></tr><tr><td class="line-number" value="3611"></td><td class="line-content">Object.defineProperty(Number.prototype, "replaceText", {value:__replaceTextMethod});</td></tr><tr><td class="line-number" value="3612"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "replaceText", {value:__replaceTextMethod});</td></tr><tr><td class="line-number" value="3613"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3614"></td><td class="line-content">Object.defineProperty(String.prototype, "pastTense", {get:__pastTenseMethod});</td></tr><tr><td class="line-number" value="3615"></td><td class="line-content">Object.defineProperty(Number.prototype, "pastTense", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3616"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "pastTense", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3617"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3618"></td><td class="line-content">Object.defineProperty(String.prototype, "presentTense", {get:__presentTenseMethod});</td></tr><tr><td class="line-number" value="3619"></td><td class="line-content">Object.defineProperty(Number.prototype, "presentTense", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3620"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "presentTense", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3621"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3622"></td><td class="line-content">Object.defineProperty(String.prototype, "futureTense", {get:__futureTenseMethod});</td></tr><tr><td class="line-number" value="3623"></td><td class="line-content">Object.defineProperty(Number.prototype, "futureTense", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3624"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "futureTense", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3625"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3626"></td><td class="line-content">Object.defineProperty(String.prototype, "getSelf", {get:function() { return this+""; }});</td></tr><tr><td class="line-number" value="3627"></td><td class="line-content">Object.defineProperty(Number.prototype, "getSelf", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3628"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "getSelf", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3629"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3630"></td><td class="line-content">Object.defineProperty(String.prototype, "getOdds", {get:function() { return 1; }});</td></tr><tr><td class="line-number" value="3631"></td><td class="line-content">Object.defineProperty(Number.prototype, "getOdds", {get:function(){ return 1; }});</td></tr><tr><td class="line-number" value="3632"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "getOdds", {get:function(){ return 1; }});</td></tr><tr><td class="line-number" value="3633"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3634"></td><td class="line-content">// WHAT IS THIS?</td></tr><tr><td class="line-number" value="3635"></td><td class="line-content">Object.defineProperty(String.prototype, "getName", {get:function() {</td></tr><tr><td class="line-number" value="3636"></td><td class="line-content">  return this+"";</td></tr><tr><td class="line-number" value="3637"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3638"></td><td class="line-content">Object.defineProperty(Number.prototype, "getName", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3639"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "getName", {get:function(){return this.valueOf();}})</td></tr><tr><td class="line-number" value="3640"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3641"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3642"></td><td class="line-content">Object.defineProperty(String.prototype, "evaluateItem", {get:function() {</td></tr><tr><td class="line-number" value="3643"></td><td class="line-content">  let r = window.__currentEvaluateSquareBlockRoot ? window.__currentEvaluateSquareBlockRoot : root; // so imported generators use their own root</td></tr><tr><td class="line-number" value="3644"></td><td class="line-content">  let out = __evaluateText(r, r, this.valueOf(), {declarationLineNumber:null});</td></tr><tr><td class="line-number" value="3645"></td><td class="line-content">  if(window.generatorLastEditTime &gt; 1716337636385) { // May 22nd 2024 bugfix, ensures only generators edited after this time get it, to prevent breaking old generators that rely on the bug</td></tr><tr><td class="line-number" value="3646"></td><td class="line-content">    out = __processEscapedCharacters(out);</td></tr><tr><td class="line-number" value="3647"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3648"></td><td class="line-content">  if(String(Number(out)) === out) {</td></tr><tr><td class="line-number" value="3649"></td><td class="line-content">    out = Number(out);</td></tr><tr><td class="line-number" value="3650"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3651"></td><td class="line-content">  return out;</td></tr><tr><td class="line-number" value="3652"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3653"></td><td class="line-content">Object.defineProperty(Number.prototype, "evaluateItem", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3654"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "evaluateItem", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3655"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3656"></td><td class="line-content">Object.defineProperty(String.prototype, Symbol.toPrimitive, {value:function(hint) {</td></tr><tr><td class="line-number" value="3657"></td><td class="line-content">  return this.valueOf();</td></tr><tr><td class="line-number" value="3658"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3659"></td><td class="line-content">// i don't think these two are necessary?</td></tr><tr><td class="line-number" value="3660"></td><td class="line-content">Object.defineProperty(Number.prototype, Symbol.toPrimitive, {value:function(hint) {</td></tr><tr><td class="line-number" value="3661"></td><td class="line-content">  return this.valueOf();</td></tr><tr><td class="line-number" value="3662"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3663"></td><td class="line-content">Object.defineProperty(Boolean.prototype, Symbol.toPrimitive, {value:function(hint) {</td></tr><tr><td class="line-number" value="3664"></td><td class="line-content">  return this.valueOf();</td></tr><tr><td class="line-number" value="3665"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3666"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3667"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3668"></td><td class="line-content">Object.defineProperty(String.prototype, "selectMany", {value:__selectManyMethodStringNum});</td></tr><tr><td class="line-number" value="3669"></td><td class="line-content">Object.defineProperty(Number.prototype, "selectMany", {value:__selectManyMethodStringNum});</td></tr><tr><td class="line-number" value="3670"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "selectMany", {value:__selectManyMethodStringNum});</td></tr><tr><td class="line-number" value="3671"></td><td class="line-content">function __selectManyMethodStringNum(num) {</td></tr><tr><td class="line-number" value="3672"></td><td class="line-content">  let arr = [];</td></tr><tr><td class="line-number" value="3673"></td><td class="line-content">  for(let i = 0; i &lt; num; i++) {</td></tr><tr><td class="line-number" value="3674"></td><td class="line-content">    arr.push(this.selectOne);</td></tr><tr><td class="line-number" value="3675"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3676"></td><td class="line-content">  // overwrite default array behaviour (selects a random one)</td></tr><tr><td class="line-number" value="3677"></td><td class="line-content">  // in the case where they don't specify a join() after the repeat:</td></tr><tr><td class="line-number" value="3678"></td><td class="line-content">  arr.toString = function() { return this.join(""); };</td></tr><tr><td class="line-number" value="3679"></td><td class="line-content">  return arr;</td></tr><tr><td class="line-number" value="3680"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3681"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3682"></td><td class="line-content">Object.defineProperty(String.prototype, "selectOne", {get:function() {</td></tr><tr><td class="line-number" value="3683"></td><td class="line-content">  let r = window.__currentEvaluateSquareBlockRoot ? window.__currentEvaluateSquareBlockRoot : root; // so imported generators use their own root</td></tr><tr><td class="line-number" value="3684"></td><td class="line-content">  let out = __evaluateText(r, r, this.valueOf(), {declarationLineNumber:null}); // so you can write e.g. [n = "{1-20}".selectOne]</td></tr><tr><td class="line-number" value="3685"></td><td class="line-content">  if(window.generatorLastEditTime &gt; 1716337636385) { // May 22nd 2024 bugfix, ensures only generators edited after this time get it, to prevent breaking old generators that rely on the bug</td></tr><tr><td class="line-number" value="3686"></td><td class="line-content">    out = __processEscapedCharacters(out);</td></tr><tr><td class="line-number" value="3687"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3688"></td><td class="line-content">  if(String(Number(out)) === out) {</td></tr><tr><td class="line-number" value="3689"></td><td class="line-content">    out = Number(out);</td></tr><tr><td class="line-number" value="3690"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3691"></td><td class="line-content">  return out;</td></tr><tr><td class="line-number" value="3692"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3693"></td><td class="line-content">Object.defineProperty(Number.prototype, "selectOne", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3694"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "selectOne", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3695"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3696"></td><td class="line-content">Object.defineProperty(String.prototype, "singularForm", {get:function(n) {</td></tr><tr><td class="line-number" value="3697"></td><td class="line-content">  let input = this+""; // need +"" because compromise wants primitive, not String() obj</td></tr><tr><td class="line-number" value="3698"></td><td class="line-content">  let output = __nlpCompromise(input).nouns().toSingular().out("text");</td></tr><tr><td class="line-number" value="3699"></td><td class="line-content">  return output === "" ? input : output;</td></tr><tr><td class="line-number" value="3700"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3701"></td><td class="line-content">Object.defineProperty(Number.prototype, "singularForm", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3702"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "singularForm", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3703"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3704"></td><td class="line-content">Object.defineProperty(String.prototype, "pluralForm", {get:function(n) {</td></tr><tr><td class="line-number" value="3705"></td><td class="line-content">  let input = this+""; // need +"" because compromise wants primitive, not String() obj</td></tr><tr><td class="line-number" value="3706"></td><td class="line-content">  let output = __nlpCompromise(input).nouns().toPlural().out("text");</td></tr><tr><td class="line-number" value="3707"></td><td class="line-content">  return output === "" ? input : output;</td></tr><tr><td class="line-number" value="3708"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3709"></td><td class="line-content">Object.defineProperty(Number.prototype, "pluralForm", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3710"></td><td class="line-content">Object.defineProperty(Boolean.prototype, "pluralForm", {get:function(){return this.valueOf();}});</td></tr><tr><td class="line-number" value="3711"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3712"></td><td class="line-content">// TODO***: add the rest of the node methods here and to Array (e.g. pastTense, etc.)</td></tr><tr><td class="line-number" value="3713"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3714"></td><td class="line-content">// Object.defineProperty(String.prototype, "shuffleCharacters", {value:function(numShuffles) {</td></tr><tr><td class="line-number" value="3715"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="3716"></td><td class="line-content">//   if(numShuffles === undefined) {</td></tr><tr><td class="line-number" value="3717"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="3718"></td><td class="line-content">//     var array = this.split("");</td></tr><tr><td class="line-number" value="3719"></td><td class="line-content">//     var currentIndex = array.length, temporaryValue, randomIndex;</td></tr><tr><td class="line-number" value="3720"></td><td class="line-content">//     // While there remain elements to shuffle...</td></tr><tr><td class="line-number" value="3721"></td><td class="line-content">//     while (0 !== currentIndex) {</td></tr><tr><td class="line-number" value="3722"></td><td class="line-content">//       // Pick a remaining element...</td></tr><tr><td class="line-number" value="3723"></td><td class="line-content">//       randomIndex = Math.floor(Math.random() * currentIndex);</td></tr><tr><td class="line-number" value="3724"></td><td class="line-content">//       currentIndex -= 1;</td></tr><tr><td class="line-number" value="3725"></td><td class="line-content">//       // And swap it with the current element.</td></tr><tr><td class="line-number" value="3726"></td><td class="line-content">//       temporaryValue = array[currentIndex];</td></tr><tr><td class="line-number" value="3727"></td><td class="line-content">//       array[currentIndex] = array[randomIndex];</td></tr><tr><td class="line-number" value="3728"></td><td class="line-content">//       array[randomIndex] = temporaryValue;</td></tr><tr><td class="line-number" value="3729"></td><td class="line-content">//     }</td></tr><tr><td class="line-number" value="3730"></td><td class="line-content">//     return array.join("")</td></tr><tr><td class="line-number" value="3731"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="3732"></td><td class="line-content">//   } else {</td></tr><tr><td class="line-number" value="3733"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="3734"></td><td class="line-content">//     let array = this.split("");</td></tr><tr><td class="line-number" value="3735"></td><td class="line-content">//     for(let i = 0; i &lt; numShuffles; i++) {</td></tr><tr><td class="line-number" value="3736"></td><td class="line-content">//       let i1 = Math.floor(array.length*Math.random());</td></tr><tr><td class="line-number" value="3737"></td><td class="line-content">//       let i2 = Math.floor(array.length*Math.random());</td></tr><tr><td class="line-number" value="3738"></td><td class="line-content">//       let c1 = array[i1];</td></tr><tr><td class="line-number" value="3739"></td><td class="line-content">//       let c2 = array[i2];</td></tr><tr><td class="line-number" value="3740"></td><td class="line-content">//       array[i1] = c2;</td></tr><tr><td class="line-number" value="3741"></td><td class="line-content">//       array[i2] = c1;</td></tr><tr><td class="line-number" value="3742"></td><td class="line-content">//     }</td></tr><tr><td class="line-number" value="3743"></td><td class="line-content">//     return array.join("");</td></tr><tr><td class="line-number" value="3744"></td><td class="line-content">//     // TODO: why not join back into a string?</td></tr><tr><td class="line-number" value="3745"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="3746"></td><td class="line-content">//   }</td></tr><tr><td class="line-number" value="3747"></td><td class="line-content">//</td></tr><tr><td class="line-number" value="3748"></td><td class="line-content">// }});</td></tr><tr><td class="line-number" value="3749"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3750"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="3751"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="3752"></td><td class="line-content">Array.prototype.toString = function () {</td></tr><tr><td class="line-number" value="3753"></td><td class="line-content">  // default behaviour of arrays when converting to string is to choose a random element.</td></tr><tr><td class="line-number" value="3754"></td><td class="line-content">  // altering the toString method is how you make it not do this by default (this is how selectMany works)</td></tr><tr><td class="line-number" value="3755"></td><td class="line-content">  // let items = [];</td></tr><tr><td class="line-number" value="3756"></td><td class="line-content">  // for(let item of this) {</td></tr><tr><td class="line-number" value="3757"></td><td class="line-content">  //   items.push(item+"");</td></tr><tr><td class="line-number" value="3758"></td><td class="line-content">  // }</td></tr><tr><td class="line-number" value="3759"></td><td class="line-content">  // return chooseRandomTextByOdds(window.root, window.root, items);</td></tr><tr><td class="line-number" value="3760"></td><td class="line-content">  if(this.length === 0) return "";</td></tr><tr><td class="line-number" value="3761"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3762"></td><td class="line-content">  return this.selectOne+""; // should this be `this.selectOne.toString({keepEscapes:true})` ?</td></tr><tr><td class="line-number" value="3763"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="3764"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3765"></td><td class="line-content">Object.defineProperty(Array.prototype, "getOdds", {get:function() { return 1; }});</td></tr><tr><td class="line-number" value="3766"></td><td class="line-content">Object.defineProperty(Array.prototype, "getSelf", {get:function() { return this; }});</td></tr><tr><td class="line-number" value="3767"></td><td class="line-content">Object.defineProperty(Array.prototype, "getLength", {get:function() { return this.length; }});</td></tr><tr><td class="line-number" value="3768"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3769"></td><td class="line-content">Object.defineProperty(Array.prototype, "consumableList", {get:function() {</td></tr><tr><td class="line-number" value="3770"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3771"></td><td class="line-content">  let proxy = new Proxy(this, {</td></tr><tr><td class="line-number" value="3772"></td><td class="line-content">    // alreadyConsumedItems: new Set(),</td></tr><tr><td class="line-number" value="3773"></td><td class="line-content">    alreadyConsumedIndices: new Set(), // NOTE: we need this (unlike in the addNodeMethods.js case where we use alreadyConsumedItems) because an array can contain duplicates of the same item: lemmy.world/post/6207000 but we should treat them as separate items.</td></tr><tr><td class="line-number" value="3774"></td><td class="line-content">    get: function(target, property) {</td></tr><tr><td class="line-number" value="3775"></td><td class="line-content">      if(property === "selectOne") {</td></tr><tr><td class="line-number" value="3776"></td><td class="line-content">        let selectedNode = __arraySelectOneMethod.bind(proxy)();</td></tr><tr><td class="line-number" value="3777"></td><td class="line-content">        // if(selectedNode) { // consumption is done in __arraySelectOneMethod now</td></tr><tr><td class="line-number" value="3778"></td><td class="line-content">        //   this.alreadyConsumedItems.add(selectedNode);</td></tr><tr><td class="line-number" value="3779"></td><td class="line-content">        // }</td></tr><tr><td class="line-number" value="3780"></td><td class="line-content">        return selectedNode;</td></tr><tr><td class="line-number" value="3781"></td><td class="line-content">      }/* else if(property === "$alreadyConsumedItems") {</td></tr><tr><td class="line-number" value="3782"></td><td class="line-content">        return this.alreadyConsumedItems;</td></tr><tr><td class="line-number" value="3783"></td><td class="line-content">      }*/ else if(property === "$alreadyConsumedIndices") {</td></tr><tr><td class="line-number" value="3784"></td><td class="line-content">        return this.alreadyConsumedIndices;</td></tr><tr><td class="line-number" value="3785"></td><td class="line-content">      } else if(property === "getLength") {</td></tr><tr><td class="line-number" value="3786"></td><td class="line-content">        // return target.length - this.alreadyConsumedItems.size;</td></tr><tr><td class="line-number" value="3787"></td><td class="line-content">        return target.length - this.alreadyConsumedIndices.size;</td></tr><tr><td class="line-number" value="3788"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="3789"></td><td class="line-content">        // TODO: strangely, the return value here seems to be automatically bound to this proxy.</td></tr><tr><td class="line-number" value="3790"></td><td class="line-content">        // so it also handles toString and valueOf methods like we want it to</td></tr><tr><td class="line-number" value="3791"></td><td class="line-content">        return target[property];</td></tr><tr><td class="line-number" value="3792"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3793"></td><td class="line-content">    },</td></tr><tr><td class="line-number" value="3794"></td><td class="line-content">  });</td></tr><tr><td class="line-number" value="3795"></td><td class="line-content">  return proxy;</td></tr><tr><td class="line-number" value="3796"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3797"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3798"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3799"></td><td class="line-content">Object.defineProperty(Array.prototype, "selectAll", {get: function() {</td></tr><tr><td class="line-number" value="3800"></td><td class="line-content">  return this;</td></tr><tr><td class="line-number" value="3801"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3802"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3803"></td><td class="line-content">Object.defineProperty(Array.prototype, "selectMany", {value:__selectManyMethod});</td></tr><tr><td class="line-number" value="3804"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3805"></td><td class="line-content">Object.defineProperty(Array.prototype, "selectUnique", {value: function(...args) {</td></tr><tr><td class="line-number" value="3806"></td><td class="line-content">  return this.consumableList.selectMany(...args);</td></tr><tr><td class="line-number" value="3807"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3808"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3809"></td><td class="line-content">let __arraySelectOneMethod = function() {</td></tr><tr><td class="line-number" value="3810"></td><td class="line-content">  //return this[Math.floor(Math.random()*this.length)];</td></tr><tr><td class="line-number" value="3811"></td><td class="line-content">  let candidates = []; /*{item, odds}*/</td></tr><tr><td class="line-number" value="3812"></td><td class="line-content">  for(let i = 0; i &lt; this.length; i++) {</td></tr><tr><td class="line-number" value="3813"></td><td class="line-content">    if(this.$alreadyConsumedIndices &amp;&amp; this.$alreadyConsumedIndices.has(i)) continue;</td></tr><tr><td class="line-number" value="3814"></td><td class="line-content">    let a = this[i];</td></tr><tr><td class="line-number" value="3815"></td><td class="line-content">    if(a.$nodeType) { // if it's a node</td></tr><tr><td class="line-number" value="3816"></td><td class="line-content">      candidates.push({item:a, odds:a.$odds, index:i});</td></tr><tr><td class="line-number" value="3817"></td><td class="line-content">    } else if(typeof a === 'string') {</td></tr><tr><td class="line-number" value="3818"></td><td class="line-content">      let details = __getTextOddsDetails(a);</td></tr><tr><td class="line-number" value="3819"></td><td class="line-content">      if(details &amp;&amp; (details.odds.includes("[") || details.odds.includes("{"))) details.odds = details.odds.evaluateItem; // don't need the if statement, but it's better for performance</td></tr><tr><td class="line-number" value="3820"></td><td class="line-content">      let odds = details ? Number(details.odds) : 1; // &lt;-- this doesn't allow dynamic odds notation in arrays. Can always add it later if it turns out that it would be useful.</td></tr><tr><td class="line-number" value="3821"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="3822"></td><td class="line-content">      if(odds &lt; 0 || isNaN(odds)) {</td></tr><tr><td class="line-number" value="3823"></td><td class="line-content">        __perchanceError(`The odds of ${a} has evaluated to ${odds &lt; 0 ? "a negative number" : "a non-number"}. It's item number ${i} in the list (the list that starts with ${this[0]}). You may have created this list with selectAll or selectUnique.`);</td></tr><tr><td class="line-number" value="3824"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3825"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="3826"></td><td class="line-content">      let item = details ? details.textWithoutOdds : a;</td></tr><tr><td class="line-number" value="3827"></td><td class="line-content">      candidates.push({item, odds, index:i});</td></tr><tr><td class="line-number" value="3828"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="3829"></td><td class="line-content">      candidates.push({item:a, odds:1, index:i});</td></tr><tr><td class="line-number" value="3830"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3831"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3832"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3833"></td><td class="line-content">  // if(this.$alreadyConsumedItems) { // this doesn't make sense because an array can contain duplicates of the same node: lemmy.world/post/6207000</td></tr><tr><td class="line-number" value="3834"></td><td class="line-content">  //   candidates = candidates.filter(c =&gt; !this.$alreadyConsumedItems.has(c.item));</td></tr><tr><td class="line-number" value="3835"></td><td class="line-content">  // }</td></tr><tr><td class="line-number" value="3836"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3837"></td><td class="line-content">  let oddsTotal = candidates.reduce((a,v) =&gt; { return a+v.odds; }, 0);</td></tr><tr><td class="line-number" value="3838"></td><td class="line-content">  let stopOddsSum = oddsTotal*Math.random();</td></tr><tr><td class="line-number" value="3839"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3840"></td><td class="line-content">  let oddsRunningSum = 0;</td></tr><tr><td class="line-number" value="3841"></td><td class="line-content">  for(let c of candidates) {</td></tr><tr><td class="line-number" value="3842"></td><td class="line-content">    oddsRunningSum += c.odds;</td></tr><tr><td class="line-number" value="3843"></td><td class="line-content">    if(oddsRunningSum &gt;= stopOddsSum) {</td></tr><tr><td class="line-number" value="3844"></td><td class="line-content">      if(this.$alreadyConsumedIndices) this.$alreadyConsumedIndices.add(c.index);</td></tr><tr><td class="line-number" value="3845"></td><td class="line-content">      return c.item;</td></tr><tr><td class="line-number" value="3846"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3847"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3848"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3849"></td><td class="line-content">  if(this.$alreadyConsumedIndices) {</td></tr><tr><td class="line-number" value="3850"></td><td class="line-content">    __perchanceError("It looks like your &lt;code&gt;consumableList&lt;/code&gt; ran out of items. This is the list in question: "+this.slice(0, 100).join(", "));</td></tr><tr><td class="line-number" value="3851"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="3852"></td><td class="line-content">    __perchanceError("Something went wrong! &lt;code&gt;Error: selectOne from array returned nothing.&lt;/code&gt; Please report this on &lt;a href='https://lemmy.world/c/perchance'&gt;lemmy.world/c/perchance&lt;/a&gt; since it's likely a bug with the engine.");</td></tr><tr><td class="line-number" value="3853"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3854"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3855"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="3856"></td><td class="line-content">Object.defineProperty(Array.prototype, "selectOne", {get:__arraySelectOneMethod});</td></tr><tr><td class="line-number" value="3857"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3858"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3859"></td><td class="line-content">Object.defineProperty(Array.prototype, Symbol.toPrimitive, {value:function(hint) {</td></tr><tr><td class="line-number" value="3860"></td><td class="line-content">  return this.toString();</td></tr><tr><td class="line-number" value="3861"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3862"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3863"></td><td class="line-content">// don't need this because we've got joinItems, right?</td></tr><tr><td class="line-number" value="3864"></td><td class="line-content">// Object.defineProperty(Array.prototype, "evaluateItem", {get:function() {</td></tr><tr><td class="line-number" value="3865"></td><td class="line-content">//   return this.toString();</td></tr><tr><td class="line-number" value="3866"></td><td class="line-content">// }});</td></tr><tr><td class="line-number" value="3867"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3868"></td><td class="line-content">Object.defineProperty(Array.prototype, "joinItems", {value:function(str="") {</td></tr><tr><td class="line-number" value="3869"></td><td class="line-content">  return this.join(str);</td></tr><tr><td class="line-number" value="3870"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3871"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3872"></td><td class="line-content">Object.defineProperty(Array.prototype, "sumItems", {get:function() {</td></tr><tr><td class="line-number" value="3873"></td><td class="line-content">  return this.reduce((a, v) =&gt; a+v.evaluateItem, 0);</td></tr><tr><td class="line-number" value="3874"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3875"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3876"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3877"></td><td class="line-content">// TODO***: make all methods configurable like in nodeMethods?</td></tr><tr><td class="line-number" value="3878"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3879"></td><td class="line-content">Object.defineProperty(Array.prototype, "pluralForm", {get:function() {</td></tr><tr><td class="line-number" value="3880"></td><td class="line-content">  return this.map(a =&gt; a.pluralForm);</td></tr><tr><td class="line-number" value="3881"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3882"></td><td class="line-content">Object.defineProperty(Array.prototype, "singularForm", {get:function() {</td></tr><tr><td class="line-number" value="3883"></td><td class="line-content">  return this.map(a =&gt; a.singularForm);</td></tr><tr><td class="line-number" value="3884"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3885"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3886"></td><td class="line-content">Object.defineProperty(Array.prototype, "pastTense", {get:function() {</td></tr><tr><td class="line-number" value="3887"></td><td class="line-content">  return this.map(a =&gt; a.pastTense);</td></tr><tr><td class="line-number" value="3888"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3889"></td><td class="line-content">Object.defineProperty(Array.prototype, "presentTense", {get:function() {</td></tr><tr><td class="line-number" value="3890"></td><td class="line-content">  return this.map(a =&gt; a.presentTense);</td></tr><tr><td class="line-number" value="3891"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3892"></td><td class="line-content">Object.defineProperty(Array.prototype, "futureTense", {get:function() {</td></tr><tr><td class="line-number" value="3893"></td><td class="line-content">  return this.map(a =&gt; a.futureTense);</td></tr><tr><td class="line-number" value="3894"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3895"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3896"></td><td class="line-content">Object.defineProperty(Array.prototype, "titleCase", {get:function() {</td></tr><tr><td class="line-number" value="3897"></td><td class="line-content">  return this.map(a =&gt; a.titleCase);</td></tr><tr><td class="line-number" value="3898"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3899"></td><td class="line-content">Object.defineProperty(Array.prototype, "upperCase", {get:function() {</td></tr><tr><td class="line-number" value="3900"></td><td class="line-content">  return this.map(a =&gt; a.upperCase);</td></tr><tr><td class="line-number" value="3901"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3902"></td><td class="line-content">Object.defineProperty(Array.prototype, "lowerCase", {get:function() {</td></tr><tr><td class="line-number" value="3903"></td><td class="line-content">  return this.map(a =&gt; a.lowerCase);</td></tr><tr><td class="line-number" value="3904"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3905"></td><td class="line-content">Object.defineProperty(Array.prototype, "sentenceCase", {get:function() {</td></tr><tr><td class="line-number" value="3906"></td><td class="line-content">  return this.map(a =&gt; a.sentenceCase);</td></tr><tr><td class="line-number" value="3907"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3908"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3909"></td><td class="line-content">Object.defineProperty(Array.prototype, "replaceText", {value:function(p1, p2, p3) {</td></tr><tr><td class="line-number" value="3910"></td><td class="line-content">  return this.map(a =&gt; a.replaceText(p1, p2, p3));</td></tr><tr><td class="line-number" value="3911"></td><td class="line-content">}});</td></tr><tr><td class="line-number" value="3912"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3913"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="3914"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="3915"></td><td class="line-content">let __curlyFunctions = [__curlyFunction_Or, __curlyFunction_Import, __curlyFunction_Range, __curlyFunction_S, __curlyFunction_A];</td></tr><tr><td class="line-number" value="3916"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3917"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3918"></td><td class="line-content">function __curlyFunction_Import(rootNode, thisRef, text, leftBlocks, rightBlocks, ctxInfo) {</td></tr><tr><td class="line-number" value="3919"></td><td class="line-content">  if(!text.includes(":")) return false;</td></tr><tr><td class="line-number" value="3920"></td><td class="line-content">  let match = /^import:([a-z0-9\-]+)$/.exec(text);</td></tr><tr><td class="line-number" value="3921"></td><td class="line-content">  if(!match) {</td></tr><tr><td class="line-number" value="3922"></td><td class="line-content">    return false;</td></tr><tr><td class="line-number" value="3923"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="3924"></td><td class="line-content">    let moduleName = match[1];</td></tr><tr><td class="line-number" value="3925"></td><td class="line-content">    let moduleRef = rootNode.$moduleSpace[moduleName];</td></tr><tr><td class="line-number" value="3926"></td><td class="line-content">    if( moduleRef ) {</td></tr><tr><td class="line-number" value="3927"></td><td class="line-content">      return moduleRef;</td></tr><tr><td class="line-number" value="3928"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="3929"></td><td class="line-content">      __perchanceError(`You've tried to import a generator that doesn't exist. The generator named '${__escapeHTMLSpecialChars(moduleName)}' was not found. You can see for yourself by visiting that generator: &lt;a href="/${moduleName}"&gt;${moduleName}&lt;/a&gt;. There's a &lt;a href="/useful-generators"&gt;list of useful generators&lt;/a&gt; that may help you find what you're looking for.`, ctxInfo);</td></tr><tr><td class="line-number" value="3930"></td><td class="line-content">      return `(cannot find generator '${moduleName}')`;</td></tr><tr><td class="line-number" value="3931"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3932"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3933"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3934"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3935"></td><td class="line-content">function __curlyFunction_A(rootNode, thisRef, text, leftBlocks, rightBlocks) {</td></tr><tr><td class="line-number" value="3936"></td><td class="line-content">  if(text === "a" || text === "A") {</td></tr><tr><td class="line-number" value="3937"></td><td class="line-content">    let right = __removeHtmlTagsFromBlocksArray(rightBlocks); //rightBlocks.filter(b =&gt; b.replace(/&lt;[^&gt;]+?&gt;/g, '').trim() !== "");</td></tr><tr><td class="line-number" value="3938"></td><td class="line-content">    if(right[0] === undefined || (right[0] &amp;&amp; (right[0].trim()[0] === "{"|| right[0].trim()[0] === "["))) {</td></tr><tr><td class="line-number" value="3939"></td><td class="line-content">      return text === "a" ? "{a}" : "{A}";</td></tr><tr><td class="line-number" value="3940"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="3941"></td><td class="line-content">      let aOrAn = __AvsAnSimple.query(right[0].trim().replace(/&lt;[^&gt;]+?&gt;/g, '').split(/[\s$%&amp;*@#,!=+\-.?:;'"(){}\[\]\/&lt;&gt;`~_|]/g)[0].trim());</td></tr><tr><td class="line-number" value="3942"></td><td class="line-content">      if(text === "A") {</td></tr><tr><td class="line-number" value="3943"></td><td class="line-content">        if(aOrAn === "a") aOrAn = "A";</td></tr><tr><td class="line-number" value="3944"></td><td class="line-content">        else aOrAn = "An";</td></tr><tr><td class="line-number" value="3945"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="3946"></td><td class="line-content">      return aOrAn;</td></tr><tr><td class="line-number" value="3947"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="3948"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="3949"></td><td class="line-content">    return false;</td></tr><tr><td class="line-number" value="3950"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3951"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3952"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3953"></td><td class="line-content">function __curlyFunction_Range(rootNode, thisRef, text, leftBlocks, rightBlocks) {</td></tr><tr><td class="line-number" value="3954"></td><td class="line-content">  if(!text.includes("-")) return false;</td></tr><tr><td class="line-number" value="3955"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3956"></td><td class="line-content">  let match;</td></tr><tr><td class="line-number" value="3957"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3958"></td><td class="line-content">  // TODO: written numbers: {twenty-fifty five} ?</td></tr><tr><td class="line-number" value="3959"></td><td class="line-content">  // TODO: custom increments: {0-100:0.5} ? not sure about notation yet</td></tr><tr><td class="line-number" value="3960"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3961"></td><td class="line-content">  // {1-10}</td></tr><tr><td class="line-number" value="3962"></td><td class="line-content">  match = /^([0-9]+)-([0-9]+)$/.exec(text);</td></tr><tr><td class="line-number" value="3963"></td><td class="line-content">  if(match) {</td></tr><tr><td class="line-number" value="3964"></td><td class="line-content">    let min = Number(match[1]);</td></tr><tr><td class="line-number" value="3965"></td><td class="line-content">    let max = Number(match[2]);</td></tr><tr><td class="line-number" value="3966"></td><td class="line-content">    if(min &gt; max) { [min, max] = [max, min]; }</td></tr><tr><td class="line-number" value="3967"></td><td class="line-content">    return Math.floor(Math.random() * (max - min + 1) + min); // we do not talk about what was here before</td></tr><tr><td class="line-number" value="3968"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3969"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3970"></td><td class="line-content">  // {a-z}</td></tr><tr><td class="line-number" value="3971"></td><td class="line-content">  match = /^([a-z])-([a-z])$/.exec(text);</td></tr><tr><td class="line-number" value="3972"></td><td class="line-content">  if(match) {</td></tr><tr><td class="line-number" value="3973"></td><td class="line-content">    let min = Number(match[1].charCodeAt(0));</td></tr><tr><td class="line-number" value="3974"></td><td class="line-content">    let max = Number(match[2].charCodeAt(0));</td></tr><tr><td class="line-number" value="3975"></td><td class="line-content">    if(min &gt; max) { [min, max] = [max, min]; }</td></tr><tr><td class="line-number" value="3976"></td><td class="line-content">    return String.fromCharCode( min+Math.round(Math.random()*(max-min)) );</td></tr><tr><td class="line-number" value="3977"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3978"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3979"></td><td class="line-content">  // {A-Z}</td></tr><tr><td class="line-number" value="3980"></td><td class="line-content">  match = /^([A-Z])-([A-Z])$/.exec(text);</td></tr><tr><td class="line-number" value="3981"></td><td class="line-content">  if(match) {</td></tr><tr><td class="line-number" value="3982"></td><td class="line-content">    let min = Number(match[1].charCodeAt(0));</td></tr><tr><td class="line-number" value="3983"></td><td class="line-content">    let max = Number(match[2].charCodeAt(0));</td></tr><tr><td class="line-number" value="3984"></td><td class="line-content">    if(min &gt; max) { [min, max] = [max, min]; }</td></tr><tr><td class="line-number" value="3985"></td><td class="line-content">    return String.fromCharCode( min+Math.round(Math.random()*(max-min)) );</td></tr><tr><td class="line-number" value="3986"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="3987"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3988"></td><td class="line-content">  return false;</td></tr><tr><td class="line-number" value="3989"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3990"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="3991"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3992"></td><td class="line-content">function __curlyFunction_S(rootNode, thisRef, text, leftBlocks, rightBlocks) {</td></tr><tr><td class="line-number" value="3993"></td><td class="line-content">  // there are {1..10} person{s} &lt;-- can't do this, must manually handle the 2 cases</td></tr><tr><td class="line-number" value="3994"></td><td class="line-content">  // I have {1..10} coin{s} &lt;-- can do this :)</td></tr><tr><td class="line-number" value="3995"></td><td class="line-content">  if(text === "s") {</td></tr><tr><td class="line-number" value="3996"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3997"></td><td class="line-content">    // TODO: fix this with some proper NLP to handle written numbers: "twenty five"</td></tr><tr><td class="line-number" value="3998"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="3999"></td><td class="line-content">    // search through leftBlocks backwards for the first number.</td></tr><tr><td class="line-number" value="4000"></td><td class="line-content">    // if a non-text block is found before a number is, return "{s}"</td></tr><tr><td class="line-number" value="4001"></td><td class="line-content">    for(let i = leftBlocks.length-1; i &gt;= 0; i--) {</td></tr><tr><td class="line-number" value="4002"></td><td class="line-content">      let block = leftBlocks[i];</td></tr><tr><td class="line-number" value="4003"></td><td class="line-content">      if(block[0] === "{" || block[0] === "[") {</td></tr><tr><td class="line-number" value="4004"></td><td class="line-content">        return "{s}";</td></tr><tr><td class="line-number" value="4005"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4006"></td><td class="line-content">      let numbers = block.split(/[\s,!?\-()/.]+/).filter(a =&gt; /[0-9]+/.test(a));</td></tr><tr><td class="line-number" value="4007"></td><td class="line-content">      if(numbers.length &gt; 0) {</td></tr><tr><td class="line-number" value="4008"></td><td class="line-content">        let num = Number(numbers[numbers.length-1]);</td></tr><tr><td class="line-number" value="4009"></td><td class="line-content">        return num === 1 ? "" : "s";</td></tr><tr><td class="line-number" value="4010"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4011"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4012"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4013"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="4014"></td><td class="line-content">  return false;</td></tr><tr><td class="line-number" value="4015"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4016"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="4017"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4018"></td><td class="line-content">function __curlyFunction_Or(rootNode, thisRef, text, leftBlocks, rightBlocks, ctxInfo={}) {</td></tr><tr><td class="line-number" value="4019"></td><td class="line-content">  if(!text.includes("|")) return false;</td></tr><tr><td class="line-number" value="4020"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4021"></td><td class="line-content">  // no need to evaluate the arguments. we can just extract them (with their odds)</td></tr><tr><td class="line-number" value="4022"></td><td class="line-content">  // and select a random one. We could evaluate the args but in that case it would be</td></tr><tr><td class="line-number" value="4023"></td><td class="line-content">  // important that we extract all the *arguments* first (and their odds), then</td></tr><tr><td class="line-number" value="4024"></td><td class="line-content">  // choose a random one (otherwise NEW "|" and "^" characters could end up in the evaluated text)</td></tr><tr><td class="line-number" value="4025"></td><td class="line-content">  // and mess up our interpretation of the arguments.</td></tr><tr><td class="line-number" value="4026"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4027"></td><td class="line-content">  // pulled the bulk of this curlyFunction_Or function out into its own function for use elsewhere:</td></tr><tr><td class="line-number" value="4028"></td><td class="line-content">  let args = __splitUpCurlyOrBlock(text, ctxInfo);</td></tr><tr><td class="line-number" value="4029"></td><td class="line-content">  if(args === false) return false;</td></tr><tr><td class="line-number" value="4030"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4031"></td><td class="line-content">  // now we need to extract odds and choose a random one</td></tr><tr><td class="line-number" value="4032"></td><td class="line-content">  // note that in curly "or" notation, *spaces matter* before and after the text.</td></tr><tr><td class="line-number" value="4033"></td><td class="line-content">  // thus we don't trim the string after extracting the odds.</td></tr><tr><td class="line-number" value="4034"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4035"></td><td class="line-content">  return __chooseRandomTextByOdds(rootNode, thisRef, args);</td></tr><tr><td class="line-number" value="4036"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4037"></td><td class="line-content">  // TODO: sort out Array.toString</td></tr><tr><td class="line-number" value="4038"></td><td class="line-content">  // LOOK AT Array.toString definition - try to extract out a common function</td></tr><tr><td class="line-number" value="4039"></td><td class="line-content">  // (or you could just call) .toString on `parts` lol</td></tr><tr><td class="line-number" value="4040"></td><td class="line-content">  // hmm. Array.toString relies on window.root being available which isn't great.</td></tr><tr><td class="line-number" value="4041"></td><td class="line-content">  // I think first step is to test whether it works, then extract out as much as I</td></tr><tr><td class="line-number" value="4042"></td><td class="line-content">  // can into functions. Array.toString is more of a handy hack - I don't want to rely</td></tr><tr><td class="line-number" value="4043"></td><td class="line-content">  // on it if I can help it.</td></tr><tr><td class="line-number" value="4044"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4045"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4046"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="4047"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4048"></td><td class="line-content">function __splitUpCurlyOrBlock(text, ctxInfo={}) {</td></tr><tr><td class="line-number" value="4049"></td><td class="line-content">  // note this returns false if it's not a valid curly OR block.</td></tr><tr><td class="line-number" value="4050"></td><td class="line-content">  // also, it expects that the outer curly brackets have already been removed</td></tr><tr><td class="line-number" value="4051"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4052"></td><td class="line-content">  // the easiest way to be find all the unescaped "|" characters is to split it</td></tr><tr><td class="line-number" value="4053"></td><td class="line-content">  // up and then search through *only text blocks*:</td></tr><tr><td class="line-number" value="4054"></td><td class="line-content">  let blocks = __splitTextAtAllBlocks(text, ctxInfo);</td></tr><tr><td class="line-number" value="4055"></td><td class="line-content">  let args = [];</td></tr><tr><td class="line-number" value="4056"></td><td class="line-content">  let currentArg = "";</td></tr><tr><td class="line-number" value="4057"></td><td class="line-content">  for(let j = 0; j &lt; blocks.length; j++) {</td></tr><tr><td class="line-number" value="4058"></td><td class="line-content">    let block = blocks[j];</td></tr><tr><td class="line-number" value="4059"></td><td class="line-content">    if(block[0] !== "{" &amp;&amp; block[0] !== "[") {</td></tr><tr><td class="line-number" value="4060"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4061"></td><td class="line-content">      let escaped = false;</td></tr><tr><td class="line-number" value="4062"></td><td class="line-content">      for(let i = 0; i &lt; block.length; i++) {</td></tr><tr><td class="line-number" value="4063"></td><td class="line-content">        if(i === 0) {</td></tr><tr><td class="line-number" value="4064"></td><td class="line-content">          // if we're at the start of the block, it's not escaped:</td></tr><tr><td class="line-number" value="4065"></td><td class="line-content">          escaped = false;</td></tr><tr><td class="line-number" value="4066"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="4067"></td><td class="line-content">          // if we're not at start, it's not escaped if the last char wasn't a backslash:</td></tr><tr><td class="line-number" value="4068"></td><td class="line-content">          if(block[i-1] !== "\\") { escaped = false; }</td></tr><tr><td class="line-number" value="4069"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4070"></td><td class="line-content">        // toggle escapedness at each consecutive backslash:</td></tr><tr><td class="line-number" value="4071"></td><td class="line-content">        if(block[i] === "\\") { escaped = !escaped; }</td></tr><tr><td class="line-number" value="4072"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4073"></td><td class="line-content">        if(block[i] === "|" &amp;&amp; !escaped) {</td></tr><tr><td class="line-number" value="4074"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4075"></td><td class="line-content">          currentArg += block.substr(0,i);</td></tr><tr><td class="line-number" value="4076"></td><td class="line-content">          args.push(currentArg);</td></tr><tr><td class="line-number" value="4077"></td><td class="line-content">          currentArg = "";</td></tr><tr><td class="line-number" value="4078"></td><td class="line-content">          block = block.substr(i+1);</td></tr><tr><td class="line-number" value="4079"></td><td class="line-content">          i = -1; // will get incremented to zero on loop</td></tr><tr><td class="line-number" value="4080"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4081"></td><td class="line-content">        } else if(i === block.length-1) {</td></tr><tr><td class="line-number" value="4082"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4083"></td><td class="line-content">          currentArg += block;</td></tr><tr><td class="line-number" value="4084"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4085"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4086"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4087"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4088"></td><td class="line-content">      if(j === blocks.length-1) {</td></tr><tr><td class="line-number" value="4089"></td><td class="line-content">        args.push(currentArg);</td></tr><tr><td class="line-number" value="4090"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4091"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4092"></td><td class="line-content">    } else {</td></tr><tr><td class="line-number" value="4093"></td><td class="line-content">      currentArg += block;</td></tr><tr><td class="line-number" value="4094"></td><td class="line-content">      if(j === blocks.length-1) {</td></tr><tr><td class="line-number" value="4095"></td><td class="line-content">        args.push(currentArg);</td></tr><tr><td class="line-number" value="4096"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4097"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4098"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="4099"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4100"></td><td class="line-content">  if(args.length === 0 || args.length === 1) {</td></tr><tr><td class="line-number" value="4101"></td><td class="line-content">    // this is not the correct curly function to interpret this curly block</td></tr><tr><td class="line-number" value="4102"></td><td class="line-content">    return false;</td></tr><tr><td class="line-number" value="4103"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="4104"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4105"></td><td class="line-content">  return args;</td></tr><tr><td class="line-number" value="4106"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4107"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="4108"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4109"></td><td class="line-content">function __chooseRandomTextByOdds(rootNode, thisRef, textArray, ctxInfo={}) {</td></tr><tr><td class="line-number" value="4110"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4111"></td><td class="line-content">  // extract odds</td></tr><tr><td class="line-number" value="4112"></td><td class="line-content">  let items = [];</td></tr><tr><td class="line-number" value="4113"></td><td class="line-content">  for(let text of textArray) {</td></tr><tr><td class="line-number" value="4114"></td><td class="line-content">    text = text+""; // cast to string (needed for Array.toString);</td></tr><tr><td class="line-number" value="4115"></td><td class="line-content">    let odds, textWithoutOdds;</td></tr><tr><td class="line-number" value="4116"></td><td class="line-content">    let details = __getTextOddsDetails(text);</td></tr><tr><td class="line-number" value="4117"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4118"></td><td class="line-content">    // TODO: fix this up to suit the new way of doign things</td></tr><tr><td class="line-number" value="4119"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4120"></td><td class="line-content">    if(!details) {</td></tr><tr><td class="line-number" value="4121"></td><td class="line-content">      textWithoutOdds = text;</td></tr><tr><td class="line-number" value="4122"></td><td class="line-content">      odds = 1;</td></tr><tr><td class="line-number" value="4123"></td><td class="line-content">      items.push({text:textWithoutOdds, odds});</td></tr><tr><td class="line-number" value="4124"></td><td class="line-content">      continue;</td></tr><tr><td class="line-number" value="4125"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4126"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4127"></td><td class="line-content">    textWithoutOdds = details.textWithoutOdds;</td></tr><tr><td class="line-number" value="4128"></td><td class="line-content">    odds = details.odds;</td></tr><tr><td class="line-number" value="4129"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4130"></td><td class="line-content">    if(typeof odds === 'string' &amp;&amp; (odds[0] === "[" || /[0-9]/.test(odds[0]) )) { // if it's a dynamic odds expression:</td></tr><tr><td class="line-number" value="4131"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4132"></td><td class="line-content">      let evaluatedOdds = __oddsTextToNumber(rootNode, thisRef, odds);</td></tr><tr><td class="line-number" value="4133"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4134"></td><td class="line-content">      if(evaluatedOdds &lt; 0) {</td></tr><tr><td class="line-number" value="4135"></td><td class="line-content">        __perchanceError(`The dynamic odds expression "${__escapeHTMLSpecialChars(odds)}" in ${__escapeHTMLSpecialChars("{"+textArray.join("|")+"}")} resolved to a *negative* number. Odds must be positive numbers, since it doesn't make sense for something to have a negative chance of being selected. Remember that you can try executing this odds expression in the console (bottom-left panel in the editor interface) and see what it yeilds. Also remember that "^" is a special character that is used to declare the probability that the item will be selected, and if you want to use it as a literal character (i.e. not to declare odds), then you need to put a "backslash" before it like so: "\\^"`, ctxInfo);</td></tr><tr><td class="line-number" value="4136"></td><td class="line-content">        return false;</td></tr><tr><td class="line-number" value="4137"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4138"></td><td class="line-content">      if(evaluatedOdds === false) {</td></tr><tr><td class="line-number" value="4139"></td><td class="line-content">        __perchanceError(`The dynamic odds expression "${__escapeHTMLSpecialChars(odds)}" in ${__escapeHTMLSpecialChars("{"+textArray.join("|")+"}")} didn't resolve to a number. Remember that you can try executing this odds expression in the console (bottom-left panel in the editor interface) and see what it yeilds. Also remember that "^" is a special character that is used to declare the probability that the item will be selected, and if you want to use it as a literal character (i.e. not to declare odds), then you need to put a "backslash" before it like so: "\\^"`, ctxInfo);</td></tr><tr><td class="line-number" value="4140"></td><td class="line-content">        return false;</td></tr><tr><td class="line-number" value="4141"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4142"></td><td class="line-content">      odds = evaluatedOdds;</td></tr><tr><td class="line-number" value="4143"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4144"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4145"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4146"></td><td class="line-content">    items.push({text:textWithoutOdds, odds});</td></tr><tr><td class="line-number" value="4147"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4148"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="4149"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4150"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4151"></td><td class="line-content">  // select one based on odds</td></tr><tr><td class="line-number" value="4152"></td><td class="line-content">  let oddsSum = 0;</td></tr><tr><td class="line-number" value="4153"></td><td class="line-content">  let oddsArray = [];</td></tr><tr><td class="line-number" value="4154"></td><td class="line-content">  for(let item of items) {</td></tr><tr><td class="line-number" value="4155"></td><td class="line-content">    oddsSum += item.odds;</td></tr><tr><td class="line-number" value="4156"></td><td class="line-content">    oddsArray.push(item.odds);</td></tr><tr><td class="line-number" value="4157"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="4158"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4159"></td><td class="line-content">  if(items.length === 0) {</td></tr><tr><td class="line-number" value="4160"></td><td class="line-content">    console.warn(`Warning: Tried to get random selection from an empty array?`);</td></tr><tr><td class="line-number" value="4161"></td><td class="line-content">    return "";</td></tr><tr><td class="line-number" value="4162"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="4163"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4164"></td><td class="line-content">  // choose random position in oddsSum range</td></tr><tr><td class="line-number" value="4165"></td><td class="line-content">  let oddsSumStopPoint = oddsSum*Math.random();</td></tr><tr><td class="line-number" value="4166"></td><td class="line-content">  let selectedItem;</td></tr><tr><td class="line-number" value="4167"></td><td class="line-content">  let oddsSumForChoice = 0;</td></tr><tr><td class="line-number" value="4168"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4169"></td><td class="line-content">  for(let i = 0; i &lt; items.length; i++) {</td></tr><tr><td class="line-number" value="4170"></td><td class="line-content">    oddsSumForChoice += oddsArray[i];</td></tr><tr><td class="line-number" value="4171"></td><td class="line-content">    if(oddsSumForChoice &gt;= oddsSumStopPoint) {</td></tr><tr><td class="line-number" value="4172"></td><td class="line-content">      selectedItem = items[i];</td></tr><tr><td class="line-number" value="4173"></td><td class="line-content">      break;</td></tr><tr><td class="line-number" value="4174"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4175"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="4176"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4177"></td><td class="line-content">  return selectedItem.text;</td></tr><tr><td class="line-number" value="4178"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4179"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="4180"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4181"></td><td class="line-content">// doesn't need to be perfect! just a rough clean to help the {a/A} blocks</td></tr><tr><td class="line-number" value="4182"></td><td class="line-content">function __removeHtmlTagsFromBlocksArray(blocks) {</td></tr><tr><td class="line-number" value="4183"></td><td class="line-content">  const joinTag = "sdoxci892387uoooJOINoooTAGooohkdsiyygjd970sjgs";</td></tr><tr><td class="line-number" value="4184"></td><td class="line-content">  let str = blocks.join(joinTag);</td></tr><tr><td class="line-number" value="4185"></td><td class="line-content">  let charArr = str.split("");</td></tr><tr><td class="line-number" value="4186"></td><td class="line-content">  let inTag = false;</td></tr><tr><td class="line-number" value="4187"></td><td class="line-content">  for(let i = 0; i &lt; charArr.length; i++) {</td></tr><tr><td class="line-number" value="4188"></td><td class="line-content">    if(charArr[i] === "&lt;" &amp;&amp; !inTag) {</td></tr><tr><td class="line-number" value="4189"></td><td class="line-content">      inTag = true;</td></tr><tr><td class="line-number" value="4190"></td><td class="line-content">      charArr[i] = "";</td></tr><tr><td class="line-number" value="4191"></td><td class="line-content">    } else if(charArr[i] === "&gt;" &amp;&amp; inTag) {</td></tr><tr><td class="line-number" value="4192"></td><td class="line-content">      inTag = false;</td></tr><tr><td class="line-number" value="4193"></td><td class="line-content">      charArr[i] = "";</td></tr><tr><td class="line-number" value="4194"></td><td class="line-content">    } else if(inTag) {</td></tr><tr><td class="line-number" value="4195"></td><td class="line-content">      charArr[i] = "";</td></tr><tr><td class="line-number" value="4196"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4197"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="4198"></td><td class="line-content">  return charArr.join("").split(joinTag).filter(c =&gt; c.trim() !== "");</td></tr><tr><td class="line-number" value="4199"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="4200"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4201"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span> </td></tr><tr><td class="line-number" value="4202"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4203"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="4204"></td><td class="line-content">    window.____DO_NOT_USE_VARIABLES_WITH_MULTIPLE_UNDERSCORES_AT_START = "they're engine-internal variables and if you use them your code may break when the engine is updated";</td></tr><tr><td class="line-number" value="4205"></td><td class="line-content">    let ___alreadyAttachedSaveHandler = false;</td></tr><tr><td class="line-number" value="4206"></td><td class="line-content">    let ___postMessagesRecieved = 0;</td></tr><tr><td class="line-number" value="4207"></td><td class="line-content">    let ___isFirstUpdate = true; // NOTE: this is for `___updateOutput` calls, not `update` calls</td></tr><tr><td class="line-number" value="4208"></td><td class="line-content">    window.moduleSpace = {}; // NOTE: people are using this in their generators, so you can't change/remove it.</td></tr><tr><td class="line-number" value="4209"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4210"></td><td class="line-content">    {</td></tr><tr><td class="line-number" value="4211"></td><td class="line-content">      // Make href="#foo" links have .href prop that behaves like "/foo" ones (RE weird/inconsistent behavior of &lt;base target="_parent"&gt; for #foo links):</td></tr><tr><td class="line-number" value="4212"></td><td class="line-content">      const originalHrefGetter = Object.getOwnPropertyDescriptor(HTMLAnchorElement.prototype, 'href').get;</td></tr><tr><td class="line-number" value="4213"></td><td class="line-content">      Object.defineProperty(HTMLAnchorElement.prototype, 'href', {</td></tr><tr><td class="line-number" value="4214"></td><td class="line-content">        get: function() {</td></tr><tr><td class="line-number" value="4215"></td><td class="line-content">          const originalHref = originalHrefGetter.call(this);</td></tr><tr><td class="line-number" value="4216"></td><td class="line-content">          if(this.getAttribute("href").startsWith("#")) {</td></tr><tr><td class="line-number" value="4217"></td><td class="line-content">            let url = new URL(window.location.href);</td></tr><tr><td class="line-number" value="4218"></td><td class="line-content">            url.hostname = "perchance.org";</td></tr><tr><td class="line-number" value="4219"></td><td class="line-content">            url.search = "";</td></tr><tr><td class="line-number" value="4220"></td><td class="line-content">            url.hash = this.getAttribute("href");</td></tr><tr><td class="line-number" value="4221"></td><td class="line-content">            return url.href;</td></tr><tr><td class="line-number" value="4222"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="4223"></td><td class="line-content">            return originalHref;</td></tr><tr><td class="line-number" value="4224"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4225"></td><td class="line-content">        },</td></tr><tr><td class="line-number" value="4226"></td><td class="line-content">        configurable: true,</td></tr><tr><td class="line-number" value="4227"></td><td class="line-content">        enumerable: true</td></tr><tr><td class="line-number" value="4228"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="4229"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4230"></td><td class="line-content">      // listen to parent telling us to change hash:</td></tr><tr><td class="line-number" value="4231"></td><td class="line-content">      window.addEventListener('message', function(e) {</td></tr><tr><td class="line-number" value="4232"></td><td class="line-content">        if(e.source !== __parentWindow) return;</td></tr><tr><td class="line-number" value="4233"></td><td class="line-content">        if(e.origin !== "https://perchance.org") return;</td></tr><tr><td class="line-number" value="4234"></td><td class="line-content">        if(e.data.type === "changeHash") {</td></tr><tr><td class="line-number" value="4235"></td><td class="line-content">          if(window.location.hash !== e.data.hash) {</td></tr><tr><td class="line-number" value="4236"></td><td class="line-content">            window.location.hash = e.data.hash;</td></tr><tr><td class="line-number" value="4237"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4238"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4239"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="4240"></td><td class="line-content">      // tell parent our hash when it changes:</td></tr><tr><td class="line-number" value="4241"></td><td class="line-content">      window.addEventListener('hashchange', function() {</td></tr><tr><td class="line-number" value="4242"></td><td class="line-content">        __parentWindow.postMessage({type:"changeHash", hash:window.location.hash}, "https://perchance.org");</td></tr><tr><td class="line-number" value="4243"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="4244"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4245"></td><td class="line-content">      // tell parent when query string changes:</td></tr><tr><td class="line-number" value="4246"></td><td class="line-content">      history.__originalReplaceState = history.replaceState;</td></tr><tr><td class="line-number" value="4247"></td><td class="line-content">      history.replaceState = function(...args) {</td></tr><tr><td class="line-number" value="4248"></td><td class="line-content">        if(typeof args[2] === "string") {</td></tr><tr><td class="line-number" value="4249"></td><td class="line-content">          // fix relative URLs since they will use &lt;base&gt; which is incorrect:</td></tr><tr><td class="line-number" value="4250"></td><td class="line-content">          let url = new URL(args[2], window.location.href);</td></tr><tr><td class="line-number" value="4251"></td><td class="line-content">          if(url.pathname !== window.location.pathname) {</td></tr><tr><td class="line-number" value="4252"></td><td class="line-content">            throw new Error(`You tried to change the pathname to '${url.pathname}' with history.replaceState, but Perchance doesn't support changing the pathname with \`history.replaceState\`. The pathname must be '${window.location.pathname}'. You can only change the search/query string, and the hash. If you want to change the pathname (i.e. to navigate to a different generator), you can create a link with an href attribute, and call \`.click()\` on that link.`);</td></tr><tr><td class="line-number" value="4253"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4254"></td><td class="line-content">          args[2] = url.href;</td></tr><tr><td class="line-number" value="4255"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4256"></td><td class="line-content">        history.__originalReplaceState.apply(this, args);</td></tr><tr><td class="line-number" value="4257"></td><td class="line-content">        __parentWindow.postMessage({type:"changeUrl", search:window.location.search, hash:window.location.hash}, "https://perchance.org");</td></tr><tr><td class="line-number" value="4258"></td><td class="line-content">      };</td></tr><tr><td class="line-number" value="4259"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="4260"></td><td class="line-content">      // tell parent when page title or favicon changes:</td></tr><tr><td class="line-number" value="4261"></td><td class="line-content">      function getFaviconHref() {</td></tr><tr><td class="line-number" value="4262"></td><td class="line-content">        const favicon = document.querySelector('link[rel="icon"], link[rel="shortcut icon"]');</td></tr><tr><td class="line-number" value="4263"></td><td class="line-content">        return favicon ? favicon.href : null;</td></tr><tr><td class="line-number" value="4264"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4265"></td><td class="line-content">      let currentFaviconHref = getFaviconHref();</td></tr><tr><td class="line-number" value="4266"></td><td class="line-content">      let currentTitle = document.title;</td></tr><tr><td class="line-number" value="4267"></td><td class="line-content">      const observer = new MutationObserver((mutations) =&gt; {</td></tr><tr><td class="line-number" value="4268"></td><td class="line-content">        if(document.title !== currentTitle) {</td></tr><tr><td class="line-number" value="4269"></td><td class="line-content">          __parentWindow.postMessage({type:"changePageTitle", pageTitle:document.title}, "https://perchance.org");</td></tr><tr><td class="line-number" value="4270"></td><td class="line-content">          currentTitle = document.title;</td></tr><tr><td class="line-number" value="4271"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4272"></td><td class="line-content">        const newFaviconHref = getFaviconHref();</td></tr><tr><td class="line-number" value="4273"></td><td class="line-content">        if(newFaviconHref !== currentFaviconHref) {</td></tr><tr><td class="line-number" value="4274"></td><td class="line-content">          __parentWindow.postMessage({type:"changeFavicon", href:newFaviconHref}, "https://perchance.org");</td></tr><tr><td class="line-number" value="4275"></td><td class="line-content">          currentFaviconHref = newFaviconHref;</td></tr><tr><td class="line-number" value="4276"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4277"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="4278"></td><td class="line-content">      const config = { childList: true, subtree: true, attributes:true, attributeFilter:["href"] };</td></tr><tr><td class="line-number" value="4279"></td><td class="line-content">      observer.observe(document.head, config);</td></tr><tr><td class="line-number" value="4280"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4281"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4282"></td><td class="line-content">    async function ___updateOutput(outputTemplate) {</td></tr><tr><td class="line-number" value="4283"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4284"></td><td class="line-content">      document.querySelector("#output-container").innerHTML = outputTemplate;</td></tr><tr><td class="line-number" value="4285"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4286"></td><td class="line-content">      // We need to get the MutationObserver to ignore all of the nodes we just added because</td></tr><tr><td class="line-number" value="4287"></td><td class="line-content">      // the MutationObserver is just for "dynamically added" nodes (i.e. added with custom javascript),</td></tr><tr><td class="line-number" value="4288"></td><td class="line-content">      // and the nodes that we just added will be rendered by the `update()` function, of course.</td></tr><tr><td class="line-number" value="4289"></td><td class="line-content">      // (we wouldn't actually need to do this if this function weren't async)</td></tr><tr><td class="line-number" value="4290"></td><td class="line-content">      let allNewTextNodes = ___getAllTextNodeDescendents(document.querySelector("#output-container")); // this function adds the text nodes to the `allTextNodes` array</td></tr><tr><td class="line-number" value="4291"></td><td class="line-content">      for(let textNode of allNewTextNodes) {</td></tr><tr><td class="line-number" value="4292"></td><td class="line-content">        textNode.___alreadyRenderedPerchanceCode = true; // note that we haven't actually rendered it yet, but we're just about to (need to get in before MutationObserver, since this function is async)</td></tr><tr><td class="line-number" value="4293"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4294"></td><td class="line-content">      // Need to do the same for attributes:</td></tr><tr><td class="line-number" value="4295"></td><td class="line-content">      for(let el of Array.from(document.querySelectorAll("#output-container *"))) {</td></tr><tr><td class="line-number" value="4296"></td><td class="line-content">        for(let attr of Array.from(el.attributes)) {</td></tr><tr><td class="line-number" value="4297"></td><td class="line-content">          attr.___alreadyRenderedPerchanceCode = true;</td></tr><tr><td class="line-number" value="4298"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4299"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4300"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4301"></td><td class="line-content">      ___templatedNodes = [];</td></tr><tr><td class="line-number" value="4302"></td><td class="line-content">      ___addNodeTemplates(document.querySelector("#output-container"));</td></tr><tr><td class="line-number" value="4303"></td><td class="line-content">      for(let element of Array.from(document.querySelectorAll("#output-container *"))) {</td></tr><tr><td class="line-number" value="4304"></td><td class="line-content">        ___reAttachDomElementEventsWithRoot(element);</td></tr><tr><td class="line-number" value="4305"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4306"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4307"></td><td class="line-content">      let capturedDomContentLoadedHandlers = [];</td></tr><tr><td class="line-number" value="4308"></td><td class="line-content">      const originalDocumentAddEventListener = document.addEventListener.bind(document);</td></tr><tr><td class="line-number" value="4309"></td><td class="line-content">      document.addEventListener = function(name, ...args) {</td></tr><tr><td class="line-number" value="4310"></td><td class="line-content">        if(typeof name === "string" &amp;&amp; name.toLowerCase() === "domcontentloaded") {</td></tr><tr><td class="line-number" value="4311"></td><td class="line-content">          capturedDomContentLoadedHandlers.push(args[0]);</td></tr><tr><td class="line-number" value="4312"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="4313"></td><td class="line-content">          originalDocumentAddEventListener(name, ...args);</td></tr><tr><td class="line-number" value="4314"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4315"></td><td class="line-content">      };</td></tr><tr><td class="line-number" value="4316"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4317"></td><td class="line-content">      let capturedWindowLoadHandlers = [];</td></tr><tr><td class="line-number" value="4318"></td><td class="line-content">      const originalWindowAddEventListener = window.addEventListener.bind(window);</td></tr><tr><td class="line-number" value="4319"></td><td class="line-content">      window.addEventListener = function(name, ...args) {</td></tr><tr><td class="line-number" value="4320"></td><td class="line-content">        if(typeof name === "string" &amp;&amp; name.toLowerCase() === "load") {</td></tr><tr><td class="line-number" value="4321"></td><td class="line-content">          capturedWindowLoadHandlers.push(args[0]);</td></tr><tr><td class="line-number" value="4322"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="4323"></td><td class="line-content">          originalWindowAddEventListener(name, ...args);</td></tr><tr><td class="line-number" value="4324"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4325"></td><td class="line-content">      };</td></tr><tr><td class="line-number" value="4326"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4327"></td><td class="line-content">      // needed to robustly detect if user's onload has ran (see below)</td></tr><tr><td class="line-number" value="4328"></td><td class="line-content">      let windowOnLoadAlreadyFiredBeforeUserCode = !!window.__windowOnLoadAlreadyFired;</td></tr><tr><td class="line-number" value="4329"></td><td class="line-content">      delete window.__windowOnLoadAlreadyFired;</td></tr><tr><td class="line-number" value="4330"></td><td class="line-content">      let dummyOnloadRan = false;</td></tr><tr><td class="line-number" value="4331"></td><td class="line-content">      let dummyOnload = function() { console.debug("dummyOnloadRan"); dummyOnloadRan = true; };</td></tr><tr><td class="line-number" value="4332"></td><td class="line-content">      window.onload = dummyOnload;</td></tr><tr><td class="line-number" value="4333"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4334"></td><td class="line-content">      let { scriptTextContentsArray } = await ___executeScriptTags();</td></tr><tr><td class="line-number" value="4335"></td><td class="line-content">      update();</td></tr><tr><td class="line-number" value="4336"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4337"></td><td class="line-content">      // TODO: make fake event objects for all the calls below?</td></tr><tr><td class="line-number" value="4338"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="4339"></td><td class="line-content">      await new Promise(r =&gt; setTimeout(r, 1)); // seems to be required to wait for inline module scripts to start executing (not necessarily finish, since they can have top-level await)</td></tr><tr><td class="line-number" value="4340"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4341"></td><td class="line-content">      for(let fn of capturedDomContentLoadedHandlers) {</td></tr><tr><td class="line-number" value="4342"></td><td class="line-content">        try { fn.bind(document)(); } catch(e) { console.error("An error occurred in a DOMContentLoaded handler:", e); }</td></tr><tr><td class="line-number" value="4343"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4344"></td><td class="line-content">      document.addEventListener = originalDocumentAddEventListener;</td></tr><tr><td class="line-number" value="4345"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4346"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4347"></td><td class="line-content">      function runCapturedWindowLoadHandlers() {</td></tr><tr><td class="line-number" value="4348"></td><td class="line-content">        for(let fn of capturedWindowLoadHandlers) {</td></tr><tr><td class="line-number" value="4349"></td><td class="line-content">          try { fn.bind(window)(); } catch(e) { console.error("An error occurred in a window 'load' event handler:", e); }</td></tr><tr><td class="line-number" value="4350"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4351"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4352"></td><td class="line-content">      function runWindowOnLoad() {</td></tr><tr><td class="line-number" value="4353"></td><td class="line-content">        try {</td></tr><tr><td class="line-number" value="4354"></td><td class="line-content">          if(typeof window.onload == "function" &amp;&amp; window.onload === document.body.onload) {</td></tr><tr><td class="line-number" value="4355"></td><td class="line-content">            // hacky heuristic, since outer block scope of script tags (due to perchance's `with` stuff) causes `function onload(){}` to "hoist into" being effectively a `var` declaration which is equivalent to `window.onload = function(){}`, which means it'd get incorrectly executed during page load.</td></tr><tr><td class="line-number" value="4356"></td><td class="line-content">            // i should really check dependencies too, but they shouldn't really be using this anyway (should use addEventListener) so false positive 'blocks' of this function are better than false negatives.</td></tr><tr><td class="line-number" value="4357"></td><td class="line-content">            if(scriptTextContentsArray.some(s =&gt; /window.onload\s*=\s*(function\s*\(|\(.+?\)\s*=&gt;\s*)/s.test(s))) {</td></tr><tr><td class="line-number" value="4358"></td><td class="line-content">              window.onload();</td></tr><tr><td class="line-number" value="4359"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="4360"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4361"></td><td class="line-content">        } catch(e) { console.error(e); }</td></tr><tr><td class="line-number" value="4362"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4363"></td><td class="line-content">      if(document.readyState == 'complete') {</td></tr><tr><td class="line-number" value="4364"></td><td class="line-content">        runCapturedWindowLoadHandlers();</td></tr><tr><td class="line-number" value="4365"></td><td class="line-content">        // readyState is 'complete', so window.onload has already been executed, but in case it ran before this script tag, or before our dummy one (and not the user one - which may have been set slightly too late), we run the user one:</td></tr><tr><td class="line-number" value="4366"></td><td class="line-content">        if(windowOnLoadAlreadyFiredBeforeUserCode || (dummyOnloadRan &amp;&amp; window.onload !== dummyOnload)) {</td></tr><tr><td class="line-number" value="4367"></td><td class="line-content">          runWindowOnLoad();</td></tr><tr><td class="line-number" value="4368"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4369"></td><td class="line-content">        window.addEventListener = originalWindowAddEventListener;</td></tr><tr><td class="line-number" value="4370"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="4371"></td><td class="line-content">        window.addEventListener = originalWindowAddEventListener; // must come *before* the below call</td></tr><tr><td class="line-number" value="4372"></td><td class="line-content">        window.addEventListener('load', function() {</td></tr><tr><td class="line-number" value="4373"></td><td class="line-content">          runCapturedWindowLoadHandlers();</td></tr><tr><td class="line-number" value="4374"></td><td class="line-content">          // no need to call runWindowOnLoad here because browser will do it.</td></tr><tr><td class="line-number" value="4375"></td><td class="line-content">        });</td></tr><tr><td class="line-number" value="4376"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4377"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4378"></td><td class="line-content">      // emulate url hash/anchor scroll (it happens *after* scripts are executed - in Chrome at least):</td></tr><tr><td class="line-number" value="4379"></td><td class="line-content">      if(___isFirstUpdate) {</td></tr><tr><td class="line-number" value="4380"></td><td class="line-content">        try {</td></tr><tr><td class="line-number" value="4381"></td><td class="line-content">          const hash = window.location.hash.slice(1);</td></tr><tr><td class="line-number" value="4382"></td><td class="line-content">          if(hash) {</td></tr><tr><td class="line-number" value="4383"></td><td class="line-content">            const element = document.getElementById(hash);</td></tr><tr><td class="line-number" value="4384"></td><td class="line-content">            if(element) element.scrollIntoView({behavior:'auto'}); // 'auto' uses computed value of `scroll-behavior`, which is correct</td></tr><tr><td class="line-number" value="4385"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4386"></td><td class="line-content">        } catch(e) {</td></tr><tr><td class="line-number" value="4387"></td><td class="line-content">          console.error(e);</td></tr><tr><td class="line-number" value="4388"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4389"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4390"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4391"></td><td class="line-content">      try {</td></tr><tr><td class="line-number" value="4392"></td><td class="line-content">        const favicon = document.querySelector('link[rel="icon"], link[rel="shortcut icon"]');</td></tr><tr><td class="line-number" value="4393"></td><td class="line-content">        if(favicon) {</td></tr><tr><td class="line-number" value="4394"></td><td class="line-content">          __parentWindow.postMessage({type:"changeFavicon", href:favicon.href}, "https://perchance.org");</td></tr><tr><td class="line-number" value="4395"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4396"></td><td class="line-content">      } catch(e) {</td></tr><tr><td class="line-number" value="4397"></td><td class="line-content">        console.error(e);</td></tr><tr><td class="line-number" value="4398"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4399"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4400"></td><td class="line-content">      ___isFirstUpdate = false;</td></tr><tr><td class="line-number" value="4401"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4402"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4403"></td><td class="line-content">    async function ___executeScriptTags(containerSelectorOrEl = "#output-container") {</td></tr><tr><td class="line-number" value="4404"></td><td class="line-content">      let container;</td></tr><tr><td class="line-number" value="4405"></td><td class="line-content">      if(typeof containerSelectorOrEl === 'string') container = document.querySelector(containerSelectorOrEl);</td></tr><tr><td class="line-number" value="4406"></td><td class="line-content">      else container = containerSelectorOrEl;</td></tr><tr><td class="line-number" value="4407"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4408"></td><td class="line-content">      let scriptTags = [];</td></tr><tr><td class="line-number" value="4409"></td><td class="line-content">      if(container.tagName.toLowerCase() === 'script') {</td></tr><tr><td class="line-number" value="4410"></td><td class="line-content">        scriptTags = [container];</td></tr><tr><td class="line-number" value="4411"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="4412"></td><td class="line-content">        scriptTags = [...container.getElementsByTagName('script')];</td></tr><tr><td class="line-number" value="4413"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4414"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4415"></td><td class="line-content">      // filter out non-javascript scripts:</td></tr><tr><td class="line-number" value="4416"></td><td class="line-content">      scriptTags = scriptTags.filter(s =&gt; !s.type || s.type === "text/javascript" || s.type === "module");</td></tr><tr><td class="line-number" value="4417"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4418"></td><td class="line-content">      let deferredScriptTags = scriptTags.filter(s =&gt; s.defer || s.type === "module"); // note that async scripts are *not* deferred. they execute as soon as they're available, which can be immediately - e.g. if in browser cache</td></tr><tr><td class="line-number" value="4419"></td><td class="line-content">      let nonDeferredScriptTags = scriptTags.filter(s =&gt; !deferredScriptTags.includes(s));</td></tr><tr><td class="line-number" value="4420"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4421"></td><td class="line-content">      let scriptTextContentsArray = [];</td></tr><tr><td class="line-number" value="4422"></td><td class="line-content">      for (var i = 0; i &lt; nonDeferredScriptTags.length ; i++) {</td></tr><tr><td class="line-number" value="4423"></td><td class="line-content">        await ___executeScriptTag(nonDeferredScriptTags[i]);</td></tr><tr><td class="line-number" value="4424"></td><td class="line-content">        scriptTextContentsArray.push(nonDeferredScriptTags[i].textContent);</td></tr><tr><td class="line-number" value="4425"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4426"></td><td class="line-content">      for (var i = 0; i &lt; deferredScriptTags.length ; i++) {</td></tr><tr><td class="line-number" value="4427"></td><td class="line-content">        await ___executeScriptTag(deferredScriptTags[i]);</td></tr><tr><td class="line-number" value="4428"></td><td class="line-content">        scriptTextContentsArray.push(deferredScriptTags[i].textContent);</td></tr><tr><td class="line-number" value="4429"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4430"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4431"></td><td class="line-content">      return {scriptTextContentsArray};</td></tr><tr><td class="line-number" value="4432"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4433"></td><td class="line-content">    </td></tr><tr><td class="line-number" value="4434"></td><td class="line-content">    function ___getAllMatches(str, regex) {</td></tr><tr><td class="line-number" value="4435"></td><td class="line-content">      const matches = [];</td></tr><tr><td class="line-number" value="4436"></td><td class="line-content">      let m;</td></tr><tr><td class="line-number" value="4437"></td><td class="line-content">      while(1) {</td></tr><tr><td class="line-number" value="4438"></td><td class="line-content">        m = regex.exec(str);</td></tr><tr><td class="line-number" value="4439"></td><td class="line-content">        if(m) matches.push(m);</td></tr><tr><td class="line-number" value="4440"></td><td class="line-content">        else break;</td></tr><tr><td class="line-number" value="4441"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4442"></td><td class="line-content">      return matches;</td></tr><tr><td class="line-number" value="4443"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4444"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4445"></td><td class="line-content">    // For all Safari versions before 17.4:</td></tr><tr><td class="line-number" value="4446"></td><td class="line-content">    let ___withFunctionScopeFixRequired = false;</td></tr><tr><td class="line-number" value="4447"></td><td class="line-content">    try {</td></tr><tr><td class="line-number" value="4448"></td><td class="line-content">      let obj = {a7d638p364:0};</td></tr><tr><td class="line-number" value="4449"></td><td class="line-content">      with(obj) {</td></tr><tr><td class="line-number" value="4450"></td><td class="line-content">        function fn() {</td></tr><tr><td class="line-number" value="4451"></td><td class="line-content">          return a7d638p364+1;</td></tr><tr><td class="line-number" value="4452"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4453"></td><td class="line-content">        fn();</td></tr><tr><td class="line-number" value="4454"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4455"></td><td class="line-content">    } catch(e) { </td></tr><tr><td class="line-number" value="4456"></td><td class="line-content">      ___withFunctionScopeFixRequired = true;</td></tr><tr><td class="line-number" value="4457"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4458"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4459"></td><td class="line-content">    async function ___executeScriptTag(oldScript) { </td></tr><tr><td class="line-number" value="4460"></td><td class="line-content">      let parent = oldScript.parentElement;</td></tr><tr><td class="line-number" value="4461"></td><td class="line-content">      let newScript = document.createElement('script');</td></tr><tr><td class="line-number" value="4462"></td><td class="line-content">      // had to use hasAttribute instead of simple property access because firefox defaults to script.async=true for dynamically-created script tags</td></tr><tr><td class="line-number" value="4463"></td><td class="line-content">      newScript.async = oldScript.hasAttribute("async"); //oldScript.async;</td></tr><tr><td class="line-number" value="4464"></td><td class="line-content">      newScript.type = oldScript.type; </td></tr><tr><td class="line-number" value="4465"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="4466"></td><td class="line-content">      let loadPromise;</td></tr><tr><td class="line-number" value="4467"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4468"></td><td class="line-content">      let isRemoteScript = !!oldScript.src;</td></tr><tr><td class="line-number" value="4469"></td><td class="line-content">      if(isRemoteScript &amp;&amp; !newScript.async) {</td></tr><tr><td class="line-number" value="4470"></td><td class="line-content">        // since plain old script tags are blocking, we need to simulate that:</td></tr><tr><td class="line-number" value="4471"></td><td class="line-content">        loadPromise = new Promise(resolve =&gt;  {newScript.onload = resolve; newScript.onerror = resolve; });</td></tr><tr><td class="line-number" value="4472"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4473"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4474"></td><td class="line-content">      if(oldScript.src) {</td></tr><tr><td class="line-number" value="4475"></td><td class="line-content">        newScript.src = oldScript.src;</td></tr><tr><td class="line-number" value="4476"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="4477"></td><td class="line-content">        if(newScript.type === "module") {</td></tr><tr><td class="line-number" value="4478"></td><td class="line-content">          newScript.textContent = oldScript.textContent;</td></tr><tr><td class="line-number" value="4479"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="4480"></td><td class="line-content">          let scriptText = oldScript.textContent;</td></tr><tr><td class="line-number" value="4481"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4482"></td><td class="line-content">          // Apply Safari `with` statement fix if needed:</td></tr><tr><td class="line-number" value="4483"></td><td class="line-content">          if(___withFunctionScopeFixRequired) {</td></tr><tr><td class="line-number" value="4484"></td><td class="line-content">            try {</td></tr><tr><td class="line-number" value="4485"></td><td class="line-content">              let topLevelListNamesRegex = new RegExp(window.root.getSelf.getAllKeys.join("|"));</td></tr><tr><td class="line-number" value="4486"></td><td class="line-content">              if(topLevelListNamesRegex.test(scriptText)) { // only if it contains a list name - to reduce chance of introducing bugs, since regex below is not full-proof.</td></tr><tr><td class="line-number" value="4487"></td><td class="line-content">                scriptText = scriptText.replace(/(\n\s*|^\s*)(async |)function\s+([a-zA-Z0-9_$]+?)(\s*\(.*\)\s*\{)/g, "$1var $3 = $2function$4");</td></tr><tr><td class="line-number" value="4488"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="4489"></td><td class="line-content">            } catch(e) {</td></tr><tr><td class="line-number" value="4490"></td><td class="line-content">              console.error("Error while applying Safari with statement fix:", r);</td></tr><tr><td class="line-number" value="4491"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="4492"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4493"></td><td class="line-content">          </td></tr><tr><td class="line-number" value="4494"></td><td class="line-content">          if(window.__withExportDebug83748) {</td></tr><tr><td class="line-number" value="4495"></td><td class="line-content">            // We need this because block-scoped declarations (let, const, async function) get trapped by the `with` statement's block. False positives for the regex are fine (e.g. if it grabs non-variables from strings that look like declarations).</td></tr><tr><td class="line-number" value="4496"></td><td class="line-content">            let potentialTopLevelVars = ___getAllMatches(scriptText, /[\s;](?:var)\s+([^\s]+?)\s*(?:=|;)/g).map(r =&gt; r[1]);</td></tr><tr><td class="line-number" value="4497"></td><td class="line-content">            let potentialTopLevelLets = ___getAllMatches(scriptText, /[\s;](?:let)\s+([^\s]+?)\s*(?:=|;)/g).map(r =&gt; r[1]);</td></tr><tr><td class="line-number" value="4498"></td><td class="line-content">            potentialTopLevelLets.push(...___getAllMatches(scriptText, /[\s;]class\s+([^\s]+?)\s*\{/g).map(r =&gt; r[1]));</td></tr><tr><td class="line-number" value="4499"></td><td class="line-content">            let potentialTopLevelConsts = ___getAllMatches(scriptText, /[\s;](?:const)\s+([^\s]+?)\s*=/g).map(r =&gt; r[1]);</td></tr><tr><td class="line-number" value="4500"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4501"></td><td class="line-content">            // NOTE: functions are not block-scoped UNLESS in strict mode, but for now strict mode isn't possible anyway due to use of `with`.</td></tr><tr><td class="line-number" value="4502"></td><td class="line-content">            // If I uncomment the line below, I need a way to 'link' a function into the global scope without causing the problem where `function onload(){...}` would be set as `window.onload=function(){...}` which is incorrect. I.e. `var onload=function(){...}` and `window.onload=function(){...}` are NOT the same as `function onload(){...}` (latter doesn't trigger during page load).</td></tr><tr><td class="line-number" value="4503"></td><td class="line-content">            // let potentialTopLevelFunctions = ___getAllMatches(scriptText, /[\s;](?:function|async function)\*?\s+([^\s]+?)\s*\(/g).map(r =&gt; r[1]);</td></tr><tr><td class="line-number" value="4504"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4505"></td><td class="line-content">            potentialTopLevelVars = potentialTopLevelVars.filter(n =&gt; __isValidJavaScriptIdentifier(n));</td></tr><tr><td class="line-number" value="4506"></td><td class="line-content">            potentialTopLevelLets = potentialTopLevelLets.filter(n =&gt; __isValidJavaScriptIdentifier(n));</td></tr><tr><td class="line-number" value="4507"></td><td class="line-content">            potentialTopLevelConsts = potentialTopLevelConsts.filter(n =&gt; __isValidJavaScriptIdentifier(n));</td></tr><tr><td class="line-number" value="4508"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4509"></td><td class="line-content">            // We use `ReferenceError`s to determine if a variable is in scope (i.e. if it should be global), and if it is, export it into a temporary object so we can then declare it with var outside the with's block scope.</td></tr><tr><td class="line-number" value="4510"></td><td class="line-content">            // Note that the old approach of directly setting it on the window object (if no reference error) doesn't work because e.g. if user defines `function onload(){...}` within a &lt;script&gt; this 'variable exporter' will execute `window.onload=onload`, which incorrectly sets it as a window onload function (note that `function onload(){...}` is *not* the same as `window.onload=function(){...}`).</td></tr><tr><td class="line-number" value="4511"></td><td class="line-content">            let varExportCtnName = "___varExporter_"+Math.random().toString(36).substring(7)+Math.random().toString(36).substring(7);</td></tr><tr><td class="line-number" value="4512"></td><td class="line-content">            let letExportCtnName = "___letExporter_"+Math.random().toString(36).substring(7)+Math.random().toString(36).substring(7);</td></tr><tr><td class="line-number" value="4513"></td><td class="line-content">            let constExportCtnName = "___constExporter_"+Math.random().toString(36).substring(7)+Math.random().toString(36).substring(7);</td></tr><tr><td class="line-number" value="4514"></td><td class="line-content">            newScript.textContent = `</td></tr><tr><td class="line-number" value="4515"></td><td class="line-content">              let ${varExportCtnName} = {};</td></tr><tr><td class="line-number" value="4516"></td><td class="line-content">              let ${letExportCtnName} = {};</td></tr><tr><td class="line-number" value="4517"></td><td class="line-content">              let ${constExportCtnName} = {};</td></tr><tr><td class="line-number" value="4518"></td><td class="line-content">              with(window.root.___proxyTarget.withObjProxy) { // withObjProxy avoids exposing builtins like lowerCase, $imports, etc.</td></tr><tr><td class="line-number" value="4519"></td><td class="line-content">                ${scriptText};</td></tr><tr><td class="line-number" value="4520"></td><td class="line-content">                ${potentialTopLevelVars.map(n =&gt; `try { ${n}; ${varExportCtnName}["${n}"]=${n}; } catch(e) {};`).join("\n")}</td></tr><tr><td class="line-number" value="4521"></td><td class="line-content">                ${potentialTopLevelLets.map(n =&gt; `try { ${n}; ${letExportCtnName}["${n}"]=${n}; } catch(e) {};`).join("\n")}</td></tr><tr><td class="line-number" value="4522"></td><td class="line-content">                ${potentialTopLevelConsts.map(n =&gt; `try { ${n}; ${constExportCtnName}["${n}"]=${n}; } catch(e) {};`).join("\n")}</td></tr><tr><td class="line-number" value="4523"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="4524"></td><td class="line-content">              for(let key in ${varExportCtnName}) {</td></tr><tr><td class="line-number" value="4525"></td><td class="line-content">                // (1, eval) is to eval in global scope: https://stackoverflow.com/a/9107367/11950764</td></tr><tr><td class="line-number" value="4526"></td><td class="line-content">                try { (1, eval)("var "+key+" = ${varExportCtnName}['"+key+"']"); } catch(e) { console.error(e); }</td></tr><tr><td class="line-number" value="4527"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="4528"></td><td class="line-content">              // need to do let/const/class via a script tag injection, since block scope would 'trap' them, and var would incorrectly set them on window object</td></tr><tr><td class="line-number" value="4529"></td><td class="line-content">              {</td></tr><tr><td class="line-number" value="4530"></td><td class="line-content">                const constScriptEl = document.createElement('script');</td></tr><tr><td class="line-number" value="4531"></td><td class="line-content">                constScriptEl.textContent = Object.keys(${constExportCtnName}).map(key =&gt; "const "+key+" = ${constExportCtnName}['"+key+"'];").join("\\n");</td></tr><tr><td class="line-number" value="4532"></td><td class="line-content">                document.head.appendChild(constScriptEl);</td></tr><tr><td class="line-number" value="4533"></td><td class="line-content">                document.head.removeChild(constScriptEl);</td></tr><tr><td class="line-number" value="4534"></td><td class="line-content">                const letScriptEl = document.createElement('script');</td></tr><tr><td class="line-number" value="4535"></td><td class="line-content">                letScriptEl.textContent = Object.keys(${letExportCtnName}).map(key =&gt; "let "+key+" = ${letExportCtnName}['"+key+"'];").join("\\n");</td></tr><tr><td class="line-number" value="4536"></td><td class="line-content">                document.head.appendChild(letScriptEl);</td></tr><tr><td class="line-number" value="4537"></td><td class="line-content">                document.head.removeChild(letScriptEl);</td></tr><tr><td class="line-number" value="4538"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="4539"></td><td class="line-content">            `;</td></tr><tr><td class="line-number" value="4540"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="4541"></td><td class="line-content">            //newScript.textContent = "with(window.root.___proxyTarget.obj){"+scriptText+"}";</td></tr><tr><td class="line-number" value="4542"></td><td class="line-content">          // The following monstrosity replaces the above commented out line due to the fact that block-scoped declarations (let, const, async function) get trapped by the `with` statement's block. False positives for the regex are fine (e.g. if it grabs non-variables from strings that look like declarations). I'm also grabbing `function` in case I ever allow people to use strict mode (the current `with` precludes it) since in strict mode `function`s are block scoped.</td></tr><tr><td class="line-number" value="4543"></td><td class="line-content">          let potentialNewGlobalVariableNames = ___getAllMatches(scriptText, /[\s;](?:var|let|const)\s+([^\s]+?)\s*=/g).map(r =&gt; r[1]);</td></tr><tr><td class="line-number" value="4544"></td><td class="line-content">          potentialNewGlobalVariableNames.push(...___getAllMatches(scriptText, /[\s;](?:function|async function)\*?\s+([^\s]+?)\s*\(/g).map(r =&gt; r[1]));</td></tr><tr><td class="line-number" value="4545"></td><td class="line-content">          potentialNewGlobalVariableNames.push(...___getAllMatches(scriptText, /[\s;]class\s+([^\s]+?)\s*\{/g).map(r =&gt; r[1]));</td></tr><tr><td class="line-number" value="4546"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4547"></td><td class="line-content">            // notice that it checks if the variable is 'in scope' via 'eval' before 'exporting' it to the higher scope. This prevents exporting local variables.</td></tr><tr><td class="line-number" value="4548"></td><td class="line-content">            newScript.textContent = `</td></tr><tr><td class="line-number" value="4549"></td><td class="line-content">              with(window.root.___proxyTarget.obj){</td></tr><tr><td class="line-number" value="4550"></td><td class="line-content">                ${scriptText};</td></tr><tr><td class="line-number" value="4551"></td><td class="line-content">                for(let name of ${JSON.stringify(potentialNewGlobalVariableNames)}) {</td></tr><tr><td class="line-number" value="4552"></td><td class="line-content">                  try { let val = eval(name); window[name] = val; } catch(e) {}</td></tr><tr><td class="line-number" value="4553"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="4554"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="4555"></td><td class="line-content">            `;</td></tr><tr><td class="line-number" value="4556"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4557"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4558"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4559"></td><td class="line-content">      if(!newScript.type) {</td></tr><tr><td class="line-number" value="4560"></td><td class="line-content">        newScript.setAttribute('type','text/javascript');</td></tr><tr><td class="line-number" value="4561"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4562"></td><td class="line-content">      parent.insertBefore(newScript, oldScript);</td></tr><tr><td class="line-number" value="4563"></td><td class="line-content">      try { parent.removeChild(oldScript); } catch(e) {} // try catch because script tag may have e.g. executed document.body.innerHTML='';</td></tr><tr><td class="line-number" value="4564"></td><td class="line-content">      if(loadPromise) await loadPromise;</td></tr><tr><td class="line-number" value="4565"></td><td class="line-content">      return newScript;</td></tr><tr><td class="line-number" value="4566"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4567"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4568"></td><td class="line-content">    let ___templatedNodes; // REMEMBER: order is important for functions like .id()</td></tr><tr><td class="line-number" value="4569"></td><td class="line-content">    function ___addNodeTemplates(domNode) {</td></tr><tr><td class="line-number" value="4570"></td><td class="line-content">      var nodes = domNode.childNodes;</td></tr><tr><td class="line-number" value="4571"></td><td class="line-content">      for (var i = 0, m = nodes.length; i &lt; m; i++) {</td></tr><tr><td class="line-number" value="4572"></td><td class="line-content">          var n = nodes[i];</td></tr><tr><td class="line-number" value="4573"></td><td class="line-content">          if(n.nodeType !== n.TEXT_NODE &amp;&amp; n.nodeName !== "#comment") {</td></tr><tr><td class="line-number" value="4574"></td><td class="line-content">            ___templatedNodes.push( ...___addAttributeTemplateToEl(n) );</td></tr><tr><td class="line-number" value="4575"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4576"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4577"></td><td class="line-content">          if (n.nodeType == n.TEXT_NODE &amp;&amp; n.parentNode.tagName !== "SCRIPT" &amp;&amp; n.parentNode.nodeName !== "STYLE") {</td></tr><tr><td class="line-number" value="4578"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4579"></td><td class="line-content">            // we found a text node, so lets break it into an expression array</td></tr><tr><td class="line-number" value="4580"></td><td class="line-content">            // and wrap expressions in spans (the "template span")</td></tr><tr><td class="line-number" value="4581"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4582"></td><td class="line-content">            let arr = __splitTextAtAllBlocks(n.textContent);</td></tr><tr><td class="line-number" value="4583"></td><td class="line-content">            if(!arr) {</td></tr><tr><td class="line-number" value="4584"></td><td class="line-content">              __perchanceError(`Some text has caused an error with the compiler. If you can, please post a bug report with a link to your generator on &lt;a href="https://lemmy.world/c/perchance"&gt;lemmy.world/c/perchance&lt;/a&gt; to help me fix this bug. Thanks! Here's the text that caused this issue: ${__escapeHTMLSpecialChars(n.textContent)}`);</td></tr><tr><td class="line-number" value="4585"></td><td class="line-content">              return;</td></tr><tr><td class="line-number" value="4586"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="4587"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4588"></td><td class="line-content">            if(arr.length === 0) {</td></tr><tr><td class="line-number" value="4589"></td><td class="line-content">              if(n.textContent.trim() !== "") {</td></tr><tr><td class="line-number" value="4590"></td><td class="line-content">                __perchanceError(`Something's not right. Some text has caused an error with the compiler. If you can, please post a bug report with a link to your generator on &lt;a href="https://lemmy.world/c/perchance"&gt;lemmy.world/c/perchance&lt;/a&gt; to help me fix this bug. A non-empty text node resulted in an empty block array. This is probably a problem with 'splitTextAtAllBlocks'. Maybe some 'continue' statements skipping over things that they shouldn't?`);</td></tr><tr><td class="line-number" value="4591"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="4592"></td><td class="line-content">              continue;</td></tr><tr><td class="line-number" value="4593"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="4594"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4595"></td><td class="line-content">            if(arr.length &gt; 1 || arr[0][0] === "[" || arr[0][0] === "{") {</td></tr><tr><td class="line-number" value="4596"></td><td class="line-content">              //let exprSpan = document.createElement('span');</td></tr><tr><td class="line-number" value="4597"></td><td class="line-content">              // exprSpan.className = "__perchance_textnode_expression";</td></tr><tr><td class="line-number" value="4598"></td><td class="line-content">              // exprSpan.dataset.perchanceExpression = arr.join("");</td></tr><tr><td class="line-number" value="4599"></td><td class="line-content">              //exprSpan.innerText = arr.join("");</td></tr><tr><td class="line-number" value="4600"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4601"></td><td class="line-content">              //n.parentNode.insertBefore(exprSpan, n);</td></tr><tr><td class="line-number" value="4602"></td><td class="line-content">              //n.parentNode.removeChild(n);</td></tr><tr><td class="line-number" value="4603"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4604"></td><td class="line-content">              ___templatedNodes.push({oldNodes:[n], parentNode:n.parentNode, previousSibling:n.previousSibling, nextSibling:n.nextSibling, type:"textNode", text:arr.join("")});</td></tr><tr><td class="line-number" value="4605"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4606"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="4607"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4608"></td><td class="line-content">            // just regular text:</td></tr><tr><td class="line-number" value="4609"></td><td class="line-content">            if(arr.length === 1 &amp;&amp; arr[0][0] !== "[" &amp;&amp; arr[0][0] !== "{") {</td></tr><tr><td class="line-number" value="4610"></td><td class="line-content">              n.nodeValue = __processEscapedCharacters(n.nodeValue);</td></tr><tr><td class="line-number" value="4611"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="4612"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4613"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="4614"></td><td class="line-content">            ___addNodeTemplates(n);</td></tr><tr><td class="line-number" value="4615"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4616"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4617"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4618"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4619"></td><td class="line-content">    function ___collectTemplatableTextChunks(domNode, foundChunks) {</td></tr><tr><td class="line-number" value="4620"></td><td class="line-content">      if(!foundChunks) foundChunks = [];</td></tr><tr><td class="line-number" value="4621"></td><td class="line-content">      var nodes = domNode.childNodes;</td></tr><tr><td class="line-number" value="4622"></td><td class="line-content">      for (var i = 0, m = nodes.length; i &lt; m; i++) {</td></tr><tr><td class="line-number" value="4623"></td><td class="line-content">          var n = nodes[i];</td></tr><tr><td class="line-number" value="4624"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4625"></td><td class="line-content">          if(n.nodeType !== n.TEXT_NODE &amp;&amp; n.nodeName !== "#comment") {</td></tr><tr><td class="line-number" value="4626"></td><td class="line-content">            for(let attribute of Array.from(n.attributes)) {</td></tr><tr><td class="line-number" value="4627"></td><td class="line-content">              if(___isTemplatableAttributeName(attribute.name)) {</td></tr><tr><td class="line-number" value="4628"></td><td class="line-content">                // we found a templatable attribute</td></tr><tr><td class="line-number" value="4629"></td><td class="line-content">                foundChunks.push(attribute.nodeValue);</td></tr><tr><td class="line-number" value="4630"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="4631"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="4632"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4633"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4634"></td><td class="line-content">          if (n.nodeType == n.TEXT_NODE &amp;&amp; n.parentNode.tagName !== "SCRIPT" &amp;&amp; n.parentNode.nodeName !== "STYLE") {</td></tr><tr><td class="line-number" value="4635"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4636"></td><td class="line-content">            // we found a templatable text node</td></tr><tr><td class="line-number" value="4637"></td><td class="line-content">            foundChunks.push(n.textContent);</td></tr><tr><td class="line-number" value="4638"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4639"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="4640"></td><td class="line-content">            ___collectTemplatableTextChunks(n, foundChunks);</td></tr><tr><td class="line-number" value="4641"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4642"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4643"></td><td class="line-content">      return foundChunks;</td></tr><tr><td class="line-number" value="4644"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4645"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4646"></td><td class="line-content">    let ___domEventAttributeNames = new Set([</td></tr><tr><td class="line-number" value="4647"></td><td class="line-content">      ...Object.getOwnPropertyNames(document),</td></tr><tr><td class="line-number" value="4648"></td><td class="line-content">      ...Object.getOwnPropertyNames(Object.getPrototypeOf(Object.getPrototypeOf(document))),</td></tr><tr><td class="line-number" value="4649"></td><td class="line-content">      ...Object.getOwnPropertyNames(Object.getPrototypeOf(window)),</td></tr><tr><td class="line-number" value="4650"></td><td class="line-content">    ].filter(k =&gt; k.startsWith("on") &amp;&amp; (document[k] == null || typeof document[k] == "function")));</td></tr><tr><td class="line-number" value="4651"></td><td class="line-content">    </td></tr><tr><td class="line-number" value="4652"></td><td class="line-content">    function ___isDomEventAttributeName(name) {</td></tr><tr><td class="line-number" value="4653"></td><td class="line-content">      if(___domEventAttributeNames.has(name)) return true;</td></tr><tr><td class="line-number" value="4654"></td><td class="line-content">      else return false;</td></tr><tr><td class="line-number" value="4655"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4656"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4657"></td><td class="line-content">    function ___isTemplatableAttributeName(name) {</td></tr><tr><td class="line-number" value="4658"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4659"></td><td class="line-content">      // note that this *doesn't* mean that they're ignored in *generated* html (i.e. generated by perchance code)</td></tr><tr><td class="line-number" value="4660"></td><td class="line-content">      // because all of thosse strings are fully executed before being output.</td></tr><tr><td class="line-number" value="4661"></td><td class="line-content">      if(___isDomEventAttributeName(name)) { return false; }</td></tr><tr><td class="line-number" value="4662"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4663"></td><td class="line-content">      // i was previously ignoring data attributes and stuff, but I see no reason for that.</td></tr><tr><td class="line-number" value="4664"></td><td class="line-content">      // sure, someone may need to use special characters in their web component attirbutes or whatever</td></tr><tr><td class="line-number" value="4665"></td><td class="line-content">      // but they can just escape them.</td></tr><tr><td class="line-number" value="4666"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4667"></td><td class="line-content">      return true;</td></tr><tr><td class="line-number" value="4668"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4669"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4670"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4671"></td><td class="line-content">    function ___addAttributeTemplateToEl(el) {</td></tr><tr><td class="line-number" value="4672"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4673"></td><td class="line-content">      let templatableNodes = [];</td></tr><tr><td class="line-number" value="4674"></td><td class="line-content">      for(let attribute of Array.from(el.attributes)) {</td></tr><tr><td class="line-number" value="4675"></td><td class="line-content">        if(!___isTemplatableAttributeName(attribute.name)) { continue; }</td></tr><tr><td class="line-number" value="4676"></td><td class="line-content">        templatableNodes.push({el, attribute, type:"attribute"});</td></tr><tr><td class="line-number" value="4677"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4678"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4679"></td><td class="line-content">      let templatedNodes = [];</td></tr><tr><td class="line-number" value="4680"></td><td class="line-content">      for(let item of templatableNodes) { </td></tr><tr><td class="line-number" value="4681"></td><td class="line-content">        let {attribute, el} = item;</td></tr><tr><td class="line-number" value="4682"></td><td class="line-content">        let exprArr = __splitTextAtAllBlocks(attribute.nodeValue);</td></tr><tr><td class="line-number" value="4683"></td><td class="line-content">        if(!exprArr[0]) { continue; }</td></tr><tr><td class="line-number" value="4684"></td><td class="line-content">        if(exprArr &amp;&amp; (exprArr.length &gt; 1 || exprArr[0][0] === "[" || exprArr[0][0] === "{")) {</td></tr><tr><td class="line-number" value="4685"></td><td class="line-content">          item.text = attribute.nodeValue;</td></tr><tr><td class="line-number" value="4686"></td><td class="line-content">          templatedNodes.push(item);</td></tr><tr><td class="line-number" value="4687"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="4688"></td><td class="line-content">          // this attribute is just plain text - no template needed. just need to remove any escaping-backslashes</td></tr><tr><td class="line-number" value="4689"></td><td class="line-content">          attribute.nodeValue = __processEscapedCharacters(attribute.nodeValue);</td></tr><tr><td class="line-number" value="4690"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4691"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4692"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4693"></td><td class="line-content">      return templatedNodes;</td></tr><tr><td class="line-number" value="4694"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4695"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4696"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4697"></td><td class="line-content">    function ___reAttachDomElementEventsWithRoot(el) {</td></tr><tr><td class="line-number" value="4698"></td><td class="line-content">      if(el.___alreadyAttatchedEventsWithRoot) return;</td></tr><tr><td class="line-number" value="4699"></td><td class="line-content">      for(let attr of Array.from(el.attributes)) {</td></tr><tr><td class="line-number" value="4700"></td><td class="line-content">        if(___isDomEventAttributeName(attr.name)) {</td></tr><tr><td class="line-number" value="4701"></td><td class="line-content">          let fn = el[attr.name];</td></tr><tr><td class="line-number" value="4702"></td><td class="line-content">          el.removeAttribute(attr.name);</td></tr><tr><td class="line-number" value="4703"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4704"></td><td class="line-content">          // el.addEventListener(attr.name.substr(2), function(event) { // &lt;-- bad because it removes ability to write e.g. el.onchange(), and also prevents *overwriting* of the handler.</td></tr><tr><td class="line-number" value="4705"></td><td class="line-content">          el[attr.name] = function(event) {</td></tr><tr><td class="line-number" value="4706"></td><td class="line-content">            try {</td></tr><tr><td class="line-number" value="4707"></td><td class="line-content">              let fnStr = fn.toString();</td></tr><tr><td class="line-number" value="4708"></td><td class="line-content">              //fnStr = fnStr.replace("{","{ with(window.root.___proxyTarget.obj) {") + "}";</td></tr><tr><td class="line-number" value="4709"></td><td class="line-content">              if(window.__withExportDebug83748) {</td></tr><tr><td class="line-number" value="4710"></td><td class="line-content">                fnStr = fnStr.replace("{","{ with(window.root ? window.root.___proxyTarget.withObjProxy : {}) {") + "}";</td></tr><tr><td class="line-number" value="4711"></td><td class="line-content">              } else {</td></tr><tr><td class="line-number" value="4712"></td><td class="line-content">                fnStr = fnStr.replace("{","{ with(window.root || {}) {") + "}"; // need `|| {}` because error may have caused window.root to not compile, and we need to gracefully handle that</td></tr><tr><td class="line-number" value="4713"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="4714"></td><td class="line-content">              eval(`(${fnStr}).bind(this)(event)`);</td></tr><tr><td class="line-number" value="4715"></td><td class="line-content">            } catch(e) {</td></tr><tr><td class="line-number" value="4716"></td><td class="line-content">              __perchanceError(`There was an error in the &lt;b&gt;${attr.name}&lt;/b&gt; attribute of this element in your HTML panel: &lt;code&gt;${this.outerHTML.replace(/&lt;(.+?)&gt;/g, "&amp;lt;$1&amp;gt;")}&lt;/code&gt;. Here's the error: &lt;span style='color:red'&gt;${e}&lt;/span&gt;`);</td></tr><tr><td class="line-number" value="4717"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="4718"></td><td class="line-content">          };</td></tr><tr><td class="line-number" value="4719"></td><td class="line-content">          </td></tr><tr><td class="line-number" value="4720"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4721"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4722"></td><td class="line-content">      el.___alreadyAttatchedEventsWithRoot = true;</td></tr><tr><td class="line-number" value="4723"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4724"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4725"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4726"></td><td class="line-content">    function update(selectorOrEl) {</td></tr><tr><td class="line-number" value="4727"></td><td class="line-content">      // if it has been a few seconds since the error was shown, and error model isn't currently open, we can probably hide the error box so it doesn't clutter the generator UI for end-users. The dev would have clicked the error modal button before randomizing again.</td></tr><tr><td class="line-number" value="4728"></td><td class="line-content">      try {</td></tr><tr><td class="line-number" value="4729"></td><td class="line-content">        if(window.__lastPerchanceErrorTime &amp;&amp; Date.now()-window.__lastPerchanceErrorTime &gt; 1000*5 &amp;&amp; (!document.querySelector("#perchance-error-container") || document.querySelector("#perchance-error-container").offsetHeight === 0)) {</td></tr><tr><td class="line-number" value="4730"></td><td class="line-content">          __clearPerchanceErrors();</td></tr><tr><td class="line-number" value="4731"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4732"></td><td class="line-content">      } catch(e) { console.error(e); }</td></tr><tr><td class="line-number" value="4733"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="4734"></td><td class="line-content">      // _updateOutput essentially reloads the page, whereas `update` just replaces all values of the expressions</td></tr><tr><td class="line-number" value="4735"></td><td class="line-content">      ___updateTemplatedNodes(selectorOrEl); // goes through templatedNodes array *in order* (that's important)</td></tr><tr><td class="line-number" value="4736"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4737"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4738"></td><td class="line-content">    function ___htmlToElements(html) {</td></tr><tr><td class="line-number" value="4739"></td><td class="line-content">      var template = document.createElement('template');</td></tr><tr><td class="line-number" value="4740"></td><td class="line-content">      template.innerHTML = html;</td></tr><tr><td class="line-number" value="4741"></td><td class="line-content">      return Array.from(template.content.childNodes);</td></tr><tr><td class="line-number" value="4742"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4743"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4744"></td><td class="line-content">    let ___trackedNodesCreatedByTemplates = new Set();</td></tr><tr><td class="line-number" value="4745"></td><td class="line-content">    try { // putting this in try/catch because it's new code and I don't want it to break anything</td></tr><tr><td class="line-number" value="4746"></td><td class="line-content">      // if an element that was created by a square/curly block is replaced with another element *specifically using the replaceWith function*</td></tr><tr><td class="line-number" value="4747"></td><td class="line-content">      // then we want our tracking code to treat them as the 'same element' in terms of the ___updateTemplatedNodes process.</td></tr><tr><td class="line-number" value="4748"></td><td class="line-content">      // we don't do that for other ways of replacing elements (e.g. setting innerHTML) because there are valid use cases for that (e.g. comments plugin uses it to avoid update() causing comments iframe to refresh)</td></tr><tr><td class="line-number" value="4749"></td><td class="line-content">      const ___originalReplaceWith = Element.prototype.replaceWith;</td></tr><tr><td class="line-number" value="4750"></td><td class="line-content">      Element.prototype.replaceWith = function(...args) {</td></tr><tr><td class="line-number" value="4751"></td><td class="line-content">        // check if this is a node that was created by a template</td></tr><tr><td class="line-number" value="4752"></td><td class="line-content">        if(___trackedNodesCreatedByTemplates.has(this)) {</td></tr><tr><td class="line-number" value="4753"></td><td class="line-content">          for(let i = 0; i &lt; args.length; i++) { // we convert any strings/numbers/booleans since replaceWith does that automatically, but we need to get a reference to the created nodes, so we do it manually</td></tr><tr><td class="line-number" value="4754"></td><td class="line-content">            if(typeof args[i] === "string" || typeof args[i] === "number" || typeof args[i] === "boolean") {</td></tr><tr><td class="line-number" value="4755"></td><td class="line-content">              args[i] = document.createTextNode(args[i].toString());</td></tr><tr><td class="line-number" value="4756"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="4757"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4758"></td><td class="line-content">          // if so, then we need to swap the new node with the old one in the oldNodes array of each ___templatedNodes item:</td></tr><tr><td class="line-number" value="4759"></td><td class="line-content">          for(let n of ___templatedNodes) {</td></tr><tr><td class="line-number" value="4760"></td><td class="line-content">            if(n.oldNodes.includes(this)) {</td></tr><tr><td class="line-number" value="4761"></td><td class="line-content">              n.oldNodes.splice(n.oldNodes.indexOf(this), 1, ...args);</td></tr><tr><td class="line-number" value="4762"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="4763"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4764"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4765"></td><td class="line-content">        ___originalReplaceWith.apply(this, args);</td></tr><tr><td class="line-number" value="4766"></td><td class="line-content">      };</td></tr><tr><td class="line-number" value="4767"></td><td class="line-content">    } catch(e) {</td></tr><tr><td class="line-number" value="4768"></td><td class="line-content">      console.error(e);</td></tr><tr><td class="line-number" value="4769"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4770"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4771"></td><td class="line-content">    async function ___updateTemplatedNodes(selectorOrEl="") {</td></tr><tr><td class="line-number" value="4772"></td><td class="line-content">      let container;</td></tr><tr><td class="line-number" value="4773"></td><td class="line-content">      if(typeof selectorOrEl === 'string') {</td></tr><tr><td class="line-number" value="4774"></td><td class="line-content">        container = document.querySelector("#output-container "+selectorOrEl);</td></tr><tr><td class="line-number" value="4775"></td><td class="line-content">        if(!container) {</td></tr><tr><td class="line-number" value="4776"></td><td class="line-content">          __perchanceError(`It looks like you've got some code like &lt;b&gt;update('${selectorOrEl}')&lt;/b&gt; but there's no element that matches the '${selectorOrEl}' selector.`);</td></tr><tr><td class="line-number" value="4777"></td><td class="line-content">          return;</td></tr><tr><td class="line-number" value="4778"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4779"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="4780"></td><td class="line-content">        container = selectorOrEl;</td></tr><tr><td class="line-number" value="4781"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4782"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4783"></td><td class="line-content">      if(container instanceof HTMLCollection) { // i.e. they have multiple elements with the same id and they referred to it using named access: https://html.spec.whatwg.org/multipage/window-object.html#named-access-on-the-window-object</td></tr><tr><td class="line-number" value="4784"></td><td class="line-content">        __perchanceError(`It looks like you've got multiple elements in your HTML with &lt;b&gt;id=${container[0].id}&lt;/b&gt;. If you can't find any duplicates, make sure that if you've imported some HTML, the ids used in that HTML aren't the same as the ids that you're using.`);</td></tr><tr><td class="line-number" value="4785"></td><td class="line-content">        return;</td></tr><tr><td class="line-number" value="4786"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4787"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4788"></td><td class="line-content">      ___trackedNodesCreatedByTemplates.clear();</td></tr><tr><td class="line-number" value="4789"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4790"></td><td class="line-content">      // goes through attributes and text nodes in the order they were declared. (order of execution is important)</td></tr><tr><td class="line-number" value="4791"></td><td class="line-content">      for(let n of ___templatedNodes) {</td></tr><tr><td class="line-number" value="4792"></td><td class="line-content">        // NOTE THAT `n` IS NOT AN ACTUAL `Node` object - it's just an obj we created with similarly names properties which "represents" the original node (which we delete and replace)</td></tr><tr><td class="line-number" value="4793"></td><td class="line-content">        // NOTE: we can't replace spaces with &amp;nbsp or new lines with &lt;br/&gt; because they could (for example) have spaces in attributes that are generated, or (for example) in html tags that they generate. we don't want &lt;a&amp;nbsphref="http://..."&gt;...&lt;/a&gt;</td></tr><tr><td class="line-number" value="4794"></td><td class="line-content">        if(n.type === "textNode" &amp;&amp; (container.contains(n.parentNode) || container === n.parentNode)) {</td></tr><tr><td class="line-number" value="4795"></td><td class="line-content">          // remove old nodes</td></tr><tr><td class="line-number" value="4796"></td><td class="line-content">          for(let node of n.oldNodes) {</td></tr><tr><td class="line-number" value="4797"></td><td class="line-content">            try { n.parentNode.removeChild(node); } catch(e) { console.debug(e); } // we try/catch because the node may not be in the parent anymore (e.g. it may have been deleted or moved with some javascript)</td></tr><tr><td class="line-number" value="4798"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4799"></td><td class="line-content">          // create new nodes</td></tr><tr><td class="line-number" value="4800"></td><td class="line-content">          let text = __processEscapedCharacters( __evaluateText(window.root, window.root, n.text, {declarationLineNumber:null}) );</td></tr><tr><td class="line-number" value="4801"></td><td class="line-content">          let newNodes = ___htmlToElements(text);</td></tr><tr><td class="line-number" value="4802"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4803"></td><td class="line-content">          // These node additions will trigger our MutationObserver (that we need for monitoring "dynamically added" nodes (i.e. nodes added with "raw" javascript) to the page so we can render them)</td></tr><tr><td class="line-number" value="4804"></td><td class="line-content">          // so we need to mark them all as "already rendered" (because they could have originally-escaped curly/square blocks which would then be seen as unescaped ones if they were "rendered" again)</td></tr><tr><td class="line-number" value="4805"></td><td class="line-content">          let allNewTextNodes = newNodes.filter(n =&gt; n.nodeType === Node.TEXT_NODE);</td></tr><tr><td class="line-number" value="4806"></td><td class="line-content">          for(let newNode of newNodes) {</td></tr><tr><td class="line-number" value="4807"></td><td class="line-content">            ___getAllTextNodeDescendents(newNode, allNewTextNodes); // this function adds the text nodes to the `allTextNodes` array</td></tr><tr><td class="line-number" value="4808"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4809"></td><td class="line-content">          for(let textNode of allNewTextNodes) {</td></tr><tr><td class="line-number" value="4810"></td><td class="line-content">            textNode.___alreadyRenderedPerchanceCode = true;</td></tr><tr><td class="line-number" value="4811"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4812"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4813"></td><td class="line-content">          // insert new nodes</td></tr><tr><td class="line-number" value="4814"></td><td class="line-content">          for(let node of newNodes) {</td></tr><tr><td class="line-number" value="4815"></td><td class="line-content">            // add it before the next sibling (if there is no next sibling, then it's the last one, so we just append)</td></tr><tr><td class="line-number" value="4816"></td><td class="line-content">            if(n.nextSibling &amp;&amp; n.parentNode.contains(n.nextSibling)) n.parentNode.insertBefore(node, n.nextSibling);</td></tr><tr><td class="line-number" value="4817"></td><td class="line-content">            else n.parentNode.appendChild(node);</td></tr><tr><td class="line-number" value="4818"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4819"></td><td class="line-content">            ___trackedNodesCreatedByTemplates.add(node);</td></tr><tr><td class="line-number" value="4820"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4821"></td><td class="line-content">          n.oldNodes = newNodes;</td></tr><tr><td class="line-number" value="4822"></td><td class="line-content">          // execute script tags:</td></tr><tr><td class="line-number" value="4823"></td><td class="line-content">          for(let i = 0; i &lt; newNodes.length; i++) {</td></tr><tr><td class="line-number" value="4824"></td><td class="line-content">            if(newNodes[i].tagName &amp;&amp; newNodes[i].tagName.toLowerCase() === "script") {</td></tr><tr><td class="line-number" value="4825"></td><td class="line-content">              newNodes[i] = await ___executeScriptTag(newNodes[i]);</td></tr><tr><td class="line-number" value="4826"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="4827"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4828"></td><td class="line-content">        } else if(n.type === "attribute" &amp;&amp; (container.contains(n.el) || container === n.el)) {</td></tr><tr><td class="line-number" value="4829"></td><td class="line-content">          let result = __processEscapedCharacters( __evaluateText(window.root, window.root, n.text, {declarationLineNumber:null}) );</td></tr><tr><td class="line-number" value="4830"></td><td class="line-content">          n.attribute.nodeValue = result;</td></tr><tr><td class="line-number" value="4831"></td><td class="line-content">          if(n.attribute.nodeName === "value") n.el.value = result; // &lt;-- because of this: https://stackoverflow.com/a/7986111/11950764 (for input elements, `n.attribute.nodeValue` is the *default* value - so changing it doesn't update the *live* value)</td></tr><tr><td class="line-number" value="4832"></td><td class="line-content">          n.attribute.___alreadyRenderedPerchanceCode = true; // &lt;-- editing attributes triggers our MutationObserver (which watches for and processes "dynamic" JavaScript DOM additions) but we don't want to run rendering twice, so we do this.</td></tr><tr><td class="line-number" value="4833"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="4834"></td><td class="line-content">          // this node isn't within the container/selector that was pased to the `update()` function</td></tr><tr><td class="line-number" value="4835"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4836"></td><td class="line-content">        if(n.type !== "attribute" &amp;&amp; n.type !== "textNode") __perchanceError(`There was an invalid node type when trying to update the HTML. If you can, please post a bug report with a link to your generator on &lt;a href="https://lemmy.world/c/perchance"&gt;lemmy.world/c/perchance&lt;/a&gt; to help me fix this bug. Thanks!`);</td></tr><tr><td class="line-number" value="4837"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4838"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="4839"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4840"></td><td class="line-content">    window.addEventListener('message', async function (e) {</td></tr><tr><td class="line-number" value="4841"></td><td class="line-content">      ___postMessagesRecieved++;</td></tr><tr><td class="line-number" value="4842"></td><td class="line-content">      let origin = e.origin || e.originalEvent.origin; // For Chrome, the origin property is in the event.originalEvent object.</td></tr><tr><td class="line-number" value="4843"></td><td class="line-content">      //console.debug("Change origin when you put it on a domain!");</td></tr><tr><td class="line-number" value="4844"></td><td class="line-content">      //console.debug(origin)</td></tr><tr><td class="line-number" value="4845"></td><td class="line-content">      if(/*origin !== "http://app.dev:3001" &amp;&amp; */origin !== "https://perchance.org") {</td></tr><tr><td class="line-number" value="4846"></td><td class="line-content">        //console.error("invalid origin");</td></tr><tr><td class="line-number" value="4847"></td><td class="line-content">        return;</td></tr><tr><td class="line-number" value="4848"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4849"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4850"></td><td class="line-content">      // if(e.data.command === "updateMetadataIfNeeded") {</td></tr><tr><td class="line-number" value="4851"></td><td class="line-content">      //   ___updateGeneratorMetaData();</td></tr><tr><td class="line-number" value="4852"></td><td class="line-content">      // }</td></tr><tr><td class="line-number" value="4853"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4854"></td><td class="line-content">      if(e.data.command === "updateOutput") {</td></tr><tr><td class="line-number" value="4855"></td><td class="line-content">        ___updateOutputMessageHandler(e);</td></tr><tr><td class="line-number" value="4856"></td><td class="line-content">        </td></tr><tr><td class="line-number" value="4857"></td><td class="line-content">        let colorSchemeTag = document.querySelector("#colorSchemeMetaTagToPreventWhiteFlash75847");</td></tr><tr><td class="line-number" value="4858"></td><td class="line-content">        if(colorSchemeTag) colorSchemeTag.remove();</td></tr><tr><td class="line-number" value="4859"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4860"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4861"></td><td class="line-content">      if(e.data.command === "evaluateText") {</td></tr><tr><td class="line-number" value="4862"></td><td class="line-content">        let text, callerId = e.data.callerId;</td></tr><tr><td class="line-number" value="4863"></td><td class="line-content">        if(window.root === null) {</td></tr><tr><td class="line-number" value="4864"></td><td class="line-content">          text = "There is an error in your generator's script.";</td></tr><tr><td class="line-number" value="4865"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="4866"></td><td class="line-content">          text = __processEscapedCharacters( __evaluateText(window.root, window.root, e.data.text, {declarationLineNumber:null}) );</td></tr><tr><td class="line-number" value="4867"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4868"></td><td class="line-content">        e.source.postMessage({type:"evaluateTextResponse", text, callerId}, e.origin);</td></tr><tr><td class="line-number" value="4869"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4870"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4871"></td><td class="line-content">      if(!___alreadyAttachedSaveHandler) {</td></tr><tr><td class="line-number" value="4872"></td><td class="line-content">        // manually bubble up save commands out of this iframe and into editor</td></tr><tr><td class="line-number" value="4873"></td><td class="line-content">        document.addEventListener("keydown", (keyEvent) =&gt; {</td></tr><tr><td class="line-number" value="4874"></td><td class="line-content">          if (keyEvent.keyCode == 83 &amp;&amp; (navigator.platform.match("Mac") ? keyEvent.metaKey : keyEvent.ctrlKey)) {</td></tr><tr><td class="line-number" value="4875"></td><td class="line-content">            keyEvent.preventDefault();</td></tr><tr><td class="line-number" value="4876"></td><td class="line-content">            e.source.postMessage({type:"saveKeyboardShortcut"}, e.origin);</td></tr><tr><td class="line-number" value="4877"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4878"></td><td class="line-content">        }, false);</td></tr><tr><td class="line-number" value="4879"></td><td class="line-content">        ___alreadyAttachedSaveHandler = true;</td></tr><tr><td class="line-number" value="4880"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="4881"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4882"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="4883"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4884"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4885"></td><td class="line-content">    async function ___updateOutputMessageHandler(e) {</td></tr><tr><td class="line-number" value="4886"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4887"></td><td class="line-content">      window.codeWarningsArray = [];</td></tr><tr><td class="line-number" value="4888"></td><td class="line-content">      __clearPerchanceErrors();</td></tr><tr><td class="line-number" value="4889"></td><td class="line-content">      if(document.querySelector("#perchance-dep-load-indicator")) document.querySelector("#perchance-dep-load-indicator").remove()</td></tr><tr><td class="line-number" value="4890"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4891"></td><td class="line-content">      try {</td></tr><tr><td class="line-number" value="4892"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4893"></td><td class="line-content">        let unfoundDeps = e.data.dependencies.filter(d =&gt; d.found === false);</td></tr><tr><td class="line-number" value="4894"></td><td class="line-content">        if(unfoundDeps.length &gt; 0) {</td></tr><tr><td class="line-number" value="4895"></td><td class="line-content">          __perchanceError(`${unfoundDeps.length &gt; 1 ? "Some dependencies" : "A dependency"} (imported generator${unfoundDeps.length &gt; 1 ? "s" : ""}) that you tried to import into your generator could not be found: &lt;b&gt;${unfoundDeps.map(d =&gt; d.name).join("&lt;/b&gt;, &lt;b&gt;")}&lt;/b&gt;. You can check that whether or not they exist by going to: &lt;i&gt;perchance.org/NAME&lt;/i&gt; where "NAME" should be replaced with the name of the generator that you're trying to import.`);</td></tr><tr><td class="line-number" value="4896"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4897"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4898"></td><td class="line-content">        if(!Array.isArray(e.data.dependencies)) { </td></tr><tr><td class="line-number" value="4899"></td><td class="line-content">          __perchanceError(`Something went wrong with the dependencies (imported modules): ${e.data.dependencies}. This is an unusual bug and may indicate a problem with the Perchance engine. If you could post a bug report on the forum that'd be great: &lt;a href='https://lemmy.world/c/perchance'&gt;lemmy.world/c/perchance&lt;a&gt;`);</td></tr><tr><td class="line-number" value="4900"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4901"></td><td class="line-content">        let foundDeps = e.data.dependencies.filter(d =&gt; d.found !== false);</td></tr><tr><td class="line-number" value="4902"></td><td class="line-content">        for(let dep of foundDeps) {</td></tr><tr><td class="line-number" value="4903"></td><td class="line-content">          dep.hasImportedPreprocessor = /\n\$preprocess *= *{import:/.test("\n"+dep.modelText);</td></tr><tr><td class="line-number" value="4904"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4905"></td><td class="line-content">        foundDeps.sort((a,b) =&gt; a.hasImportedPreprocessor ? 1 : -1); // compile generators that rely on preprocessors last so that their preprocessor has already been compiled and is thus available in the moduleSpace when we're compiling that generator</td></tr><tr><td class="line-number" value="4906"></td><td class="line-content">        for(let dep of foundDeps) {</td></tr><tr><td class="line-number" value="4907"></td><td class="line-content">          if(moduleSpace[dep.name]) continue; // Don't want to recompile things that we've already got! (only a problem if there is "recursive" dependency stuff I think)</td></tr><tr><td class="line-number" value="4908"></td><td class="line-content">          try {</td></tr><tr><td class="line-number" value="4909"></td><td class="line-content">            moduleSpace[dep.name] = __createPerchanceTree(dep.modelText, dep.name);</td></tr><tr><td class="line-number" value="4910"></td><td class="line-content">            moduleSpace[dep.name].$moduleSpace = moduleSpace;</td></tr><tr><td class="line-number" value="4911"></td><td class="line-content">          } catch(e) {</td></tr><tr><td class="line-number" value="4912"></td><td class="line-content">            console.error("Critical error in __createPerchanceTree:", e); // need to catch this else we can't e.g. tell parent that it failed to load (which is relevant for the saving process)</td></tr><tr><td class="line-number" value="4913"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4914"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4915"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4916"></td><td class="line-content">        // get all imports in HTML and add them to window.root.$imports</td></tr><tr><td class="line-number" value="4917"></td><td class="line-content">        let htmlTestDiv = document.createElement("div");</td></tr><tr><td class="line-number" value="4918"></td><td class="line-content">        htmlTestDiv.innerHTML = e.data.generator.outputTemplate;</td></tr><tr><td class="line-number" value="4919"></td><td class="line-content">        let templatableTextChunks = ___collectTemplatableTextChunks(htmlTestDiv);</td></tr><tr><td class="line-number" value="4920"></td><td class="line-content">        let htmlImports = [];</td></tr><tr><td class="line-number" value="4921"></td><td class="line-content">        __ignorePerchanceErrors = true;</td></tr><tr><td class="line-number" value="4922"></td><td class="line-content">        for(let chunk of templatableTextChunks) {</td></tr><tr><td class="line-number" value="4923"></td><td class="line-content">          htmlImports.push( ...__collectImportedModuleNamesFromText(chunk) );</td></tr><tr><td class="line-number" value="4924"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4925"></td><td class="line-content">        __ignorePerchanceErrors = false;</td></tr><tr><td class="line-number" value="4926"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4927"></td><td class="line-content">        try {</td></tr><tr><td class="line-number" value="4928"></td><td class="line-content">          window.root = __createPerchanceTree(e.data.generator.modelText, e.data.generator.name);</td></tr><tr><td class="line-number" value="4929"></td><td class="line-content">        } catch(e) {</td></tr><tr><td class="line-number" value="4930"></td><td class="line-content">          console.error("Critical error in __createPerchanceTree:", e); // need to catch this else we can't e.g. tell parent that it failed to load (which is relevant for the saving process)</td></tr><tr><td class="line-number" value="4931"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4932"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4933"></td><td class="line-content">        if(!window.root) {</td></tr><tr><td class="line-number" value="4934"></td><td class="line-content">          if(e.data.generator.modelText.startsWith("$preprocess") || e.data.generator.modelText.includes("\n$preprocess")) {</td></tr><tr><td class="line-number" value="4935"></td><td class="line-content">            let imports = e.data.generator.modelText.split("\n").map(l =&gt; __collectImportedModuleNamesFromText(l)).flat();</td></tr><tr><td class="line-number" value="4936"></td><td class="line-content">            imports.push(...new Set(htmlImports));</td></tr><tr><td class="line-number" value="4937"></td><td class="line-content">            imports = imports.filter(name =&gt; name !== e.data.generator.name);</td></tr><tr><td class="line-number" value="4938"></td><td class="line-content">            __parentWindow.postMessage({type:"importsUpdate", imports:[...new Set(imports)]}, "https://perchance.org");</td></tr><tr><td class="line-number" value="4939"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="4940"></td><td class="line-content">          __perchanceError(`Your generator's script seems to have errors in it. If you haven't recieved any other errors above this one which could indicate what went wrong, then this could be a bug in the Perchance engine. In that case, it would be great if you could post a quick bug report on the forum: &lt;a href="https://lemmy.world/c/perchance"&gt;lemmy.world/c/perchance&lt;a&gt;`);</td></tr><tr><td class="line-number" value="4941"></td><td class="line-content">          </td></tr><tr><td class="line-number" value="4942"></td><td class="line-content">          __parentWindow.postMessage({type:"failedToLoadDueToGeneratorErrors"}, "https://perchance.org");</td></tr><tr><td class="line-number" value="4943"></td><td class="line-content">          return;</td></tr><tr><td class="line-number" value="4944"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="4945"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4946"></td><td class="line-content">        window.root.$imports.push(...new Set(htmlImports));</td></tr><tr><td class="line-number" value="4947"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4948"></td><td class="line-content">        // remove import of THIS module (most likely mistake by user)</td></tr><tr><td class="line-number" value="4949"></td><td class="line-content">        window.root.$imports = window.root.$imports.filter(name =&gt; name !== e.data.generator.name);</td></tr><tr><td class="line-number" value="4950"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4951"></td><td class="line-content">        moduleSpace[e.data.generator.name] = window.root;</td></tr><tr><td class="line-number" value="4952"></td><td class="line-content">        window.root.$moduleSpace = moduleSpace;</td></tr><tr><td class="line-number" value="4953"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4954"></td><td class="line-content">        // EDIT: This is no longer needed since we do it all in the `key=value` getter - see MARKER:odj29hfi3j0d2kj0hx24f</td></tr><tr><td class="line-number" value="4955"></td><td class="line-content">        // if((document.referrer+"").includes("test-import-linking-removal")) {</td></tr><tr><td class="line-number" value="4956"></td><td class="line-content">        //   // do nothing</td></tr><tr><td class="line-number" value="4957"></td><td class="line-content">        // } else {</td></tr><tr><td class="line-number" value="4958"></td><td class="line-content">        //   // tie all direct import assignments to the actual module's root node (otherwise we can't access sub-properties):</td></tr><tr><td class="line-number" value="4959"></td><td class="line-content">        //   for(let moduleRoot of Object.values(window.root.$moduleSpace)) {</td></tr><tr><td class="line-number" value="4960"></td><td class="line-content">        //     for(let node of moduleRoot.$allNodes) {</td></tr><tr><td class="line-number" value="4961"></td><td class="line-content">        //       if(node.$nodeType === "value" &amp;&amp; typeof node.$value === "string") {</td></tr><tr><td class="line-number" value="4962"></td><td class="line-content">        //         let match = /^\{import:([a-z0-9\-]+)\}$/.exec(node.$value);</td></tr><tr><td class="line-number" value="4963"></td><td class="line-content">        //         if(match) {</td></tr><tr><td class="line-number" value="4964"></td><td class="line-content">        //           let moduleName = match[1];</td></tr><tr><td class="line-number" value="4965"></td><td class="line-content">        //           let importedModuleRoot = window.root.$moduleSpace[moduleName];</td></tr><tr><td class="line-number" value="4966"></td><td class="line-content">        //           if(importedModuleRoot) {</td></tr><tr><td class="line-number" value="4967"></td><td class="line-content">        //             if("$output" in importedModuleRoot.getSelf) {</td></tr><tr><td class="line-number" value="4968"></td><td class="line-content">        //               if(importedModuleRoot.getSelf.$valueChildren.includes("$output")) {</td></tr><tr><td class="line-number" value="4969"></td><td class="line-content">        //                 let outputNode = importedModuleRoot.getSelf.$allNodes.find(n =&gt; n.$key === "$output" &amp;&amp; n.$parent === importedModuleRoot.getSelf);</td></tr><tr><td class="line-number" value="4970"></td><td class="line-content">        //                 let value;</td></tr><tr><td class="line-number" value="4971"></td><td class="line-content">        //                 if(typeof outputNode.$value === "string") value = outputNode;</td></tr><tr><td class="line-number" value="4972"></td><td class="line-content">        //                 else value = outputNode.$value;</td></tr><tr><td class="line-number" value="4973"></td><td class="line-content">        //                 Object.defineProperty(node.$parent, node.$key, {value:value, writable:true, configurable:true}); // &lt;-- need outputNode.$value rather than importedModuleRoot.getSelf.$output because $output will be getter if it's a value node that's not a direct link to another list (ctrl+f "tie direct references to" in createPerchanceTree.js), and so if $output=[listOfLists.selectOne], this import statement would get tied to a *specific* list in listOfLists, which is wrong. Bug "report": reddit.com/r/perchance/comments/fft71g/has_anyone_made_an_object_generator/fk0pw5d</td></tr><tr><td class="line-number" value="4974"></td><td class="line-content">        //               } else {</td></tr><tr><td class="line-number" value="4975"></td><td class="line-content">        //                 Object.defineProperty(node.$parent, node.$key, {value:importedModuleRoot.getSelf.$output, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="4976"></td><td class="line-content">        //               }</td></tr><tr><td class="line-number" value="4977"></td><td class="line-content">        //             } else {</td></tr><tr><td class="line-number" value="4978"></td><td class="line-content">        //               //node.$parent[node.$key] = importedModuleRoot;</td></tr><tr><td class="line-number" value="4979"></td><td class="line-content">        //               Object.defineProperty(node.$parent, node.$key, {value:importedModuleRoot.getSelf, writable:true, configurable:true});</td></tr><tr><td class="line-number" value="4980"></td><td class="line-content">        //             }</td></tr><tr><td class="line-number" value="4981"></td><td class="line-content">        //           } else {</td></tr><tr><td class="line-number" value="4982"></td><td class="line-content">        //             __perchanceError(`A generator that you imported, '${moduleName}', could not be found. If you're sure that generator exists, try saving your generator and reloading.`);</td></tr><tr><td class="line-number" value="4983"></td><td class="line-content">        //           }</td></tr><tr><td class="line-number" value="4984"></td><td class="line-content">        //         }</td></tr><tr><td class="line-number" value="4985"></td><td class="line-content">        //       }</td></tr><tr><td class="line-number" value="4986"></td><td class="line-content">        //     }</td></tr><tr><td class="line-number" value="4987"></td><td class="line-content">        //   }</td></tr><tr><td class="line-number" value="4988"></td><td class="line-content">        // }</td></tr><tr><td class="line-number" value="4989"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4990"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4991"></td><td class="line-content">        let currentDepNames = e.data.dependencies.map(d =&gt; d.name);</td></tr><tr><td class="line-number" value="4992"></td><td class="line-content">        let newDepNames = window.root.$imports.filter(name =&gt; !currentDepNames.includes(name));</td></tr><tr><td class="line-number" value="4993"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4994"></td><td class="line-content">        // // only send import updates if there are new imports</td></tr><tr><td class="line-number" value="4995"></td><td class="line-content">        if(newDepNames.length &gt; 0) {</td></tr><tr><td class="line-number" value="4996"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="4997"></td><td class="line-content">          // NOTE: see note below about race condition - we're always sending importsUpdate now</td></tr><tr><td class="line-number" value="4998"></td><td class="line-content">          //e.source.postMessage({type:"importsUpdate", imports:window.root.$imports}, e.origin);</td></tr><tr><td class="line-number" value="4999"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5000"></td><td class="line-content">          if(document.querySelector("#perchance-dep-load-indicator")) document.querySelector("#perchance-dep-load-indicator").remove();</td></tr><tr><td class="line-number" value="5001"></td><td class="line-content">          let div = document.createElement("div");</td></tr><tr><td class="line-number" value="5002"></td><td class="line-content">          div.innerHTML = `&lt;div id="perchance-dep-load-indicator" style="position:fixed; bottom:8px; right:8px; background-color: #34ba22; color:white; cursor:pointer;"&gt;</td></tr><tr><td class="line-number" value="5003"></td><td class="line-content">            &lt;span style="display: inline-block;padding: 0.5em;"&gt;&amp;#xFE0E; Loading imported generators...&lt;/span&gt;</td></tr><tr><td class="line-number" value="5004"></td><td class="line-content">          &lt;/div&gt;`;</td></tr><tr><td class="line-number" value="5005"></td><td class="line-content">          document.body.append(div.firstElementChild);</td></tr><tr><td class="line-number" value="5006"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5007"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="5008"></td><td class="line-content">          let perchanceErrorIndicator = document.querySelector("#perchance-error-indicator"); // marker:85hdke9thsi</td></tr><tr><td class="line-number" value="5009"></td><td class="line-content">          try {</td></tr><tr><td class="line-number" value="5010"></td><td class="line-content">            await ___updateOutput(e.data.generator.outputTemplate);</td></tr><tr><td class="line-number" value="5011"></td><td class="line-content">          } catch(e) {</td></tr><tr><td class="line-number" value="5012"></td><td class="line-content">            __perchanceError(`There was some sort of error during page load: ${e.message}\n\n${e.stack}`);</td></tr><tr><td class="line-number" value="5013"></td><td class="line-content">            console.error(e);</td></tr><tr><td class="line-number" value="5014"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5015"></td><td class="line-content">          if(perchanceErrorIndicator &amp;&amp; !document.querySelector("#perchance-error-indicator")) document.body.append(perchanceErrorIndicator); // since update would have removed it. TODO: this is very hacky. should move error modal to parent frame (can still show indicator 'over' generator frame)</td></tr><tr><td class="line-number" value="5016"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5017"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5018"></td><td class="line-content">        // NOTE: due to issues with race conditions during saving (https://www.reddit.com/r/perchance/comments/cgyhey/when_i_try_to_open_the_generator_it_says_that_the/), I'm just going to *always* send back an importsUpdate (I check in the main thread/frame whether the update is actually needed)</td></tr><tr><td class="line-number" value="5019"></td><td class="line-content">            // // tell main app which imports are being *directly* used by this generator in case we</td></tr><tr><td class="line-number" value="5020"></td><td class="line-content">            // // can clear some no-longer-used dependencies</td></tr><tr><td class="line-number" value="5021"></td><td class="line-content">            // let unusedOrIndirectDeps = currentDepNames.filter(n =&gt; !window.root.$imports.includes(n));</td></tr><tr><td class="line-number" value="5022"></td><td class="line-content">            // if(unusedOrIndirectDeps.length &gt; 0) {</td></tr><tr><td class="line-number" value="5023"></td><td class="line-content">        // EDIT: IMPORTANT: this must come before `finishedLoadingIncludingMetaData` postMessage</td></tr><tr><td class="line-number" value="5024"></td><td class="line-content">        __parentWindow.postMessage({type:"importsUpdate", imports:window.root.$imports}, "https://perchance.org");</td></tr><tr><td class="line-number" value="5025"></td><td class="line-content">            // }</td></tr><tr><td class="line-number" value="5026"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5027"></td><td class="line-content">        let metaDataUpdatePromise = ___updateGeneratorMetaData(); // no need to `await` this</td></tr><tr><td class="line-number" value="5028"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5029"></td><td class="line-content">        try { // try/catch since this is new code. can remove later.</td></tr><tr><td class="line-number" value="5030"></td><td class="line-content">          if(e.data.generator.outputTemplate.includes(" id=")) { // &lt;-- just an optimisation</td></tr><tr><td class="line-number" value="5031"></td><td class="line-content">            let topLevelVariableNames = [...window.root.getPropertyNames, ...window.root.getChildNames];</td></tr><tr><td class="line-number" value="5032"></td><td class="line-content">            let htmlElementIds = [...document.querySelectorAll("[id]")].map(el =&gt; el.id);</td></tr><tr><td class="line-number" value="5033"></td><td class="line-content">            let intersection = htmlElementIds.filter(value =&gt; topLevelVariableNames.includes(value));</td></tr><tr><td class="line-number" value="5034"></td><td class="line-content">            if(intersection.length &gt; 0) {</td></tr><tr><td class="line-number" value="5035"></td><td class="line-content">              window.codeWarningsArray.push({lineNumber:root[intersection[0]].$declarationLineNumber, generatorName:window.generatorName, warningId:"top-level-list-name-same-as-html-element-id"});</td></tr><tr><td class="line-number" value="5036"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="5037"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5038"></td><td class="line-content">        } catch(e) {</td></tr><tr><td class="line-number" value="5039"></td><td class="line-content">          console.error(e);</td></tr><tr><td class="line-number" value="5040"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5041"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5042"></td><td class="line-content">        __parentWindow.postMessage({type:"codeWarningsUpdate", warnings:window.codeWarningsArray}, "https://perchance.org");</td></tr><tr><td class="line-number" value="5043"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5044"></td><td class="line-content">        __parentWindow.postMessage({type:"finishedLoading"}, "https://perchance.org");</td></tr><tr><td class="line-number" value="5045"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5046"></td><td class="line-content">        (async function() {</td></tr><tr><td class="line-number" value="5047"></td><td class="line-content">          await metaDataUpdatePromise;</td></tr><tr><td class="line-number" value="5048"></td><td class="line-content">          await new Promise(r =&gt; setTimeout(r, 5));</td></tr><tr><td class="line-number" value="5049"></td><td class="line-content">          // this event is used to know when we can save the generator (with correct dependencies + metadata based on current text in editor)</td></tr><tr><td class="line-number" value="5050"></td><td class="line-content">          __parentWindow.postMessage({type:"finishedLoadingIncludingMetaData", imports:window.root.$imports}, "https://perchance.org");</td></tr><tr><td class="line-number" value="5051"></td><td class="line-content">        })();</td></tr><tr><td class="line-number" value="5052"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5053"></td><td class="line-content">      } catch(error) {</td></tr><tr><td class="line-number" value="5054"></td><td class="line-content">        //debugger;</td></tr><tr><td class="line-number" value="5055"></td><td class="line-content">        document.querySelector("#output-container").innerHTML = e.data.generator.outputTemplate;</td></tr><tr><td class="line-number" value="5056"></td><td class="line-content">        __perchanceError(`There was an error while trying to compile your generator. Here's the error message: &lt;blockquote&gt;${__escapeHTMLSpecialChars(error.stack)}&lt;/blockquote&gt;`);</td></tr><tr><td class="line-number" value="5057"></td><td class="line-content">        __parentWindow.postMessage({type:"finishedLoading"}, "https://perchance.org");</td></tr><tr><td class="line-number" value="5058"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5059"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5060"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5061"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5062"></td><td class="line-content">    async function ___updateGeneratorMetaData() {</td></tr><tr><td class="line-number" value="5063"></td><td class="line-content">      // get page title from first h1 that contains text:</td></tr><tr><td class="line-number" value="5064"></td><td class="line-content">      let h1 = [...document.querySelectorAll("h1")].filter(el =&gt; el.textContent.trim())[0];</td></tr><tr><td class="line-number" value="5065"></td><td class="line-content">      if(!h1) h1 = document.querySelector("h2");</td></tr><tr><td class="line-number" value="5066"></td><td class="line-content">      let generatorTitle = h1 &amp;&amp; h1.textContent !== "Your Generator's Title" &amp;&amp; h1.textContent !== "Minimal Example" ? h1.textContent : window.location.pathname.slice(1).split("-").filter(function(a){return a;}).map(function(word){return word[0].toUpperCase()+word.slice(1); }).join(" ");</td></tr><tr><td class="line-number" value="5067"></td><td class="line-content">      let generatorHTML = (document.querySelector("#output-container") || document.body).innerHTML;</td></tr><tr><td class="line-number" value="5068"></td><td class="line-content">      let generatorImage = "";</td></tr><tr><td class="line-number" value="5069"></td><td class="line-content">      let generatorDescription = "";</td></tr><tr><td class="line-number" value="5070"></td><td class="line-content">      let generatorDynamicMetaDataFunction = null;</td></tr><tr><td class="line-number" value="5071"></td><td class="line-content">      let tags = null;</td></tr><tr><td class="line-number" value="5072"></td><td class="line-content">      let header = null;</td></tr><tr><td class="line-number" value="5073"></td><td class="line-content">      if(root.$meta) {</td></tr><tr><td class="line-number" value="5074"></td><td class="line-content">        if(root.$meta.title) generatorTitle = root.$meta.title.evaluateItem;</td></tr><tr><td class="line-number" value="5075"></td><td class="line-content">        if(root.$meta.description) generatorDescription = root.$meta.description.evaluateItem;</td></tr><tr><td class="line-number" value="5076"></td><td class="line-content">        if(root.$meta.image) generatorImage = root.$meta.image.evaluateItem;</td></tr><tr><td class="line-number" value="5077"></td><td class="line-content">        if(root.$meta.tags) tags = root.$meta.tags.evaluateItem;</td></tr><tr><td class="line-number" value="5078"></td><td class="line-content">        if(root.$meta.header) {</td></tr><tr><td class="line-number" value="5079"></td><td class="line-content">          header = {};</td></tr><tr><td class="line-number" value="5080"></td><td class="line-content">          if(root.$meta.header.background) {</td></tr><tr><td class="line-number" value="5081"></td><td class="line-content">            let bg = root.$meta.header.background.evaluateItem;</td></tr><tr><td class="line-number" value="5082"></td><td class="line-content">            if(typeof bg === "string") {</td></tr><tr><td class="line-number" value="5083"></td><td class="line-content">              if(CSS.supports("background", bg)) {</td></tr><tr><td class="line-number" value="5084"></td><td class="line-content">                header.background = bg;</td></tr><tr><td class="line-number" value="5085"></td><td class="line-content">              } else {</td></tr><tr><td class="line-number" value="5086"></td><td class="line-content">                __perchanceError(`Your $meta header background &lt;code&gt;${bg}&lt;/code&gt; is invalid. It must be a valid CSS background property like &lt;code&gt;blue&lt;/code&gt; or &lt;code&gt;url(https://example.com/image.jpeg) center&lt;/code&gt;.`);</td></tr><tr><td class="line-number" value="5087"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="5088"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="5089"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5090"></td><td class="line-content">          if(root.$meta.header.mode) {</td></tr><tr><td class="line-number" value="5091"></td><td class="line-content">            let mode = root.$meta.header.mode.evaluateItem;</td></tr><tr><td class="line-number" value="5092"></td><td class="line-content">            if(typeof mode === "string" &amp;&amp; (mode === "normal" || mode === "minimal")) {</td></tr><tr><td class="line-number" value="5093"></td><td class="line-content">              header.mode = mode;</td></tr><tr><td class="line-number" value="5094"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="5095"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5096"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5097"></td><td class="line-content">        if(root.$meta.dynamic) {</td></tr><tr><td class="line-number" value="5098"></td><td class="line-content">          try {</td></tr><tr><td class="line-number" value="5099"></td><td class="line-content">            // grab the lines that are in the 'dynamic' function.</td></tr><tr><td class="line-number" value="5100"></td><td class="line-content">            let lines = window.root.$meta.getRawListText.split("\n");</td></tr><tr><td class="line-number" value="5101"></td><td class="line-content">            let keepLines = [];</td></tr><tr><td class="line-number" value="5102"></td><td class="line-content">            let inFunction = false;</td></tr><tr><td class="line-number" value="5103"></td><td class="line-content">            let functionHeaderIndentSpaces = null;</td></tr><tr><td class="line-number" value="5104"></td><td class="line-content">            for(let line of lines) {</td></tr><tr><td class="line-number" value="5105"></td><td class="line-content">              if(line.trim().startsWith("dynamic(") || line.trim().startsWith("async dynamic(")) {</td></tr><tr><td class="line-number" value="5106"></td><td class="line-content">                inFunction = true;</td></tr><tr><td class="line-number" value="5107"></td><td class="line-content">                functionHeaderIndentSpaces = line.length - line.replace(/^ +/g, "").length;</td></tr><tr><td class="line-number" value="5108"></td><td class="line-content">                keepLines.push(line.trim().replace("dynamic(", "function dynamic(").replace("=&gt;", " {"));</td></tr><tr><td class="line-number" value="5109"></td><td class="line-content">                continue;</td></tr><tr><td class="line-number" value="5110"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="5111"></td><td class="line-content">              if(inFunction) {</td></tr><tr><td class="line-number" value="5112"></td><td class="line-content">                let indentSpaces = line.length - line.replace(/^ +/g, "").length;</td></tr><tr><td class="line-number" value="5113"></td><td class="line-content">                if(line.trim() &amp;&amp; indentSpaces &lt;= functionHeaderIndentSpaces) {</td></tr><tr><td class="line-number" value="5114"></td><td class="line-content">                  break;</td></tr><tr><td class="line-number" value="5115"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="5116"></td><td class="line-content">                keepLines.push(line);</td></tr><tr><td class="line-number" value="5117"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="5118"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="5119"></td><td class="line-content">            generatorDynamicMetaDataFunction = keepLines.join("\n") + "\n}";</td></tr><tr><td class="line-number" value="5120"></td><td class="line-content">            if(generatorDynamicMetaDataFunction.length &gt; 20000) {</td></tr><tr><td class="line-number" value="5121"></td><td class="line-content">              generatorDynamicMetaDataFunction = null;</td></tr><tr><td class="line-number" value="5122"></td><td class="line-content">              __perchanceError("Your $meta dynamic function is too long. It must be less than 20,000 characters - you can `fetch` a remote file that you uploaded to perchance.org/upload if needed.");  </td></tr><tr><td class="line-number" value="5123"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="5124"></td><td class="line-content">          } catch(e) {</td></tr><tr><td class="line-number" value="5125"></td><td class="line-content">            console.error(e);</td></tr><tr><td class="line-number" value="5126"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5127"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5128"></td><td class="line-content">          if(generatorDynamicMetaDataFunction) {</td></tr><tr><td class="line-number" value="5129"></td><td class="line-content">            try {</td></tr><tr><td class="line-number" value="5130"></td><td class="line-content">              // this would be done server-side anyway, but we do it here so that we can dynamically update the title of the current browser tab</td></tr><tr><td class="line-number" value="5131"></td><td class="line-content">              let urlParams = Object.fromEntries([...new URL(window.location.href).searchParams].filter(e =&gt; !e[0].startsWith("utm_")));</td></tr><tr><td class="line-number" value="5132"></td><td class="line-content">              let inputs = {urlParams};</td></tr><tr><td class="line-number" value="5133"></td><td class="line-content">              let cacheKey = generatorDynamicMetaDataFunction + "&lt;&lt;&lt;---&gt;&gt;&gt;" + JSON.stringify(inputs);</td></tr><tr><td class="line-number" value="5134"></td><td class="line-content">              let outputs;</td></tr><tr><td class="line-number" value="5135"></td><td class="line-content">              if(!window.__dynamicMetaDataCache) window.__dynamicMetaDataCache = {}; // simple cache just so while they're editing we're not e.g. spamming a `fetch` that they have in their `dynamic` function</td></tr><tr><td class="line-number" value="5136"></td><td class="line-content">              if(window.__dynamicMetaDataCache[cacheKey]) {</td></tr><tr><td class="line-number" value="5137"></td><td class="line-content">                outputs = window.__dynamicMetaDataCache[cacheKey];</td></tr><tr><td class="line-number" value="5138"></td><td class="line-content">                console.debug("Used cached dynamic meta data:", outputs);</td></tr><tr><td class="line-number" value="5139"></td><td class="line-content">              } else {</td></tr><tr><td class="line-number" value="5140"></td><td class="line-content">                outputs = await root.$meta.dynamic(inputs);</td></tr><tr><td class="line-number" value="5141"></td><td class="line-content">                console.debug("Computed dynamic meta data:", outputs);</td></tr><tr><td class="line-number" value="5142"></td><td class="line-content">                window.__dynamicMetaDataCache[cacheKey] = outputs;</td></tr><tr><td class="line-number" value="5143"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="5144"></td><td class="line-content">              if(typeof outputs.title === "string") generatorTitle = outputs.title;</td></tr><tr><td class="line-number" value="5145"></td><td class="line-content">              if(typeof outputs.description === "string") generatorDescription = outputs.description;</td></tr><tr><td class="line-number" value="5146"></td><td class="line-content">              if(typeof outputs.image === "string") generatorImage = outputs.image;</td></tr><tr><td class="line-number" value="5147"></td><td class="line-content">            } catch(e) {</td></tr><tr><td class="line-number" value="5148"></td><td class="line-content">              __perchanceError(`There was an error in your $meta dynamic function. Here's the error message: &lt;blockquote&gt;${__escapeHTMLSpecialChars(e.stack)}&lt;/blockquote&gt;`);</td></tr><tr><td class="line-number" value="5149"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="5150"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5151"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5152"></td><td class="line-content">        </td></tr><tr><td class="line-number" value="5153"></td><td class="line-content">        let metaProps = new Set(root.$meta.$allKeys);</td></tr><tr><td class="line-number" value="5154"></td><td class="line-content">        metaProps.delete("title");</td></tr><tr><td class="line-number" value="5155"></td><td class="line-content">        metaProps.delete("description");</td></tr><tr><td class="line-number" value="5156"></td><td class="line-content">        metaProps.delete("image");</td></tr><tr><td class="line-number" value="5157"></td><td class="line-content">        metaProps.delete("dynamic");</td></tr><tr><td class="line-number" value="5158"></td><td class="line-content">        metaProps.delete("header");</td></tr><tr><td class="line-number" value="5159"></td><td class="line-content">        metaProps.delete("tags");</td></tr><tr><td class="line-number" value="5160"></td><td class="line-content">        if(metaProps.size &gt; 0) __perchanceError("Looks like you've got some invalid properties in your $meta list? The only valid properties are 'title', 'description', 'image', 'tags', 'header', and 'dynamic'.");</td></tr><tr><td class="line-number" value="5161"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5162"></td><td class="line-content">      if(!navigator.webdriver) { // try to avoid Google crawler title swap bug - no idea if this will fix it.</td></tr><tr><td class="line-number" value="5163"></td><td class="line-content">        __parentWindow.postMessage({type:"metaUpdate", title:generatorTitle, html:generatorHTML, image:generatorImage, description:generatorDescription, dynamic:generatorDynamicMetaDataFunction, header, tags, _validation:{generatorName:window.generatorName}}, "https://perchance.org"); // had to use "https://perchance.org" as origin so our initial dummy update (using embedded data) works.</td></tr><tr><td class="line-number" value="5164"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5165"></td><td class="line-content">      await new Promise(r =&gt; setTimeout(r, 5)); // ensure postMessage has actually been sent</td></tr><tr><td class="line-number" value="5166"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5167"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5168"></td><td class="line-content">    window.addEventListener("DOMContentLoaded", function() {</td></tr><tr><td class="line-number" value="5169"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5170"></td><td class="line-content">      let dependencies;</td></tr><tr><td class="line-number" value="5171"></td><td class="line-content">      try { // adding try/catch here in case of future instances of this: https://lemmy.world/post/4913660</td></tr><tr><td class="line-number" value="5172"></td><td class="line-content">        dependencies = JSON.parse( decodeURI( document.querySelector("#imported-generators").textContent ) );</td></tr><tr><td class="line-number" value="5173"></td><td class="line-content">      } catch(e) {</td></tr><tr><td class="line-number" value="5174"></td><td class="line-content">        if(!location.href.includes("__generatorDependenciesCacheBust")) { // try a cache bust if we haven't already.</td></tr><tr><td class="line-number" value="5175"></td><td class="line-content">          let url = new URL(window.location.href);</td></tr><tr><td class="line-number" value="5176"></td><td class="line-content">          url.searchParams.set("__generatorDependenciesCacheBust", Math.random());</td></tr><tr><td class="line-number" value="5177"></td><td class="line-content">          window.location.href = url.href; </td></tr><tr><td class="line-number" value="5178"></td><td class="line-content">          return;</td></tr><tr><td class="line-number" value="5179"></td><td class="line-content">        } else { // if we've already tried bust, don't do it again, else it'll be a refresh loop</td></tr><tr><td class="line-number" value="5180"></td><td class="line-content">          dependencies = [];</td></tr><tr><td class="line-number" value="5181"></td><td class="line-content">          let errorCode = 1;</td></tr><tr><td class="line-number" value="5182"></td><td class="line-content">          let importedGeneratorsTextContent = document.querySelector("#imported-generators").textContent;</td></tr><tr><td class="line-number" value="5183"></td><td class="line-content">          if(importedGeneratorsTextContent === "") {</td></tr><tr><td class="line-number" value="5184"></td><td class="line-content">            errorCode = 2;</td></tr><tr><td class="line-number" value="5185"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="5186"></td><td class="line-content">            errorCode = 3;</td></tr><tr><td class="line-number" value="5187"></td><td class="line-content">            try {</td></tr><tr><td class="line-number" value="5188"></td><td class="line-content">              decodeURI(importedGeneratorsTextContent);</td></tr><tr><td class="line-number" value="5189"></td><td class="line-content">            } catch(e) {</td></tr><tr><td class="line-number" value="5190"></td><td class="line-content">              errorCode = 4;</td></tr><tr><td class="line-number" value="5191"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="5192"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5193"></td><td class="line-content">          console.error(e);</td></tr><tr><td class="line-number" value="5194"></td><td class="line-content">          console.error("Error parsing dependencies in embed.", errorCode);</td></tr><tr><td class="line-number" value="5195"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5196"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5197"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5198"></td><td class="line-content">      if(/__initWithDataFromParentWindow=[1-9]/.test(window.location.href)) {</td></tr><tr><td class="line-number" value="5199"></td><td class="line-content">        // this is so that the 'reload' button in the editor works without saving - i.e. we request the fresh, potentially-not-yet-saved-to-the-server data from the parent window.</td></tr><tr><td class="line-number" value="5200"></td><td class="line-content">        __parentWindow.postMessage({type:"requestOutputUpdate"}, "https://perchance.org");</td></tr><tr><td class="line-number" value="5201"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="5202"></td><td class="line-content">        let fakeMessageEvent = {};</td></tr><tr><td class="line-number" value="5203"></td><td class="line-content">        fakeMessageEvent.source = {};</td></tr><tr><td class="line-number" value="5204"></td><td class="line-content">        fakeMessageEvent.source.postMessage = function() {};</td></tr><tr><td class="line-number" value="5205"></td><td class="line-content">        fakeMessageEvent.data = {</td></tr><tr><td class="line-number" value="5206"></td><td class="line-content">          generator: JSON.parse( decodeURI( document.querySelector("#preloaded-generator-data").textContent ) ),</td></tr><tr><td class="line-number" value="5207"></td><td class="line-content">          dependencies,</td></tr><tr><td class="line-number" value="5208"></td><td class="line-content">        };</td></tr><tr><td class="line-number" value="5209"></td><td class="line-content">        ___updateOutputMessageHandler(fakeMessageEvent);</td></tr><tr><td class="line-number" value="5210"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5211"></td><td class="line-content">        let colorSchemeTag = document.querySelector("#colorSchemeMetaTagToPreventWhiteFlash75847");</td></tr><tr><td class="line-number" value="5212"></td><td class="line-content">        if(colorSchemeTag) colorSchemeTag.remove();</td></tr><tr><td class="line-number" value="5213"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5214"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5215"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="5216"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5217"></td><td class="line-content">    // WARNING: This isn't needed, but also it must *not* be re-enabled because it triggers the document.title mutation observer, which sends the changePageTitle to the parent.</td></tr><tr><td class="line-number" value="5218"></td><td class="line-content">    // window.addEventListener("DOMContentLoaded", function() {</td></tr><tr><td class="line-number" value="5219"></td><td class="line-content">    //   var h1 = window.document.querySelector("h1");</td></tr><tr><td class="line-number" value="5220"></td><td class="line-content">    //   let title;</td></tr><tr><td class="line-number" value="5221"></td><td class="line-content">    //   if(h1) {</td></tr><tr><td class="line-number" value="5222"></td><td class="line-content">    //     title = h1.innerText ? h1.innerText : h1.textContent; // fall back to .textContent for e.g. JSDOM which doesn't support .innerText (relevant for using JSDOM to build a hacky API)</td></tr><tr><td class="line-number" value="5223"></td><td class="line-content">    //   }  else {</td></tr><tr><td class="line-number" value="5224"></td><td class="line-content">    //     title = window.location.pathname.slice(1).split("-").filter(function(a){return a;}).map(function(word){return word[0].toUpperCase()+word.slice(1); }).join(" ");</td></tr><tr><td class="line-number" value="5225"></td><td class="line-content">    //   }</td></tr><tr><td class="line-number" value="5226"></td><td class="line-content">    //   document.title = title+"  Perchance" + (title.toLowerCase().includes("gener") ? "" : " Generator");</td></tr><tr><td class="line-number" value="5227"></td><td class="line-content">    // });</td></tr><tr><td class="line-number" value="5228"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5229"></td><td class="line-content">  <span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="5230"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5231"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5232"></td><td class="line-content">  <span class="html-comment">&lt;!-- CSS LOADING SPINNER --&gt;</span></td></tr><tr><td class="line-number" value="5233"></td><td class="line-content">  <span class="html-tag">&lt;style&gt;</span></td></tr><tr><td class="line-number" value="5234"></td><td class="line-content">    .ldspmzjfhueifssge-ring {</td></tr><tr><td class="line-number" value="5235"></td><td class="line-content">      display: inline-block;</td></tr><tr><td class="line-number" value="5236"></td><td class="line-content">      position: relative;</td></tr><tr><td class="line-number" value="5237"></td><td class="line-content">      width: 64px;</td></tr><tr><td class="line-number" value="5238"></td><td class="line-content">      height: 64px;</td></tr><tr><td class="line-number" value="5239"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5240"></td><td class="line-content">    .ldspmzjfhueifssge-ring div {</td></tr><tr><td class="line-number" value="5241"></td><td class="line-content">      box-sizing: border-box;</td></tr><tr><td class="line-number" value="5242"></td><td class="line-content">      display: block;</td></tr><tr><td class="line-number" value="5243"></td><td class="line-content">      position: absolute;</td></tr><tr><td class="line-number" value="5244"></td><td class="line-content">      width: 51px;</td></tr><tr><td class="line-number" value="5245"></td><td class="line-content">      height: 51px;</td></tr><tr><td class="line-number" value="5246"></td><td class="line-content">      margin: 6px;</td></tr><tr><td class="line-number" value="5247"></td><td class="line-content">      border: 6px solid #444;</td></tr><tr><td class="line-number" value="5248"></td><td class="line-content">      border-radius: 50%;</td></tr><tr><td class="line-number" value="5249"></td><td class="line-content">      animation: lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;</td></tr><tr><td class="line-number" value="5250"></td><td class="line-content">      border-color: #444 transparent transparent transparent;</td></tr><tr><td class="line-number" value="5251"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5252"></td><td class="line-content">    .ldspmzjfhueifssge-ring div:nth-child(1) {</td></tr><tr><td class="line-number" value="5253"></td><td class="line-content">      animation-delay: -0.45s;</td></tr><tr><td class="line-number" value="5254"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5255"></td><td class="line-content">    .ldspmzjfhueifssge-ring div:nth-child(2) {</td></tr><tr><td class="line-number" value="5256"></td><td class="line-content">      animation-delay: -0.3s;</td></tr><tr><td class="line-number" value="5257"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5258"></td><td class="line-content">    .ldspmzjfhueifssge-ring div:nth-child(3) {</td></tr><tr><td class="line-number" value="5259"></td><td class="line-content">      animation-delay: -0.15s;</td></tr><tr><td class="line-number" value="5260"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5261"></td><td class="line-content">    @keyframes lds-ring {</td></tr><tr><td class="line-number" value="5262"></td><td class="line-content">      0% {</td></tr><tr><td class="line-number" value="5263"></td><td class="line-content">        transform: rotate(0deg);</td></tr><tr><td class="line-number" value="5264"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5265"></td><td class="line-content">      100% {</td></tr><tr><td class="line-number" value="5266"></td><td class="line-content">        transform: rotate(360deg);</td></tr><tr><td class="line-number" value="5267"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5268"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5269"></td><td class="line-content">  <span class="html-tag">&lt;/style&gt;</span></td></tr><tr><td class="line-number" value="5270"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5271"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="5272"></td><td class="line-content">  // We need to make sure that when a user dynamically adds an element that has an inline event</td></tr><tr><td class="line-number" value="5273"></td><td class="line-content">  // handler (like onclick, for example) then we make sure they can directly reference their</td></tr><tr><td class="line-number" value="5274"></td><td class="line-content">  // top-level lists within those handlers:</td></tr><tr><td class="line-number" value="5275"></td><td class="line-content">  let mutationCallback = function(mutationsList, observer) {</td></tr><tr><td class="line-number" value="5276"></td><td class="line-content">    for(let mutation of mutationsList) {</td></tr><tr><td class="line-number" value="5277"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5278"></td><td class="line-content">      for(let node of (mutation.addedNodes || [])) { // mutation.addedNodes seems to not give all descendents - just the "top-level" nodes of each addition</td></tr><tr><td class="line-number" value="5279"></td><td class="line-content">        if(node.nodeType === 1 &amp;&amp; (node.tagName.toLowerCase() === 'script' || node.tagName.toLowerCase() === 'style')) {</td></tr><tr><td class="line-number" value="5280"></td><td class="line-content">          // I'm not currently handling dynamic addition of script tags, so they won't get a `with(root) { ... }` wrapping, but I think that's fine. Might add it later if needed.</td></tr><tr><td class="line-number" value="5281"></td><td class="line-content">          // Oh, and wouldn't they already have executed anyway?</td></tr><tr><td class="line-number" value="5282"></td><td class="line-content">          continue;</td></tr><tr><td class="line-number" value="5283"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5284"></td><td class="line-content">        let addedNodesArr = [node, ...___getAllDescendentNodesIncludingTextNodes(node)]; // &lt;-- ignores script and style nodes</td></tr><tr><td class="line-number" value="5285"></td><td class="line-content">        for(let addedNode of addedNodesArr) {</td></tr><tr><td class="line-number" value="5286"></td><td class="line-content">          if(addedNode.nodeType === Node.ELEMENT_NODE) {</td></tr><tr><td class="line-number" value="5287"></td><td class="line-content">            // See below comment where I attach this handler function to learn why I commented this out.</td></tr><tr><td class="line-number" value="5288"></td><td class="line-content">            // for(let attr of [...addedNode.attributes]) {</td></tr><tr><td class="line-number" value="5289"></td><td class="line-content">            //   processAttributeMutation(attr, addedNode);</td></tr><tr><td class="line-number" value="5290"></td><td class="line-content">            // }</td></tr><tr><td class="line-number" value="5291"></td><td class="line-content">            ___reAttachDomElementEventsWithRoot(addedNode);</td></tr><tr><td class="line-number" value="5292"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5293"></td><td class="line-content">          // See below comment where I attach this handler function to learn why I commented this out.</td></tr><tr><td class="line-number" value="5294"></td><td class="line-content">          /*else if(addedNode.nodeType === Node.TEXT_NODE &amp;&amp; ___isRenderableDomNode(addedNode)) {</td></tr><tr><td class="line-number" value="5295"></td><td class="line-content">            renderDynamicallyAddedTextNode(addedNode);</td></tr><tr><td class="line-number" value="5296"></td><td class="line-content">          }*/</td></tr><tr><td class="line-number" value="5297"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5298"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5299"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5300"></td><td class="line-content">      if(mutation.attributeName) {</td></tr><tr><td class="line-number" value="5301"></td><td class="line-content">        // See below comment where I attach this handler function to learn why I commented this out.</td></tr><tr><td class="line-number" value="5302"></td><td class="line-content">        //if(mutation.target.attributes[mutation.attributeName]) processAttributeMutation(mutation.target.attributes[mutation.attributeName], mutation.target);</td></tr><tr><td class="line-number" value="5303"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5304"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5305"></td><td class="line-content">    } </td></tr><tr><td class="line-number" value="5306"></td><td class="line-content">  };</td></tr><tr><td class="line-number" value="5307"></td><td class="line-content">  // NOTE: I originally impemented automatic evaluation on DOM mutations, but then there's this problem: https://www.reddit.com/r/perchance/comments/bz9vcu/dev_fixed_a_bug_in_the_engine_today_thanks_to/erbcjr1</td></tr><tr><td class="line-number" value="5308"></td><td class="line-content">  //       Basically, the problem is that a mutation will take {&lt;button&gt;button1&lt;/button&gt;|&lt;button&gt;button2&lt;/button&gt;} and spread it over FIVE DOM nodes, and so we can't render it. I was originally working under that (bad) assumption that</td></tr><tr><td class="line-number" value="5309"></td><td class="line-content">  //       each mutation would sort of be "contained" within a single text/attribute node. In retrospect this whole idea is very silly. Instead, the generator maker should render their content with evaluateItem and THEN put that into the innerHTML of some element.</td></tr><tr><td class="line-number" value="5310"></td><td class="line-content">  // EDIT: Actually, we still need to ___reAttachDomElementEventsWithRoot for the new elements! Otherwise if they dynamically add an element (e.g. by having `output.innerHTML = someHTML` within an element's onclick handler) that itself has inline event handlers,</td></tr><tr><td class="line-number" value="5311"></td><td class="line-content">  //       then those new element's handlers wouldn't be wrapped in `with(root) { ... }`. So we still need this (but I've commented out the "rendering" stuff). Here's an example that wouldn't work without this mutation stuff: https://perchance.org/t3c1hm87wv</td></tr><tr><td class="line-number" value="5312"></td><td class="line-content">  let ___observer = new MutationObserver(mutationCallback);</td></tr><tr><td class="line-number" value="5313"></td><td class="line-content">  document.addEventListener("DOMContentLoaded", function() {</td></tr><tr><td class="line-number" value="5314"></td><td class="line-content">    ___observer.observe(document.querySelector("#output-container"), { childList: true, subtree: true, attributes: true });</td></tr><tr><td class="line-number" value="5315"></td><td class="line-content">  });</td></tr><tr><td class="line-number" value="5316"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5317"></td><td class="line-content">  function ___getAllDescendentNodesIncludingTextNodes(element, nodes=[]) { // but not scripts and styles...</td></tr><tr><td class="line-number" value="5318"></td><td class="line-content">    for(let child of element.childNodes) {</td></tr><tr><td class="line-number" value="5319"></td><td class="line-content">      if(child.nodeType === Node.ELEMENT_NODE &amp;&amp; child.tagName.toLowerCase() !== 'script' &amp;&amp; child.tagName.toLowerCase() !== 'style') {</td></tr><tr><td class="line-number" value="5320"></td><td class="line-content">        nodes.push(child);</td></tr><tr><td class="line-number" value="5321"></td><td class="line-content">        ___getAllDescendentNodesIncludingTextNodes(child, nodes);</td></tr><tr><td class="line-number" value="5322"></td><td class="line-content">      } else if(child.nodeType === Node.TEXT_NODE) {</td></tr><tr><td class="line-number" value="5323"></td><td class="line-content">        nodes.push(child);</td></tr><tr><td class="line-number" value="5324"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5325"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5326"></td><td class="line-content">    return nodes;</td></tr><tr><td class="line-number" value="5327"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="5328"></td><td class="line-content">  function ___getAllTextNodeDescendents(element, nodes=[]) { // but not scripts and styles...</td></tr><tr><td class="line-number" value="5329"></td><td class="line-content">    for(let child of element.childNodes) {</td></tr><tr><td class="line-number" value="5330"></td><td class="line-content">      if(child.nodeType === Node.ELEMENT_NODE &amp;&amp; child.tagName.toLowerCase() !== 'script' &amp;&amp; child.tagName.toLowerCase() !== 'style') {</td></tr><tr><td class="line-number" value="5331"></td><td class="line-content">        ___getAllDescendentNodesIncludingTextNodes(child, nodes);</td></tr><tr><td class="line-number" value="5332"></td><td class="line-content">      } else if(child.nodeType === Node.TEXT_NODE) {</td></tr><tr><td class="line-number" value="5333"></td><td class="line-content">        nodes.push(child);</td></tr><tr><td class="line-number" value="5334"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5335"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5336"></td><td class="line-content">    return nodes;</td></tr><tr><td class="line-number" value="5337"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="5338"></td><td class="line-content">  function ___isRenderableDomNode(node) {</td></tr><tr><td class="line-number" value="5339"></td><td class="line-content">    return node.nodeType === 3 || (node.nodeType === 1 &amp;&amp; node.tagName.toLowerCase() !== 'script' &amp;&amp; node.tagName.toLowerCase() !== 'style');</td></tr><tr><td class="line-number" value="5340"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="5341"></td><td class="line-content">  <span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="5342"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5343"></td><td class="line-content">  <span class="html-tag">&lt;style&gt;</span></td></tr><tr><td class="line-number" value="5344"></td><td class="line-content">  #perchance-error-container {</td></tr><tr><td class="line-number" value="5345"></td><td class="line-content">    display: none;</td></tr><tr><td class="line-number" value="5346"></td><td class="line-content">    position: fixed;</td></tr><tr><td class="line-number" value="5347"></td><td class="line-content">    top: 0;</td></tr><tr><td class="line-number" value="5348"></td><td class="line-content">    left: 0;</td></tr><tr><td class="line-number" value="5349"></td><td class="line-content">    right: 0;</td></tr><tr><td class="line-number" value="5350"></td><td class="line-content">    bottom: 0;</td></tr><tr><td class="line-number" value="5351"></td><td class="line-content">    font-family:monospace;</td></tr><tr><td class="line-number" value="5352"></td><td class="line-content">    z-index:1000000001;</td></tr><tr><td class="line-number" value="5353"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="5354"></td><td class="line-content">  #perchance-error-container blockquote {   </td></tr><tr><td class="line-number" value="5355"></td><td class="line-content">    background: #eee;</td></tr><tr><td class="line-number" value="5356"></td><td class="line-content">    padding: 1em;</td></tr><tr><td class="line-number" value="5357"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="5358"></td><td class="line-content">  #perchance-error-container .perchance-error-outer-wrapper {</td></tr><tr><td class="line-number" value="5359"></td><td class="line-content">    margin: auto;</td></tr><tr><td class="line-number" value="5360"></td><td class="line-content">    box-sizing: border-box;</td></tr><tr><td class="line-number" value="5361"></td><td class="line-content">    max-width:90%;</td></tr><tr><td class="line-number" value="5362"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="5363"></td><td class="line-content">  #perchance-error-container .perchance-error-background { </td></tr><tr><td class="line-number" value="5364"></td><td class="line-content">    z-index: -1;</td></tr><tr><td class="line-number" value="5365"></td><td class="line-content">    position:fixed;</td></tr><tr><td class="line-number" value="5366"></td><td class="line-content">    top:0;</td></tr><tr><td class="line-number" value="5367"></td><td class="line-content">    left:0;</td></tr><tr><td class="line-number" value="5368"></td><td class="line-content">    width:100%;</td></tr><tr><td class="line-number" value="5369"></td><td class="line-content">    height:100%;</td></tr><tr><td class="line-number" value="5370"></td><td class="line-content">    opacity:0.2;</td></tr><tr><td class="line-number" value="5371"></td><td class="line-content">    background:#000;</td></tr><tr><td class="line-number" value="5372"></td><td class="line-content">    transition: opacity .15s linear;</td></tr><tr><td class="line-number" value="5373"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="5374"></td><td class="line-content">  #perchance-error-container .perchance-error-content-wrapper {</td></tr><tr><td class="line-number" value="5375"></td><td class="line-content">    overflow:hidden;</td></tr><tr><td class="line-number" value="5376"></td><td class="line-content">    background:#fff;</td></tr><tr><td class="line-number" value="5377"></td><td class="line-content">    height:100%;</td></tr><tr><td class="line-number" value="5378"></td><td class="line-content">    width:100%;</td></tr><tr><td class="line-number" value="5379"></td><td class="line-content">    border-radius:3px;</td></tr><tr><td class="line-number" value="5380"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="5381"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5382"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5383"></td><td class="line-content">  /* DEFAULT CONTENT STYLES */</td></tr><tr><td class="line-number" value="5384"></td><td class="line-content">  #perchance-error-container button, #perchance-error-container input {</td></tr><tr><td class="line-number" value="5385"></td><td class="line-content">    height:3em;</td></tr><tr><td class="line-number" value="5386"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="5387"></td><td class="line-content">  #perchance-error-container button {</td></tr><tr><td class="line-number" value="5388"></td><td class="line-content">    background:#eee;</td></tr><tr><td class="line-number" value="5389"></td><td class="line-content">    color:#444;</td></tr><tr><td class="line-number" value="5390"></td><td class="line-content">    width:50%;</td></tr><tr><td class="line-number" value="5391"></td><td class="line-content">    border:none;</td></tr><tr><td class="line-number" value="5392"></td><td class="line-content">    outline:none;</td></tr><tr><td class="line-number" value="5393"></td><td class="line-content">    font-size: 90%;</td></tr><tr><td class="line-number" value="5394"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="5395"></td><td class="line-content">  #perchance-error-container button:hover { background:#e1e1e1; }</td></tr><tr><td class="line-number" value="5396"></td><td class="line-content">  #perchance-error-container button.main { background:#444; color:white; }</td></tr><tr><td class="line-number" value="5397"></td><td class="line-content">  #perchance-error-container button.main:hover { background:#333; }</td></tr><tr><td class="line-number" value="5398"></td><td class="line-content">  #perchance-error-container span.link {</td></tr><tr><td class="line-number" value="5399"></td><td class="line-content">    cursor:pointer;</td></tr><tr><td class="line-number" value="5400"></td><td class="line-content">    text-decoration:underline;</td></tr><tr><td class="line-number" value="5401"></td><td class="line-content">    color:#1212ff;</td></tr><tr><td class="line-number" value="5402"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="5403"></td><td class="line-content">  #perchance-error-container code {</td></tr><tr><td class="line-number" value="5404"></td><td class="line-content">    padding: 0.1em 0.3em;</td></tr><tr><td class="line-number" value="5405"></td><td class="line-content">    background:#eee;</td></tr><tr><td class="line-number" value="5406"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="5407"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5408"></td><td class="line-content">  <span class="html-tag">&lt;/style&gt;</span></td></tr><tr><td class="line-number" value="5409"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5410"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5411"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="5412"></td><td class="line-content">    let __perchanceErrorString = "";</td></tr><tr><td class="line-number" value="5413"></td><td class="line-content">    let __maxPerchanceErrorCount = 20;</td></tr><tr><td class="line-number" value="5414"></td><td class="line-content">    let __currentPerchanceErrorCount = 0;</td></tr><tr><td class="line-number" value="5415"></td><td class="line-content">    window.__lastPerchanceErrorTime = null;</td></tr><tr><td class="line-number" value="5416"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5417"></td><td class="line-content">    window.addEventListener('unhandledrejection', function(event) {</td></tr><tr><td class="line-number" value="5418"></td><td class="line-content">      if(window.__lastPerchanceFnExecutionDetails &amp;&amp; __lastPerchanceFnExecutionDetails.async &amp;&amp; Date.now()-window.__lastPerchanceFnExecutionDetails.time &lt; 2000) { // = {declarationLineNumber:${lines[i].lineNumber}, moduleName:"${moduleName}"};</td></tr><tr><td class="line-number" value="5419"></td><td class="line-content">        __perchanceError(`This possibly occurred within an &lt;b&gt;async&lt;/b&gt; function. It &lt;u&gt;may&lt;/u&gt; be related to the function defined at line number &lt;b&gt;${window.__lastPerchanceFnExecutionDetails.declarationLineNumber}&lt;/b&gt;. Here's the error: &lt;b&gt;Unhandled Promise Rejection: ${event.reason}&lt;/b&gt;`, {moduleName:window.__lastPerchanceFnExecutionDetails.moduleName});</td></tr><tr><td class="line-number" value="5420"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="5421"></td><td class="line-content">        __perchanceError(`An unhandled promise rejection occurred: ${event.reason}`);</td></tr><tr><td class="line-number" value="5422"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5423"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="5424"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5425"></td><td class="line-content">    function __perchanceError(message, ctx={}) {</td></tr><tr><td class="line-number" value="5426"></td><td class="line-content">      // __evaluateCurlyBlock, __getTextOddsDetails, __oddsTextToNumber</td></tr><tr><td class="line-number" value="5427"></td><td class="line-content">      window.__lastPerchanceErrorTime = Date.now();</td></tr><tr><td class="line-number" value="5428"></td><td class="line-content">      __currentPerchanceErrorCount++;</td></tr><tr><td class="line-number" value="5429"></td><td class="line-content">      if(__currentPerchanceErrorCount &gt; __maxPerchanceErrorCount) return;</td></tr><tr><td class="line-number" value="5430"></td><td class="line-content">      message = message.replace(/#&lt;Object&gt;/g,"#&amp;lt;Object&amp;gt;");</td></tr><tr><td class="line-number" value="5431"></td><td class="line-content">      if(__ignorePerchanceErrors) { return; } // needed to ignore errors in "secondary parses" (like the one to extract html imports)</td></tr><tr><td class="line-number" value="5432"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5433"></td><td class="line-content">      if(!document.querySelector("#perchance-error-indicator")) {</td></tr><tr><td class="line-number" value="5434"></td><td class="line-content">        let div = document.createElement("div");</td></tr><tr><td class="line-number" value="5435"></td><td class="line-content">        div.innerHTML = `&lt;div id="perchance-error-indicator" style="position:fixed; bottom:8px; right:8px; z-index:1000000000; "&gt;</td></tr><tr><td class="line-number" value="5436"></td><td class="line-content">          &lt;span onclick="__clearPerchanceErrors();" style="font-size:80%;padding: 0.3rem 0.5rem;border-radius: 4px;background:#565656; color:white; cursor:pointer;"&gt; clear&lt;/span&gt;</td></tr><tr><td class="line-number" value="5437"></td><td class="line-content">          &lt;span onclick="__showPerchanceErrorBox();" style="display: inline-block;padding: 0.3rem 0.5rem;border-radius: 4px;font-size:80%;background-color: #fc5b5b;color:white;cursor:pointer;"&gt;This page has errors (click here)&lt;/span&gt;</td></tr><tr><td class="line-number" value="5438"></td><td class="line-content">        &lt;/div&gt;`;</td></tr><tr><td class="line-number" value="5439"></td><td class="line-content">        document.body.append(div.firstElementChild);</td></tr><tr><td class="line-number" value="5440"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5441"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="5442"></td><td class="line-content">      let intro;</td></tr><tr><td class="line-number" value="5443"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5444"></td><td class="line-content">      if(ctx.declarationLineNumber) {</td></tr><tr><td class="line-number" value="5445"></td><td class="line-content">        let isInClone = false;</td></tr><tr><td class="line-number" value="5446"></td><td class="line-content">        let declarationLineNumber = ctx.declarationLineNumber;</td></tr><tr><td class="line-number" value="5447"></td><td class="line-content">        if(ctx.node) {</td></tr><tr><td class="line-number" value="5448"></td><td class="line-content">          try {</td></tr><tr><td class="line-number" value="5449"></td><td class="line-content">            // this only works if the node itself was cloned, or the node's parent, or the node's parent's parent. no deeper than that. it probably catches 90% of cases, I'd guess.</td></tr><tr><td class="line-number" value="5450"></td><td class="line-content">            if(___clonedNodeToOriginalNodeWeakMap.has(ctx.node)) {</td></tr><tr><td class="line-number" value="5451"></td><td class="line-content">              let originalNode = ___clonedNodeToOriginalNodeWeakMap.get(ctx.node);</td></tr><tr><td class="line-number" value="5452"></td><td class="line-content">              declarationLineNumber = originalNode.$declarationLineNumber;</td></tr><tr><td class="line-number" value="5453"></td><td class="line-content">              isInClone = true;</td></tr><tr><td class="line-number" value="5454"></td><td class="line-content">            } else if(ctx.node.$parent &amp;&amp; ___clonedNodeToOriginalNodeWeakMap.has(ctx.node.$parent)) {</td></tr><tr><td class="line-number" value="5455"></td><td class="line-content">              let originalNodeParent = ___clonedNodeToOriginalNodeWeakMap.get(ctx.node.$parent);</td></tr><tr><td class="line-number" value="5456"></td><td class="line-content">              let originalNode = originalNodeParent[ctx.node.$key];</td></tr><tr><td class="line-number" value="5457"></td><td class="line-content">              if(originalNode) {</td></tr><tr><td class="line-number" value="5458"></td><td class="line-content">                declarationLineNumber = originalNode.$declarationLineNumber;</td></tr><tr><td class="line-number" value="5459"></td><td class="line-content">                isInClone = true;</td></tr><tr><td class="line-number" value="5460"></td><td class="line-content">              } else {</td></tr><tr><td class="line-number" value="5461"></td><td class="line-content">                console.error("Couldn't find original node in cloned parent?");</td></tr><tr><td class="line-number" value="5462"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="5463"></td><td class="line-content">            } else if(ctx.node.$parent.$parent &amp;&amp; ___clonedNodeToOriginalNodeWeakMap.has(ctx.node.$parent.$parent)) {</td></tr><tr><td class="line-number" value="5464"></td><td class="line-content">              let originalNodeParentParent = ___clonedNodeToOriginalNodeWeakMap.get(ctx.node.$parent.$parent);</td></tr><tr><td class="line-number" value="5465"></td><td class="line-content">              let originalNodeParent = originalNodeParentParent[ctx.node.$parent.$key];</td></tr><tr><td class="line-number" value="5466"></td><td class="line-content">              if(originalNodeParent) {</td></tr><tr><td class="line-number" value="5467"></td><td class="line-content">                let originalNode = originalNodeParent[ctx.node.$key];</td></tr><tr><td class="line-number" value="5468"></td><td class="line-content">                if(originalNode) {</td></tr><tr><td class="line-number" value="5469"></td><td class="line-content">                  declarationLineNumber = originalNode.$declarationLineNumber;</td></tr><tr><td class="line-number" value="5470"></td><td class="line-content">                  isInClone = true;</td></tr><tr><td class="line-number" value="5471"></td><td class="line-content">                } else {</td></tr><tr><td class="line-number" value="5472"></td><td class="line-content">                  console.error("Couldn't find original node in cloned parent?");</td></tr><tr><td class="line-number" value="5473"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="5474"></td><td class="line-content">              } else {</td></tr><tr><td class="line-number" value="5475"></td><td class="line-content">                console.error("Couldn't find original node in cloned parent?");</td></tr><tr><td class="line-number" value="5476"></td><td class="line-content">              }</td></tr><tr><td class="line-number" value="5477"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="5478"></td><td class="line-content">          } catch(e) {</td></tr><tr><td class="line-number" value="5479"></td><td class="line-content">            console.error(e);</td></tr><tr><td class="line-number" value="5480"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5481"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5482"></td><td class="line-content">        intro = `&lt;span style="opacity:0.7;"&gt;${ctx.moduleName &amp;&amp; ctx.moduleName !== window.generatorName ? `There is a problem with the '&lt;a style="color:blue; font-family:inherit; font-weight:bold;" href="https://perchance.org/${ctx.moduleName}#edit" target="_blank"&gt;${ctx.moduleName}&lt;/a&gt;' generator. ` : ""}An error has occurred${isInClone ? ` in a &lt;b&gt;clone&lt;/b&gt; of an item` : ""} near &lt;b style='color:red;'&gt;line number ${declarationLineNumber}&lt;/b&gt;:&lt;/span&gt;`;</td></tr><tr><td class="line-number" value="5483"></td><td class="line-content">      } else {</td></tr><tr><td class="line-number" value="5484"></td><td class="line-content">        intro = `&lt;span style="opacity:0.7;"&gt;${ctx.moduleName &amp;&amp; ctx.moduleName !== window.generatorName ? `There is a problem with the '&lt;a style="color:blue; font-family:inherit; font-weight:bold;" href="https://perchance.org/${ctx.moduleName}#edit" target="_blank"&gt;${ctx.moduleName}&lt;/a&gt;' generator. ` : ""}An error has occurred somewhere in your code (in lists or HTML):&lt;/span&gt;`;</td></tr><tr><td class="line-number" value="5485"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5486"></td><td class="line-content">      __perchanceErrorString += `&lt;div&gt;${intro} ${message}&lt;/div&gt;&lt;hr style="border: 1px solid #e1e1e1;"/&gt;`;</td></tr><tr><td class="line-number" value="5487"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5488"></td><td class="line-content">      // The following line is a hack to make it so "pause on caught errors" works for perchance errors in devtools.</td></tr><tr><td class="line-number" value="5489"></td><td class="line-content">      // Click the function names in the "call stack" to go "back in time" and find more details about your error (ask for help on the forum if needed)</td></tr><tr><td class="line-number" value="5490"></td><td class="line-content">      try { throw new Error(""); } catch(e) {}</td></tr><tr><td class="line-number" value="5491"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5492"></td><td class="line-content">    function __clearPerchanceErrors() {</td></tr><tr><td class="line-number" value="5493"></td><td class="line-content">      if(document.querySelector("#perchance-error-container")) document.querySelector("#perchance-error-container").remove();</td></tr><tr><td class="line-number" value="5494"></td><td class="line-content">      if(document.querySelector("#perchance-error-indicator")) document.querySelector("#perchance-error-indicator").remove();</td></tr><tr><td class="line-number" value="5495"></td><td class="line-content">      __perchanceErrorString = "";</td></tr><tr><td class="line-number" value="5496"></td><td class="line-content">      __currentPerchanceErrorCount = 0;</td></tr><tr><td class="line-number" value="5497"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5498"></td><td class="line-content">    window.clearPerchanceErrors = __clearPerchanceErrors; // public version</td></tr><tr><td class="line-number" value="5499"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5500"></td><td class="line-content">    window.ignorePerchanceErrors = function(cb) {</td></tr><tr><td class="line-number" value="5501"></td><td class="line-content">      let orig = __ignorePerchanceErrors;</td></tr><tr><td class="line-number" value="5502"></td><td class="line-content">      __ignorePerchanceErrors = true;</td></tr><tr><td class="line-number" value="5503"></td><td class="line-content">      let result = cb();</td></tr><tr><td class="line-number" value="5504"></td><td class="line-content">      __ignorePerchanceErrors = orig;</td></tr><tr><td class="line-number" value="5505"></td><td class="line-content">      return result;</td></tr><tr><td class="line-number" value="5506"></td><td class="line-content">    };</td></tr><tr><td class="line-number" value="5507"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5508"></td><td class="line-content">    function __showPerchanceErrorBox() {</td></tr><tr><td class="line-number" value="5509"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5510"></td><td class="line-content">      if(document.querySelector("#perchance-error-container")) document.querySelector("#perchance-error-container").remove();</td></tr><tr><td class="line-number" value="5511"></td><td class="line-content">      let div = document.createElement("div");</td></tr><tr><td class="line-number" value="5512"></td><td class="line-content">      div.innerHTML = `</td></tr><tr><td class="line-number" value="5513"></td><td class="line-content">      &lt;div id="perchance-error-container" style="display:flex; color:rgb(25, 25, 25); font-family:monospace;"&gt;</td></tr><tr><td class="line-number" value="5514"></td><td class="line-content">        &lt;div style="" class="perchance-error-background" onclick="document.querySelector('#perchance-error-container').remove();"&gt;&lt;/div&gt;</td></tr><tr><td class="line-number" value="5515"></td><td class="line-content">        &lt;div style="z-index:51;" class="perchance-error-outer-wrapper" onclick="if(document.querySelector('#perchance-error-container') &amp;&amp; !document.querySelector('#perchance-error-container').contains(event.target)) { document.querySelector('#perchance-error-container').remove(); }"&gt;</td></tr><tr><td class="line-number" value="5516"></td><td class="line-content">          &lt;div ref="contentWrapper" class="perchance-error-content-wrapper"&gt;</td></tr><tr><td class="line-number" value="5517"></td><td class="line-content">            &lt;div class="perchance-error-view"&gt;</td></tr><tr><td class="line-number" value="5518"></td><td class="line-content">              &lt;div class="perchance-error-modal-body" style="max-height: 350px; overflow-y: auto; padding: 1em; text-align: left;"&gt;</td></tr><tr><td class="line-number" value="5519"></td><td class="line-content">                &lt;div id="perchance-error-stream"&gt;&lt;/div&gt;</td></tr><tr><td class="line-number" value="5520"></td><td class="line-content">                &lt;p style="background: #b5ffb5; padding: 1em; margin-bottom: 0;"&gt;If you need help with errors, please post a question to the &lt;a href="https://lemmy.world/c/perchance"&gt;perchance community&lt;/a&gt; along with a link to your generator and someone will take a look at it for you :)&lt;/p&gt;</td></tr><tr><td class="line-number" value="5521"></td><td class="line-content">              &lt;/div&gt;</td></tr><tr><td class="line-number" value="5522"></td><td class="line-content">              &lt;div class="perchance-error-modal-footer"&gt;</td></tr><tr><td class="line-number" value="5523"></td><td class="line-content">                &lt;button class="perchance-error-main" style="width:100%;" onclick="document.querySelector('#perchance-error-container').remove();"&gt;close&lt;/button&gt;</td></tr><tr><td class="line-number" value="5524"></td><td class="line-content">              &lt;/div&gt;</td></tr><tr><td class="line-number" value="5525"></td><td class="line-content">            &lt;/div&gt;</td></tr><tr><td class="line-number" value="5526"></td><td class="line-content">          &lt;/div&gt;</td></tr><tr><td class="line-number" value="5527"></td><td class="line-content">        &lt;/div&gt;</td></tr><tr><td class="line-number" value="5528"></td><td class="line-content">      &lt;/div&gt;`;</td></tr><tr><td class="line-number" value="5529"></td><td class="line-content">      document.body.append(div.firstElementChild);</td></tr><tr><td class="line-number" value="5530"></td><td class="line-content">      document.querySelector("#perchance-error-stream").innerHTML = __perchanceErrorString;</td></tr><tr><td class="line-number" value="5531"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5532"></td><td class="line-content">      // to override user styles on the page:</td></tr><tr><td class="line-number" value="5533"></td><td class="line-content">      document.querySelectorAll("#perchance-error-container *").forEach(el =&gt; {</td></tr><tr><td class="line-number" value="5534"></td><td class="line-content">        el.style.cssText += ";font-family:inherit;";</td></tr><tr><td class="line-number" value="5535"></td><td class="line-content">        if(!el.style.cssText.includes("color")) el.style.cssText += ";color:inherit;";</td></tr><tr><td class="line-number" value="5536"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="5537"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5538"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5539"></td><td class="line-content">    // override clicks on href="#foo" links - since otherwise due to &lt;base&gt; tag's target="_parent" it would cause a top-level navigation</td></tr><tr><td class="line-number" value="5540"></td><td class="line-content">    document.addEventListener('click', (e) =&gt; {</td></tr><tr><td class="line-number" value="5541"></td><td class="line-content">      let target = e.target.closest('a');</td></tr><tr><td class="line-number" value="5542"></td><td class="line-content">      if(target) {</td></tr><tr><td class="line-number" value="5543"></td><td class="line-content">        if(target.getAttribute("href") &amp;&amp; target.getAttribute("href").startsWith("#")) {</td></tr><tr><td class="line-number" value="5544"></td><td class="line-content">          e.preventDefault();</td></tr><tr><td class="line-number" value="5545"></td><td class="line-content">          if(window.location.hash === target.getAttribute("href")) { // if it's already set to that, browsers still trigger the scroll. we need to do that manually</td></tr><tr><td class="line-number" value="5546"></td><td class="line-content">            const element = document.getElementById(window.location.hash.slice(1));</td></tr><tr><td class="line-number" value="5547"></td><td class="line-content">            if(element) element.scrollIntoView({behavior:'auto'});</td></tr><tr><td class="line-number" value="5548"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="5549"></td><td class="line-content">            window.location.hash = target.getAttribute("href"); // scroll is triggered automatically</td></tr><tr><td class="line-number" value="5550"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5551"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5552"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5553"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="5554"></td><td class="line-content">  <span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="5555"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="5556"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="5557"></td><td class="line-content">    (async function() {</td></tr><tr><td class="line-number" value="5558"></td><td class="line-content">      if((window.location.host === "null.perchance.org" || window.location.host === `${window.generatorPublicId}.perchance.org`) &amp;&amp; !navigator["\u0077\u0065\u0062\u0064\u0072\u0069\u0076\u0065\u0072"]) {</td></tr><tr><td class="line-number" value="5559"></td><td class="line-content">        await new Promise(r =&gt; setTimeout(r, 1000*10));</td></tr><tr><td class="line-number" value="5560"></td><td class="line-content">        while(1) {</td></tr><tr><td class="line-number" value="5561"></td><td class="line-content">          await new Promise(r =&gt; { ["mouseenter", "mousemove", "touchstart"].forEach(n =&gt; document.addEventListener(n, e=&gt;{ if(e.isTrusted){r()} }, { once: true })); });</td></tr><tr><td class="line-number" value="5562"></td><td class="line-content">          while(document.visibilityState !== "visible" || !document.hasFocus()) await new Promise(r =&gt; setTimeout(r, 1000));</td></tr><tr><td class="line-number" value="5563"></td><td class="line-content">          await new Promise(r =&gt; setTimeout(r, 1000*90));</td></tr><tr><td class="line-number" value="5564"></td><td class="line-content">          fetch(`https://perchance.org/api/cv?generatorName=${window.location.pathname.slice(1)}&amp;isFromEmbed=1&amp;__cacheBust=${Math.random()}`, {mode:"no-cors"}).catch(e =&gt; console.error(e));</td></tr><tr><td class="line-number" value="5565"></td><td class="line-content">          await new Promise(r =&gt; setTimeout(r, 1000*60*60*6));</td></tr><tr><td class="line-number" value="5566"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5567"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5568"></td><td class="line-content">    })();</td></tr><tr><td class="line-number" value="5569"></td><td class="line-content">  <span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="5570"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="5571"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="5572"></td><td class="line-content">    (function() {</td></tr><tr><td class="line-number" value="5573"></td><td class="line-content">      if(window.location.host !== "null.perchance.org" &amp;&amp; window.location.host !== `${window.generatorPublicId}.perchance.org`) return;</td></tr><tr><td class="line-number" value="5574"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="5575"></td><td class="line-content">      let alreadySentSignal = false; // just to be sure</td></tr><tr><td class="line-number" value="5576"></td><td class="line-content">      let interval;</td></tr><tr><td class="line-number" value="5577"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5578"></td><td class="line-content">      let alreadyInitedFocusBugFix = false;</td></tr><tr><td class="line-number" value="5579"></td><td class="line-content">      function initFocusBugFix() {</td></tr><tr><td class="line-number" value="5580"></td><td class="line-content">        if(alreadyInitedFocusBugFix) return;</td></tr><tr><td class="line-number" value="5581"></td><td class="line-content">        alreadyInitedFocusBugFix = true;</td></tr><tr><td class="line-number" value="5582"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5583"></td><td class="line-content">        if(window.location.hash.startsWith("#disable_focus_fix")) return;</td></tr><tr><td class="line-number" value="5584"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5585"></td><td class="line-content">        function elementOverlapsWithViewport(el) {</td></tr><tr><td class="line-number" value="5586"></td><td class="line-content">          const rect = el.getBoundingClientRect();</td></tr><tr><td class="line-number" value="5587"></td><td class="line-content">          return (</td></tr><tr><td class="line-number" value="5588"></td><td class="line-content">            rect.top &lt; (window.innerHeight || document.documentElement.clientHeight) &amp;&amp;</td></tr><tr><td class="line-number" value="5589"></td><td class="line-content">            rect.bottom &gt; 0 &amp;&amp;</td></tr><tr><td class="line-number" value="5590"></td><td class="line-content">            rect.left &lt; (window.innerWidth || document.documentElement.clientWidth) &amp;&amp;</td></tr><tr><td class="line-number" value="5591"></td><td class="line-content">            rect.right &gt; 0</td></tr><tr><td class="line-number" value="5592"></td><td class="line-content">          );</td></tr><tr><td class="line-number" value="5593"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5594"></td><td class="line-content">        </td></tr><tr><td class="line-number" value="5595"></td><td class="line-content">        setInterval(() =&gt; {</td></tr><tr><td class="line-number" value="5596"></td><td class="line-content">          if(document.hasFocus()) {</td></tr><tr><td class="line-number" value="5597"></td><td class="line-content">            __parentWindow.postMessage({type:"outputIframeCurrentlyHasFocus", time:Date.now()}, "https://perchance.org");</td></tr><tr><td class="line-number" value="5598"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5599"></td><td class="line-content">        }, 1000);</td></tr><tr><td class="line-number" value="5600"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5601"></td><td class="line-content">        let enableStrongFocusFix = false; // for whether it should be enabled at all</td></tr><tr><td class="line-number" value="5602"></td><td class="line-content">        let pauseStrongFocusFix = false; // parent sends signal to set this to true if/when user taps anything in parent DOM</td></tr><tr><td class="line-number" value="5603"></td><td class="line-content">        window.addEventListener("message", function(e) {</td></tr><tr><td class="line-number" value="5604"></td><td class="line-content">          if(e.source !== __parentWindow || e.origin !== "https://perchance.org") return;</td></tr><tr><td class="line-number" value="5605"></td><td class="line-content">          </td></tr><tr><td class="line-number" value="5606"></td><td class="line-content">          if(e.data.type === "enableStrongFocusFix") {</td></tr><tr><td class="line-number" value="5607"></td><td class="line-content">            console.debug(" embed enabled focus fix:", e);</td></tr><tr><td class="line-number" value="5608"></td><td class="line-content">            enableStrongFocusFix = true; </td></tr><tr><td class="line-number" value="5609"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5610"></td><td class="line-content">          if(e.data.type === "pauseStrongFocusFix") {</td></tr><tr><td class="line-number" value="5611"></td><td class="line-content">            if(pauseStrongFocusFix === false) console.debug(" embed paused focus fix:", e);</td></tr><tr><td class="line-number" value="5612"></td><td class="line-content">            pauseStrongFocusFix = true; // pause until user interacts with the DOM in this frame again</td></tr><tr><td class="line-number" value="5613"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5614"></td><td class="line-content">        });</td></tr><tr><td class="line-number" value="5615"></td><td class="line-content">        let lastTappedElement = null;</td></tr><tr><td class="line-number" value="5616"></td><td class="line-content">        window.addEventListener("pointerdown", function(e) {</td></tr><tr><td class="line-number" value="5617"></td><td class="line-content">          if(pauseStrongFocusFix === true) console.debug(" embed UNpaused focus fix:", e);</td></tr><tr><td class="line-number" value="5618"></td><td class="line-content">          pauseStrongFocusFix = false; // unpause because we know user is back in this embed</td></tr><tr><td class="line-number" value="5619"></td><td class="line-content">          lastTappedElement = e.target;</td></tr><tr><td class="line-number" value="5620"></td><td class="line-content">        });</td></tr><tr><td class="line-number" value="5621"></td><td class="line-content">        window.addEventListener("blur", function() {</td></tr><tr><td class="line-number" value="5622"></td><td class="line-content">          if(!lastTappedElement || pauseStrongFocusFix || !enableStrongFocusFix) return;</td></tr><tr><td class="line-number" value="5623"></td><td class="line-content">          let t = lastTappedElement.tagName;</td></tr><tr><td class="line-number" value="5624"></td><td class="line-content">          // Note that on blur, it seems that (sometimes? maybe depends on mobile vs desktop?) document.body becomes the active element, regardless of what was active element the instant before that.</td></tr><tr><td class="line-number" value="5625"></td><td class="line-content">          if(t === "INPUT" || t === "TEXTAREA" &amp;&amp; (lastTappedElement === document.activeElement || document.body === document.activeElement) &amp;&amp; elementOverlapsWithViewport(lastTappedElement)) { // need the activeElement check because window blur can be triggered by clicking on an iframe *within this page* - i.e. child, not just parent. and in case of child click, that iframe becomes active element</td></tr><tr><td class="line-number" value="5626"></td><td class="line-content">            console.debug(" embed force-refocussed");</td></tr><tr><td class="line-number" value="5627"></td><td class="line-content">            setTimeout(() =&gt; lastTappedElement.focus(), 0);</td></tr><tr><td class="line-number" value="5628"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5629"></td><td class="line-content">        });</td></tr><tr><td class="line-number" value="5630"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5631"></td><td class="line-content">        // OLD VERSION:</td></tr><tr><td class="line-number" value="5632"></td><td class="line-content">        // // This is to help fix the ad-related focus bug, but it's harmless to add anyway - just makes it so focus is "recovered" to the last active element, rather than the body element.</td></tr><tr><td class="line-number" value="5633"></td><td class="line-content">        // let lastActiveElementDuringFocus = null;</td></tr><tr><td class="line-number" value="5634"></td><td class="line-content">        // let lastActiveElementDuringFocus_selectionStart = null;</td></tr><tr><td class="line-number" value="5635"></td><td class="line-content">        // let lastActiveElementDuringFocus_selectionEnd = null;</td></tr><tr><td class="line-number" value="5636"></td><td class="line-content">        // let lastActiveElementDuringFocus_time = null;</td></tr><tr><td class="line-number" value="5637"></td><td class="line-content">        // setInterval(() =&gt; {</td></tr><tr><td class="line-number" value="5638"></td><td class="line-content">        //   if(document.hasFocus()) {</td></tr><tr><td class="line-number" value="5639"></td><td class="line-content">        //     lastActiveElementDuringFocus = document.activeElement;</td></tr><tr><td class="line-number" value="5640"></td><td class="line-content">        //     lastActiveElementDuringFocus_selectionStart = lastActiveElementDuringFocus.selectionStart;</td></tr><tr><td class="line-number" value="5641"></td><td class="line-content">        //     lastActiveElementDuringFocus_selectionEnd = lastActiveElementDuringFocus.selectionEnd;</td></tr><tr><td class="line-number" value="5642"></td><td class="line-content">        //     lastActiveElementDuringFocus_time = Date.now();</td></tr><tr><td class="line-number" value="5643"></td><td class="line-content">        //   }</td></tr><tr><td class="line-number" value="5644"></td><td class="line-content">        // }, 1000);</td></tr><tr><td class="line-number" value="5645"></td><td class="line-content">        // let lastClickTime = -1;</td></tr><tr><td class="line-number" value="5646"></td><td class="line-content">        // window.addEventListener("click", async function() {</td></tr><tr><td class="line-number" value="5647"></td><td class="line-content">        //   lastClickTime = Date.now();</td></tr><tr><td class="line-number" value="5648"></td><td class="line-content">        // });</td></tr><tr><td class="line-number" value="5649"></td><td class="line-content">        // window.addEventListener("focus", async function() {</td></tr><tr><td class="line-number" value="5650"></td><td class="line-content">        //   if(!lastActiveElementDuringFocus) return;</td></tr><tr><td class="line-number" value="5651"></td><td class="line-content">        //   const clickedRecently = Date.now()-lastClickTime &lt; 300; // if they recently clicked, then we let the click event determine the current focus</td></tr><tr><td class="line-number" value="5652"></td><td class="line-content">        //   const recentlyHadFocus = Date.now()-lastActiveElementDuringFocus_time &lt; 800;</td></tr><tr><td class="line-number" value="5653"></td><td class="line-content">        //   if(!clickedRecently &amp;&amp; recentlyHadFocus) {</td></tr><tr><td class="line-number" value="5654"></td><td class="line-content">        //     await new Promise(r =&gt; setTimeout(r, 10)); // otherwise a click doesn't have a chance to change the the active element, it seems</td></tr><tr><td class="line-number" value="5655"></td><td class="line-content">        //     // only if it was a text input element, and the current one isn't:</td></tr><tr><td class="line-number" value="5656"></td><td class="line-content">        //     const lastActiveWasTextInput = (lastActiveElementDuringFocus.nodeName === "TEXTAREA" || (lastActiveElementDuringFocus.nodeName === "INPUT" &amp;&amp; lastActiveElementDuringFocus.type === "text"));</td></tr><tr><td class="line-number" value="5657"></td><td class="line-content">        //     const currentActiveIsTextInput = (document.activeElement.nodeName === "TEXTAREA" || (document.activeElement.nodeName === "INPUT" &amp;&amp; document.activeElement.type === "text"));</td></tr><tr><td class="line-number" value="5658"></td><td class="line-content">        //     if(lastActiveWasTextInput &amp;&amp; !currentActiveIsTextInput &amp;&amp; document.activeElement !== lastActiveElementDuringFocus) {</td></tr><tr><td class="line-number" value="5659"></td><td class="line-content">        //       lastActiveElementDuringFocus.focus();</td></tr><tr><td class="line-number" value="5660"></td><td class="line-content">        //       lastActiveElementDuringFocus.click();</td></tr><tr><td class="line-number" value="5661"></td><td class="line-content">        //       // lastActiveElementDuringFocus.setSelectionRange(lastActiveElementDuringFocus_selectionStart, lastActiveElementDuringFocus_selectionEnd);</td></tr><tr><td class="line-number" value="5662"></td><td class="line-content">        //       console.debug("Refocussed input element.", document.activeElement, lastActiveElementDuringFocus, lastActiveWasTextInput, currentActiveIsTextInput, lastActiveElementDuringFocus_selectionStart, lastActiveElementDuringFocus_selectionEnd);</td></tr><tr><td class="line-number" value="5663"></td><td class="line-content">        //     }</td></tr><tr><td class="line-number" value="5664"></td><td class="line-content">        //   }</td></tr><tr><td class="line-number" value="5665"></td><td class="line-content">        // });</td></tr><tr><td class="line-number" value="5666"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5667"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5668"></td><td class="line-content">      let messageType = "usingAdPoweredPlugin";</td></tr><tr><td class="line-number" value="5669"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5670"></td><td class="line-content">      // for embeds within embeds, we pass the message up the chain:</td></tr><tr><td class="line-number" value="5671"></td><td class="line-content">      window.addEventListener("message", function(e) {</td></tr><tr><td class="line-number" value="5672"></td><td class="line-content">        if(e.data.type === messageType) {</td></tr><tr><td class="line-number" value="5673"></td><td class="line-content">          __parentWindow.postMessage({type:messageType}, "*"); // must use wildcard origin because could be embed within embed</td></tr><tr><td class="line-number" value="5674"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5675"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="5676"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="5677"></td><td class="line-content">      function detectAdPoweredPlugin() {</td></tr><tr><td class="line-number" value="5678"></td><td class="line-content">        if(!alreadySentSignal) {</td></tr><tr><td class="line-number" value="5679"></td><td class="line-content">          if(window.root &amp;&amp; window.root.$moduleSpace &amp;&amp; (window.root.$moduleSpace["text-to-image-plugin"] || window.root.$moduleSpace["ai-text-plugin"])) {</td></tr><tr><td class="line-number" value="5680"></td><td class="line-content">            __parentWindow.postMessage({type:messageType}, "*"); // must use wildcard origin because could be embed within embed</td></tr><tr><td class="line-number" value="5681"></td><td class="line-content">            initFocusBugFix();</td></tr><tr><td class="line-number" value="5682"></td><td class="line-content">            clearInterval(interval);</td></tr><tr><td class="line-number" value="5683"></td><td class="line-content">            alreadySentSignal = true;</td></tr><tr><td class="line-number" value="5684"></td><td class="line-content">            return;</td></tr><tr><td class="line-number" value="5685"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5686"></td><td class="line-content">          if([...document.querySelectorAll("iframe")].filter(el =&gt; el.src.startsWith("https://image-generation.perchance.org/embed") || el.src.startsWith("https://text-generation.perchance.org/embed")).length &gt; 0) {</td></tr><tr><td class="line-number" value="5687"></td><td class="line-content">            __parentWindow.postMessage({type:messageType}, "*"); // must use wildcard origin because could be embed within embed</td></tr><tr><td class="line-number" value="5688"></td><td class="line-content">            initFocusBugFix();</td></tr><tr><td class="line-number" value="5689"></td><td class="line-content">            clearInterval(interval);</td></tr><tr><td class="line-number" value="5690"></td><td class="line-content">            alreadySentSignal = true;</td></tr><tr><td class="line-number" value="5691"></td><td class="line-content">            return;</td></tr><tr><td class="line-number" value="5692"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5693"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5694"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5695"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="5696"></td><td class="line-content">      interval = setInterval(detectAdPoweredPlugin, 1000);</td></tr><tr><td class="line-number" value="5697"></td><td class="line-content">      setTimeout(() =&gt; {</td></tr><tr><td class="line-number" value="5698"></td><td class="line-content">        clearInterval(interval);</td></tr><tr><td class="line-number" value="5699"></td><td class="line-content">        if(!alreadySentSignal) {</td></tr><tr><td class="line-number" value="5700"></td><td class="line-content">          interval = setInterval(detectAdPoweredPlugin, 10000);</td></tr><tr><td class="line-number" value="5701"></td><td class="line-content">          setTimeout(() =&gt; clearInterval(interval), 2*60*1000);</td></tr><tr><td class="line-number" value="5702"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5703"></td><td class="line-content">      }, 10000);</td></tr><tr><td class="line-number" value="5704"></td><td class="line-content">    })();</td></tr><tr><td class="line-number" value="5705"></td><td class="line-content">  <span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="5706"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5707"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="5708"></td><td class="line-content">    // CAUTION: This cache bustint stuff is still needed for when user is embedding with null.perchance.org - since in that case there's no __generatorLastEditTime, and hence no way to know if it's the latest version. </td></tr><tr><td class="line-number" value="5709"></td><td class="line-content">    (async function() {</td></tr><tr><td class="line-number" value="5710"></td><td class="line-content">      // CAUTION: we can't rely on __generatorLastEditTime because a *dependency* could have been updated.</td></tr><tr><td class="line-number" value="5711"></td><td class="line-content">      // if(window.location.href.includes("__generatorLastEditTime=")) return;</td></tr><tr><td class="line-number" value="5712"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5713"></td><td class="line-content">      // Here we tell the server to update the cache if needed, and if it did, then we temporarily bust the cache using a query string.</td></tr><tr><td class="line-number" value="5714"></td><td class="line-content">      if(window.location.host === "null.perchance.org" || window.location.host === `${window.generatorPublicId}.perchance.org`) { // only if this HTML file is hosted at null.perchance.org / &lt;publidId&gt;.perchance.org</td></tr><tr><td class="line-number" value="5715"></td><td class="line-content">        if(navigator.webdriver) return; // just in case this is what's confusing the Google crawler - RE the title bug</td></tr><tr><td class="line-number" value="5716"></td><td class="line-content">        if(window.location.href.includes("__cacheBust")) return; // no need to run this check if cache is already busted</td></tr><tr><td class="line-number" value="5717"></td><td class="line-content">        if(/__initWithDataFromParentWindow=[1-9]/.test(window.location.href)) return; // data is being loaded from parent</td></tr><tr><td class="line-number" value="5718"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5719"></td><td class="line-content">        let imports = JSON.parse(decodeURI(document.querySelector("#imported-generator-names").textContent));</td></tr><tr><td class="line-number" value="5720"></td><td class="line-content">        let clientHtmlServerRenderTime = Number(document.querySelector("#this-html-server-render-time").textContent);</td></tr><tr><td class="line-number" value="5721"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5722"></td><td class="line-content">        let transferSize = 1;</td></tr><tr><td class="line-number" value="5723"></td><td class="line-content">        try { transferSize = performance.getEntriesByType("navigation")[0].transferSize; } catch(e) {}</td></tr><tr><td class="line-number" value="5724"></td><td class="line-content">        if(isNaN(transferSize)) transferSize = 1;</td></tr><tr><td class="line-number" value="5725"></td><td class="line-content">        console.debug("Embed transfer size:", window.location.pathname, transferSize);</td></tr><tr><td class="line-number" value="5726"></td><td class="line-content">        // transferSize will be zero if it was loaded from browser cache, assuming the user's browser supports the API</td></tr><tr><td class="line-number" value="5727"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5728"></td><td class="line-content">        let checkStartTime = Date.now();</td></tr><tr><td class="line-number" value="5729"></td><td class="line-content">        let weHaveAnOldVersionOfThisGen = await fetch(`https://perchance.org/api/clearCacheIfGeneratorOrImportsHaveBeenUpdated?generatorName=${window.location.pathname.slice(1)}&amp;importedGeneratorNames=${imports.join(",")}&amp;clientHtmlServerRenderTime=${clientHtmlServerRenderTime}&amp;transferSize=${transferSize}&amp;queryParamString=${encodeURIComponent(window.location.search)}&amp;__cacheBust=${Math.random()}`).then(r =&gt; r.json());</td></tr><tr><td class="line-number" value="5730"></td><td class="line-content">        if(weHaveAnOldVersionOfThisGen) { </td></tr><tr><td class="line-number" value="5731"></td><td class="line-content">          console.debug("This is an old version of this generator.");</td></tr><tr><td class="line-number" value="5732"></td><td class="line-content">          if(Date.now()-checkStartTime &lt; 10000) {</td></tr><tr><td class="line-number" value="5733"></td><td class="line-content">            console.debug("Doing cache bust reload in embed now...");</td></tr><tr><td class="line-number" value="5734"></td><td class="line-content">            let url = new URL(window.location.href);</td></tr><tr><td class="line-number" value="5735"></td><td class="line-content">            url.searchParams.set("__cacheBust", Math.random());</td></tr><tr><td class="line-number" value="5736"></td><td class="line-content">            window.location.href = url.href;</td></tr><tr><td class="line-number" value="5737"></td><td class="line-content">          } else {</td></tr><tr><td class="line-number" value="5738"></td><td class="line-content">            console.debug("Too late to do cache bust in embed.");</td></tr><tr><td class="line-number" value="5739"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="5740"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5741"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5742"></td><td class="line-content">    })();</td></tr><tr><td class="line-number" value="5743"></td><td class="line-content">    if(location.href.includes("__cacheBust")) {</td></tr><tr><td class="line-number" value="5744"></td><td class="line-content">      let url = new URL(window.location.href);</td></tr><tr><td class="line-number" value="5745"></td><td class="line-content">      url.searchParams.delete("__cacheBust");</td></tr><tr><td class="line-number" value="5746"></td><td class="line-content">      history.__originalReplaceState({}, "", url.href);</td></tr><tr><td class="line-number" value="5747"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="5748"></td><td class="line-content">  <span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="5749"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5750"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5751"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5752"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5753"></td><td class="line-content">  <span class="html-comment">&lt;!-- OFFLINE EDITOR --&gt;</span></td></tr><tr><td class="line-number" value="5754"></td><td class="line-content">  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="5755"></td><td class="line-content">    document.addEventListener("DOMContentLoaded", function() {</td></tr><tr><td class="line-number" value="5756"></td><td class="line-content">      if(!window.location.href.startsWith("file:") || window.location.hash !== "#edit") return;</td></tr><tr><td class="line-number" value="5757"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5758"></td><td class="line-content">      let originalHtmlText = document.documentElement.outerHTML; // for editing + saving later</td></tr><tr><td class="line-number" value="5759"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5760"></td><td class="line-content">      let preloadedGeneratorDataEl = document.querySelector("#preloaded-generator-data");</td></tr><tr><td class="line-number" value="5761"></td><td class="line-content">      let preloadedGeneratorData = JSON.parse(decodeURI(preloadedGeneratorDataEl.textContent));</td></tr><tr><td class="line-number" value="5762"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="5763"></td><td class="line-content">      let importedGeneratorsEl = document.querySelector("#imported-generators");</td></tr><tr><td class="line-number" value="5764"></td><td class="line-content">      let importedGenerators = JSON.parse(decodeURI(importedGeneratorsEl.textContent));</td></tr><tr><td class="line-number" value="5765"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="5766"></td><td class="line-content">      let importedGeneratorNamesEl = document.querySelector("#imported-generator-names");</td></tr><tr><td class="line-number" value="5767"></td><td class="line-content">      let importedGeneratorNames = JSON.parse(decodeURI(importedGeneratorNamesEl.textContent));</td></tr><tr><td class="line-number" value="5768"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5769"></td><td class="line-content">      function saveTextFile(text, name) {</td></tr><tr><td class="line-number" value="5770"></td><td class="line-content">        let el = document.createElement("a");</td></tr><tr><td class="line-number" value="5771"></td><td class="line-content">        let extension = name.split(".").pop();</td></tr><tr><td class="line-number" value="5772"></td><td class="line-content">        let type = extension === "txt" ? "plain" : extension;</td></tr><tr><td class="line-number" value="5773"></td><td class="line-content">        let file = new Blob([text], {type:"text/"+extension});</td></tr><tr><td class="line-number" value="5774"></td><td class="line-content">        let url = URL.createObjectURL(file);</td></tr><tr><td class="line-number" value="5775"></td><td class="line-content">        el.href = url;</td></tr><tr><td class="line-number" value="5776"></td><td class="line-content">        el.download = name;</td></tr><tr><td class="line-number" value="5777"></td><td class="line-content">        el.style.display = 'none';</td></tr><tr><td class="line-number" value="5778"></td><td class="line-content">        document.body.appendChild(el);</td></tr><tr><td class="line-number" value="5779"></td><td class="line-content">        el.click();</td></tr><tr><td class="line-number" value="5780"></td><td class="line-content">        document.body.removeChild(el);</td></tr><tr><td class="line-number" value="5781"></td><td class="line-content">        setTimeout(() =&gt; URL.revokeObjectURL(url), 10000);</td></tr><tr><td class="line-number" value="5782"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5783"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5784"></td><td class="line-content">      function makeElementDraggable(el) { // This function expects `el` to contain an element with the `drag-handle` class.</td></tr><tr><td class="line-number" value="5785"></td><td class="line-content">        let endX = 0, endY = 0, startX = 0, startY = 0;</td></tr><tr><td class="line-number" value="5786"></td><td class="line-content">        let dragHandleEl = el.querySelector(".drag-handle");</td></tr><tr><td class="line-number" value="5787"></td><td class="line-content">        dragHandleEl.addEventListener("mousedown", dragMouseDown);</td></tr><tr><td class="line-number" value="5788"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5789"></td><td class="line-content">        function dragMouseDown(e) {</td></tr><tr><td class="line-number" value="5790"></td><td class="line-content">          e = e || window.event;</td></tr><tr><td class="line-number" value="5791"></td><td class="line-content">          e.preventDefault();</td></tr><tr><td class="line-number" value="5792"></td><td class="line-content">          // get the mouse cursor position at startup:</td></tr><tr><td class="line-number" value="5793"></td><td class="line-content">          startX = e.clientX;</td></tr><tr><td class="line-number" value="5794"></td><td class="line-content">          startY = e.clientY;</td></tr><tr><td class="line-number" value="5795"></td><td class="line-content">          document.addEventListener("mouseup", closeDragElement);</td></tr><tr><td class="line-number" value="5796"></td><td class="line-content">          document.addEventListener("mousemove", elementDrag);</td></tr><tr><td class="line-number" value="5797"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5798"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5799"></td><td class="line-content">        function elementDrag(e) {</td></tr><tr><td class="line-number" value="5800"></td><td class="line-content">          e = e || window.event;</td></tr><tr><td class="line-number" value="5801"></td><td class="line-content">          e.preventDefault();</td></tr><tr><td class="line-number" value="5802"></td><td class="line-content">          // calculate the new cursor position:</td></tr><tr><td class="line-number" value="5803"></td><td class="line-content">          endX = startX - e.clientX;</td></tr><tr><td class="line-number" value="5804"></td><td class="line-content">          endY = startY - e.clientY;</td></tr><tr><td class="line-number" value="5805"></td><td class="line-content">          startX = e.clientX;</td></tr><tr><td class="line-number" value="5806"></td><td class="line-content">          startY = e.clientY;</td></tr><tr><td class="line-number" value="5807"></td><td class="line-content">          // set the element's new position:</td></tr><tr><td class="line-number" value="5808"></td><td class="line-content">          el.style.top = (el.offsetTop - endY) + "px";</td></tr><tr><td class="line-number" value="5809"></td><td class="line-content">          el.style.left = (el.offsetLeft - endX) + "px";</td></tr><tr><td class="line-number" value="5810"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5811"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5812"></td><td class="line-content">        function closeDragElement() {</td></tr><tr><td class="line-number" value="5813"></td><td class="line-content">          // stop moving when mouse button is released:</td></tr><tr><td class="line-number" value="5814"></td><td class="line-content">          document.removeEventListener("mouseup", closeDragElement);</td></tr><tr><td class="line-number" value="5815"></td><td class="line-content">          document.removeEventListener("mousemove", elementDrag);</td></tr><tr><td class="line-number" value="5816"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5817"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5818"></td><td class="line-content">      </td></tr><tr><td class="line-number" value="5819"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5820"></td><td class="line-content">      let editorCtn = document.createElement("div");</td></tr><tr><td class="line-number" value="5821"></td><td class="line-content">      editorCtn.style.cssText = "width:700px; height:500px; position:fixed; display: flex; flex-direction: column;";</td></tr><tr><td class="line-number" value="5822"></td><td class="line-content">      editorCtn.innerHTML = `</td></tr><tr><td class="line-number" value="5823"></td><td class="line-content">        &lt;div class="header" style="display:flex; overflow:auto;"&gt; </td></tr><tr><td class="line-number" value="5824"></td><td class="line-content">          &lt;!-- &lt;div class="drag-handle" style=" display: flex; background: #e8e8e8; padding: 1rem;"&gt;&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width: 2rem;"&gt;&lt;path d="M278.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-64 64c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8h32v96H128V192c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9  34.9 6.9s19.8-16.6 19.8-29.6V288h96v96H192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64c12.5 12.5 32.8 12.5 45.3 0l64-64c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8H288V288h96v32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6v32H288V128h32c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-64-64z"&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/div&gt; --&gt;</td></tr><tr><td class="line-number" value="5825"></td><td class="line-content">          &lt;button class="drag-handle"&gt;drag&lt;/button&gt;</td></tr><tr><td class="line-number" value="5826"></td><td class="line-content">          &lt;button class="save-button"&gt;save&lt;/button&gt;</td></tr><tr><td class="line-number" value="5827"></td><td class="line-content">          &lt;div style=""&gt;</td></tr><tr><td class="line-number" value="5828"></td><td class="line-content">            &lt;div class="tabs" style="display:flex; width:max-content;"&gt;</td></tr><tr><td class="line-number" value="5829"></td><td class="line-content">              &lt;!-- tabs get inserted here --&gt;</td></tr><tr><td class="line-number" value="5830"></td><td class="line-content">            &lt;/div&gt;</td></tr><tr><td class="line-number" value="5831"></td><td class="line-content">          &lt;/div&gt;</td></tr><tr><td class="line-number" value="5832"></td><td class="line-content">        &lt;/div&gt;</td></tr><tr><td class="line-number" value="5833"></td><td class="line-content">        &lt;div class="body" style="flex-grow:1;"&gt; </td></tr><tr><td class="line-number" value="5834"></td><td class="line-content">          &lt;!-- text editors get inserted here --&gt;</td></tr><tr><td class="line-number" value="5835"></td><td class="line-content">        &lt;/div&gt;</td></tr><tr><td class="line-number" value="5836"></td><td class="line-content">      `;</td></tr><tr><td class="line-number" value="5837"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5838"></td><td class="line-content">      makeElementDraggable(editorCtn);</td></tr><tr><td class="line-number" value="5839"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5840"></td><td class="line-content">      let editors = [];</td></tr><tr><td class="line-number" value="5841"></td><td class="line-content">      editors.push({</td></tr><tr><td class="line-number" value="5842"></td><td class="line-content">        name: preloadedGeneratorData.name,</td></tr><tr><td class="line-number" value="5843"></td><td class="line-content">        content: preloadedGeneratorData.modelText,</td></tr><tr><td class="line-number" value="5844"></td><td class="line-content">        main: true,</td></tr><tr><td class="line-number" value="5845"></td><td class="line-content">        type: "lists",</td></tr><tr><td class="line-number" value="5846"></td><td class="line-content">        visible: true,</td></tr><tr><td class="line-number" value="5847"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="5848"></td><td class="line-content">      editors.push({</td></tr><tr><td class="line-number" value="5849"></td><td class="line-content">        name: preloadedGeneratorData.name,</td></tr><tr><td class="line-number" value="5850"></td><td class="line-content">        content: preloadedGeneratorData.outputTemplate,</td></tr><tr><td class="line-number" value="5851"></td><td class="line-content">        main: true,</td></tr><tr><td class="line-number" value="5852"></td><td class="line-content">        type: "html",</td></tr><tr><td class="line-number" value="5853"></td><td class="line-content">        visible: false,</td></tr><tr><td class="line-number" value="5854"></td><td class="line-content">      });</td></tr><tr><td class="line-number" value="5855"></td><td class="line-content">      for(let gen of importedGenerators) {</td></tr><tr><td class="line-number" value="5856"></td><td class="line-content">        editors.push({</td></tr><tr><td class="line-number" value="5857"></td><td class="line-content">          name: gen.name,</td></tr><tr><td class="line-number" value="5858"></td><td class="line-content">          content: gen.modelText,</td></tr><tr><td class="line-number" value="5859"></td><td class="line-content">          visible: false,</td></tr><tr><td class="line-number" value="5860"></td><td class="line-content">        });</td></tr><tr><td class="line-number" value="5861"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5862"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5863"></td><td class="line-content">      function saveGenerator() {</td></tr><tr><td class="line-number" value="5864"></td><td class="line-content">        let preloadedGeneratorData_new = JSON.parse(JSON.stringify(preloadedGeneratorData));</td></tr><tr><td class="line-number" value="5865"></td><td class="line-content">        preloadedGeneratorData_new.modelText = editors.filter(e =&gt; e.main &amp;&amp; e.type=="lists")[0].textArea.value;</td></tr><tr><td class="line-number" value="5866"></td><td class="line-content">        preloadedGeneratorData_new.outputTemplate = editors.filter(e =&gt; e.main &amp;&amp; e.type=="html")[0].textArea.value;</td></tr><tr><td class="line-number" value="5867"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5868"></td><td class="line-content">        let importedGenerators_new = JSON.parse(JSON.stringify(importedGenerators));</td></tr><tr><td class="line-number" value="5869"></td><td class="line-content">        for(let editor of editors) {</td></tr><tr><td class="line-number" value="5870"></td><td class="line-content">          if(editor.main) continue;</td></tr><tr><td class="line-number" value="5871"></td><td class="line-content">          importedGenerators_new.filter(e =&gt; e.name===editor.name)[0].modelText = editor.textArea.value;</td></tr><tr><td class="line-number" value="5872"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5873"></td><td class="line-content">        let text = originalHtmlText;</td></tr><tr><td class="line-number" value="5874"></td><td class="line-content">        text = text.replace(/(&lt;script id="preloaded-generator-data"[^&gt;]*&gt;)(.+?)(&lt;\/script&gt;)/, `$1${encodeURI(JSON.stringify(preloadedGeneratorData_new))}$3`);</td></tr><tr><td class="line-number" value="5875"></td><td class="line-content">        text = text.replace(/(&lt;script id="imported-generators"[^&gt;]*&gt;)(.+?)(&lt;\/script&gt;)/, `$1${encodeURI(JSON.stringify(importedGenerators_new))}$3`);</td></tr><tr><td class="line-number" value="5876"></td><td class="line-content">        // TODO: Add `imported-generator-names` when you've added the ability to add more generators.</td></tr><tr><td class="line-number" value="5877"></td><td class="line-content">        saveTextFile(text, preloadedGeneratorData_new.name+".html");</td></tr><tr><td class="line-number" value="5878"></td><td class="line-content">      };</td></tr><tr><td class="line-number" value="5879"></td><td class="line-content">      editorCtn.querySelector(".save-button").onclick = saveGenerator;</td></tr><tr><td class="line-number" value="5880"></td><td class="line-content">      document.addEventListener("keydown", function(e) {</td></tr><tr><td class="line-number" value="5881"></td><td class="line-content">        if(e.key === 's' &amp;&amp; (navigator.platform.match("Mac") ? e.metaKey : e.ctrlKey)) {</td></tr><tr><td class="line-number" value="5882"></td><td class="line-content">          e.preventDefault();</td></tr><tr><td class="line-number" value="5883"></td><td class="line-content">          saveGenerator();</td></tr><tr><td class="line-number" value="5884"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="5885"></td><td class="line-content">      }, false);</td></tr><tr><td class="line-number" value="5886"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5887"></td><td class="line-content">      for(let editor of editors) {</td></tr><tr><td class="line-number" value="5888"></td><td class="line-content">        let textArea = document.createElement("textarea");</td></tr><tr><td class="line-number" value="5889"></td><td class="line-content">        textArea.style.cssText = `width:100%; height:100%; display:${editor.visible ? "block" : "none"}; white-space:pre; font-family:monospace; tab-size:2;`;</td></tr><tr><td class="line-number" value="5890"></td><td class="line-content">        textArea.value = editor.content;</td></tr><tr><td class="line-number" value="5891"></td><td class="line-content">        editorCtn.querySelector(".body").appendChild(textArea);</td></tr><tr><td class="line-number" value="5892"></td><td class="line-content">        editor.textArea = textArea;</td></tr><tr><td class="line-number" value="5893"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5894"></td><td class="line-content">        // TODO: Handle resizing of the editor properly:</td></tr><tr><td class="line-number" value="5895"></td><td class="line-content">        // new ResizeObserver(resizeHandler).observe(textArea)</td></tr><tr><td class="line-number" value="5896"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5897"></td><td class="line-content">        let tabButton = document.createElement("button");</td></tr><tr><td class="line-number" value="5898"></td><td class="line-content">        tabButton.innerHTML = `${editor.name}${editor.type=="html" ? " (html)" : ""}`;</td></tr><tr><td class="line-number" value="5899"></td><td class="line-content">        tabButton.style.cssText = `width:max-content; ${editor.main ? "font-weight:bold;" : ""} ${editor.visible ? "color:green;" : ""}`;</td></tr><tr><td class="line-number" value="5900"></td><td class="line-content">        tabButton.onclick = () =&gt; {</td></tr><tr><td class="line-number" value="5901"></td><td class="line-content">          editors.forEach(e =&gt; e.textArea.style.display="none");</td></tr><tr><td class="line-number" value="5902"></td><td class="line-content">          editors.forEach(e =&gt; e.tabButton.style.color="");</td></tr><tr><td class="line-number" value="5903"></td><td class="line-content">          textArea.style.display = "block";</td></tr><tr><td class="line-number" value="5904"></td><td class="line-content">          tabButton.style.color = "green";</td></tr><tr><td class="line-number" value="5905"></td><td class="line-content">        };</td></tr><tr><td class="line-number" value="5906"></td><td class="line-content">        editorCtn.querySelector(".tabs").appendChild(tabButton);</td></tr><tr><td class="line-number" value="5907"></td><td class="line-content">        editor.tabButton = tabButton;</td></tr><tr><td class="line-number" value="5908"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="5909"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5910"></td><td class="line-content">      document.body.appendChild(editorCtn);</td></tr><tr><td class="line-number" value="5911"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5912"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="5913"></td><td class="line-content">  <span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="5914"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5915"></td><td class="line-content"><span class="html-tag">&lt;/head&gt;</span></td></tr><tr><td class="line-number" value="5916"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5917"></td><td class="line-content"><span class="html-tag">&lt;body <span class="html-attribute-name">id</span>="<span class="html-attribute-value">output-container</span>"&gt;</span><span class="html-tag">&lt;script <span class="html-attribute-name">defer</span> <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" rel="noreferrer noopener">https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015</a>" <span class="html-attribute-name">integrity</span>="<span class="html-attribute-value">sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==</span>" <span class="html-attribute-name">data-cf-beacon</span>='<span class="html-attribute-value">{"rayId":"8bfc7a96197a0615","serverTiming":{"name":{"cfL4":true}},"version":"2024.8.0","token":"fc685cb0ca0145b3acbca350b7d29943"}</span>' <span class="html-attribute-name">crossorigin</span>="<span class="html-attribute-value">anonymous</span>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="5918"></td><td class="line-content"><span class="html-tag">&lt;/body&gt;</span></td></tr><tr><td class="line-number" value="5919"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="5920"></td><td class="line-content"><span class="html-tag">&lt;/html&gt;</span></td></tr><tr><td class="line-number" value="5921"></td><td class="line-content"><span class="html-end-of-file"></span></td></tr></tbody></table></body></html>